!function(){"use strict";var e=function(){console.log("domLoad:components")};function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?u(e):t}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return h(this,n)}}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){i=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(i)throw r}}return n}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var y=function(){function e(t){n(this,e),this.target=t,this.$slide=this.target.closest(".slide"),this.lang=document.documentElement.getAttribute("lang"),HISTORYLAB.import.done||(this.$slide&&(this.$buttonFeedback=this.$slide.querySelector("[data-feedback-button]"),this.$buttonFeedback&&(this.$buttonFeedbackText=this.$buttonFeedback.querySelector("span"))),this.showFeedback=this.showFeedback.bind(this))}return i(e,[{key:"showFeedback",value:function(){this.$buttonFeedback&&this.$buttonFeedback.classList.contains("button-hidden")&&this.$buttonFeedback.classList.remove("button-hidden")}},{key:"hideFeedback",value:function(){this.$buttonFeedback.classList.add("button-hidden")}}]),e}(),b=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$element=document.querySelector("[data-lupa]"),i.$canvas=document.querySelector("[data-lupa-canvas]"),i.ctx=i.$canvas.getContext("2d"),i._onStart=i._onStart.bind(u(i)),i._onMove=i._onMove.bind(u(i)),i._onEnd=i._onEnd.bind(u(i)),i._update=i._update.bind(u(i)),i._onResize=i._onResize.bind(u(i)),i.zoomGlassSize=230,i.targetBCR=null,i.zoomed=0,i.targetZoomed=0,i.x=0,i.y=0,i.trackingTouch=!1,i._addEventListeners(),i._initCanvas(),i._onResize(),window.requestAnimationFrame(i._update),i}return i(a,[{key:"_initCanvas",value:function(){var e=this.zoomGlassSize,t=this.zoomGlassSize,n=window.devicePixelRation||1;this.$canvas.width=e*n,this.$canvas.height=t*n,this.$canvas.style.width="".concat(e,"px"),this.$canvas.style.height="".concat(t,"px"),this.ctx.scale(n,n)}},{key:"_onResize",value:function(){this.targetBCR=this.target.getBoundingClientRect()}},{key:"_onStart",value:function(e){e.target===this.target&&(e.preventDefault(),this.x=e.pageX||e.touches[0].pageX,this.y=e.pageY||e.touches[0].pageY,this.trackingTouch=!0,this.targetZoomed=1,this.zoomed=0,window.requestAnimationFrame(this._update))}},{key:"_onMove",value:function(e){this.trackingTouch&&(this.x=e.pageX||e.touches[0].pageX,this.y=e.pageY||e.touches[0].pageY)}},{key:"_onEnd",value:function(){this.targetZoomed&&this.showFeedback(),this.targetZoomed=0,this.trackingTouch=!1}},{key:"_update",value:function(){var e=2*Math.PI,t=100*this.zoomed;this.targetBCR=this.target.getBoundingClientRect();var n=Math.max(0,Math.min(1,(this.x-this.targetBCR.left)/this.targetBCR.width)),a=Math.max(0,Math.min(1,(this.y-this.targetBCR.top)/this.targetBCR.height)),i=2.5*this.targetBCR.width,r=2.5*this.targetBCR.height;platform.os.family.indexOf("Windows")>-1&&platform.name.indexOf("Firefox")>-1||(this.ctx.shadowColor="rgba(0,0,0,0.4)",this.ctx.shadowBlur=12,this.ctx.shadowOffsetY=8),this.ctx.clearRect(0,0,this.zoomGlassSize,this.zoomGlassSize),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(this.zoomGlassSize/2,this.zoomGlassSize-10-t,t,0,e),this.ctx.closePath(),this.ctx.fill(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.zoomGlassSize/2,this.zoomGlassSize-10-(t+1),1.03*t,0,e),this.ctx.clip(),this.ctx.closePath(),this.ctx.drawImage(this.target,-n*i+this.zoomGlassSize/2,-a*r+this.zoomGlassSize/2,i,r),this.ctx.restore(),this.$element.style.transform="translate(".concat(this.x,"px, ").concat(this.y,"px)"),this.zoomed+=(this.targetZoomed-this.zoomed)/4,this.zoomed>.001?window.requestAnimationFrame(this._update):this.zoomed=0}},{key:"_addEventListeners",value:function(){document.addEventListener("touchstart",this._onStart),document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onEnd),document.addEventListener("mousedown",this._onStart),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onEnd),window.addEventListener("resize",this._onResize)}}]),a}(y);function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a={bubbles:!0},i=Object.assign(a,t);return new CustomEvent(e,o({detail:n},i))}function w(e,t,n,a){var i=k(t,n,a);e.dispatchEvent(i)}function $(e){return e&&"object"===t(e)&&!Array.isArray(e)}function x(e,t){t.parentNode.insertBefore(e,t)}function E(e,t){t.parentNode.insertBefore(e,t.nextSibling)}function C(e){e.parentNode.removeChild(e)}function S(e){var t=[];return t="Firefox"===platform.name&&d3.event.target.closest(".half-slide-active")?[d3.event.offsetX,d3.event.offsetY]:d3.mouse(e),{x:d3.format(".0f")(t[0]),y:d3.format(".0f")(t[1])}}function A(e){var t=new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform),n=document.body;window.pageYOffset||n.scrollTop,window.pageXOffset||n.scrollLeft;return{left:e.offsetLeft+t.m41,top:e.offsetTop+t.m42}}function T(e){var t=e.getBoundingClientRect(),n=document.body,a=window.pageYOffset||n.scrollTop,i=window.pageXOffset||n.scrollLeft;return{left:t.left+i,top:t.top+a,height:t.height,width:t.width}}function _(e,t){L(e,t)?N(e,t):M(e,t)}function L(e,t){return!(!e||!t)&&(e.classList?e.classList.contains(t):"".concat(e.className," ").indexOf("".concat(t," "))>-1)}function M(e,t){var n=e,a=t;if(n&&a)if("string"==typeof n?n=document.querySelectorAll(n):n.tagName&&(n=[n]),"string"==typeof a){a=a.split(" ");for(var i=0;i<n.length;i+=1){var r;if(n[i].classList)(r=n[i].classList).add.apply(r,m(a));else if(!L.apply(void 0,[n[i]].concat(m(a))))for(var s=0;s<a.length;s+=1)n[i].classes+=" ".concat(a[s])}}else console.log("Class argument must be string with spaces in between class names.")}function N(e,t){var n=e,a=t;if(n&&a)if("string"==typeof n?n=document.querySelectorAll(n):n.tagName&&(n=[n]),"string"==typeof a){a=a.split(" ");for(var i=0;i<n.length;i+=1){var r;if(n[i].classList)(r=n[i].classList).remove.apply(r,m(a));else for(var s=0;s<a.length;s+=1)n[i].className=n[i].className.replace(new RegExp("\\b".concat(t[s],"\\b"),"g"),"")}}else console.log("Class argument must be string with spaces in between class names.")}var I={playchange:k("playchange"),timechange:k("timechange"),canplaystart:k("canplaystart")};function q(e){e.forEach((function(e){var t=e.querySelector("audio")||e.querySelector("video");t&&!t.paused&&(t.pause(),e.querySelector("[data-player-control]").setAttribute("data-player-control","paused"))}))}function F(e){var t={seconds:Math.floor(e),minutes:Math.floor(e/60)};return t.seconds=(t.seconds-60*t.minutes).toString(10),"".concat(t.minutes,":").concat("0".concat(t.seconds).slice(-2))}var R=function(e){c(a,e);var t=g(a);function a(e){return n(this,a),t.call(this,e)}return i(a,null,[{key:"addEventListeners",value:function(e,t){var n=document.querySelectorAll("[data-player-audio]"),a=e.querySelector("audio"),i=e.querySelector("[data-player-control]"),r=e.querySelector("[data-audio-time-left]");i.addEventListener("click",(function(e){"paused"===i.getAttribute("data-player-control")?(q(n),a.play(),i.setAttribute("data-player-control","playing")):(a.pause(),i.setAttribute("data-player-control","paused")),t(),e.stopPropagation()}),!1),i.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),a.addEventListener("timeupdate",(function(){r.innerText=F(a.currentTime)})),a.addEventListener("ended",(function(){i.setAttribute("data-player-control","paused")}))}}]),a}(y),D=function(){function e(){n(this,e)}return i(e,null,[{key:"start",value:function(e){d3.select(e).raise().classed("is-dragged",!0)}},{key:"dragged",value:function(e,t){d3.select(e).attr("x",(d3.event.x-t.x).toFixed()).attr("y",(d3.event.y-t.y).toFixed())}},{key:"end",value:function(e,t,n){d3.select(e).attr("x",(d3.event.x-n.x).toFixed()).attr("y",(d3.event.y-n.y).toFixed()).classed("is-dragged",!1)}}]),e}(),O=function(){function e(){n(this,e)}return i(e,null,[{key:"renderPath",value:function(t,n){if("image"===d3.event.sourceEvent.target.nodeName){var a=d3.line().curve(d3.curveLinear),i=d3.format(".0f"),r=d3.event.subject,s=i(d3.event.x),o=i(d3.event.y),c="".concat(t.id,"_path-").concat(s,"-").concat(o),l=d3.select("#".concat(t.id," .svg-view")).append("svg:path").attr("data-svg-path","").attr("class","svg-path").attr("id",c).datum(r);d3.event.on("drag",(function(){var e=i(d3.event.x),t=i(d3.event.y),n=e-s,c=t-o;n*n+c*c>300?r.push([s=e,o=t]):r[r.length-1]=[e,t],l.attr("d",a)})).on("end",(function(){var e=d3.select("#".concat(c));e&&(e.attr("d")?e.attr("d").length<40?e.remove():w(document,"svg.change",{},{svg:{id:t.id,task:"create",node:e.node(),nodeName:e.node().nodeName,contextMenu:!1}}):e.attr("d")||e.remove()),n()})),e.pathEventsManager(t,d3.select("#".concat(c)).node())}}},{key:"createCircle",value:function(t,n){var a=d3.select("#".concat(t.id," .svg-view")),i=S(t),r="".concat(t.id,"_circle-").concat(i.x,"-").concat(i.y),s=(a.append("svg:foreignObject").attr("data-svg-circle","").attr("id",r).attr("x",i.x).attr("y",i.y).attr("width",1).attr("height",1).append("xhtml:div").attr("class","svg-circle ".concat(n)),document.querySelector("#".concat(r)));e.circleEventsManager(t,s),w(document,"svg.change",{},{svg:{id:t.id,task:"create",node:s,nodeName:s.nodeName,contextMenu:!1}})}},{key:"pathEventsManager",value:function(e,t){d3.select("#".concat(t.id)).on("click",(function(){w(document,"svg.change",{},{svg:{id:e.id,task:"remove",node:d3.event.target,nodeName:d3.event.target.nodeName,contextMenu:!1}}),d3.select("#".concat(t.id)).remove(),d3.event.preventDefault()}),!1)}},{key:"circleEventsManager",value:function(e,t){var n=document.querySelector("#".concat(e.id," .svg-view")),a=[t.getAttribute("x"),t.getAttribute("y")],i={},r=d3.selectAll("#".concat(t.id," > div"));d3.select(r.nodes()[0]).on("click",(function(){w(document,"svg.change",{},{svg:{id:e.id,task:"remove",node:t,nodeName:t.nodeName,contextMenu:!1}});var n=t.id.split("_");"dropItem"===n[n.length-1]&&w(document,"svg.drop.delete",{},{item:{id:n[1],$object:t.firstChild}}),d3.event.target.closest("foreignObject").remove()})).call(d3.drag().container(n).subject(t).on("start",(function(){i={x:d3.event.x-a[0],y:d3.event.y-a[1]},D.start(t)})).on("drag",(function(){D.dragged(t,i)})).on("end",(function(){var n=a[0],r=a[1],s="move";D.end(t,"circle",i),a=[t.getAttribute("x"),t.getAttribute("y")],z.removeCloneConnectionManager(t)&&(s="create"),a[0]===n&&a[1]===r||w(document,"svg.change",{},{svg:{id:e.id,task:s,node:t,nodeName:t.nodeName,contextMenu:!1}})})))}}]),e}(),P=function(){function e(){n(this,e)}return i(e,null,[{key:"createText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:333,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=document.querySelector('[data-svg-active="true"]'),i=a.id,r=d3.select(a).select(".svg-view"),s=document.querySelector("[data-radial-menu]"),o={x:s.getAttribute("data-local-x"),y:s.getAttribute("data-local-y")},c="".concat(i,"_svg-text-").concat(o.x,"-").concat(o.y),l="#".concat(c),d={x:r.attr("width")-o.x>320?"right":"left",y:r.attr("height")-o.y>60?"bottom":"top"},u=r.append("svg:foreignObject").attr("class","svg-text orientation-".concat(d.x," orientation-").concat(d.y)).attr("data-svg-text","").attr("x",o.x).attr("y",o.y).attr("width",1).attr("height",1);u.append("xhtml:div").attr("class","svg-circle svg-circle-text");var h=u.append("xhtml:textarea").attr("maxlength",t).attr("tabindex","-1").attr("id",c).attr("class","svg-textarea").attr("data-save","").attr("data-svg-textarea-target",i);a.querySelector(l).focus(),e.textEventsManager(a,h.node(),!0,n)}},{key:"textEventsManager",value:function(t,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=t.querySelector(".svg-view"),s="#".concat(n.id),o=a,c=n.value,l=t.querySelector(s).parentElement,d=[l.getAttribute("x"),l.getAttribute("y")],u={};d3.select(s).call(d3.drag().container(r).subject(l).on("start",(function(){u={x:d3.event.x-d[0],y:d3.event.y-d[1]},D.start(l)})).on("drag",(function(){D.dragged(l,u)})).on("end",(function(){var e=d[0],n=d[1],a="move";D.end(l,"text",u),d=[l.getAttribute("x"),l.getAttribute("y")],o||d[0]===e&&d[1]===n||(z.removeCloneConnectionManager(l.childNodes[1])&&(a="create"),w(document,"svg.change",{},{svg:{id:t.id,task:a,node:l.childNodes[1],nodeName:l.childNodes[1].nodeName,contextMenu:!1}}))}))).on("keyup",(function(){e.updateTextareaHeight(d3.event.target)})).on("blur",(function(){var e,n=d3.event.target,a=n.value,r=!1;0!==a.length?(a.length<i?(M(n,"is-wrong"),r=!0):a.length>=i&&L(n,"is-wrong")&&(N(n,"is-wrong"),r=!1),c!==a&&(o?(e="create",o=!1):e="change",c=a,z.removeCloneConnectionManager(n)&&(e="create"),w(document,"svg.change",{},{svg:{id:t.id,task:e,node:n,nodeName:n.nodeName,isWrong:r,contextMenu:!1}})),c=a):z.removeItem(!1,s)})).on("focus",(function(){d3.select(l).raise()}))}},{key:"updateTextareaHeight",value:function(e){e.style.height="1px",e.style.height="".concat(22+e.scrollHeight,"px")}},{key:"comicBubblesEventsManager",value:function(t,n){var a=!0,i=n.value;d3.select(n).on("keyup",(function(){e.updateTextareaHeight(d3.event.target)})).on("blur",(function(){var e,n=d3.event.target,r=n.value;i!==r&&(a?(e="create",a=!1):(e="change",0===r.length&&(a=!0)),i=r,z.removeCloneConnectionManager(n)&&(e="create"),w(document,"svg.change",{},{svg:{id:t.id,task:e,node:n,nodeName:n.nodeName,isBubble:!0,contextMenu:!1}})),i=r}))}}]),e}(),z=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$canvas=i.target.querySelector(".svg-view"),i.format=d3.format(".0f"),i._setSize(),i.init(),i._initWhenDone(),i}return i(a,[{key:"init",value:function(){if(!HISTORYLAB.import.done){this.toDuplicate=this.target.getAttribute("data-duplicate-svg");for(var e=this.target.getAttribute("data-svg-target").split(" "),t=this.target.getAttribute("data-svg-colors"),n=t?t.split(" ")[0]:"blue",a=0;a<e.length;a+=1)"kresleni"===e[a]?this._initPath(this.showFeedback):"znacky"===e[a]&&this._initCircle(this.showFeedback,n);this._initComicBubbles(),this._getEvents(),this._getDropEvent()}}},{key:"_initWhenDone",value:function(){HISTORYLAB.import.done&&d3.selectAll("[data-svg-text] textarea").on("mouseenter",(function(){d3.select(this.closest("foreignObject")).raise()}))}},{key:"_setSize",value:function(){var e=this.target.getAttribute("viewBox").split(" "),t=this.target.getBoundingClientRect(),n=window.innerWidth,a=.9*window.innerHeight,i=function(){return t.height?t.height>e[3]?e[3]:t.height:e[3]},r=(i()>a?a:i())/e[3],s=e[2]*r,o=r?"".concat(s<n?s:n,"px"):"";this.target.style.maxWidth=o,this.target.getAttribute("data-svg-drop")&&!this.target.closest(".layout-vertical")&&(this.target.closest(".svgs-container").style.maxWidth=o)}},{key:"_initPath",value:function(e){var t=this;d3.select(this.target).call(d3.drag().container((function(){return t.target})).subject((function(){var e=[d3.event.x.toFixed(),d3.event.y.toFixed()];return[e,e]})).on("start",(function(){O.renderPath(t.target,e)})))}},{key:"_initCircle",value:function(e,t){var n=this;d3.select(this.target).on("click",(function(){"image"===d3.event.target.nodeName&&(O.createCircle(n.target,t),e(),d3.event.preventDefault())}),!1)}},{key:"_initComicBubbles",value:function(){var e=this,t=this.target.querySelectorAll(".svg-komiks .svg-textarea");t&&t.forEach((function(t){P.comicBubblesEventsManager(e.target,t)}))}},{key:"_generateNewID",value:function(e){var t=e.split("_");return t.length<2?(console.log("Svg ID error!",e),e):(t[t.length-1]!=="clone-".concat(t[0])&&t.push("clone-".concat(t[0])),t[0]=this.target.id,t.join("_"))}},{key:"_getEvents",value:function(){var e=this,t=this.toDuplicate?this.toDuplicate.split(" "):[];t[0]&&document.addEventListener("svg.change",(function(n){if(t.includes(n.detail.svg.id)){var a,i=n.detail.svg.node,r=n.detail.svg.nodeName,s=e._generateNewID(i.id),o=e.target.querySelector("#".concat(s));if(!o&&"create"!==n.detail.svg.task)return;if(a=n.detail.svg.task,"path"===r)switch(a){case"create":e._clonePath(i,s);break;case"color":N(o,"red blue"),M(o,n.detail.svg.color);break;case"remove":o.remove();break;default:console.log("Nondefinated path events task. :(")}else if("TEXTAREA"===r)if(n.detail.svg.isBubble)switch(a){case"create":e._cloneComicBubbles(i,s);break;case"change":0!==i.value.length?(o.value=i.value,o.style.height!==i.style.height&&(o.style.height=i.style.height)):o.parentElement.remove();break;default:console.log("Nondefinated comicBubble events task. :(")}else switch(a){case"create":e._cloneTextField(n.detail.svg.isWrong,i,s);break;case"change":o.value=i.value,n.detail.svg.isWrong?M(o,"is-wrong"):N(o,"is-wrong"),o.style.height!==i.style.height&&(o.style.height=i.style.height);break;case"color":N(o=o.parentElement.childNodes[0],"red blue"),M(o,n.detail.svg.color);break;case"move":o&&o.parentElement.remove(),e._cloneTextField(n.detail.svg.isWrong,i,s);break;case"remove":o.parentElement.remove();break;default:console.log("Nondefinated textField events task. :(")}else if("foreignObject"===r)switch(a){case"create":e._cloneCircle(i,s);break;case"color":N(o=o.childNodes[0],"red blue"),M(o,n.detail.svg.color);break;case"move":o&&o.remove(),e._cloneCircle(i,s);break;case"remove":o.remove();break;default:console.log("Nondefinated circle events task. :(")}else console.log("Nondefinated events nodeName. :(",r);w(document,"svg.change",{},{svg:{id:e.target.id,task:n.detail.svg.task,node:i,nodeName:r,contextMenu:!1}})}}))}},{key:"_getDropEvent",value:function(){var e=this,t=0;document.addEventListener("svg.drop",(function(n){if(n.detail.svg.id===e.target.id){var a=n.detail.svg,i=a.$node,r=a.position,s=a.type,o=a.size,c="image"===s||"svg"===s?.62:"tag"===s?1.075:1;o.width=o.width*c,o.height=o.height*c;var l=d3.select("#".concat(e.target.id," .svg-view")).append("svg:foreignObject").attr("width",o.width).attr("height",o.height).attr("x",e.format(r[0]-o.width/2)).attr("y",e.format(r[1]-o.height/2)).attr("id","".concat(e.target.id,"_").concat(i.getAttribute("data-id"),"_").concat(t,"_dropItem")),d=document.createElement("div");d.classList.add("dropped__item","dropped__item--".concat(s)),d.appendChild(i.firstElementChild.firstElementChild),l.append((function(){return d}));var u=l.node();t+=1,O.circleEventsManager(e.target,u),w(document,"svg.change",{},{svg:{id:e.target.id,task:"create",node:u,nodeName:u.nodeName,contextMenu:!1}})}}))}},{key:"_clonePath",value:function(e,t){var n=e.cloneNode(!0);n.id=t,this.$canvas.appendChild(n),O.pathEventsManager(this.target,n)}},{key:"_cloneTextField",value:function(e,t,n){var a=t.parentElement.cloneNode(!0);a.childNodes[1].id=n,this.$canvas.appendChild(a),e?M(a,"is-wrong"):N(a,"is-wrong"),P.textEventsManager(this.target,a.childNodes[1],!1)}},{key:"_cloneCircle",value:function(e,t){var n=e.cloneNode(!0);n.id=t,this.$canvas.appendChild(n),O.circleEventsManager(this.target,n)}},{key:"_cloneComicBubbles",value:function(e,t){var n=e.parentElement.cloneNode(!0);n.childNodes[1].id=t,this.$canvas.appendChild(n),P.comicBubblesEventsManager(this.target,n.childNodes[1])}}],[{key:"selectItem",value:function(e){e.setAttribute("data-svg-selected","true")}},{key:"deselectItem",value:function(){for(var e=document.querySelectorAll('[data-svg-selected="true"]'),t=0;t<e.length;t+=1)e[t].setAttribute("data-svg-selected","false")}},{key:"removeItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'[data-svg-selected="true"]',n=document.querySelector(t),a=n.nodeName,i=n.parentElement;switch(a){case"path":case"TEXTAREA":break;case"DIV":a=(n=i.childNodes[1]?i.childNodes[1]:i).nodeName;break;default:console.log("Nondefinated node type. :(",a)}var r=n.id.split("_")[0];if(w(document,"svg.change",{},{svg:{id:r,task:"remove",node:n,nodeName:a,contextMenu:e}}),"foreignObject"===i.nodeName){d3.select(i).remove();var s=i.id.split("_");"dropItem"===s[s.length-1]&&w(document,"svg.drop.delete",{},{item:{id:s[1],$object:n.firstChild}})}else d3.select(n).remove()}},{key:"deactivate",value:function(){for(var e=document.querySelectorAll('[data-svg-active="true"]'),t=0;t<e.length;t+=1)e[t].setAttribute("data-svg-active","false")}},{key:"activate",value:function(e){a.deactivate(),e.setAttribute("data-svg-active","true")}},{key:"removeCloneConnectionManager",value:function(e){var t=e.id.split("_");return!!t[t.length-1].includes("clone")&&(t.pop(),e.id=t.join("_"),!0)}}]),a}(y),H=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$settings=document.querySelector('[data-sortable-id-reference="'.concat(i.target.id,'"]')),i.feedback=JSON.parse(i.$settings.getAttribute("data-module-zpetnavazba")),i.$container=i.target,i.$items=i.target.querySelectorAll("[data-sortable-drag]"),i.$droppables=i.target.querySelectorAll("[data-sortable-drop]"),i.$placeholder=function(){return document.querySelector("#sortable-placeholder")},i.$players=i.$container.querySelectorAll("[data-player-audio]"),i.$inheritors=document.querySelectorAll("[data-sortable-inheritor=".concat(i.target.id,"]")),i.inheritors=[],i.order=[],i.direction=i.target.getAttribute("data-sortable-target"),i.trackingTouch=!1,i.before=!1,i.after=!1,i.evaluation=void 0,i.mouse={x:function(e){return e.clientX||e.touches[0].clientX},y:function(e){return e.clientY||e.touches[0].clientY},x0:0,y0:0,x1:0,y1:0},i.dragged={el:null,clone:null,posRel:{},rect:function(){return i.dragged.el.getBoundingClientRect()},size:{},type:null},i.siblings={prev:null,next:null},i._onStart=i._onStart.bind(u(i)),i._onMove=i._onMove.bind(u(i)),i._onEnd=i._onEnd.bind(u(i)),i._update=i._update.bind(u(i)),i._setupInitialOrder(),i._setupInheritors(),i._addEventListeners(),i.cache={colors:[]},i.feedback&&(i.cache.colors=i.feedback.map((function(e){return e.barva}))),i}return i(a,[{key:"_onStart",value:function(e){e.target.hasAttribute("data-sortable-drag")&&(this.$players.length>0&&q(this.$players),this.trackingTouch=!0,this.dragged.el=e.target,this.dragged.type=e.target.getAttribute("data-sortable-drag"),this.dragged.clone=this.dragged.el.cloneNode(!0),this.dragged.posRel.top=this.dragged.el.offsetTop,this.dragged.posRel.left=this.dragged.el.offsetLeft,this.dragged.size.width=this.dragged.el.offsetWidth,this.dragged.size.height=this.dragged.el.offsetHeight,this.dragged.el.style.top="".concat(this.dragged.posRel.top,"px"),this.dragged.el.style.left="".concat(this.dragged.posRel.left,"px"),this.dragged.el.style.width="".concat(this.dragged.size.width,"px"),this.dragged.el.style.height="".concat(this.dragged.size.height,"px"),this.dragged.el.classList.add("is-dragged"),this.$container.classList.add("is-dragged"),this._addPlaceholder(this.dragged.el),this._onOver(),this.mouse.x0=this.mouse.x(e),this.mouse.y0=this.mouse.y(e),e.preventDefault())}},{key:"_onMove",value:function(e){this.trackingTouch&&(this.mouse.x1=this.mouse.x(e)-this.mouse.x0,this.mouse.y1=this.mouse.y(e)-this.mouse.y0,window.requestAnimationFrame(this._update),this._onOver())}},{key:"_onEnd",value:function(e){if(this.trackingTouch){this.trackingTouch=!1,this.$container.classList.remove("is-dragged"),this.dragged.el.classList.remove("is-dragged"),this.dragged.el.style.top="",this.dragged.el.style.left="",this.dragged.el.style.width="",this.dragged.el.style.height="",this.dragged.el.style.transform="";var t=this.$placeholder().getBoundingClientRect();switch(this.direction){case"horizontal":t.left<=this.mouse.x(e)<=t.right&&this._onDrop();break;case"vertical":t.top<=this.mouse.y(e)<=t.bottom&&this._onDrop()}this._removePlaceholder(),this._updateOrder(),this._updateOrderInInheritors(),this._dispatchEvent(),this._checkAndResolveFeedback()}}},{key:"_onOver",value:function(){if(this.before=!1,this.after=!1,this._getReference(),this.siblings.next&&this.siblings.next.hasAttribute("data-sortable-drop")){var e=this.siblings.next.getBoundingClientRect();switch(this.direction){case"horizontal":this.dragged.rect().right>e.left+e.width/1.5&&(this.after=!0,this._addPlaceholder(this.siblings.next));break;case"vertical":this.dragged.rect().bottom>e.top+e.height/1.5&&(this.after=!0,this._addPlaceholder(this.siblings.next))}}if(this.siblings.prev&&this.siblings.prev.hasAttribute("data-sortable-drop")){var t=this.siblings.prev.getBoundingClientRect();switch(this.direction){case"horizontal":this.dragged.rect().left<t.right-t.width/1.5&&(this.before=!0,this._addPlaceholder(this.siblings.prev));break;case"vertical":this.dragged.rect().top<t.bottom-t.height/1.5&&(this.before=!0,this._addPlaceholder(this.siblings.prev))}}}},{key:"_onDrop",value:function(){var e=this.$placeholder();this._addEventListenerToItem(this.dragged.clone),this.dragged.clone.querySelector("[data-player-audio]")&&R.addEventListeners(this.dragged.clone,this.showFeedback),this.$container.insertBefore(this.dragged.clone,e),this.dragged.el.parentElement.removeChild(this.dragged.el)}},{key:"_update",value:function(){this.dragged.el.style.transform="translate3d(".concat(this.mouse.x1,"px, ").concat(this.mouse.y1,"px, 0) rotate(5deg)")}},{key:"_addPlaceholder",value:function(e){this._removePlaceholder();var t=document.createElement("div");if(t.classList.add("sortable-item","sortable-placeholder"),t.setAttribute("id","sortable-placeholder"),t.style.minHeight="".concat(this.dragged.size.height,"px"),this.dragged.el.querySelector("img")){var n=this.dragged.el.querySelector("img").getAttribute("src"),a=document.createElement("img");a.setAttribute("src",n),t.appendChild(a)}this.after?this.$container.insertBefore(t,e.nextElementSibling):(this.before,this.$container.insertBefore(t,e))}},{key:"_removePlaceholder",value:function(){var e=this.$placeholder();e&&e.parentElement.removeChild(e)}},{key:"_getReference",value:function(){var e=this.$placeholder();this.siblings.prev=e.previousElementSibling===this.dragged.el?this.dragged.el.previousElementSibling:e.previousElementSibling,this.siblings.next=e.nextElementSibling===this.dragged.el?this.dragged.el.nextElementSibling:e.nextElementSibling}},{key:"_addEventListenerToItem",value:function(e){if(e.addEventListener("touchstart",this._onStart,!1),e.addEventListener("mousedown",this._onStart,!1),"svg"===this.dragged.type)new z(e.querySelector("[data-svg-target]"))}},{key:"_addEventListeners",value:function(){var e=this;document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onEnd),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onEnd),this.$items.forEach((function(t){e._addEventListenerToItem(t)}))}},{key:"checkIfTheArrayIsGood",value:function(e){return!e.some((function(e,t){return t!==e-1}))}},{key:"oneMove",value:function(e){if(this.checkIfTheArrayIsGood(e))return 0;for(var t=0;t<e.length;t+=1)if(e[t]!==t+1){var n=m(e),a=n[t];if(n.splice(t,1),n.splice(a-1,0,a),this.checkIfTheArrayIsGood(n))return 1}return 2}},{key:"_checkAndResolveFeedback",value:function(){if(this.feedback){var e,t=m(this.target.querySelectorAll("[data-sortable-drag]")).map((function(e){return parseInt(e.dataset.sortableSpravnaodpoved,10)})),n=0;2===this.feedback.length?this.checkIfTheArrayIsGood(t)||(n=1):n=this.oneMove(t);var a=this.feedback.find((function(e){return e.podminka===n}));(e=this.$buttonFeedback.classList).remove.apply(e,m(this.cache.colors)),this.$buttonFeedback.classList.add(a.barva),this.$buttonFeedbackText.innerText=a.text,this.evaluation=a.splneno}this.showFeedback()}},{key:"_setupInitialOrder",value:function(){this._updateOrder()}},{key:"_setupInheritors",value:function(){this.$inheritors.length>0&&(this.inheritors=Array.from(this.$inheritors).map((function(e){return{$inheritor:e,$container:e.querySelector("[data-sortable-inheritor-item]").parentElement}})))}},{key:"_updateOrder",value:function(){this.order=Array.from(this.target.querySelectorAll("[data-sortable-drag]")).map((function(e){return{id:parseInt(e.dataset.sortableIndex,10)}}))}},{key:"_updateOrderInInheritors",value:function(){var e=this;this.$inheritors.length>0&&this.inheritors.forEach((function(t){e.order.forEach((function(e){t.$container.appendChild(t.$container.querySelector('[data-sortable-inheritor-item="'.concat(e.id,'"]')))}))}))}},{key:"_dispatchEvent",value:function(){w(this.target,"sortable.change",{},{id:this.target.id,evaluation:this.evaluation,order:this.order})}}]),a}(y),B=function(){function e(t,a){n(this,e),this.$radialMenu=t,this.$radialMenuItems=this.$radialMenu.querySelectorAll("[data-radial-menu-item]"),this.$colorItems=this.$radialMenu.querySelectorAll(".radial-menu-color"),this.$textItems=this.$radialMenu.querySelectorAll(".radial-menu-text"),this.$createTextItem=this.$radialMenu.querySelector("#create-text"),this.$removeItem=this.$radialMenu.querySelector("#remove-content"),this.$tooltip=this.$radialMenu.querySelector("[data-radial-menu-tooltip]"),this.$svgs=a,this.initialSetUp=!0,this.menuRadius=parseInt(window.getComputedStyle(this.$radialMenu.querySelector(".radial-menu-wrapper"),null).getPropertyValue("width"),10)/2,this.itemRadius=parseInt(window.getComputedStyle(this.$radialMenu.querySelector(".radial-menu-item"),null).getPropertyValue("width"),10)/2,this.init()}return i(e,[{key:"init",value:function(){var e=this;this.setUpRadialMenuItems(),this.addEventListenersToRadialMenu(),this.$svgs.forEach((function(t){var n=t.getAttribute("data-svg-target").split(" "),a=t.getAttribute("data-svg-colors"),i=a?a.split(" "):void 0,r=n.includes("text"),s=i&&i.length>1||!a;d3.select(t).on("contextmenu",(function(){z.activate(t),z.deselectItem(),e.filterMenuButtons(d3.event.target,r,s),e.showRadialMenu(t,d3.event),d3.event.preventDefault()}))})),this.initialSetUp=!1}},{key:"setUpRadialMenuItems",value:function(){var e=this;this.$radialMenuItems.forEach((function(t){e.addEventListenersToRadialMenuItem(t)}))}},{key:"positionRadialMenuItems",value:function(e){var t=e.length,n=this.menuRadius,a=this.itemRadius,i=n-a,r=.6283185307,s=-r/2+t*r/2;e.forEach((function(e,t){var a=Math.PI+t*r*-1+s,o=n*Math.sin(a)+i,c=n*Math.cos(a)+i;e.style.left="".concat(o.toFixed(1),"px"),e.style.top="".concat(c.toFixed(1),"px")}))}},{key:"addEventListenersToRadialMenu",value:function(){var e=this;this.onMouseLeave(),this.$radialMenu.addEventListener("click",(function(t){e.hideRadialMenu(e.$radialMenu),t.preventDefault()})),this.$radialMenu.addEventListener("contextmenu",(function(t){e.hideRadialMenu(e.$radialMenu),t.preventDefault()}))}},{key:"addEventListenersToRadialMenuItem",value:function(t){var n=this,a=t,i=a.getAttribute("data-radial-menu-item");"remove-content"===i?a.addEventListener("click",(function(){z.removeItem(!0),n.hideRadialMenu()}),!1):"create-text"===i?d3.select(a).on("click",(function(){P.createText(),n.hideRadialMenu()}),!1):"color-point-blue"===i?a.addEventListener("click",(function(){e.changeColor("blue"),n.hideRadialMenu()}),!1):("color-point-red"===i||"color-point-red"===i)&&a.addEventListener("click",(function(){e.changeColor("red"),n.hideRadialMenu()}),!1),a.addEventListener("mouseenter",(function(e){n.$tooltip.innerHTML=e.currentTarget.getAttribute("data-radial-menu-item-tooltip"),n.$tooltip.style.display="block"}),!1),a.addEventListener("mouseleave",(function(){n.$tooltip.innerHTML="",n.$tooltip.style.display="none"}),!1)}},{key:"showRadialMenu",value:function(e,t){var n=e||document.querySelector('[data-svg-active="true"]'),a=function(e){return{x:e.pageX,y:e.pageY}}(t),i=S(n);this.$radialMenu.setAttribute("data-local-x",i.x),this.$radialMenu.setAttribute("data-local-y",i.y),this.$radialMenu.style.top="".concat(a.y-7,"px"),this.$radialMenu.style.left="".concat(a.x-7,"px");var r=this.$radialMenu.querySelectorAll(".is-active");this.positionRadialMenuItems(r),M(this.$radialMenu,"is-active")}},{key:"hideRadialMenu",value:function(){var e=this;N(this.$radialMenu,"is-active"),z.deactivate(),z.deselectItem(),setTimeout((function(){L(e.$radialMenu,"is-active")||e.$radialMenuItems.forEach((function(e){N(e,"is-active")}))}),150)}},{key:"onMouseLeave",value:function(){var e,t=this;this.$radialMenu.addEventListener("mouseleave",(function(){e=setTimeout((function(){t.hideRadialMenu(t.$radialMenu)}),500)})),this.$radialMenu.addEventListener("mouseenter",(function(){clearTimeout(e)}))}},{key:"filterMenuButtons",value:function(e,t,n){(L(e,"svg-path")||"path"===e.nodeName)&&(t?M(this.$createTextItem,"is-active"):N(this.$createTextItem,"is-active"),n&&this.$colorItems.forEach((function(e){M(e,"is-active")})),this.$textItems.forEach((function(e){N(e,"is-active")}))),L(e,"svg-circle")&&(t?M(this.$createTextItem,"is-active"):N(this.$createTextItem,"is-active"),n&&this.$colorItems.forEach((function(e){M(e,"is-active")})),this.$textItems.forEach((function(e){N(e,"is-active")}))),L(e,"svg-textarea")&&(N(this.$createTextItem,"is-active"),L(e,"do-not-remove")||(this.$colorItems.forEach((function(e){N(e,"is-active")})),this.$textItems.forEach((function(e){M(e,"is-active")})))),"image"===e.nodeName?(t?M(this.$createTextItem,"is-active"):N(this.$createTextItem,"is-active"),N(this.$removeItem,"is-active"),this.$colorItems.forEach((function(e){N(e,"is-active")})),this.$textItems.forEach((function(e){N(e,"is-active")}))):(L(e,"do-not-remove")?N(this.$removeItem,"is-active"):(t?M(this.$createTextItem,"is-active"):N(this.$createTextItem,"is-active"),M(this.$removeItem,"is-active")),z.selectItem(e))}}],[{key:"changeColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'[data-svg-selected="true"]',n=document.querySelector(t),a=n.nodeName,i="color";switch(N(n,"red blue"),M(n,e),a){case"path":break;case"DIV":a=(n=n.parentElement.childNodes[1]?n.parentElement.childNodes[1]:n.parentElement).nodeName;break;default:console.log("Nondefinated node type. :(",a)}z.removeCloneConnectionManager(n)&&(i="create");var r=n.id.split("_")[0];w(document,"svg.change",{},{svg:{id:r,task:i,node:n,nodeName:a,contextMenu:!0,color:e}})}}]),e}(),j=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$editor=i.target,i.id=i.$editor.id,i.settings=JSON.parse(document.querySelector('[data-editor-id-reference="'.concat(i.id,'"]')).getAttribute("data-module-settings")),i.opts=function e(t,n){var a=Object.assign({},t);return $(t)&&$(n)&&Object.keys(n).forEach((function(i){$(n[i])&&i in t?a[i]=e(t[i],n[i]):Object.assign(a,r({},i,n[i]))})),a}(a.defaults,i.settings),i.models={passive:["cteni"],interactive:["predznaceny","zvyraznovani","komentáře","psani"],withMenu:["predznaceny","zvyraznovani","komentáře"]},i.totalTagId=0,i.hasMenu=!0,i.selection=null,i.lastSelectionSettings={},i.isCollapsed=null,i.savedSelectionRange=null,i.selectionAttributes=null,i.dummyRangeElement=null,i.selectionMouseDown=!1,i.selectionDirection=null,i.hasEditableContentChanged=!1,i.lastPressedKey=null,i.hasToolbar=!1,i.toolbar={},i.originalContent={},i.currentContent={},i._handlers=[],i.wrapLastDeletesTimeoutClass="",i.wrapLastDeletesTimeoutFunction=function(){},i.wrapLastAdditionsTimeoutClass="",i.wrapLastAdditionsTimeoutFunction=function(){},i.isWrappingLastText=!1,i.isWriting=!1,i.$groupDeleted=null,i.cache={body:document.body,window:window},i.init(),i}return i(a,[{key:"init",value:function(){if(a._hasMenu(this.opts))try{this.$menu=this.$editor.querySelector(".".concat(this.opts.menuClass)),this.$menuActions=this.$menu.querySelector(".menu").querySelectorAll(".menu-item"),this.$menuClose=this.$menu.querySelector(".close")}catch(e){this.hasMenu=!1}else this.hasMenu=!1;a._hasToolbar(this.opts)&&(this.hasToolbar=!0),this.$canvas=this.$editor.querySelector(".".concat(this.opts.canvasClass)),"cteni"!==this.opts.funkce&&(M(this.$menu,"hidden"),"psani"===this.opts.funkce&&(this.originalContent.html=this.$canvas.innerHTML,this.originalContent.text=this.$canvas.innerText,this.currentContent.html=this.$canvas.innerHTML,this.currentContent.text=this.$canvas.innerText,this.wrapLastDeletesTimeoutClass=this._generateNewTagGroupClass(),this.wrapLastAdditionsTimeoutClass=this._generateNewTagGroupClass()),this.hasToolbar&&(this.toolbar.$element=this.$editor.querySelector(".editor-toolbar"),this.toolbar.$btnReset=this.toolbar.$element.querySelector(".editor-toolbar-action-reset")),this.registerEditableHandlers()),"predznaceny"===this.opts.funkce&&this.initPreHighlightedTextOptions()}},{key:"_generateNewTagId",value:function(){return this.totalTagId=this.totalTagId+1,"".concat(this.id,"-").concat(this.totalTagId)}},{key:"_generateNewTagGroupClass",value:function(){return this.totalTagId=this.totalTagId+1,"group-".concat(this.id,"-").concat(this.totalTagId)}},{key:"registerEditableHandlers",value:function(){var e=this;this.$canvas.addEventListener("mousedown",this.handlerFocus.bind(this),!1),this.$canvas.addEventListener("touchstart",this.handlerFocus.bind(this),!1),this.$canvas.addEventListener("focusout ",this.handlerFocus.bind(this),!1),this.cache.body.addEventListener("mouseup",this.handlerFocus.bind(this),!1),this.cache.body.addEventListener("touchend",this.handlerFocus.bind(this),!1),"psani"===this.opts.funkce&&this.$canvas.addEventListener("keydown",(function(t){var n,a=window.getSelection(),i=t.which||t.keyCode,r=t.key;if(e.showFeedback(),"Backspace"===r||"Delete"===r){if(a.rangeCount){window.clearTimeout(e.wrapLastDeletesTimeoutFunction);var s=a.getRangeAt(0),o=s.cloneRange();if(e.lastSelectionSettings.isCollapsed)try{o.setStart(s.startContainer,s.startOffset-1)}catch(t){o.setStart(s.startContainer,s.startOffset),o.collapse(!0)}else o.setStart(s.startContainer,s.startOffset);o.setEnd(s.endContainer,s.endOffset);var c=o.cloneContents().textContent.trim();if(""!==c&&"&nbsp;"!==c||e.isWrappingLastText){var l=document.createElement("span");l.className="user-removed-text-inner ".concat(e.wrapLastDeletesTimeoutClass),o.surroundContents(l),a.removeAllRanges(),a.addRange(s),e.wrapLastDeletesTimeoutFunction=setTimeout((function(){e.isWrappingLastText=!1;var t=document.createElement("span");t.contentEditable=!1,t.className="user-removed-text";var n=e._generateNewTagId();t.id=n;var a=document.querySelectorAll(".".concat(e.wrapLastDeletesTimeoutClass));x(t,a[0]),a.forEach((function(e,n){t.appendChild(e)}));var i=document.createElement("span");i.className=e.opts.closeBtnClass;i.addEventListener("click",function(t){var n=t.currentTarget.parentNode;e._removeNodeKeepTextContent(n),t.stopPropagation()}.bind(e)),document.getElementById(n).appendChild(i),e.wrapLastDeletesTimeout=!0,e.wrapLastDeletesTimeoutClass=e._generateNewTagGroupClass()}),700),e.isWrappingLastText=!0,t.preventDefault()}else{if(!e.isWrappingLastText)return;t.preventDefault()}}}else if((n=i)>47&&n<58||32==n||13==n||n>64&&n<91||n>95&&n<112||n>185&&n<193||n>218&&n<223)if(e.lastSelectionSettings.isCollapsed){if(32===i){if(!e.isWrappingLastText)return;r=" "}if(a.rangeCount){window.clearTimeout(e.wrapLastAdditionsTimeoutFunction);var d=a.getRangeAt(0),u=d.cloneRange();u.setStart(d.startContainer,d.startOffset),u.setEnd(d.endContainer,d.endOffset);var h=document.createElement("span");h.contentEditable=!1,h.className="user-inserted-text-inner ".concat(e.wrapLastAdditionsTimeoutClass),h.innerHTML=r,u.insertNode(h),d.setStartAfter(h),a.removeAllRanges(),a.addRange(d),e.wrapLastAdditionsTimeoutFunction=setTimeout((function(){e.isWrappingLastText=!1;var t=document.createElement("span");t.contentEditable=!1,t.className="user-inserted-text";var n=e._generateNewTagId();t.id=n;var a=document.querySelectorAll(".".concat(e.wrapLastAdditionsTimeoutClass));x(t,a[0]),a.forEach((function(e,n){t.appendChild(e)}));var i=document.createElement("span");i.className=e.opts.closeBtnClass;i.addEventListener("click",function(e){C(e.currentTarget.parentNode),e.stopPropagation()}.bind(e)),document.getElementById(n).appendChild(i),e.wrapLastAdditionsTimeoutClass=e._generateNewTagGroupClass()}),700),e.isWrappingLastText=!0}!1===e.hasEditableContentChanged&&(e.hasEditableContentChanged=!0),t.preventDefault()}else{window.clearTimeout(e.wrapLastAdditionsTimeoutFunction);var g=a.getRangeAt(0),v=g.cloneRange();if(v.setStart(g.startContainer,g.startOffset),v.setEnd(g.endContainer,g.endOffset),!1===e.isWriting&&a.toString().length>0){e.$groupDeleted=document.createElement("span"),e.$groupDeleted.contentEditable=!1,e.$groupDeleted.className="user-removed-text";var m=e._generateNewTagId();e.$groupDeleted.id=m;var f=document.createElement("span");f.className="user-removed-text-inner",e.$groupDeleted.appendChild(f),v.surroundContents(e.$groupDeleted);var p=document.createElement("span");p.className=e.opts.closeBtnClass;p.addEventListener("click",function(t){var n=t.currentTarget.parentNode;e._removeNodeKeepTextContent(n),t.stopPropagation()}.bind(e)),e.$groupDeleted.appendChild(p)}e.isWriting=!0;var y=document.createElement("span");y.contentEditable=!1,y.className="user-inserted-text-inner ".concat(e.wrapLastAdditionsTimeoutClass),y.innerHTML="".concat(r),x(y,e.$groupDeleted),g.setStartAfter(y),a.removeAllRanges(),a.addRange(g),e.wrapLastAdditionsTimeoutFunction=setTimeout((function(){e.isWriting=!1;var t=document.createElement("span");t.contentEditable=!1,t.className="user-inserted-text";var n=e._generateNewTagId();t.id=n;var a=document.querySelectorAll(".".concat(e.wrapLastAdditionsTimeoutClass));x(t,a[0]),a.forEach((function(e,n){t.appendChild(e)}));var i=document.createElement("span");i.className=e.opts.closeBtnClass;i.addEventListener("click",function(e){C(e.currentTarget.parentNode),e.stopPropagation()}.bind(e)),document.getElementById(n).appendChild(i),e.wrapLastAdditionsTimeoutClass=e._generateNewTagGroupClass()}),700),t.preventDefault()}})),this.hasMenu&&this.registerMenuHandler(),this.hasToolbar&&this.toolbar.$btnReset.addEventListener("click",(function(){confirm("Opravdu chcete vrátit text do původní podoby? Vaše změny se tímto ztratí.")&&(e.$canvas.innerHTML=e.originalContent.html)}))}},{key:"registerMenuHandler",value:function(){for(var e=0,t=this.$menuActions.length;e<t;e+=1)this.$menuActions[e].addEventListener("click",this.handlerMenuActions.bind(this),!1);this.$menuClose.addEventListener("click",this.handlerMenuClose.bind(this),!1)}},{key:"initPreHighlightedTextOptions",value:function(){var e=this;this.$textOptionsElements=this.$editor.querySelectorAll("[".concat("data-text-option","]")),this.$textOptionsElements.forEach((function(t){t.addEventListener("click",(function(){_(t,e.opts.textOptions.selectedClass);var n=e.id.replace("editor-","");if(L(t,e.opts.textOptions.selectedClass)){var a=JSON.parse(t.getAttribute("data-text-option"));w(document,"editor.change",{},{text:{id:n,task:"add",tagData:a,value:t.cloneNode(!0)}})}else w(document,"editor.change",{},{text:{id:n,task:"remove",value:t}});e.showFeedback()}))}))}},{key:"toggleMenu",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0!==e&&!0!==this.selectionMouseDown?L(this.$menu,"hidden")&&!1===this.selectionMouseDown&&(this._setmenuDimensions(),N(this.$menu,"hidden")):M(this.$menu,"hidden")}},{key:"_setmenuDimensions",value:function(){var e,t,n=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.cloneNode(!0);n.style.visibility="hidden",n.style.display="block",E(n,e);var a=n.getBoundingClientRect(),i=t?A(n):T(n);return C(n),{width:a.width,height:a.height,top:i.top,left:i.left}}(this.$menu),a=A(this.$editor),i=T(this.$editor),r=this.selectionAttributes.left+this.selectionAttributes.width+n.width+this.opts.menuMargin.x>a.left+i.width,s=this.selectionAttributes.top-n.height-this.opts.menuMargin.y<a.top;this.selectionAttributes.top,this.selectionAttributes.height,n.height,this.opts.menuMargin.y,a.top,i.height;e=r?this.selectionAttributes.left-n.width-this.opts.menuMargin.x:this.selectionAttributes.left+this.selectionAttributes.width+this.opts.menuMargin.x,t=s?this.selectionAttributes.top+n.height+this.opts.menuMargin.y:this.selectionAttributes.top-n.height-this.opts.menuMargin.y,this.$menu.style.left="".concat(e,"px"),this.$menu.style.top="".concat(t,"px")}},{key:"handlerMenuClose",value:function(e){this.toggleMenu(!0),e.preventDefault()}},{key:"handlerMenuActions",value:function(e){var t=e.currentTarget,n=t.getAttribute("data-command"),a=t.getAttribute("data-command-name"),i=JSON.parse(t.getAttribute("data-command-options"));this.setSelection(n,a,i),e.preventDefault()}},{key:"handlerFocus",value:function(e){null!==e.target.closest(".canvas")&&(3===e.which||L(e.target,"node-close")||L(e.target,"node-selected")||("mousedown"!==e.type&&"touchstart"!==e.type||(this.selectionMouseDown=!0,!0===this.hasMenu&&this.toggleMenu()),"mouseup"!==e.type&&"touchend"!==e.type||!this.selectionMouseDown||(e.preventDefault(),this.lastSelectionSettings={},this.selection=window.getSelection(),this.isCollapsed=this.selection.isCollapsed,this.lastSelectionSettings.isCollapsed=this.selection.isCollapsed,this.savedSelectionRange=this.selection.getRangeAt(0),this.selectionMouseDown=!1,this.lastSelectionSettings.anchorOffset=this.selection.anchorOffset,this.lastSelectionSettings.focusOffset=this.selection.focusOffset,this.lastSelectionSettings.text=this.savedSelectionRange.toString(),!1===this.selection.isCollapsed&&""!==this.savedSelectionRange.toString().trim()&&(this.selectionDirection=this.selection.anchorOffset<=this.selection.focusOffset?"right":"left",!0===this.hasMenu&&(this._setSelectionPosition(),this.toggleMenu())))))}},{key:"_setSelectionPosition",value:function(){var e=document.createElement("span");e.className="dummy-range-element",this.savedSelectionRange.surroundContents(e);var t=A(e),n=T(e);this.selectionAttributes={left:t.left,top:t.top,width:n.width,height:n.height},N(e,"dummy-range-element"),this._removeNodeKeepTextContent(e)}},{key:"_highlightContents",value:function(e,t){e.appendChild(this.savedSelectionRange.extractContents()),this.savedSelectionRange.insertNode(e),e.setAttribute("data-tag-id",t)}},{key:"_storeHighlightedContents",value:function(e,t){var n=e.getAttribute("data-command-name"),a=e.getAttribute("class").split(" "),i="";a.forEach((function(e){e.includes("node-text-")&&(i=e.replace("node-text-",""))}));var r=this.id.replace("editor-","");w(document,"editor.change",{},{text:{id:r,task:"add",tagData:{tagName:n},value:e.cloneNode(!0),tagColor:i}})}},{key:"_removeNodeKeepTextContent",value:function(e){var t=e.textContent;e.parentNode.insertBefore(document.createTextNode(t),e),C(e)}},{key:"_createCloseBtnForElement",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=document.createElement("span");a.innerHTML="×",a.setAttribute("class",n.class);n.toggleClass.split(" ");var i=function e(n){var a=n.currentTarget,i=a.parentNode;a.removeEventListener("click",e),i.removeChild(a),void 0!==i.commentRef&&(t.$editor.removeChild(i.commentRef),i.commentRef=null),t._removeNodeKeepTextContent(i);var r=i.getAttribute("data-command-name"),s=t.id.replace("editor-","");w(document,"editor.change",{},{text:{id:s,task:"remove",tagData:{tagName:r},value:i}}),n.stopPropagation()};a.addEventListener("click",i.bind(this)),e.appendChild(a)}},{key:"_calculateCommentPosition",value:function(e){var t=A(e);return{left:"".concat(t.left+parseInt(e.offsetWidth,10)+this.opts.commentMargin.x,"px"),top:"".concat(t.top+this.opts.commentMargin.y,"px")}}},{key:"_createCommentForNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.getElementById("comment-template").innerHTML,a=document.createElement("div");a.innerHTML=n;var i=a.childNodes[1];i.data={},i.data.nodeRef=e;var r=i.querySelector(".comment-new-text"),s=i.querySelector("button"),o=i.querySelector(".comments-container"),c=this._calculateCommentPosition(e);i.style.left=c.left,i.style.top=c.top,M(i,t.class),i.addEventListener("click",(function(t){L(t.target,"close")&&(M(i,"hidden"),N(e,"active"))})),s.addEventListener("click",(function(e){if(""!==r.value){var t=document.createElement("div");t.className="comment-item",t.innerText=r.value,o.appendChild(t),r.value=""}})),this.$editor.append(i),M(e,"comment-created"),e.commentRef=i}},{key:"_addCommentHandlerForElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};function n(n){if(!L(n.target,"node-close")){if(L(e,"comment-created")){var a=this._calculateCommentPosition(e);e.commentRef.style.left=a.left,e.commentRef.style.top=a.top,N(e.commentRef,"hidden")}else this._createCommentForNode(e,t);L(e,"active")?(N(e,"active"),M(e.commentRef,"hidden")):M(e,"active")}n.stopPropagation()}M(e,"has-comments"),e.addEventListener("click",n.bind(this))}},{key:"setSelection",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.selection){if("toggle-class"===e){var a=document.createElement("span");a.setAttribute("class",n.toggleClass),a.setAttribute("data-command-name",t);var i=this._generateNewTagId();this._highlightContents(a,i),!0===n.closeBtn&&this._createCloseBtnForElement(a,{class:"node-close",toggleClass:n.toggleClass}),!0===n.comments&&this._addCommentHandlerForElement(a,{class:n.commentsClass}),this._storeHighlightedContents(a,i),!0===n.showCommentsOnInit&&a.click()}this.toggleMenu(!0),this.showFeedback()}}}]),a}(y);j.defaults={menuClass:"contextual-menu-component",canvasClass:"canvas",resetBtnClass:"reset",closeBtnClass:"node-close",nodeSelectedClass:"node-selected",commentMargin:{x:50,y:0},menuMargin:{x:15,y:15},textOptions:{enable:!1,animatedClass:"active",selectedClass:"selected",deselectedClass:"deselected"}},j._hasMenu=function(e){return"cteni"!==e.funkce&&"psani"!==e.funkce&&!1!==e.menu&&void 0!==e.menu},j._hasToolbar=function(e){return"psani"===e.funkce||!1!==e.toolbar&&void 0!==e.toolbar};var W=function(e){c(a,e);var t=g(a);function a(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n(this,a),(i=t.call(this,e)).id=i.target.id,i.function=i.target.getAttribute("data-keywords")||"selekce-",i.$controls=i.target.querySelectorAll("[data-keywords-control]"),i.opts=o(o({},a.defaults),r),i.$itemsContainer=i.target.querySelector(".".concat(i.opts.itemsContainerClassName)),i.opts.inherit&&i.opts.inherit.from.length>0?i.isInherited=!0:i.$items=i.target.querySelectorAll(".".concat(i.opts.itemClassName)),i}return i(a,[{key:"init",value:function(){switch(this.function){case"selekce-":case"selekce+":this.opts.import&&this.opts.import.length>0&&(this.$itemsContainer.innerHTML=a._getHTMLFromItems(this.opts.import)),this.isInherited&&this.opts.inherit.onInit&&this._regenerateItemsContainerFromInherited(),this._registerHandlers();break;case"wordcloud":this.$items.forEach((function(e){e.setAttribute("data-keywords-item",0)})),this._changeSizeOfKeywordItem(this.opts.skala)}}},{key:"_changeSizeOfKeywordItem",value:function(e){var t=this;function n(t,n,a){var i=parseInt(t.getAttribute("data-keywords-item"),10),r=i+n,s=Math.abs(r)>e?i:r;t.setAttribute("data-keywords-item",s),a()}e=e?parseInt(e,10):4,this.$controls.forEach((function(e){var a=e.parentElement.parentElement;switch(e.getAttribute("data-keywords-control")){case"minus":e.addEventListener("click",(function(e){n(a,-1,t.showFeedback),e.preventDefault()}));break;case"plus":e.addEventListener("click",(function(e){n(a,1,t.showFeedback),e.preventDefault()}))}}))}},{key:"_regenerateItemsContainerFromInherited",value:function(){var e=this,t="";this.opts.inherit.from.forEach((function(n){var i=document.getElementById(n).querySelector(".".concat(e.opts.itemsContainerClassName)).innerHTML;t+=a.renameItemsIds(n,e.id,i)})),this.$itemsContainer.innerHTML=t,this.$items=this.target.querySelectorAll(".".concat(this.opts.itemClassName))}},{key:"_registerHandlers",value:function(){var e=this;this.$items.forEach((function(t){t.addEventListener("click",e._clickEventHandler.bind(e),!0),document.addEventListener("keyword.change",(function(n){e._dispatchEventHandler(n,t)}),!1)}))}},{key:"_clickEventHandler",value:function(e){"click"===e.type&&(_(e.currentTarget,"disabled"),w(document,"keyword.change",{},{keywords:{id:this.id,node:e.currentTarget}}),this.showFeedback())}},{key:"_dispatchEventHandler",value:function(e,t){var n=e.detail.keywords,a=n.id,i=n.node;if(this.isInherited&&this.opts.inherit.from.includes(a)){var r=t.id,s=i.id;r.replace(this.id,"")===s.replace(a,"")&&_(t,"disabled")}}}]),a}(y);W._getItemFromDOMElement=function(e){return{class:e.className,id:e.getAttribute("id"),text:e.innerText}},W._getItemsHTML=function(e){return e.innerHTML},W._getItemsFromHTML=function(e,t){var n=e.querySelectorAll(".".concat(t)),a=[];return n.forEach((function(e){a.push(W._getItemFromDOMElement(e))})),a},W._getDOMElementFromItem=function(e){var t=document.createElement("div");return t.setAttribute("class",e.class),t.setAttribute("id",e.id),t.innerHTML=e.text,function(e){if(e&&e.tagName){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}}(t)},W._getHTMLFromItems=function(e){var t="";return e.forEach((function(e){t+=W._getDOMElementFromItem(e)})),t},W.renameItemsIds=function(e,t,n){var a=new RegExp(e,"g");return n.replace(a,t)},W.defaults={itemsContainerClassName:"keywords-items-container",itemClassName:"keywords-item"};var G=function(e){c(a,e);var t=g(a);function a(e,i,r){var s;return n(this,a),(s=t.call(this,i)).id=e,s.opts=o(o({},a.defaults),r),s.$questions=s.target.querySelectorAll(".".concat(s.opts.itemClass)),s.cache={answersCorrect:0,colors:[],questions:[]},s.opts.zpetnaVazba&&(s.cache.colors=s.opts.zpetnaVazba.map((function(e){return e.barva}))),s}return i(a,[{key:"init",value:function(){this._registerHandlers()}},{key:"_registerHandlers",value:function(){var e=this;this.$questions.forEach((function(t,n){e.cache.questions.push({answered:!1});var a=parseInt(t.getAttribute("data-module-answer"),10),i=t.querySelectorAll(".".concat(e.opts.optionClass));i.forEach((function(t,r){t.addEventListener("click",(function(){var s=t;if(!s.classList.contains("selected")){if(i.forEach((function(t){return N(t,e.opts.selectedClass)})),_(s,e.opts.selectedClass),e.opts.zpetnaVazba){var o;r===a?e.cache.answersCorrect+=1:0!==e.cache.answersCorrect&&!0===e.cache.questions[n].answered&&(e.cache.answersCorrect-=1);var c=e.opts.zpetnaVazba.find((function(t){return t.podminka.includes(e.cache.answersCorrect)}));(o=e.$buttonFeedback.classList).remove.apply(o,m(e.cache.colors)),e.$buttonFeedback.classList.add(c.barva),e.$buttonFeedbackText.innerText=c.text}e.cache.questions[n].answered=!0,void 0===e.cache.questions.find((function(e){return!e.answered}))&&e.showFeedback()}}),!1)}))}))}}]),a}(y);G.defaults={itemClass:"test-quiz-item",optionClass:"option",selectedClass:"selected"};var V=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).target.addEventListener("click",(function(e){switch(i.$fullscreenContainer.innerHTML=i.target.nextElementSibling.outerHTML,i.$fullscreenTarget=i.$fullscreenContainer.firstElementChild,i.$fullscreenTarget.removeAttribute("style"),i.$fullscreenTarget.removeAttribute("id"),i.target.nextElementSibling.nodeName.toLowerCase()){case"img":setTimeout((function(){var e;(e=i.$fullscreenTarget.currentSrc,new Promise((function(t,n){var a=new Image;a.onload=function(){return t(a)},a.onerror=n,a.src=e}))).then((function(){i.image.width=i.$fullscreenTarget.naturalWidth,i.image.height=i.$fullscreenTarget.naturalHeight,i.image.ratio=i.image.width/i.image.height,i.setSize();new b(i.$fullscreenTarget)}))}),10);break;case"svg":var t=v(i.$fullscreenTarget.getAttribute("viewBox").split(" "),4);i.image.width=t[2],i.image.height=t[3],i.image.ratio=i.image.width/i.image.height,i.setSize();var n=i.$fullscreenTarget.querySelectorAll("textarea");n.length>0&&n.forEach((function(e){var t=e.id;e.removeAttribute("id"),e.value=document.getElementById(t).value,e.readOnly=!0}))}i.$fullscreen.classList.toggle("hidden"),i.showFeedback(),e.preventDefault(),e.stopPropagation()}),!1),i}return i(a,[{key:"setSize",value:function(){this.image.ratio>=this.window.ratio?(this.$fullscreenTarget.style.width="100%",this.$fullscreenTarget.style.height="auto"):(this.$fullscreenTarget.style.width="auto",this.$fullscreenTarget.style.height="".concat(this.window.height,"px"))}}]),a}(function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$fullscreen=document.querySelector('[data-fullscreen="fullscreen"]'),i.$fullscreenContainer=i.$fullscreen.querySelector('[data-fullscreen="container"]'),i.$fullscreenTarget=i.$fullscreen.querySelector('[data-fullscreen="target"]'),i.window={},i.image={},i.window.width=window.innerWidth,i.window.height=window.innerHeight,i.window.ratio=i.window.width/i.window.height,i}return a}(y)),Y=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$userTexts=i.$slide.querySelectorAll("[data-textarea-target]"),i.$counter=i.target.nextElementSibling.querySelector("[data-usertext-counter]"),i.$wrapper=i.$counter.parentElement,i.feedback=JSON.parse(i.target.getAttribute("data-feedback")),i.lengthExpected={min:parseInt("0"===i.target.getAttribute("minlength")?1:i.target.getAttribute("minlength"),10),avg:null,max:parseInt(i.target.getAttribute("maxlength")/2,10)},i.lengthExpected.avg=Math.floor((i.lengthExpected.max-i.lengthExpected.min)/4+i.lengthExpected.min),i.cache={answersCorrect:0,colors:["color-red","color-orange","color-green"],questions:[]},i.lastValue="",i.hadData=i.target.value&&i.target.value.length>0,i.wasUsed=!1,i.hadData&&i.updateCharacterCounter(),HISTORYLAB.import.done||(i.toDuplicate=i.target.getAttribute("data-duplicate-text"),i.textDuplicateSources=i.toDuplicate?i.toDuplicate.split(" "):[],i.getEvents(),i.addEventListeners()),i}return i(a,[{key:"updateCharacterCounter",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.target.value.length;(e=this.$wrapper.classList).remove.apply(e,m(this.cache.colors)),t<this.lengthExpected.min?this.$wrapper.classList.add(this.cache.colors[0]):t<=this.lengthExpected.avg?this.$wrapper.classList.add(this.cache.colors[1]):t>this.lengthExpected.avg&&this.$wrapper.classList.add(this.cache.colors[2]),this.$counter.innerText=t,this.target.classList.add("is-used",!this.wasUsed),this.wasUsed=!0}},{key:"updateFeedback",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.target.value.length;if(this.$buttonFeedback)if((e=this.$buttonFeedback.classList).remove.apply(e,m(this.cache.colors)),t<this.lengthExpected.min)this.$buttonFeedback.classList.add(this.cache.colors[0]),this.$buttonFeedbackText.innerText=this.feedback.none;else{t<=this.lengthExpected.avg?(this.$buttonFeedback.classList.add(this.cache.colors[1]),this.$buttonFeedbackText.innerText=this.feedback.short):t>this.lengthExpected.avg&&(this.$buttonFeedback.classList.add(this.cache.colors[2]),this.$buttonFeedbackText.innerText=this.feedback.ok),this.target.setAttribute("data-textarea-target","success");var n=Array.from(this.$userTexts).find((function(e){return"success"!==e.getAttribute("data-textarea-target")}));void 0===n&&this.showFeedback()}}},{key:"addEventListeners",value:function(){var e=this;this.target.addEventListener("blur",(function(t){if(e.updateCharacterCounter(),t.target.value!==e.lastValue){var n=""===e.lastValue?"create":"change";e.lastValue=t.target.value,w(document,"text.change",{},{text:{id:t.target.id,task:n,text:t.target.value}}),e.textDuplicateSources=[]}})),this.target.addEventListener("keyup",(function(t){t.stopPropagation();var n=e.target.value.length;e.updateCharacterCounter(n),e.updateFeedback(n)}))}},{key:"getEvents",value:function(){var e=this;this.textDuplicateSources[0]&&document.addEventListener("text.change",(function(t){if(e.textDuplicateSources.includes(t.detail.text.id)){var n=""===e.target.value?"create":"change";switch(t.detail.text.task){case"create":case"change":""!==e.target.value&&(e.target.value+="\n"),1===e.textDuplicateSources.length?e.target.value=t.detail.text.text:e.target.value+="".concat(t.detail.text.text,"\n"),w(document,"text.change",{},{text:{id:e.target.id,task:n,text:e.target.value}}),e.lastValue=e.target.value,e.updateCharacterCounter();break;default:console.log("Nondefinated text events task. :(")}}}))}}]),a}(y),X=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$playButton=i.target.querySelector("[data-player-control]"),i.$loadWave=i.target.querySelector("[data-audio-wave]"),i.$leftTime=i.target.querySelector("[data-audio-time-left]"),i.$audioDuration=i.target.querySelector("[data-audio-time-duration]"),i.wavesurfer=WaveSurfer.create({container:i.$loadWave,waveColor:"#A77977",progressColor:"#FCE4E3",height:80,responsive:!0,barWidth:2}),i.wavesurfer.load(i.$loadWave.dataset.src),i.initWave(),i}return i(a,[{key:"initWave",value:function(){var e=this;this.wavesurfer.on("ready",(function(){e.$leftTime.textContent="0:00";var t=e.wavesurfer.getDuration(),n=Math.floor(t%3600/60),a="00".concat(Math.floor(t%60)).slice(-2);e.$audioDuration.textContent="".concat(n,":").concat(a),e.addListenerAfterReady()}))}},{key:"addListenerAfterReady",value:function(){var e=this;this.wavesurfer.on("audioprocess",(function(t){var n=Math.floor(t%3600/60),a="00".concat(Math.floor(t%60)).slice(-2);e.$leftTime.textContent="".concat(n,":").concat(a)})),this.wavesurfer.on("finish",(function(){e.$playButton.setAttribute("data-player-control","paused")})),this.$playButton.addEventListener("click",(function(){e.wavesurfer.playPause(),"paused"===e.$playButton.getAttribute("data-player-control")?e.$playButton.setAttribute("data-player-control","playing"):e.$playButton.setAttribute("data-player-control","paused"),e.showFeedback()})),document.querySelectorAll("[data-nav-button]").forEach((function(t){t.addEventListener("click",(function(){"playing"===e.$playButton.getAttribute("data-player-control")&&(e.wavesurfer.playPause(),e.$playButton.setAttribute("data-player-control","paused"))}))}))}}]),a}(y),K=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$audio=i.target.querySelector("audio"),i.$timeLeft=i.target.querySelector("[data-audio-time-left]"),i.$duration=i.target.querySelector("[data-audio-time-duration]"),i.$duration.innerText="/".concat(F(i.$audio.duration)),R.addEventListeners(i.target,i.showFeedback),i}return a}(R),U=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$buttons=i.target.querySelectorAll('[data-fake-map="toggle"]'),i.$maps=i.target.querySelectorAll('[data-fake-map="map"]'),i.lastActiveIndex=0,i.addEventListenerToButtons(),i}return i(a,[{key:"switchMap",value:function(e,t){this.$maps[this.lastActiveIndex].classList.remove("active"),this.$buttons[this.lastActiveIndex].classList.remove("active"),this.$maps[t].classList.add("active"),e.classList.add("active"),this.lastActiveIndex=t}},{key:"addEventListenerToButtons",value:function(){var e=this;this.$buttons.forEach((function(t,n){t.addEventListener("click",(function(a){e.switchMap(t,n),e.showFeedback(),a.preventDefault()}))}))}}]),a}(y),J=function(e){c(a,e);var t=g(a);function a(e,i){var r;return n(this,a),(r=t.call(this,e)).$media=r.target.querySelector("video"),r.options=Object(i),r.prefix=r.options.prefix||"media",r.lang=Object(r.options.lang),r.paused=null,r.currentTime=null,r.duration=null,r.interval=null,r.$document=r.target.ownerDocument,r.$controls=r.target.querySelector(".media-player-controls"),r.$play=r.$controls.querySelector("[data-player-control]"),r.$playSymbol=r.$play.querySelector(".media-play-symbol"),r.$pauseSymbol=r.$play.querySelector(".media-pause-symbol"),r.$time=r.$controls.querySelector("[data-video-time-progress]"),r.$timeMeter=r.$time.querySelector(".media-meter.media-time-meter"),r.$timeRange=r.$time.querySelector(".media-range.media-time-range"),r.$currentTimeText=r.$document.createTextNode(""),r.$currentTime=r.$controls.querySelector("[data-video-time-left]"),r.$currentTime.appendChild(r.$currentTimeText),r.durationTime=r.$media.duration,r.$durationTime=r.$controls.querySelector("[data-video-time-duration]"),r.$durationTime.innerText=F(r.durationTime),r.$durationTime.setAttribute("title","".concat(a.timeToAural(r.durationTime,r.lang.minutes||"minutes",r.lang.seconds||"seconds"))),r.$fullscreen=r.$controls.querySelector(".fullscreen-toggle"),r.$enterFullscreenSymbol=r.$fullscreen.querySelector(".media-enterFullscreen-symbol"),r.$leaveFullscreenSymbol=r.$fullscreen.querySelector(".media-leaveFullscreen-symbol"),r._fullscreenchange="onfullscreenchange"in r.target?"fullscreenchange":"onwebkitfullscreenchange"in r.target?"webkitfullscreenchange":"onMSFullscreenChange"in r.target?"MSFullscreenChange":"fullscreenchange",r._requestFullscreen=r.target.requestFullscreen||r.target.webkitRequestFullscreen||r.target.msRequestFullscreen,r.onCanPlayStart=r.onCanPlayStart.bind(u(r)),r.onLoadStart=r.onLoadStart.bind(u(r)),r.onLoadedData=r.onLoadedData.bind(u(r)),r.onPlayChange=r.onPlayChange.bind(u(r)),r.onTimeChange=r.onTimeChange.bind(u(r)),r.onPlayClick=r.onPlayClick.bind(u(r)),r.onTimeKeydown=r.onTimeKeydown.bind(u(r)),r.onTimeClick=r.onTimeClick.bind(u(r)),r.onTimeKeydown=r.onTimeKeydown.bind(u(r)),r.onFullscreenClick=r.onFullscreenClick.bind(u(r)),r.onFullscreenChange=r.onFullscreenChange.bind(u(r)),r.$media.addEventListener("canplaythrough",r.onCanPlayStart),r.$media.addEventListener("loadstart",r.onLoadStart),r.$media.addEventListener("loadeddata",r.onLoadedData),r.$media.addEventListener("pause",r.onPlayChange),r.$media.addEventListener("play",r.onPlayChange),r.$media.addEventListener("timeupdate",r.onTimeChange),r.$controls.addEventListener("click",r.onPlayClick,!1),r.$play.addEventListener("keydown",r.onTimeKeydown),r.$time.addEventListener("click",r.onTimeClick,!1),r.$time.addEventListener("keydown",r.onTimeKeydown),r.$fullscreen.addEventListener("click",r.onFullscreenClick,!1),document.addEventListener(r._fullscreenchange,r.onFullscreenChange),a.onDrag(r.$time,r.$timeRange,(function(e){r.$media.currentTime=r.duration*Math.max(0,Math.min(1,e)),r.onTimeChange()})),r.onLoadStart(),r}return i(a,[{key:"onPlayChange",value:function(){this.paused!==this.$media.paused&&(this.paused=this.$media.paused,this.$play.setAttribute("aria-label",this.paused?this.lang.play||"play":this.lang.pause||"pause"),this.target.setAttribute("data-player-state",this.paused?"paused":"playing"),this.$playSymbol.setAttribute("aria-hidden",!this.paused),this.$pauseSymbol.setAttribute("aria-hidden",this.paused),clearInterval(this.interval),this.paused||(this.interval=setInterval(this.onTimeChange,34)),this.$media.dispatchEvent(I.playchange))}},{key:"onTimeChange",value:function(){if(this.currentTime!==this.$media.currentTime||this.duration!==this.$media.duration){this.currentTime=this.$media.currentTime,this.duration=this.$media.duration||0;var e=this.currentTime/this.duration,t=F(this.currentTime);t!==this.$currentTimeText.nodeValue&&(this.$currentTimeText.nodeValue=t,this.$currentTime.setAttribute("title","".concat(a.timeToAural(this.currentTime,this.lang.minutes||"minutes",this.lang.seconds||"seconds")))),this.$time.setAttribute("aria-valuenow",this.currentTime),this.$time.setAttribute("aria-valuemin",0),this.$time.setAttribute("aria-valuemax",this.duration),this.$timeMeter.style.width="".concat(100*e,"%"),this.$media.dispatchEvent(I.timechange)}}},{key:"onLoadStart",value:function(){this.$media.removeEventListener("canplaythrough",this.onCanPlayStart),this.$media.addEventListener("canplaythrough",this.onCanPlayStart),this.onPlayChange(),this.onFullscreenChange(),this.onTimeChange()}},{key:"onLoadedData",value:function(){this.onTimeChange()}},{key:"onCanPlayStart",value:function(){this.$media.removeEventListener("canplaythrough",this.nCanPlayStart),this.$media.dispatchEvent(I.canplaystart),this.paused&&!this.$media.autoplay||this.$media.play()}},{key:"onFullscreenChange",value:function(){var e=this.target===a._fullscreenElement();this.$fullscreen.setAttribute("aria-label",e?this.lang.leaveFullscreen||"leave full screen":this.lang.enterFullscreen||"enter full screen"),this.$enterFullscreenSymbol.setAttribute("aria-hidden",e),this.$leaveFullscreenSymbol.setAttribute("aria-hidden",!e)}},{key:"onPlayClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.$media[this.$media.paused?"play":"pause"]()}},{key:"onTimeClick",value:function(e){e.stopPropagation(),e.pointerType||e.detail||this.onPlayClick(e)}},{key:"onFullscreenClick",value:function(e){var t=this;e.stopPropagation(),this._requestFullscreen?this.target===a._fullscreenElement()?a._exitFullscreen().call(document):(this._requestFullscreen.call(this.target),this.$fullscreen.focus(),setTimeout((function(){t.$fullscreen.focus()}),200)):this.$media.webkitSupportsFullscreen&&(this.$media.webkitDisplayingFullscreen?this.$media.webkitExitFullscreen():this.$media.webkitEnterFullscreen(),this.onFullscreenChange())}},{key:"onTimeKeydown",value:function(e){var t=e.keyCode,n=e.shiftKey;if(t>=37&&t<=40){e.preventDefault();var a=37===t||39===t?t-38:t-39;this.$media.currentTime=Math.max(0,Math.min(this.$media.duration,this.$media.currentTime+a*(n?10:1))),this.onTimeChange()}}}],[{key:"_fullscreenElement",value:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement}},{key:"_exitFullscreen",value:function(){return document.exitFullscreen||document.webkitCancelFullScreen||document.msExitFullscreen}},{key:"onDrag",value:function(e,t,n){var a,i,r,s=void 0!==e.onpointerup,o=void 0!==e.ontouchstart,c=s?"pointerdown":o?"touchstart":"mousedown",l=s?"pointermove":o?"touchmove":"mousemove",d=s?"pointerup":o?"touchend":"mouseup",u="clientX";function h(e){e.preventDefault();var t=u in e?e.clientX:e.touches&&e.touches[0]&&e.touches[0].clientX||0;n((t-i)/(r-i))}function g(){a.removeEventListener(l,h),a.removeEventListener(d,g)}e.addEventListener(c,(function(n){a=e.ownerDocument.defaultView;var s=t.getBoundingClientRect();i=s.left,r=s.right,h(n),a.addEventListener(l,h),a.addEventListener(d,g)}))}},{key:"timeToAural",value:function(e,t,n){return"".concat(Math.floor(e/60)," ").concat(t,", ").concat(Math.floor(e%60)," ").concat(n)}}]),a}(y),Z=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$settings=document.querySelector('[data-selectable-id-reference="'.concat(i.target.id,'"]')),i.feedback=JSON.parse(i.$settings.getAttribute("data-module-zpetnavazba")),i.settings=JSON.parse(i.$settings.getAttribute("data-module-settings")),i.$items=i.target.querySelectorAll(".selectable-item"),i.$inputs=i.target.querySelectorAll("input"),i.$inputs.forEach((function(e){i._changeClassIfChecked(e),i._addEventListeners(e)})),i.cache={answersCorrect:0,zpetnaVazba:!1,colors:[],checkedInput:0},i.feedback&&(i.cache.zpetnaVazba=!0,i.cache.colors=i.feedback.map((function(e){return e.barva}))),i}return i(a,[{key:"_addEventListeners",value:function(e){var t=this;e.addEventListener("change",(function(){t.$inputs.forEach((function(e){t._changeClassIfChecked(e)})),t._checkAndResolveFeedback()}),!1)}},{key:"_changeClassIfChecked",value:function(e){e.parentNode.classList.toggle("is-checked",!0===e.checked)}},{key:"_checkAndResolveFeedback",value:function(){var e=this;if(this.cache.answersCorrect=0,this.settings.viceOdpovedi?this.$items.forEach((function(t,n){e.$inputs[n].checked&&(e.cache.checkedInput+=1),e.$inputs[n].checked&&t.hasAttribute("data-select-spravnaodpoved")&&(e.cache.answersCorrect+=1),e.$inputs[n].checked||t.hasAttribute("data-select-spravnaodpoved")||(e.cache.answersCorrect+=1)})):this.$items.forEach((function(t,n){e.$inputs[n].checked&&(e.cache.checkedInput+=1),e.$inputs[n].checked&&t.hasAttribute("data-select-spravnaodpoved")&&(e.cache.answersCorrect+=1)})),0===this.cache.checkedInput&&!this.settings.vybrano||this.cache.checkedInput===this.$inputs.length&&this.settings.vybrano||this.settings.disableFeedback)this.hideFeedback();else{if(this.cache.zpetnaVazba){var t,n=this.feedback.find((function(t){return t.podminka.includes(e.cache.answersCorrect)}));(t=this.$buttonFeedback.classList).remove.apply(t,m(this.cache.colors)),this.$buttonFeedback.classList.add(n.barva),this.$buttonFeedbackText.innerText=n.text}this.showFeedback()}this.cache.checkedInput=0,this._dispatchEvent()}},{key:"_dispatchEvent",value:function(){var e=Array.from(this.$inputs).map((function(e){return{checked:e.checked,id:e.id}}));w(this.target,"selection.change",{},{id:this.target.id,items:e})}}]),a}(y),Q=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).dataFrom=i.target.parentNode.getAttribute("data-from"),i.dataSources=i.dataFrom?i.dataFrom.split(" "):[],i.id=e.getAttribute("id"),i.cache={tasks:[]},i.init(),i}return i(a,[{key:"init",value:function(){var e=this,t=this.target.parentNode.getAttribute("data-autofill");switch(t){case"columns":this._columnManager();break;case"rows":this._rowManager();break;case"cells":this.target.querySelectorAll(".table-new__cell").forEach((function(t){var n=t.getAttribute("data-column-id"),a=t.getAttribute("data-row-id");n&&a&&e._cellManager(t,n,a)}));break;default:console.log("NewTableERROR: Undefinated autofill key word!",t)}}},{key:"_rowManager",value:function(){var e=this;document.addEventListener("editor.change",(function(t){var n=t.detail.text;if(e.dataSources.includes(n.id)){var i,r=!0,s=e.target.previousSibling.firstChild.childNodes;switch(n.task){case"add":(i=document.createElement("div")).setAttribute("class","table-new__row"),s.forEach((function(t){var a=document.createElement("div");a.setAttribute("class","table-new__cell");var s=JSON.parse(t.getAttribute("data-type"));s.tagName&&s.tagName!==n.tagData.tagName?r=!1:e.fillCell(s,n,a),r&&i.appendChild(a)})),r&&e.target.appendChild(i);break;case"remove":e.target.childNodes.forEach((function(e){e.childNodes.forEach((function(t,r){var o=JSON.parse(s[r].getAttribute("data-type"));a.isRightToDeleteHelper(t,n.value,o)&&(i=e)}))})),i&&(i.childNodes.forEach((function(t){e._removeTaskFromCache(t)})),i.remove());break;default:console.log("NewTableERROR: Undefinated task for new table! (rowManager)")}}}))}},{key:"_columnManager",value:function(){var e=this;document.addEventListener("editor.change",(function(t){var n=t.detail.text;if(e.dataSources.includes(n.id)){var i=e.target.childNodes;switch(n.task){case"add":i.forEach((function(t){var a=document.createElement("div");a.setAttribute("class","table-new__cell");var i=t.firstChild,r=JSON.parse(i.getAttribute("data-type"));e.fillCell(r,n,a),t.appendChild(a)}));break;case"remove":var r;i.forEach((function(e){var t=e.firstChild,i=JSON.parse(t.getAttribute("data-type"));e.childNodes.forEach((function(e,t){a.isRightToDeleteHelper(e,n.value,i)&&(r=t)}))})),e.target.childNodes.forEach((function(t){e._removeTaskFromCache(t.childNodes[r]),t.childNodes[r].remove()}));break;default:console.log("NewTableERROR: Undefinated task for new table! (columnManager)")}}}))}},{key:"_cellManager",value:function(e,t,n){var i=this,r=JSON.parse(this._findCellType(e)),s=function(t){switch(t.task){case"add":var n=document.createElement("div");i.fillCell(r,t,e),e.appendChild(n);break;case"remove":for(var s=e.querySelectorAll("div"),o=!1,c=0;c<s.length;c+=1)!o&&a.isRightToDeleteHelper(s[c],t.value,r)&&(s[c].remove(),o=!0);break;default:console.log("NewTableERROR: Undefinated task for new table! (cellManager)")}};document.addEventListener("editor.change",(function(e){var a=e.detail.text;!i.dataSources.includes(a.id)||a.tagData.tagName!==n&&a.tagData.tagName!==t||r.textId&&r.textId!==a.id||s(a)})),document.addEventListener("draggable.drop",(function(e){var n=e.detail;if(i.dataSources.includes(n.id)&&e.detail.columnId===t){var a=n.$node.querySelector("span").cloneNode(!0);a.classList.add("node-selected","node-text-gray"),a.setAttribute("data-by","table-drop"),s({task:n.task,value:a})}}))}},{key:"fillCell",value:function(e,t,n){var a,i,r=this,s=0;if(this.cache.tasks.length>0){var o=this.cache.tasks[this.cache.tasks.length-1].id.split("-");s=+o[o.length-1]+1}switch(n.classList.add("table-new__cell--".concat(e.name),"table-new__cell--".concat(e.type)),e.name){case"dup-text":a=document.createElement("div"),"text"===e.type?a.innerHTML=t.value.textContent:"tag"===e.type&&a.appendChild(t.value.cloneNode(!0));break;case"select":i={id:"".concat(this.id,"-select-").concat(s),answer:"",rightAnswer:t.tagData},this.cache.tasks.push(i),(a=document.createElement(e.name)).setAttribute("id",i.id),a.setAttribute("data-save","value"),a.setAttribute("tabindex",-1),e.options.forEach((function(e){var t=document.createElement("option");t.innerHTML=e,a.appendChild(t)})),a.addEventListener("change",(function(e){return r._correctedAnswer(e,i)}));break;case"input":case"textarea":i={id:"".concat(this.id,"-input-").concat(s),answer:"",rightAnswer:t.tagData},this.cache.tasks.push(i),(a=document.createElement(e.name)).setAttribute("id",i.id),a.setAttribute("data-save","value"),a.setAttribute("tabindex",-1),"textarea"===e.name&&a.setAttribute("resize",i.id),Object.keys(e.attributes).forEach((function(t){a.setAttribute(t,e.attributes[t])})),a.addEventListener("change",(function(e){return r._correctedAnswer(e,i)}));break;case"drop":a=document.createElement("div");var c=e.number?e.number:-1;a.setAttribute("data-drop-place",c);break;default:a=document.createElement("div"),t.tagData[e.name]?a.innerHTML=t.tagData[e.name]:(a.innerHTML=" ",console.log("FillCellERROR: Undefinated object name.",e))}n.appendChild(a)}},{key:"_findCellType",value:function(e){var t=e.parentNode.firstChild.getAttribute("data-type");if(t)return t;var n=e.getAttribute("data-column-id"),a=this.target.parentNode.querySelector(".table-new__cell--header[data-column-id=".concat(n,"]"));return a?a.getAttribute("data-type"):"empty"}},{key:"_correctedAnswer",value:function(e,t){this.cache.tasks.forEach((function(n){n.id===t.id&&(n.answer=e.target.value)}))}},{key:"_removeTaskFromCache",value:function(e){var t=this;this.cache.tasks.forEach((function(n,a){"SELECT"!==e.firstChild.tagName&&"INPUT"!==e.firstChild.tagName&&"TEXTAREA"!==e.firstChild.tagName||e.firstChild.id===n.id&&t.cache.tasks.splice(a,1)}))}}],[{key:"isRightToDeleteHelper",value:function(e,t,n){var a;"dup-text"===n.name?a=("tag"===n.type&&"×"===e.textContent[e.textContent.length-1]?e.textContent.slice(0,-1):e.textContent)===t.textContent:a=!1;return a}}]),a}(y),ee=function(e){c(a,e);var t=g(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).idPrefix="drag-item",i.dataFrom=i.target.getAttribute("data-from"),i.dataSources=i.dataFrom?i.dataFrom.split(" "):[],i.position={x:0,y:0,dx:0,dy:0},i.cache={items:{}},i.$targetPrevious=null,i.$targetCurrent=null,i.$draggedItem=null,i.objWidth=null,i.objHeight=null,i.init(),i}return i(a,[{key:"init",value:function(){var e=this;this.target.querySelectorAll(".draggable__item").forEach((function(t){var n=t.getAttribute("data-id");e.cache.items[n]=0,e.dragAndDropEvents(d3.select(t),n)})),this.handleDeleteItemFromSvgDrop(),this.handleAddTagsFromText()}},{key:"dragAndDropEvents",value:function(e,t){var n=this,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.call(d3.drag().container(this.$slide).on("start",(function(){n.onStart(e)})).on("drag",(function(){n.onDrag(e)})).on("end",(function(){n.onDrop(e,t,a)})))}},{key:"onStart",value:function(e){this.$slide.classList.add("is-dragging"),this.$targetPrevious=d3.event.sourceEvent.target;var t=e.node();if(this.objWidth=t.offsetWidth,this.objHeight=t.offsetHeight,this.position.x=d3.event.sourceEvent.clientX-d3.event.sourceEvent.offsetX,this.position.y=d3.event.sourceEvent.clientY-d3.event.sourceEvent.offsetY,this.position.dx=0,this.position.dy=0,t.parentNode.hasAttribute("data-drag-place"))this.$draggedItem=t.cloneNode(!0);else{this.$draggedItem=t;var n=t.closest(".table-new__body"),a=t.closest(".table-new__cell").getAttribute("data-column-id");w(document,"draggable.drop",{},{id:n.id,task:"remove",columnId:a,$node:t})}document.body.appendChild(this.$draggedItem),this.$draggedItem=d3.select(this.$draggedItem),this.$draggedItem.classed("is-dragged",!0).classed("was-dropped",!1).attr("style","top:".concat(this.position.y,"px; left:").concat(this.position.x,"px;"))}},{key:"onDrag",value:function(e){if(this.position.dx+=d3.event.dx,this.position.dy+=d3.event.dy,this.$draggedItem.style("transform","translate3d(".concat(this.position.dx,"px, ").concat(this.position.dy,"px, 0) rotate(5deg)")),this.$targetCurrent=d3.event.sourceEvent.target,this.$targetPrevious!==this.$targetCurrent){var t=this.$targetPrevious.querySelector(".draggable__item--placeholder");if(t&&t.remove(),this.$targetCurrent.hasAttribute("data-drop-place")){var n=this.$targetCurrent.getAttribute("data-drop-place"),a=this.$targetCurrent.childElementCount;if("-1"===n||+n>a){var i=e.clone(!0).classed("is-dragged",!1).classed("draggable__item--placeholder",!0).attr("style","outline: 0px;").node();this.$targetCurrent.appendChild(i)}}this.$targetPrevious=this.$targetCurrent}}},{key:"onDrop",value:function(e,t,n){var a,i=this;if(this.$targetCurrent=d3.event.sourceEvent.target,this.$targetCurrent.hasAttribute("data-drop-place")){var r=this.$targetCurrent.querySelector(".draggable__item--placeholder");if(r){var s=r.getAttribute("data-draggable-item");if(r.classList.remove("draggable__item--placeholder","was-dropped"),r.classList.add("dropped__item"),n&&(e.classed("was-dropped",!0),this.cache.items[t]+=1),"svg"===s)r.querySelector('[data-fullscreen="toggle"]').remove();else{var o=r.firstElementChild,c=document.createElement("span");c.classList.add("node-close"),c.innerText="×",o.removeChild(o.lastElementChild),o.appendChild(c),c.addEventListener("click",(function(){i.removeDraggableItem(r,t,n)}))}this.dragAndDropEvents(d3.select(r),t,!1)}else r=e.clone(!0).classed("is-dragged",!1).attr("style","outline: 0px;").node(),this.$targetCurrent.appendChild(r),this.dragAndDropEvents(d3.select(r),t,!1);var l=this.$targetCurrent.closest(".table-new__body"),d=this.$targetCurrent.closest(".table-new__cell").getAttribute("data-column-id");w(document,"draggable.drop",{},{id:l.id,task:"add",columnId:d,$node:r}),this.$draggedItem.remove()}else{var u=this.$targetCurrent.closest("svg");if(!!u&&u.hasAttribute("data-svg-drop")){var h=(a=u.closest(".half-slide-active"),"Firefox"===platform.name&&a?[d3.mouse(u)[0]-(a.offsetWidth+i.objWidth),d3.mouse(u)[1]]:d3.mouse(u)),g=this.$draggedItem.classed("is-dragged",!1).attr("style","outline: 0px;").node();e.classed("was-dropped",!0),this.cache.items[t]+=1,w(document,"svg.drop",{},{svg:{id:u.id,$node:g,type:g.getAttribute("data-draggable-item"),position:h,size:{width:this.objWidth,height:this.objHeight}}}),this.$draggedItem.remove()}else this.removeDraggableItem(this.$draggedItem,t,n)}this.$slide.classList.remove("is-dragging")}},{key:"handleDeleteItemFromSvgDrop",value:function(){var e=this;document.addEventListener("svg.drop.delete",(function(t){var n=t.detail.item,a=n.id,i=(n.$object,e.target.querySelector("div[data-id=".concat(a,"]")));i&&(1===e.cache.items[a]&&i.classList.remove("was-dropped"),e.cache.items[a]-=1)}))}},{key:"handleAddTagsFromText",value:function(){var e=this,t=1;document.addEventListener("editor.change",(function(n){var i,r,s,o,c,l=n.detail.text,d=e.target.getAttribute("data-tagName");if(e.dataSources.includes(l.id)&&(!d||d===l.tagData.tagName))switch(l.task){case"add":(i=e.target.firstElementChild.cloneNode(!0)).classList.remove("hidden"),r=i.querySelector(".keywords-item"),"×"===(s=l.value.textContent)[s.length-1]&&(s=s.slice(0,-1)),r.firstElementChild.innerHTML=s,i.firstElementChild.classList.add("node-text-".concat(l.tagColor)),r.classList.add("node-text-".concat(l.tagColor)),(c=(o=i.getAttribute("data-id")).split("-")).splice(-1,1,"dup-".concat(t)),o=c.join("-"),i.setAttribute("data-id",o),e.cache.items[o]=0,t+=1,e.target.appendChild(i),e.dragAndDropEvents(d3.select(i),o);break;case"remove":e.target.childNodes.forEach((function(e){a.isRightToDeleteHelper(e,l.value,e.getAttribute("data-draggable-item"))&&e.remove()}));break;default:console.log("NewTableERROR: Undefinated task for new table! (cellManager)")}}))}},{key:"removeDraggableItem",value:function(e,t,n){1===this.cache.items[t]&&this.target.querySelector("div[data-id=".concat(t,"]")).classList.remove("was-dropped");n||(this.cache.items[t]-=1),e.remove()}}],[{key:"isRightToDeleteHelper",value:function(e,t,n){return("tag"===n&&"×"===e.textContent[e.textContent.length-1]?e.textContent.slice(0,-1):e.textContent)===t.textContent}}]),a}(y),te=function(){console.log("windowLoad:components");var e=document.querySelectorAll("[data-player-video]");e.length>0&&(e.forEach((function(e){new J(e)})),document.addEventListener("slide.change",(function(){q(e)})));var t=document.querySelectorAll('[data-player-audio="normal"]');t.length>0&&t.forEach((function(e){new X(e)}));var n=document.querySelectorAll('[data-player-audio="simple"]');n.length>0&&(n.forEach((function(e){new K(e)})),document.addEventListener("slide.change",(function(){q(n)})));var a=document.querySelectorAll('[data-fullscreen="toggle"]');a.length>0&&a.forEach((function(e){new V(e)}));var i=document.querySelectorAll("[data-lupa-target]");if(i.length>0)for(var r=0;r<i.length;r+=1)new b(i[r]);var s=document.querySelectorAll('[data-fake-map="target"]');if(s.length>0)for(var o=0;o<s.length;o+=1)new U(s[o]);var c=document.querySelectorAll('[data-textarea-target=""]');c.length>0&&c.forEach((function(e){new Y(e)}));var l=document.querySelectorAll("[data-svg-target]");if(l.length>0){if(!0!==HISTORYLAB.import.done){var d=document.querySelector("[data-radial-menu]");if(d)new B(d,l)}l.forEach((function(e){new z(e)}))}if(!0!==HISTORYLAB.import.done){var u=document.querySelectorAll("[data-editor]");u.length>0&&u.forEach((function(e){new j(e)}));var h=document.querySelectorAll("[data-target-test-quiz]");h.length>0&&h.forEach((function(e){var t=document.querySelector('[data-test-quiz-id-reference="'.concat(e.getAttribute("data-test-quiz-id"),'"]'));new G(e.getAttribute("data-test-quiz-id"),e,JSON.parse(t.getAttribute("data-module-settings"))).init()}));var g=document.querySelectorAll("[data-new-table]");g.length>0&&g.forEach((function(e){new Q(e)}));var v=document.querySelectorAll("[data-draggable]");v.length>0&&v.forEach((function(e){new ee(e)}));var m=document.querySelectorAll("[data-sortable-target]");m.length>0&&m.forEach((function(e){new H(e)}));var f=document.querySelectorAll("[data-selectable-target]");f.length>0&&f.forEach((function(e){new Z(e)}));var p=document.querySelectorAll("[data-keywords]");p.length>0&&p.forEach((function(e){var t=e.hasAttribute("data-module-settings")?e.getAttribute("data-module-settings"):{};new W(e,JSON.parse(t)).init()}))}};!function(){if(function(){if(!Array.from||!Element.prototype.matches||!Element.prototype.closest||"function"!=typeof window.CustomEvent||"function"!=typeof Object.assign){console.warn("Not supported browser.");var e=document.querySelector("#unsupported");return e.querySelector("#unsupported-browser").innerHTML=" ".concat(platform.name," ").concat(platform.version," "),e.classList.remove("is-hidden"),!0}return!1}())return!1;document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",te,!1)}()}();
//# sourceMappingURL=components.build.js.map
