!function(){"use strict";var e=function(){console.log("domLoad:components")};function t(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function a(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?t(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=c(e);if(t){var i=c(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return u(this,a)}}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,i,r=[],o=!0,s=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(r.push(n.value),!t||r.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(s)throw i}}return r}(e,t)||m(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){if(e){if("string"==typeof e)return f(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var p=function(){function e(t){n(this,e),this.target=t,this.$slide=this.target.closest(".slide"),this.lang=document.documentElement.getAttribute("lang"),HISTORYLAB.import.done||(this.$slide&&(this.$buttonFeedback=this.$slide.querySelector("[data-feedback-button]"),this.$buttonFeedback&&(this.$buttonFeedbackText=this.$buttonFeedback.querySelector("span"))),this.showFeedback=this.showFeedback.bind(this))}return r(e,[{key:"showFeedback",value:function(){this.$buttonFeedback&&this.$buttonFeedback.classList.contains("button-hidden")&&this.$buttonFeedback.classList.remove("button-hidden")}},{key:"hideFeedback",value:function(){this.$buttonFeedback.classList.add("button-hidden")}}]),e}(),y=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$element=document.querySelector("[data-lupa]"),i.$canvas=document.querySelector("[data-lupa-canvas]"),i.ctx=i.$canvas.getContext("2d"),i._onStart=i._onStart.bind(d(i)),i._onMove=i._onMove.bind(d(i)),i._onEnd=i._onEnd.bind(d(i)),i._update=i._update.bind(d(i)),i._onResize=i._onResize.bind(d(i)),i.zoomGlassSize=230,i.targetBCR=null,i.zoomed=0,i.targetZoomed=0,i.x=0,i.y=0,i.trackingTouch=!1,i.displayStyle="",i._addEventListeners(),i._initCanvas(),i._onResize(),window.requestAnimationFrame(i._update),i}return r(a,[{key:"_initCanvas",value:function(){var e=this.zoomGlassSize,t=this.zoomGlassSize,a=window.devicePixelRation||1;this.$canvas.width=e*a,this.$canvas.height=t*a,this.$canvas.style.width="".concat(e,"px"),this.$canvas.style.height="".concat(t,"px"),this.ctx.scale(a,a)}},{key:"_onResize",value:function(){this.targetBCR=this.target.getBoundingClientRect()}},{key:"_onStart",value:function(e){this.displayStyle=getComputedStyle(this.$element).display,e.target===this.target&&"none"!==this.displayStyle&&(e.preventDefault(),this.x=e.pageX||e.touches[0].pageX,this.y=e.pageY||e.touches[0].pageY,this.trackingTouch=!0,this.targetZoomed=1,this.zoomed=0,window.requestAnimationFrame(this._update))}},{key:"_onMove",value:function(e){this.trackingTouch&&"none"!==this.displayStyle&&(this.x=e.pageX||e.touches[0].pageX,this.y=e.pageY||e.touches[0].pageY)}},{key:"_onEnd",value:function(){this.targetZoomed&&this.showFeedback(),this.targetZoomed=0,this.trackingTouch=!1}},{key:"_update",value:function(){var e=2*Math.PI,t=100*this.zoomed;this.targetBCR=this.target.getBoundingClientRect();var a=Math.max(0,Math.min(1,(this.x-this.targetBCR.left)/this.targetBCR.width)),n=Math.max(0,Math.min(1,(this.y-this.targetBCR.top)/this.targetBCR.height)),i=2.5*this.targetBCR.width,r=2.5*this.targetBCR.height;platform.os.family.indexOf("Windows")>-1&&platform.name.indexOf("Firefox")>-1||(this.ctx.shadowColor="rgba(0,0,0,0.4)",this.ctx.shadowBlur=12,this.ctx.shadowOffsetY=8),this.ctx.clearRect(0,0,this.zoomGlassSize,this.zoomGlassSize),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(this.zoomGlassSize/2,this.zoomGlassSize-10-t,t,0,e),this.ctx.closePath(),this.ctx.fill(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.zoomGlassSize/2,this.zoomGlassSize-10-(t+1),1.03*t,0,e),this.ctx.clip(),this.ctx.closePath(),this.ctx.drawImage(this.target,-a*i+this.zoomGlassSize/2,-n*r+this.zoomGlassSize/2,i,r),this.ctx.restore(),this._setTransformStyle(this.x,this.y),this.zoomed+=(this.targetZoomed-this.zoomed)/4,this.zoomed>.001?window.requestAnimationFrame(this._update):this.zoomed=0}},{key:"_addEventListeners",value:function(){document.addEventListener("touchstart",this._onStart),document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onEnd),document.addEventListener("mousedown",this._onStart),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onEnd),window.addEventListener("resize",this._onResize)}},{key:"_setTransformStyle",value:function(e,t){var a,n,i=this.zoomGlassSize/2;a=e-i<0?Math.abs(e)+i+18:e+i>window.innerWidth?window.innerWidth-(e-window.innerWidth)-this.zoomGlassSize:e,n=t-this.zoomGlassSize<0?Math.abs(t)+this.zoomGlassSize+18:t,this.$element.style.transform="translate(".concat(a,"px, ").concat(n,"px)")}}]),a}(p);function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i={bubbles:!0},r=Object.assign(i,t);return new CustomEvent(e,a({detail:n},r))}function k(e,t,a,n){var i=b(t,a,n);e.dispatchEvent(i)}function x(e){return{x:e.pageX||e.touches[0].pageX,y:e.pageY||e.touches[0].pageY}}function $(e,t){var a=[];"Firefox"===platform.name&&e.target.closest(".half-slide-active")?a=[e.offsetX,e.offsetY]:(a=d3.pointer(e,t))[0]||(a=g(d3.pointers(e,t),1)[0]);return{x:d3.format(".0f")(a[0]),y:d3.format(".0f")(a[1])}}function w(e,t){E(e,t)?A(e,t):S(e,t)}function E(e,t){return!(!e||!t)&&(e.classList?e.classList.contains(t):"".concat(e.className," ").indexOf("".concat(t," "))>-1)}function S(e,t){var a=e,n=t;if(a&&n)if("string"==typeof a?a=document.querySelectorAll(a):a.tagName&&(a=[a]),"string"==typeof n){n=n.split(" ");for(var i=0;i<a.length;i+=1){var r;if(a[i].classList)(r=a[i].classList).add.apply(r,v(n));else if(!E.apply(void 0,[a[i]].concat(v(n))))for(var o=0;o<n.length;o+=1)a[i].classes+=" ".concat(n[o])}}else console.log("Class argument must be string with spaces in between class names.")}function A(e,t){var a=e,n=t;if(a&&n)if("string"==typeof a?a=document.querySelectorAll(a):a.tagName&&(a=[a]),"string"==typeof n){n=n.split(" ");for(var i=0;i<a.length;i+=1){var r;if(a[i].classList)(r=a[i].classList).remove.apply(r,v(n));else for(var o=0;o<n.length;o+=1)a[i].className=a[i].className.replace(new RegExp("\\b".concat(t[o],"\\b"),"g"),"")}}else console.log("Class argument must be string with spaces in between class names.")}var C={playchange:b("playchange"),timechange:b("timechange"),canplaystart:b("canplaystart")};function T(e){e.forEach((function(e){var t=e.querySelector("audio")||e.querySelector("video");t&&!t.paused&&(t.pause(),e.querySelector("[data-player-control]").setAttribute("data-player-control","paused"))}))}function _(e){var t={seconds:Math.floor(e),minutes:Math.floor(e/60)};return t.seconds=(t.seconds-60*t.minutes).toString(10),"".concat(t.minutes,":").concat("0".concat(t.seconds).slice(-2))}var M=function(e){s(a,e);var t=h(a);function a(e){return n(this,a),t.call(this,e)}return r(a,null,[{key:"addEventListeners",value:function(e,t){var a=document.querySelectorAll("[data-player-audio]"),n=e.querySelector("audio"),i=e.querySelector("[data-player-control]"),r=e.querySelector("[data-audio-time-left]");i.addEventListener("click",(function(e){"paused"===i.getAttribute("data-player-control")?(T(a),n.play(),i.setAttribute("data-player-control","playing")):(n.pause(),i.setAttribute("data-player-control","paused")),t(),e.stopPropagation()}),!1),i.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),n.addEventListener("timeupdate",(function(){r.innerText=_(n.currentTime)})),n.addEventListener("ended",(function(){i.setAttribute("data-player-control","paused")}))}}]),a}(p),L=function(){function e(){n(this,e)}return r(e,null,[{key:"start",value:function(e){d3.select(e).raise().classed("is-dragged",!0)}},{key:"dragged",value:function(e,t,a,n,i){var r=g(this.getJustifiedCord(e,t,a,n,i),2),o=r[0],s=r[1];d3.select(t).attr("x",o.toFixed()).attr("y",s.toFixed())}},{key:"end",value:function(e,t,a,n,i){var r=g(this.getJustifiedCord(e,t,a,n,i),2),o=r[0],s=r[1];d3.select(t).attr("x",o.toFixed()).attr("y",s.toFixed()).classed("is-dragged",!1)}},{key:"getOffsetOfText",value:function(e,t){return"left"===e[0]&&"top"===e[1]?[t.width-10,t.height-10]:"left"===e[0]&&"bottom"===e[1]?[t.width-10,0]:"right"===e[0]&&"top"===e[1]?[0,t.height-10]:"right"===e[0]&&"bottom"===e[1]?[0,0]:void 0}},{key:"getJustifiedCord",value:function(e,t,a,n,i){var r={height:i.offsetHeight,width:i.offsetWidth},o=t.getAttribute("data-svg-resolution").split(", ").map((function(e){return parseInt(e,10)}));switch(a){case"text":return this.textJustified(e,t,n,r,o);case"pretahovani":return this.pretahovaniJustified(e,t,n,o);default:return this.circleJustified(e,o,n,r)}}},{key:"textJustified",value:function(e,t,a,n,i){var r=t.getAttribute("data-svg-text-orientation").split(", "),o=this.getOffsetOfText(r,n);return[e.x-a.x<=10+o[0]?10+o[0]:e.x-a.x>i[0]-n.width+o[0]?i[0]-n.width+o[0]:e.x-a.x,e.y-a.y<=10+o[1]?10+o[1]:e.y-a.y>i[1]-n.height+o[1]?i[1]-n.height+o[1]:e.y-a.y]}},{key:"pretahovaniJustified",value:function(e,t,a,n){var i=t.attributes.height.value,r=t.attributes.width.value;return[e.x-a.x<=0?0:e.x-a.x>n[0]-r?n[0]-r:e.x-a.x,e.y-a.y<=0?0:e.y-a.y>n[1]-i?n[1]-i:e.y-a.y]}},{key:"circleJustified",value:function(e,t,a,n){return[e.x-a.x<=n.width/2?n.width/2:e.x-a.x>t[0]-n.width/2?t[0]-n.width/2:e.x-a.x,e.y-a.y<=n.height/2?n.height/2:e.y-a.y>t[1]-n.height/2?t[1]-n.height/2:e.y-a.y]}},{key:"circleMove",value:function(e,t,a,n,i){var r=g(this.circleJustified(t,a,n,i),2),o=r[0],s=r[1];e.attr("cx",o.toFixed()).attr("cy",s.toFixed())}}]),e}(),I=function(){function e(){n(this,e)}return r(e,null,[{key:"renderPath",value:function(t,a,n,i){if("image"===t.sourceEvent.target.nodeName){var r=d3.line().curve(d3.curveLinear),o=d3.format(".0f"),s=t.subject,c=o(t.x),l=o(t.y),d="".concat(a.id,"_path-").concat(c,"-").concat(l),u=d3.select("#".concat(a.id," .svg-view")).append("svg:path").attr("data-svg-path","").attr("class","svg-path ".concat(n)).attr("id",d).datum(s);t.on("drag",(function(e){var t=o(e.x),a=o(e.y),n=t-c,i=a-l;n*n+i*i>300?s.push([c=t,l=a]):s[s.length-1]=[t,a],u.attr("d",r)})).on("end",(function(){var e=d3.select("#".concat(d));e&&(e.attr("d")?e.attr("d").length<40?e.remove():k(document,"svg.change",{},{svg:{id:a.id,task:"create",node:e.node(),nodeName:e.node().nodeName,contextMenu:!1}}):e.attr("d")||e.remove()),i()})),e.pathEventsManager(a,d3.select("#".concat(d)).node())}}},{key:"createCircle",value:function(t,a,n){var i=d3.select(a).select(".svg-view"),r=$(t,a),o="".concat(a.id,"_circle-").concat(r.x,"-").concat(r.y);i.append("svg:circle").attr("data-svg-circle","").attr("id",o).attr("cx",r.x).attr("cy",r.y).attr("data-svg-resolution","".concat(i.attr("width"),", ").concat(i.attr("height"))).attr("data-svg-type","circle").attr("class","svg-circle ".concat(n," unselectable"));var s=document.querySelector("#".concat(o));e.circleEventsManager(a,s),k(document,"svg.change",{},{svg:{id:a.id,task:"create",node:s,nodeName:s.nodeName,contextMenu:!1}})}},{key:"pathEventsManager",value:function(e,t){d3.select("#".concat(t.id)).on("click",(function(a){k(document,"svg.change",{},{svg:{id:e.id,task:"remove",node:a.target,nodeName:a.target.nodeName,contextMenu:!1}}),d3.select("#".concat(t.id)).remove(),a.preventDefault()}),!1)}},{key:"circleEventsManager",value:function(e,t){var a,n=document.querySelector("#".concat(e.id," .svg-view")),i=d3.select(t),r=[parseInt(n.getAttribute("width"),10),parseInt(n.getAttribute("height"),10)],o=(a="r",getComputedStyle(t).getPropertyValue(a)||null),s=[2*o,2*o],c=[i.attr("cx"),i.attr("cy")],l={};i.on("click",(function(a){k(document,"svg.change",{},{svg:{id:e.id,task:"remove",node:t,nodeName:t.nodeName,contextMenu:!1}}),a.target.remove()})).call(d3.drag().container(n).subject(t).on("start",(function(e){l={x:e.x-c[0],y:e.y-c[1]},L.start(t),k(document,"event.propagation",{},{event:{from:"circle.drag.start",data:e}})})).on("drag",(function(e){k(document,"event.stopPropagation",{},{event:{}}),"true"!==i.attr("data-svg-selected")&&L.circleMove(i,e,r,l,s)})).on("end",(function(a){if(k(document,"event.stopPropagation",{},{event:{}}),"true"!==i.attr("data-svg-selected")){var n=c[0],o=c[1],d="move";L.circleMove(i,a,r,l,s),i.classed("is-dragged",!1),c=[t.getAttribute("cx"),t.getAttribute("cy")],N.removeCloneConnectionManager(t)&&(d="create"),c[0]===n&&c[1]===o||k(document,"svg.change",{},{svg:{id:e.id,task:d,node:t,nodeName:t.nodeName,contextMenu:!1}})}})))}},{key:"dropItemEventsManager",value:function(e,t){var a=document.querySelector("#".concat(e.id," .svg-view")),n=d3.select(t),i=[n.attr("x"),n.attr("y")],r={};n.on("click",(function(){k(document,"svg.change",{},{svg:{id:e.id,task:"remove",node:t,nodeName:t.nodeName,contextMenu:!1}});var a=t.id.split("_"),n=e.closest(".slide");"dropItem"===a[a.length-1]&&k(document,"svg.drop.delete",{},{item:{slideId:n.id,id:a[1],$object:t.firstChild}}),t.remove()})).call(d3.drag().container(a).subject(t).on("start",(function(e){r={x:e.x-i[0],y:e.y-i[1]},L.start(t),k(document,"event.propagation",{},{event:{from:"circle.drag.start",data:e}})})).on("drag",(function(e){k(document,"event.stopPropagation",{},{event:{}}),"true"!==n.attr("data-svg-selected")&&L.dragged(e,t,"pretahovani",r,t)})).on("end",(function(a){if(k(document,"event.stopPropagation",{},{event:{}}),"true"!==n.attr("data-svg-selected")){var o=i[0],s=i[1],c="move";L.end(a,t,"pretahovani",r,t),n.classed("is-dragged",!1),i=[t.getAttribute("x"),t.getAttribute("y")],N.removeCloneConnectionManager(t)&&(c="create"),i[0]===o&&i[1]===s||k(document,"svg.change",{},{svg:{id:e.id,task:c,node:t,nodeName:t.nodeName,contextMenu:!1}})}})))}}]),e}(),q=function(){function e(){n(this,e)}return r(e,null,[{key:"createText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:333,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n="15.2rem",i="55px",r=document.querySelector('[data-svg-active="true"]'),o=r.id,s=d3.select(r).select(".svg-view"),c=document.querySelector("[data-radial-menu]"),l={x:c.getAttribute("data-local-x"),y:c.getAttribute("data-local-y")},d="".concat(o,"_svg-text-").concat(l.x,"-").concat(l.y),u="#".concat(d),h={x:s.attr("width")-l.x>320?"right":"left",y:s.attr("height")-l.y>60?"bottom":"top"},g=s.append("svg:foreignObject").attr("class","svg-text orientation-".concat(h.x," orientation-").concat(h.y," unselectable")).attr("data-svg-text","").attr("x",l.x).attr("y",l.y).attr("data-svg-text-orientation","".concat(h.x,", ").concat(h.y)).attr("data-svg-resolution","".concat(s.attr("width"),", ").concat(s.attr("height"))).attr("style","width: ".concat(n,"; height: ").concat(i,";")),v=s.append("svg:circle").attr("id","".concat(d,"-circle")).attr("cx",l.x).attr("cy",l.y).attr("class","svg-circle svg-circle-text do-not-remove unselectable"),m=g.append("xhtml:textarea").attr("maxlength",t).attr("tabindex","-1").attr("id",d).attr("class","svg-textarea").attr("data-save","").attr("data-svg-textarea-target",o).attr("style","width: ".concat(n,"; height: ").concat(i,";"));e.fixVisualOrientation(g.node()),r.querySelector(u).focus(),e.textEventsManager(r,m.node(),v.node(),!0,a)}},{key:"textEventsManager",value:function(t,a,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=t.querySelector(".svg-view"),s="#".concat(a.id),c=i,l=a.value,d=t.querySelector(s).parentElement,u=[d.getAttribute("x"),d.getAttribute("y")],h={};d3.select(s).call(d3.drag().container(o).subject(d).on("start",(function(e){h={x:e.x-u[0],y:e.y-u[1]},L.start(d),k(document,"event.propagation",{},{event:{from:"text.drag.start",data:e}})})).on("drag",(function(e){k(document,"event.stopPropagation",{},{event:{}}),L.dragged(e,d,"text",h,a),n.setAttribute("cx",d.getAttribute("x")),n.setAttribute("cy",d.getAttribute("y"))})).on("end",(function(e){k(document,"event.stopPropagation",{},{event:{}}),a.focus();var i=u[0],r=u[1],o="move";L.end(e,d,"text",h,a),u=[d.getAttribute("x"),d.getAttribute("y")],n.setAttribute("cx",u[0]),n.setAttribute("cy",u[1]),c||u[0]===i&&u[1]===r||(N.removeCloneConnectionManager(d.childNodes[0])&&(o="create",N.removeCloneConnectionManager(n)),k(document,"svg.change",{},{svg:{id:t.id,task:o,node:d.childNodes[0],nodeName:d.childNodes[0].nodeName,circle:n,contextMenu:!1}})),d3.select(n).raise()}))).on("keyup",(function(t){e.updateTextareaHeight(t.target)})).on("blur",(function(e){var a,i=e.target,o=i.value,d=!1;0!==o.length?(o.length<r?(S(i,"is-wrong"),d=!0):o.length>=r&&E(i,"is-wrong")&&(A(i,"is-wrong"),d=!1),l!==o&&(c?(a="create",c=!1):a="change",l=o,N.removeCloneConnectionManager(i)&&(a="create",N.removeCloneConnectionManager(n)),k(document,"svg.change",{},{svg:{id:t.id,task:a,node:i,nodeName:i.nodeName,circle:n,isWrong:d,contextMenu:!1}})),l=o,e.target.classList.remove("unselectable")):N.removeItem(!1,s)})).on("focus",(function(){d3.select(d).raise(),d3.select(n).raise()}))}},{key:"updateTextareaHeight",value:function(t){t.style.height="1px";var a="".concat(22+t.scrollHeight,"px");t.style.height=a;var n=t.parentElement;n.style.height=a,e.fixVisualOrientation(n)}},{key:"fixVisualOrientation",value:function(e){var t=e.style.width,a=e.style.height;e.classList.contains("orientation-left")&&e.classList.contains("orientation-top")?e.style.transform="translate(-".concat(t,", -").concat(a,")"):e.classList.contains("orientation-top")?e.style.transform="translateY(-".concat(a,")"):e.classList.contains("orientation-left")&&(e.style.transform="translateX(-".concat(t,")"))}},{key:"comicBubblesEventsManager",value:function(t,a){var n=!0,i=a.value;d3.select(a).on("keyup",(function(t){e.updateTextareaHeight(t.target)})).on("blur",(function(e){var a,r=e.target,o=r.value;i!==o&&(n?(a="create",n=!1):(a="change",0===o.length&&(n=!0)),i=o,N.removeCloneConnectionManager(r)&&(a="create"),k(document,"svg.change",{},{svg:{id:t.id,task:a,node:r,nodeName:r.nodeName,isBubble:!0,contextMenu:!1}})),i=o}))}}]),e}(),N=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$canvas=i.target.querySelector(".svg-view"),i.format=d3.format(".0f"),i._setSize(),i.init(),i._initWhenDone(),i}return r(a,[{key:"init",value:function(){if(!HISTORYLAB.import.done){this.toDuplicate=this.target.getAttribute("data-duplicate-svg");for(var e=this.target.getAttribute("data-svg-target").split(" "),t=this.target.getAttribute("data-svg-colors"),a=0;a<e.length;a+=1)if("kresleni"===e[a]){var n=t?t.split(" ")[0]:"yellow";this._initPath(this.showFeedback,n)}else if("znacky"===e[a]){var i=t?t.split(" ")[0]:"blue";this._initCircle(this.showFeedback,i)}this._initComicBubbles(),this._getEvents(),this._getDropEvent()}}},{key:"_initWhenDone",value:function(){HISTORYLAB.import.done&&d3.selectAll("[data-svg-text] textarea").on("mouseenter",(function(){d3.select(this.closest("foreignObject")).raise()}))}},{key:"_setSize",value:function(){var e=this.target.getAttribute("viewBox").split(" "),t=this.target.getBoundingClientRect(),a=window.innerWidth,n=.9*window.innerHeight,i=function(){return t.height?t.height>e[3]?e[3]:t.height:e[3]},r=(i()>n?n:i())/e[3],o=e[2]*r,s=r?"".concat(o<a?o:a,"px"):"";this.target.style.maxWidth=s,this.target.getAttribute("data-svg-drop")&&!this.target.closest(".layout-vertical")&&(this.target.closest(".svgs-container").style.maxWidth=s)}},{key:"_initPath",value:function(e,t){var a=this;d3.select(this.target).call(d3.drag().container((function(){return a.target})).subject((function(e){var t=[e.x.toFixed(),e.y.toFixed()];return[t,t]})).on("start",(function(n){I.renderPath(n,a.target,t,e)})))}},{key:"_initCircle",value:function(e,t){var a=this;d3.select(this.target).on("click",(function(n){"image"===n.target.nodeName&&(I.createCircle(n,a.target,t),e(),n.preventDefault())}),!1)}},{key:"_initComicBubbles",value:function(){var e=this,t=this.target.querySelectorAll(".svg-komiks .svg-textarea");t&&t.forEach((function(t){q.comicBubblesEventsManager(e.target,t)}))}},{key:"_generateNewID",value:function(e){var t=e.split("_");return t.length<2?(console.log("Svg ID error!",e),e):(t[t.length-1]!=="clone-".concat(t[0])&&t.push("clone-".concat(t[0])),t[0]=this.target.id,t.join("_"))}},{key:"_getEvents",value:function(){var e=this,t=this.toDuplicate?this.toDuplicate.split(" "):[];t[0]&&document.addEventListener("svg.change",(function(a){if(t.includes(a.detail.svg.id)){var n,i=a.detail.svg.node,r=a.detail.svg.circle,o=a.detail.svg.nodeName,s=e._generateNewID(i.id),c=e.target.querySelector("#".concat(s));if(!c&&"create"!==a.detail.svg.task)return;if(n=a.detail.svg.task,"path"===o)switch(n){case"create":e._clonePath(i,s);break;case"color":A(c,"red blue"),S(c,a.detail.svg.color);break;case"remove":c.remove();break;default:console.log("Nondefinated path events task. :(")}else if("TEXTAREA"===o)if(a.detail.svg.isBubble)switch(n){case"create":e._cloneComicBubbles(i,s);break;case"change":0!==i.value.length?(c.value=i.value,c.style.height!==i.style.height&&(c.style.height=i.style.height)):c.parentElement.remove();break;default:console.log("Nondefinated comicBubble events task. :(")}else{var l;if(r)l=r.id;else{var d=i.id.split("_");d[1]+="-circle",l=d.join("_")}var u=e._generateNewID(l),h=e.target.querySelector("#".concat(u));switch(n){case"create":e._cloneTextField(a.detail.svg.isWrong,i,r,s,u);break;case"change":c.value=i.value,a.detail.svg.isWrong?S(c,"is-wrong"):A(c,"is-wrong"),c.style.height!==i.style.height&&(c.style.height=i.style.height);break;case"color":A(h,"red blue"),S(h,a.detail.svg.color);break;case"move":c&&(c.parentElement.remove(),h.remove()),e._cloneTextField(a.detail.svg.isWrong,i,r,s,u);break;case"remove":c.parentElement.remove(),h.remove();break;default:console.log("Nondefinated textField events task. :(")}}else if("circle"===o)switch(n){case"create":e._cloneCircle(i,s);break;case"color":A(c,"red blue"),S(c,a.detail.svg.color);break;case"move":c&&c.remove(),e._cloneCircle(i,s);break;case"remove":c.remove();break;default:console.log("Nondefinated circle events task. :(")}else if("foreignObject"===o)switch(n){case"create":e._cloneDropItem(i,s);break;case"move":c&&c.remove(),e._cloneDropItem(i,s);break;case"remove":c.remove();break;default:console.log("Nondefinated drop item events task. :(")}else console.log("Nondefinated events nodeName. :(",o);k(document,"svg.change",{},{svg:{id:e.target.id,task:a.detail.svg.task,node:i,circle:r,nodeName:o,contextMenu:!1}})}}))}},{key:"_getDropEvent",value:function(){var e=this,t=0;document.addEventListener("svg.drop",(function(a){if(a.detail.svg.id===e.target.id){var n=a.detail.svg,i=n.$node,r=n.position,o=n.type,s=n.size,c="image"===o||"svg"===o?.62:"tag"===o?1.075:1;s.width*=c,s.height*=c;var l={x:e.format(s.width/2),y:e.format(s.height/2)},d=d3.select("#".concat(e.target.id," .svg-view")),u=d.append("svg:foreignObject").attr("width","".concat(s.width)).attr("height","".concat(s.height)).attr("x",e.format(r.x-l.x)).attr("y",e.format(r.y-l.y)).attr("data-svg-resolution","".concat(d.attr("width"),", ").concat(d.attr("height"))).attr("data-svg-type","pretahovani").attr("id","".concat(e.target.id,"_").concat(i.getAttribute("data-id"),"_").concat(t,"_dropItem")).attr("class","unselectable try-something"),h=u.append("xhtml:div").attr("class","dropped__item dropped__item--".concat(o," unselectable")).attr("style","width: ".concat(s.width,"px; height: ").concat(s.height,"px;")).node(),g=i.firstElementChild.firstElementChild;g.classList.add("unselectable"),g.style.width="".concat(s.width,"px"),g.style.height="".concat(s.height,"px"),h.appendChild(g);var v=u.node();t+=1,I.dropItemEventsManager(e.target,v),L.end(r,v,"pretahovani",l,i),k(document,"svg.change",{},{svg:{id:e.target.id,task:"create",node:v,nodeName:v.nodeName,contextMenu:!1}})}}))}},{key:"_clonePath",value:function(e,t){var a=e.cloneNode(!0);a.id=t,this.$canvas.appendChild(a),I.pathEventsManager(this.target,a)}},{key:"_cloneTextField",value:function(e,t,a,n,i){var r=a.cloneNode(!0);r.id=i,this.$canvas.appendChild(r);var o=t.parentElement.cloneNode(!0);o.childNodes[0].id=n,this.$canvas.insertBefore(o,r),e?S(o,"is-wrong"):A(o,"is-wrong"),q.textEventsManager(this.target,o.childNodes[0],r,!1)}},{key:"_cloneCircle",value:function(e,t){var a=e.cloneNode(!0);return a.id=t,this.$canvas.appendChild(a),I.circleEventsManager(this.target,a),a}},{key:"_cloneDropItem",value:function(e,t){var a=e.cloneNode(!0);return a.id=t,this.$canvas.appendChild(a),I.dropItemEventsManager(this.target,a),a}},{key:"_cloneComicBubbles",value:function(e,t){var a=e.parentElement.cloneNode(!0);a.childNodes[1].id=t,this.$canvas.appendChild(a),q.comicBubblesEventsManager(this.target,a.childNodes[1])}}],[{key:"selectItem",value:function(e){e.setAttribute("data-svg-selected","true")}},{key:"deselectItem",value:function(){for(var e=document.querySelectorAll('[data-svg-selected="true"]'),t=0;t<e.length;t+=1)e[t].setAttribute("data-svg-selected","false")}},{key:"removeItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'[data-svg-selected="true"]',a=document.querySelector(t),n=a.nodeName,i=a.parentElement;switch(n){case"path":case"circle":case"TEXTAREA":break;case"DIV":n=(a="pretahovani"===i.getAttribute("data-svg-type")?i:i.childNodes[0]).nodeName;break;default:console.log("Nondefinated node type. :(",n)}var r=a.id.split("_")[0];if(k(document,"svg.change",{},{svg:{id:r,task:"remove",node:a,nodeName:n,contextMenu:e}}),"foreignObject"===i.nodeName){var o=a.id.split("_");d3.select('[id^="'.concat(o[0],"_").concat(o[1],'-circle"')).remove(),d3.select(i).remove();var s=i.id.split("_"),c=document.querySelector("#".concat(r)).closest(".slide");"dropItem"===s[s.length-1]&&k(document,"svg.drop.delete",{},{item:{slideId:c.id,id:s[1],$object:a.firstChild}})}else d3.select(a).remove()}},{key:"deactivate",value:function(){for(var e=document.querySelectorAll('[data-svg-active="true"]'),t=0;t<e.length;t+=1)e[t].setAttribute("data-svg-active","false")}},{key:"activate",value:function(e){a.deactivate(),e.setAttribute("data-svg-active","true")}},{key:"removeCloneConnectionManager",value:function(e){var t=e.id.split("_");return!!t[t.length-1].includes("clone")&&(t.pop(),e.id=t.join("_"),!0)}},{key:"findNearElements",value:function(e){var t=e.target;return"image"!==t.nodeName&&"svg"!==t.nodeName||[[-3,-3],[0,-5],[3,-3],[-5,0],[5,0],[-3,3],[0,5],[3,3]].every((function(a){var n=x(e),i=document.elementFromPoint(n.x+a[0],n.y+a[1]);return"DIV"===i.nodeName||"svg"===i.nodeName||"image"===(t=i).nodeName})),t}}]),a}(p),O=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$settings=document.querySelector('[data-sortable-id-reference="'.concat(i.target.id,'"]')),i.feedback=JSON.parse(i.$settings.getAttribute("data-module-zpetnavazba")),i.$container=i.target,i.$items=i.target.querySelectorAll("[data-sortable-drag]"),i.$droppables=i.target.querySelectorAll("[data-sortable-drop]"),i.$placeholder=function(){return document.querySelector("#sortable-placeholder")},i.$players=i.$container.querySelectorAll("[data-player-audio]"),i.$inheritors=document.querySelectorAll("[data-sortable-inheritor=".concat(i.target.id,"]")),i.inheritors=[],i.order=[],i.direction=i.target.getAttribute("data-sortable-target"),i.trackingTouch=!1,i.before=!1,i.after=!1,i.evaluation=void 0,i.mouse={x:function(e){return e.clientX||e.touches[0].clientX},y:function(e){return e.clientY||e.touches[0].clientY},x0:0,y0:0,x1:0,y1:0},i.dragged={el:null,clone:null,posRel:{},rect:function(){return i.dragged.el.getBoundingClientRect()},size:{},type:null},i.siblings={prev:null,next:null},i._onStart=i._onStart.bind(d(i)),i._onMove=i._onMove.bind(d(i)),i._onEnd=i._onEnd.bind(d(i)),i._update=i._update.bind(d(i)),i._setupInitialOrder(),i._setupInheritors(),i._addEventListeners(),i.cache={colors:[]},i.feedback&&(i.cache.colors=i.feedback.map((function(e){return e.barva}))),i}return r(a,[{key:"_onStart",value:function(e){e.target.hasAttribute("data-sortable-drag")&&(this.$players.length>0&&T(this.$players),this.trackingTouch=!0,this.dragged.el=e.target,this.dragged.type=e.target.getAttribute("data-sortable-drag"),this.dragged.clone=this.dragged.el.cloneNode(!0),this.dragged.posRel.top=this.dragged.el.offsetTop,this.dragged.posRel.left=this.dragged.el.offsetLeft,this.dragged.size.width=this.dragged.el.offsetWidth,this.dragged.size.height=this.dragged.el.offsetHeight,this.dragged.el.style.top="".concat(this.dragged.posRel.top,"px"),this.dragged.el.style.left="".concat(this.dragged.posRel.left,"px"),this.dragged.el.style.width="".concat(this.dragged.size.width,"px"),this.dragged.el.style.height="".concat(this.dragged.size.height,"px"),this.dragged.el.classList.add("is-dragged"),this.$container.classList.add("is-dragged"),this._addPlaceholder(this.dragged.el),this._onOver(),this.mouse.x0=this.mouse.x(e),this.mouse.y0=this.mouse.y(e),e.preventDefault())}},{key:"_onMove",value:function(e){this.trackingTouch&&(this.mouse.x1=this.mouse.x(e)-this.mouse.x0,this.mouse.y1=this.mouse.y(e)-this.mouse.y0,window.requestAnimationFrame(this._update),this._onOver())}},{key:"_onEnd",value:function(e){if(this.trackingTouch){this.trackingTouch=!1,this.$container.classList.remove("is-dragged"),this.dragged.el.classList.remove("is-dragged"),this.dragged.el.style.top="",this.dragged.el.style.left="",this.dragged.el.style.width="",this.dragged.el.style.height="",this.dragged.el.style.transform="";var t=this.$placeholder().getBoundingClientRect();switch(this.direction){case"horizontal":t.left<=this.mouse.x(e)<=t.right&&this._onDrop();break;case"vertical":t.top<=this.mouse.y(e)<=t.bottom&&this._onDrop()}this._removePlaceholder(),this._updateOrder(),this._updateOrderInInheritors(),this._dispatchEvent(),this._checkAndResolveFeedback()}}},{key:"_onOver",value:function(){if(this.before=!1,this.after=!1,this._getReference(),this.siblings.next&&this.siblings.next.hasAttribute("data-sortable-drop")){var e=this.siblings.next.getBoundingClientRect();switch(this.direction){case"horizontal":this.dragged.rect().right>e.left+e.width/1.5&&(this.after=!0,this._addPlaceholder(this.siblings.next));break;case"vertical":this.dragged.rect().bottom>e.top+e.height/1.5&&(this.after=!0,this._addPlaceholder(this.siblings.next))}}if(this.siblings.prev&&this.siblings.prev.hasAttribute("data-sortable-drop")){var t=this.siblings.prev.getBoundingClientRect();switch(this.direction){case"horizontal":this.dragged.rect().left<t.right-t.width/1.5&&(this.before=!0,this._addPlaceholder(this.siblings.prev));break;case"vertical":this.dragged.rect().top<t.bottom-t.height/1.5&&(this.before=!0,this._addPlaceholder(this.siblings.prev))}}}},{key:"_onDrop",value:function(){var e=this.$placeholder();this._addEventListenerToItem(this.dragged.clone),this.dragged.clone.querySelector("[data-player-audio]")&&M.addEventListeners(this.dragged.clone,this.showFeedback),this.$container.insertBefore(this.dragged.clone,e),this.dragged.el.parentElement.removeChild(this.dragged.el)}},{key:"_update",value:function(){this.dragged.el.style.transform="translate3d(".concat(this.mouse.x1,"px, ").concat(this.mouse.y1,"px, 0) rotate(5deg)")}},{key:"_addPlaceholder",value:function(e){this._removePlaceholder();var t=document.createElement("div");if(t.classList.add("sortable-item","sortable-placeholder"),t.setAttribute("id","sortable-placeholder"),t.style.minHeight="".concat(this.dragged.size.height,"px"),this.dragged.el.querySelector("img")){var a=this.dragged.el.querySelector("img").getAttribute("src"),n=document.createElement("img");n.setAttribute("src",a),t.appendChild(n)}this.after?this.$container.insertBefore(t,e.nextElementSibling):(this.before,this.$container.insertBefore(t,e))}},{key:"_removePlaceholder",value:function(){var e=this.$placeholder();e&&e.parentElement.removeChild(e)}},{key:"_getReference",value:function(){var e=this.$placeholder();this.siblings.prev=e.previousElementSibling===this.dragged.el?this.dragged.el.previousElementSibling:e.previousElementSibling,this.siblings.next=e.nextElementSibling===this.dragged.el?this.dragged.el.nextElementSibling:e.nextElementSibling}},{key:"_addEventListenerToItem",value:function(e){e.addEventListener("touchstart",this._onStart,!1),e.addEventListener("mousedown",this._onStart,!1),"svg"===this.dragged.type&&new N(e.querySelector("[data-svg-target]"))}},{key:"_addEventListeners",value:function(){var e=this;document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onEnd),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onEnd),this.$items.forEach((function(t){e._addEventListenerToItem(t)}))}},{key:"checkIfTheArrayIsGood",value:function(e){return!e.some((function(e,t){return t!==e-1}))}},{key:"oneMove",value:function(e){if(this.checkIfTheArrayIsGood(e))return 0;for(var t=0;t<e.length;t+=1)if(e[t]!==t+1){var a=v(e),n=a[t];if(a.splice(t,1),a.splice(n-1,0,n),this.checkIfTheArrayIsGood(a))return 1}return 2}},{key:"_checkAndResolveFeedback",value:function(){if(this.feedback){var e,t=v(this.target.querySelectorAll("[data-sortable-drag]")).map((function(e){return parseInt(e.dataset.sortableSpravnaodpoved,10)})),a=0;2===this.feedback.length?this.checkIfTheArrayIsGood(t)||(a=1):a=this.oneMove(t);var n=this.feedback.find((function(e){return e.podminka===a}));(e=this.$buttonFeedback.classList).remove.apply(e,v(this.cache.colors)),this.$buttonFeedback.classList.add(n.barva),this.$buttonFeedbackText.innerText=n.text,this.evaluation=n.splneno}this.showFeedback()}},{key:"_setupInitialOrder",value:function(){this._updateOrder()}},{key:"_setupInheritors",value:function(){this.$inheritors.length>0&&(this.inheritors=Array.from(this.$inheritors).map((function(e){return{$inheritor:e,$container:e.querySelector("[data-sortable-inheritor-item]").parentElement}})))}},{key:"_updateOrder",value:function(){this.order=Array.from(this.target.querySelectorAll("[data-sortable-drag]")).map((function(e){return{id:parseInt(e.dataset.sortableIndex,10)}}))}},{key:"_updateOrderInInheritors",value:function(){var e=this;this.$inheritors.length>0&&this.inheritors.forEach((function(t){e.order.forEach((function(e){t.$container.appendChild(t.$container.querySelector('[data-sortable-inheritor-item="'.concat(e.id,'"]')))}))}))}},{key:"_dispatchEvent",value:function(){k(this.target,"sortable.change",{},{id:this.target.id,evaluation:this.evaluation,order:this.order})}}]),a}(p),D=function(){function e(t,a){n(this,e),this.$radialMenu=t,this.$radialMenuItems=this.$radialMenu.querySelectorAll("[data-radial-menu-item]"),this.$colorItems=this.$radialMenu.querySelectorAll(".radial-menu-color"),this.$textItems=this.$radialMenu.querySelectorAll(".radial-menu-text"),this.$createTextItem=this.$radialMenu.querySelector("#create-text"),this.$removeItem=this.$radialMenu.querySelector("#remove-content"),this.$tooltip=this.$radialMenu.querySelector("[data-radial-menu-tooltip]"),this.$svgs=a,this.initialSetUp=!0,this.menuRadius=parseInt(window.getComputedStyle(this.$radialMenu.querySelector(".radial-menu-wrapper"),null).getPropertyValue("width"),10)/2,this.itemRadius=parseInt(window.getComputedStyle(this.$radialMenu.querySelector(".radial-menu-item"),null).getPropertyValue("width"),10)/2,this.init()}return r(e,[{key:"init",value:function(){var e=this;this.setUpRadialMenuItems(),this.addEventListenersToRadialMenu(),this.$svgs.forEach((function(t){d3.select(t).on("contextmenu",(function(a){e.openRadialMenu(a,t)})),e.iOSAddonEvents(t)}))}},{key:"iOSAddonEvents",value:function(e){var t,a=this;/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(console.log("This is a IOS device"),document.addEventListener("event.propagation",(function(n){var i=n.detail.event.data.sourceEvent;t=setTimeout((function(){i.preventDefault(),a.openRadialMenu(i,e)}),400)})),document.addEventListener("event.stopPropagation",(function(){t&&clearTimeout(t)})),e.addEventListener("touchstart",(function(n){1===n.touches.length&&(t=setTimeout((function(){n.preventDefault(),n.stopPropagation(),a.openRadialMenu(n,e)}),400))})),e.addEventListener("touchmove",(function(){t&&clearTimeout(t)})),e.addEventListener("touchend",(function(){t&&clearTimeout(t)})),e.addEventListener("touchcancel",(function(){t&&clearTimeout(t)})))}},{key:"openRadialMenu",value:function(t,a){var n=e.hasText(a),i=e.hasMoreColors(a),r=N.findNearElements(t);N.activate(a),N.deselectItem(),this.filterMenuButtons(r,n,i),this.showRadialMenu(t,a),t.preventDefault(),window.getSelection().removeAllRanges(),this.initialSetUp=!1}},{key:"setUpRadialMenuItems",value:function(){var e=this;this.$radialMenuItems.forEach((function(t){e.addEventListenersToRadialMenuItem(t)}))}},{key:"positionRadialMenuItems",value:function(e){var t=e.length,a=this.menuRadius,n=this.itemRadius,i=a-n,r=.6283185307,o=-r/2+t*r/2;e.forEach((function(e,t){var n=Math.PI+t*r*-1+o,s=a*Math.sin(n)+i,c=a*Math.cos(n)+i;e.style.left="".concat(s.toFixed(1),"px"),e.style.top="".concat(c.toFixed(1),"px")}))}},{key:"addEventListenersToRadialMenu",value:function(){var e=this;this.onMouseLeave(),this.$radialMenu.addEventListener("click",(function(t){e.hideRadialMenu(e.$radialMenu),t.preventDefault()})),this.$radialMenu.addEventListener("contextmenu",(function(t){e.hideRadialMenu(e.$radialMenu),t.preventDefault()}))}},{key:"addEventListenersToRadialMenuItem",value:function(t){var a=this,n=t,i=n.getAttribute("data-radial-menu-item");"remove-content"===i?n.addEventListener("click",(function(){N.removeItem(!0),a.hideRadialMenu()}),!1):"create-text"===i?d3.select(n).on("click",(function(){q.createText(),a.hideRadialMenu()}),!1):"color-point-blue"===i?n.addEventListener("click",(function(){e.changeColor("blue"),a.hideRadialMenu()}),!1):("color-point-red"===i||"color-point-red"===i)&&n.addEventListener("click",(function(){e.changeColor("red"),a.hideRadialMenu()}),!1),n.addEventListener("mouseenter",(function(e){a.$tooltip.innerHTML=e.currentTarget.getAttribute("data-radial-menu-item-tooltip"),a.$tooltip.style.display="block"}),!1),n.addEventListener("mouseleave",(function(){a.$tooltip.innerHTML="",a.$tooltip.style.display="none"}),!1)}},{key:"showRadialMenu",value:function(e,t){var a=t||document.querySelector('[data-svg-active="true"]'),n=x(e),i=$(e,a);this.$radialMenu.setAttribute("data-local-x",i.x),this.$radialMenu.setAttribute("data-local-y",i.y),this.$radialMenu.style.top="".concat(n.y-7,"px"),this.$radialMenu.style.left="".concat(n.x-7,"px");var r=this.$radialMenu.querySelectorAll(".is-active");this.positionRadialMenuItems(r),S(this.$radialMenu,"is-active")}},{key:"hideRadialMenu",value:function(){var e=this;A(this.$radialMenu,"is-active"),N.deactivate(),N.deselectItem(),setTimeout((function(){E(e.$radialMenu,"is-active")||e.$radialMenuItems.forEach((function(e){A(e,"is-active")}))}),150)}},{key:"onMouseLeave",value:function(){var e,t=this;this.$radialMenu.addEventListener("mouseleave",(function(){e=setTimeout((function(){t.hideRadialMenu(t.$radialMenu)}),500)})),this.$radialMenu.addEventListener("mouseenter",(function(){clearTimeout(e)}))}},{key:"filterMenuButtons",value:function(e,t,a){(E(e,"svg-path")||"path"===e.nodeName)&&(t?S(this.$createTextItem,"is-active"):A(this.$createTextItem,"is-active"),a&&this.$colorItems.forEach((function(e){S(e,"is-active")})),this.$textItems.forEach((function(e){A(e,"is-active")}))),E(e,"svg-circle")&&(t?S(this.$createTextItem,"is-active"):A(this.$createTextItem,"is-active"),a&&this.$colorItems.forEach((function(e){S(e,"is-active")})),this.$textItems.forEach((function(e){A(e,"is-active")}))),E(e,"svg-textarea")&&(A(this.$createTextItem,"is-active"),E(e,"do-not-remove")||(this.$colorItems.forEach((function(e){A(e,"is-active")})),this.$textItems.forEach((function(e){S(e,"is-active")})))),"image"===e.nodeName?(t?S(this.$createTextItem,"is-active"):A(this.$createTextItem,"is-active"),A(this.$removeItem,"is-active"),this.$colorItems.forEach((function(e){A(e,"is-active")})),this.$textItems.forEach((function(e){A(e,"is-active")}))):(E(e,"do-not-remove")?A(this.$removeItem,"is-active"):(t?S(this.$createTextItem,"is-active"):A(this.$createTextItem,"is-active"),S(this.$removeItem,"is-active")),N.selectItem(e))}}],[{key:"hasText",value:function(e){return e.getAttribute("data-svg-target").split(" ").includes("text")}},{key:"hasMoreColors",value:function(e){var t=e.getAttribute("data-svg-colors"),a=t?t.split(" "):void 0;return a&&a.length>1||!t}},{key:"changeColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'[data-svg-selected="true"]',a=document.querySelector(t),n=a.nodeName,i="color";switch(A(a,"red blue"),S(a,e),n){case"path":case"circle":break;case"DIV":n=(a=a.parentElement.childNodes[1]?a.parentElement.childNodes[1]:a.parentElement).nodeName;break;default:console.log("Nondefinated node type. :(",n)}if("circle"===n&&a.id.includes("svg-text")){var r=a.id.replace("-circle",""),o=document.querySelector("#".concat(r));N.removeCloneConnectionManager(o)}N.removeCloneConnectionManager(a)&&(i="create");var s=a.id.split("_")[0];k(document,"svg.change",{},{svg:{id:s,task:i,node:a,nodeName:n,contextMenu:!0,color:e}})}}]),e}(),F=function(){function e(t,a,i,r){n(this,e),this.$menuBox=r,this.init(t,a,i),this.update(i,null)}return r(e,[{key:"init",value:function(t,a,n){var i=this,r=a.nodes,o=a.marks;this.$menuBox.querySelector("a").addEventListener("click",(function(){i.update(n)})),n.dom.parentNode.addEventListener("blur",(function(e){!e.relatedTarget||e.relatedTarget.classList.contains("menu-item")||e.relatedTarget.classList.contains("contextual-menu-component")||i.update(n)}));var s=this.$menuBox.querySelectorAll(".menu-item"),c=0;s&&s.forEach((function(a){var s=a.getAttribute("data-color"),l=a.getAttribute("data-command-name");a.addEventListener("click",(function(a){if(a.preventDefault(),e.isAdded(o.marker,n.state))i.update(n,null);else{var d="".concat(i.$menuBox.id,"-").concat(c);e.addRemoveButton(n,r.removeButton),pm.toggleMark(o.marker,{color:s,dataCommandName:l,dataTagId:d})(n.state,n.dispatch,n);var u=n.state.selection;e.closeSelection(n),c+=1;var h=e.connectAllSelectedParts(n,d);e.removingMarkerHandler({editorId:t,editorView:n,markedSelection:u,$dispatchNode:h,dataTagId:d,dataCommandName:l,marker:o.marker}),k(document,"editor.change",{},{text:{id:t,task:"add",tagData:{tagName:l},value:h,tagColor:s}})}}))})),n.dom.parentNode.appendChild(this.$menuBox)}},{key:"update",value:function(e,t){var a=e.state,n=e.readOnly,i=document.activeElement.classList;if(a&&!n&&!a.selection.empty&&i.contains("canvas"))if(this.$menuBox.classList.remove("hidden"),this.$menuBox.offsetParent){var r=a.selection,o=r.from,s=r.to;try{var c=e.coordsAtPos(o),l=e.coordsAtPos(s),d=this.$menuBox.getBoundingClientRect(),u=this.$menuBox.offsetParent.getBoundingClientRect(),h=(c.left+l.left)/2-d.width/2-u.left;h<5&&(h=5),this.$menuBox.style.left="".concat(h,"px"),this.$menuBox.style.top="".concat(c.top-u.top-d.height,"px")}catch(e){console.error("Menu selection error",e)}}else this.$menuBox.classList.contains("hidden")||this.$menuBox.classList.add("hidden");else this.$menuBox.classList.contains("hidden")||this.$menuBox.classList.add("hidden")}},{key:"destroy",value:function(){this.$menuBox&&this.$menuBox.remove()}}],[{key:"isAdded",value:function(e,t){for(var a=t.selection.ranges,n=!1,i=0;!n&&i<a.length;i+=1){var r=a[i],o=r.$from,s=r.$to;n=t.doc.rangeHasMark(o.pos,s.pos,e)}return n}},{key:"addRemoveButton",value:function(e,t){var a=e.state,n=a.selection.ranges,i=n[n.length-1].$to.pos,r=a.apply(a.tr.insert(i,t.create()));e.updateState(r)}},{key:"closeSelection",value:function(e){var t=e.state,a=t.apply(t.tr.setSelection(pm.TextSelection.create(t.doc,0,0)));e.updateState(a)}},{key:"removingMarkerHandler",value:function(e){var t=e.editorId,a=e.editorView;e.markedSelection;var n=e.$dispatchNode,i=e.dataTagId,r=e.dataCommandName,o=e.marker,s=a.dom.querySelector("[data-tag-id=".concat(i,"] > span.node-close"));s&&s.addEventListener("click",(function(e){e.preventDefault();for(var c=a.dom.querySelectorAll("span[data-tag-id=".concat(i,"]")),l=a.state,d=l.tr,u=function(e){var t=c[e],n=a.posAtDOM(t),i=n+t.textContent.length+2,r=[];d.doc.nodesBetween(n,i,(function(e,t){if(e.isInline){var a=null;if(o instanceof pm.MarkType){var s=o.isInSet(e.marks);s&&(a=[s])}else o?o.isInSet(e.marks)&&(a=[o]):a=e.marks;if(a&&a.length)for(var c=Math.min(t+e.nodeSize,i),l=0;l<a.length;l+=1){for(var d=a[l],u=void 0,h=0;h<r.length;h+=1){var g=r[h];-1===g.step&&d.eq(r[h].style)&&(u=g)}u?(u.to=c,u.step=0):r.push({style:d,from:Math.max(t,n),to:c,step:0})}}})),r.forEach((function(e){return d.step(new pm.RemoveMarkStep(e.from,e.to,e.style))}))},h=0;h<c.length;h+=1)u(h);var g=a.posAtDOM(s);d.delete(g-1,g+1);var v=l.apply(d);a.updateState(v),k(document,"editor.change",{},{text:{id:t,task:"remove",tagData:{tagName:r},value:n}})}))}},{key:"connectAllSelectedParts",value:function(e,t){var a=e.dom.querySelectorAll("span[data-tag-id=".concat(t,"]"));if(1===a.length)return a[0];if(a.length>1){for(var n=a[0].cloneNode(!0),i=a[0].textContent,r=1;r<a.length;r+=1)i+=a[r].textContent;return n.innerHTML=i,n}return console.error("Error: Didn't find parts of marked part of text."),null}}]),e}(),R=function(){function e(t,a){n(this,e),this.$removeAllChanges=a.querySelector(".editor-toolbar-action-reset"),this.init(t)}return r(e,[{key:"init",value:function(e){var t=e.state;this.$removeAllChanges.addEventListener("click",(function(){confirm("Opravdu chcete vrátit text do původní podoby? Vaše změny se tímto ztratí.")&&e.updateState(t)}))}},{key:"destroy",value:function(){this.$removeAllChanges&&this.$removeAllChanges.remove()}}],[{key:"update",value:function(e,t){}}]),e}(),P={nodes:{doc:{content:"block+"},heading:{attrs:{level:{default:1},style:{default:!1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",getAttrs:function(e){return{level:1,style:e.getAttribute("style")}}},{tag:"h2",getAttrs:function(e){return{level:2,style:e.getAttribute("style")}}},{tag:"h3",getAttrs:function(e){return{level:3,style:e.getAttribute("style")}}},{tag:"h4",getAttrs:function(e){return{level:4,style:e.getAttribute("style")}}},{tag:"h5",getAttrs:function(e){return{level:5,style:e.getAttribute("style")}}},{tag:"h6",getAttrs:function(e){return{level:6,style:e.getAttribute("style")}}}],toDOM:function(e){var t=e.attrs.style;return["h".concat(e.attrs.level),{style:t},0]}},paragraph:{content:"inline*",group:"block",defining:!0,attrs:{style:{default:!1}},parseDOM:[{tag:"p",getAttrs:function(e){return{style:e.getAttribute("style")}}}],toDOM:function(e){return["p",{style:e.attrs.style},0]}},list:{content:"block+",group:"block",attrs:{type:{default:!1}},parseDOM:[{tag:"ol",getAttrs:function(e){return{type:e.getAttribute("type")}}}],toDOM:function(e){return["ol",{type:e.attrs.type},0]}},listItem:{content:"inline*",group:"block",parseDOM:[{tag:"li"}],toDOM:function(){return["li",0]}},hard_break:{group:"block",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return["br"]}},text:{inline:!0,group:"inline"},premarked:{content:"inline",inline:!0,group:"inline",attrs:{id:{},textData:{},className:{}},parseDOM:[{tag:"span.text-option",getAttrs:function(e){return{id:e.getAttribute("id"),textData:e.getAttribute("data-text-option"),className:e.getAttribute("class")}}}],toDOM:function(e){var t=e.attrs,a=t.id,n=t.textData;return["span",{id:a,class:t.className,"data-text-option":n},0]}},removeButton:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"span.node-close"}],toDOM:function(){return["span",{class:"node-close"},"×"]}}},marks:{italic:{parseDOM:[{tag:"i"},{tag:"em"}],toDOM:function(){return["em",0]}},bold:{parseDOM:[{tag:"b"}],toDOM:function(){return["b",0]}},code:{parseDOM:[{tag:"code"}],toDOM:function(){return["code",0]}},small:{parseDOM:[{tag:"small"}],toDOM:function(){return["small",0]}},marker:{attrs:{color:{},dataCommandName:{},dataTagId:{}},parseDOM:[{tag:"span[data-tag-id]",getAttrs:function(e){return{color:e.getAttribute("data-color"),dataCommandName:e.getAttribute("data-command-name"),dataTagId:e.getAttribute("data-tag-id")}}}],toDOM:function(e){var t=e.attrs,a=t.color,n=t.dataCommandName,i=t.dataTagId;return["span",{class:"node-selected node-text-".concat(a),"data-command-name":n,"data-tag-id":i,"data-color":a},0]}},writtingInsertPart:{attrs:{id:{}},parseDOM:[{tag:"span.user-inserted-text.user-inserted-text-inner",getAttrs:function(e){return{id:e.getAttribute("data-add-id")}}}],toDOM:function(e){return["span",{class:"user-inserted-text user-inserted-text-inner","data-add-id":e.attrs.id},0]}},writtingRemovePart:{attrs:{id:{}},parseDOM:[{tag:"span.user-removed-text.user-removed-text-inner",getAttrs:function(e){return{id:e.getAttribute("data-remove-id")}}}],toDOM:function(e){return["span",{class:"user-removed-text user-removed-text-inner","data-remove-id":e.attrs.id},0]}}}},z=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).editor=void 0,i.id=i.target.id,i.editorType=i.target.getAttribute("data-editor"),i.$editor=i.target.querySelector("#prosemirror-editor-".concat(i.id)),i.$content=i.target.querySelector("#prosemirror-content-".concat(i.id)),i.schema=new pm.Schema(P),HISTORYLAB.import.done?i.initJSON():i.initHTML(),i}return r(a,[{key:"getEditorJSON",value:function(){return this.editor?this.editor.state.toJSON():{}}},{key:"initHTML",value:function(){var e;"zvyraznovani"===this.editorType&&(e=[this.selectionMenu(this.id)]);"predznaceny"===this.editorType&&(e=[a.premarkedParts(this.id,this.schema)]);if("psani"===this.editorType){var t=this.writting(pm.keydownHandler),n=pm.keymap({"Mod-z":pm.undo,"Mod-y":pm.redo});e=[pm.history(),n,t]}this.editor=new pm.EditorView(this.$editor,{state:pm.EditorState.create({doc:pm.DOMParser.fromSchema(this.schema).parse(this.$content),plugins:e})})}},{key:"initJSON",value:function(){var e=JSON.parse(this.$content.textContent),t=a.readOnlyMod(),n=this.schema;this.editor=new pm.EditorView(this.$editor,{state:pm.EditorState.fromJSON({schema:n,plugins:[t]},e)})}},{key:"selectionMenu",value:function(e){var t=this.schema,a=this.target.querySelector("#marker-menu-".concat(this.target.id));return new pm.Plugin({view:function(n){return new F(e,t,n,a)},props:{editable:function(){return!1}},key:new pm.PluginKey("SelectionMenu")})}},{key:"writting",value:function(e){var t=this,a=this.target.querySelector("#toolbar-".concat(this.target.id)),n=0,i=function(e,a){var i="remove-part-".concat(n);return pm.toggleMark(t.schema.marks.writtingRemovePart,{id:i})(e,a),n+=1,!0};return new pm.Plugin({view:function(e){return new R(e,a)},props:{handleKeyDown:e({Delete:i,Backspace:i})},key:new pm.PluginKey("Writting")})}}],[{key:"readOnlyMod",value:function(){return new pm.Plugin({props:{editable:function(){return!1}},key:new pm.PluginKey("ReadOnlyMod")})}},{key:"premarkedParts",value:function(e,t){return new pm.Plugin({props:{editable:function(){return!1},handleClickOn:function(a,n,i,r){if(t.nodes.premarked.name===i.type.name){var o,s,c="selected",l=a.state,d=l.tr,u=JSON.parse(i.attrs.textData);u.tagName="vyznacena-pasaz",i.attrs.className.includes(c)?(o=i.attrs.className.replace(" ".concat(c),""),s="remove"):(o="".concat(i.attrs.className," ").concat(c),s="add");var h={id:i.attrs.id,className:o,textData:i.attrs.textData};d.setNodeMarkup(r,null,h);var g=l.apply(d);a.updateState(g);var v=a.dom.querySelector("#".concat(i.attrs.id));k(document,"editor.change",{},{text:{id:e,task:s,tagData:u,value:v.cloneNode(!0)}})}return!1}},key:new pm.PluginKey("PremarkedParts")})}}]),a}(p),B=function(e){s(i,e);var t=h(i);function i(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n(this,i),(r=t.call(this,e)).id=r.target.id,r.function=r.target.getAttribute("data-keywords")||"selekce-",r.$controls=r.target.querySelectorAll("[data-keywords-control]"),r.opts=a(a({},i.defaults),o),r.$itemsContainer=r.target.querySelector(".".concat(r.opts.itemsContainerClassName)),r.opts.inherit&&r.opts.inherit.from.length>0?r.isInherited=!0:r.$items=r.target.querySelectorAll(".".concat(r.opts.itemClassName)),r}return r(i,[{key:"init",value:function(){switch(this.function){case"selekce-":case"selekce+":this.opts.import&&this.opts.import.length>0&&(this.$itemsContainer.innerHTML=i._getHTMLFromItems(this.opts.import)),this.isInherited&&this.opts.inherit.onInit&&this._regenerateItemsContainerFromInherited(),this._registerHandlers();break;case"wordcloud":this.$items.forEach((function(e){e.setAttribute("data-keywords-item",0)})),this._changeSizeOfKeywordItem(this.opts.skala)}}},{key:"_changeSizeOfKeywordItem",value:function(e){var t=this;function a(t,a,n){var i=parseInt(t.getAttribute("data-keywords-item"),10),r=i+a,o=Math.abs(r)>e?i:r;t.setAttribute("data-keywords-item",o),n()}e=e?parseInt(e,10):4,this.$controls.forEach((function(e){var n=e.parentElement.parentElement;switch(e.getAttribute("data-keywords-control")){case"minus":e.addEventListener("click",(function(e){a(n,-1,t.showFeedback),e.preventDefault()}));break;case"plus":e.addEventListener("click",(function(e){a(n,1,t.showFeedback),e.preventDefault()}))}}))}},{key:"_regenerateItemsContainerFromInherited",value:function(){var e=this,t="";this.opts.inherit.from.forEach((function(a){var n=document.getElementById(a).querySelector(".".concat(e.opts.itemsContainerClassName)).innerHTML;t+=i.renameItemsIds(a,e.id,n)})),this.$itemsContainer.innerHTML=t,this.$items=this.target.querySelectorAll(".".concat(this.opts.itemClassName))}},{key:"_registerHandlers",value:function(){var e=this;this.$items.forEach((function(t){t.addEventListener("click",e._clickEventHandler.bind(e),!0),document.addEventListener("keyword.change",(function(a){e._dispatchEventHandler(a,t)}),!1)}))}},{key:"_clickEventHandler",value:function(e){"click"===e.type&&(w(e.currentTarget,"disabled"),k(document,"keyword.change",{},{keywords:{id:this.id,node:e.currentTarget}}),this.showFeedback())}},{key:"_dispatchEventHandler",value:function(e,t){var a=e.detail.keywords,n=a.id,i=a.node;if(this.isInherited&&this.opts.inherit.from.includes(n)){var r=t.id,o=i.id;r.replace(this.id,"")===o.replace(n,"")&&w(t,"disabled")}}}]),i}(p);B._getItemFromDOMElement=function(e){return{class:e.className,id:e.getAttribute("id"),text:e.innerText}},B._getItemsHTML=function(e){return e.innerHTML},B._getItemsFromHTML=function(e,t){var a=e.querySelectorAll(".".concat(t)),n=[];return a.forEach((function(e){n.push(B._getItemFromDOMElement(e))})),n},B._getDOMElementFromItem=function(e){var t=document.createElement("div");return t.setAttribute("class",e.class),t.setAttribute("id",e.id),t.innerHTML=e.text,function(e){if(e&&e.tagName){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}}(t)},B._getHTMLFromItems=function(e){var t="";return e.forEach((function(e){t+=B._getDOMElementFromItem(e)})),t},B.renameItemsIds=function(e,t,a){var n=new RegExp(e,"g");return a.replace(n,t)},B.defaults={itemsContainerClassName:"keywords-items-container",itemClassName:"keywords-item"};var H=function(e){s(i,e);var t=h(i);function i(e,r,o){var s;return n(this,i),(s=t.call(this,r)).id=e,s.opts=a(a({},i.defaults),o),s.$questions=s.target.querySelectorAll(".".concat(s.opts.itemClass)),s.cache={answersCorrect:0,colors:[],questions:[]},s.opts.zpetnaVazba&&(s.cache.colors=s.opts.zpetnaVazba.map((function(e){return e.barva}))),s}return r(i,[{key:"init",value:function(){this._registerHandlers()}},{key:"_registerHandlers",value:function(){var e=this;this.$questions.forEach((function(t,a){e.cache.questions.push({answered:!1});var n=parseInt(t.getAttribute("data-module-answer"),10),i=t.querySelectorAll(".".concat(e.opts.optionClass));i.forEach((function(t,r){t.addEventListener("click",(function(){var o=t;if(!o.classList.contains("selected")){if(i.forEach((function(t){return A(t,e.opts.selectedClass)})),w(o,e.opts.selectedClass),e.opts.zpetnaVazba){var s;r===n?e.cache.answersCorrect+=1:0!==e.cache.answersCorrect&&!0===e.cache.questions[a].answered&&(e.cache.answersCorrect-=1);var c=e.opts.zpetnaVazba.find((function(t){return t.podminka.includes(e.cache.answersCorrect)}));(s=e.$buttonFeedback.classList).remove.apply(s,v(e.cache.colors)),e.$buttonFeedback.classList.add(c.barva),e.$buttonFeedbackText.innerText=c.text}e.cache.questions[a].answered=!0,void 0===e.cache.questions.find((function(e){return!e.answered}))&&e.showFeedback()}}),!1)}))}))}}]),i}(p);H.defaults={itemClass:"test-quiz-item",optionClass:"option",selectedClass:"selected"};var j=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).imageAlternative=i.target.getAttribute("data-fullscreen-image"),i.target.addEventListener("click",(function(e){switch(i.imageAlternative?(i.$fullscreenContainer.innerHTML=i.target.nextElementSibling.nextElementSibling.outerHTML,i.$fullscreenTarget=i.$fullscreenContainer.firstElementChild,i.$fullscreenTarget.classList.remove("is-hidden")):(i.$fullscreenContainer.innerHTML=i.target.nextElementSibling.outerHTML,i.$fullscreenTarget=i.$fullscreenContainer.firstElementChild),i.$fullscreenTarget.removeAttribute("style"),i.$fullscreenTarget.removeAttribute("id"),i.target.nextElementSibling.nodeName.toLowerCase()){case"img":setTimeout((function(){var e;(e=i.$fullscreenTarget.currentSrc,new Promise((function(t,a){var n=new Image;n.onload=function(){return t(n)},n.onerror=a,n.src=e}))).then((function(){i.image.width=i.$fullscreenTarget.naturalWidth,i.image.height=i.$fullscreenTarget.naturalHeight,i.image.ratio=i.image.width/i.image.height,i.setSize(),new y(i.$fullscreenTarget)}))}),10);break;case"svg":var t=g(i.$fullscreenTarget.getAttribute("viewBox").split(" "),4);i.image.width=t[2],i.image.height=t[3],i.image.ratio=i.image.width/i.image.height,i.setSize();var a=i.$fullscreenTarget.querySelectorAll("textarea");a.length>0&&a.forEach((function(e){var t=e.id;e.removeAttribute("id"),e.value=document.getElementById(t).value,e.readOnly=!0}))}i.$fullscreen.classList.toggle("hidden"),i.showFeedback(),e.preventDefault(),e.stopPropagation()}),!1),i}return r(a,[{key:"setSize",value:function(){this.image.ratio>=this.window.ratio?(this.$fullscreenTarget.style.width="100%",this.$fullscreenTarget.style.height="auto"):(this.$fullscreenTarget.style.width="auto",this.$fullscreenTarget.style.height="".concat(this.window.height,"px"))}}]),a}(function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$fullscreen=document.querySelector('[data-fullscreen="fullscreen"]'),i.$fullscreenContainer=i.$fullscreen.querySelector('[data-fullscreen="container"]'),i.$fullscreenTarget=i.$fullscreen.querySelector('[data-fullscreen="target"]'),i.window={},i.image={},i.window.width=window.innerWidth,i.window.height=window.innerHeight,i.window.ratio=i.window.width/i.window.height,i}return r(a)}(p)),W=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$item=i.target.closest(".user-text"),i.$counter=i.$item.querySelector("[data-usertext-counter]"),i.$counterWrapper=i.$item.querySelector(".user-text__counter"),i.$instruction=i.$item.querySelector(".user-text__question"),i.$userTexts=i.$slide.querySelectorAll("[data-textarea-target]"),i.feedback=JSON.parse(i.target.getAttribute("data-feedback")),i.lengthExpected={min:parseInt("0"===i.target.getAttribute("minlength")?1:i.target.getAttribute("minlength"),10),avg:null,max:parseInt(i.target.getAttribute("maxlength")/2,10)},i.lengthExpected.avg=Math.floor((i.lengthExpected.max-i.lengthExpected.min)/4+i.lengthExpected.min),i.cache={answersCorrect:0,colors:["color-red","color-orange","color-green"],questions:[]},i.lastValue="",i.hadData=i.target.value&&i.target.value.length>0,i.wasUsed=!1,i.hadData&&i.updateCharacterCounter(),HISTORYLAB.import.done||(i.toDuplicate=i.target.getAttribute("data-duplicate-text"),i.textDuplicateSources=i.toDuplicate?i.toDuplicate.split(" "):[],i.getEvents(),i.addEventListeners()),i}return r(a,[{key:"updateCharacterCounter",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.target.value.length;(e=this.$counterWrapper.classList).remove.apply(e,v(this.cache.colors)),t<this.lengthExpected.min?this.$counterWrapper.classList.add(this.cache.colors[0]):t<=this.lengthExpected.avg?this.$counterWrapper.classList.add(this.cache.colors[1]):t>this.lengthExpected.avg&&this.$counterWrapper.classList.add(this.cache.colors[2]),this.$counter.innerText=t,this.target.classList.add("is-used",!this.wasUsed),this.wasUsed=!0}},{key:"updateFeedback",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.target.value.length;if(this.$buttonFeedback)if((e=this.$buttonFeedback.classList).remove.apply(e,v(this.cache.colors)),t<this.lengthExpected.min)this.$buttonFeedback.classList.add(this.cache.colors[0]),this.$buttonFeedbackText.innerText=this.feedback.none;else{t<=this.lengthExpected.avg?(this.$buttonFeedback.classList.add(this.cache.colors[1]),this.$buttonFeedbackText.innerText=this.feedback.short):t>this.lengthExpected.avg&&(this.$buttonFeedback.classList.add(this.cache.colors[2]),this.$buttonFeedbackText.innerText=this.feedback.ok),this.target.setAttribute("data-textarea-target","success");var a=Array.from(this.$userTexts).find((function(e){return"success"!==e.getAttribute("data-textarea-target")}));void 0===a&&this.showFeedback()}}},{key:"addEventListeners",value:function(){var e=this;this.target.addEventListener("blur",(function(t){if(e.updateCharacterCounter(),t.target.value!==e.lastValue){var a=""===e.lastValue?"create":"change";e.lastValue=t.target.value,k(document,"text.change",{},{text:{id:t.target.id,task:a,text:t.target.value}}),e.textDuplicateSources=[]}})),this.target.addEventListener("keyup",(function(t){t.stopPropagation();var a=e.target.value.length;e.updateCharacterCounter(a),e.updateFeedback(a)}))}},{key:"getEvents",value:function(){var e=this;if(this.$instruction&&this.$instruction.hasAttribute("data-from")){var t=this.$instruction.getAttribute("data-from");document.addEventListener("selection.change",(function(a){t===a.detail.id&&a.detail.itemData&&"string"==typeof a.detail.itemData&&(e.$instruction.innerText=a.detail.itemData)}))}this.textDuplicateSources[0]&&document.addEventListener("text.change",(function(t){if(e.textDuplicateSources.includes(t.detail.text.id)){var a=""===e.target.value?"create":"change";switch(t.detail.text.task){case"create":case"change":""!==e.target.value&&(e.target.value+="\n"),1===e.textDuplicateSources.length?e.target.value=t.detail.text.text:e.target.value+="".concat(t.detail.text.text,"\n"),k(document,"text.change",{},{text:{id:e.target.id,task:a,text:e.target.value}}),e.lastValue=e.target.value,e.updateCharacterCounter();break;default:console.log("Nondefinated text events task. :(")}}}))}}]),a}(p),V=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$playButton=i.target.querySelector("[data-player-control]"),i.$loadWave=i.target.querySelector("[data-audio-wave]"),i.$leftTime=i.target.querySelector("[data-audio-time-left]"),i.$audioDuration=i.target.querySelector("[data-audio-time-duration]"),i.wavesurfer=WaveSurfer.create({container:i.$loadWave,waveColor:"#A77977",progressColor:"#FCE4E3",height:80,responsive:!0,barWidth:2}),i.wavesurfer.load(i.$loadWave.dataset.src),i.initWave(),i}return r(a,[{key:"initWave",value:function(){var e=this;this.wavesurfer.on("ready",(function(){e.$leftTime.textContent="0:00";var t=e.wavesurfer.getDuration(),a=Math.floor(t%3600/60),n="00".concat(Math.floor(t%60)).slice(-2);e.$audioDuration.textContent="".concat(a,":").concat(n),e.addListenerAfterReady()}))}},{key:"addListenerAfterReady",value:function(){var e=this;this.wavesurfer.on("audioprocess",(function(t){var a=Math.floor(t%3600/60),n="00".concat(Math.floor(t%60)).slice(-2);e.$leftTime.textContent="".concat(a,":").concat(n)})),this.wavesurfer.on("finish",(function(){e.$playButton.setAttribute("data-player-control","paused")})),this.$playButton.addEventListener("click",(function(){e.wavesurfer.playPause(),"paused"===e.$playButton.getAttribute("data-player-control")?e.$playButton.setAttribute("data-player-control","playing"):e.$playButton.setAttribute("data-player-control","paused"),e.showFeedback()})),document.querySelectorAll("[data-nav-button]").forEach((function(t){t.addEventListener("click",(function(){"playing"===e.$playButton.getAttribute("data-player-control")&&(e.wavesurfer.playPause(),e.$playButton.setAttribute("data-player-control","paused"))}))}))}}]),a}(p),J=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$audio=i.target.querySelector("audio"),i.$timeLeft=i.target.querySelector("[data-audio-time-left]"),i.$duration=i.target.querySelector("[data-audio-time-duration]"),i.$duration.innerText="/".concat(_(i.$audio.duration)),M.addEventListeners(i.target,i.showFeedback),i}return r(a)}(M),Y=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$buttons=i.target.querySelectorAll('[data-fake-map="toggle"]'),i.$maps=i.target.querySelectorAll('[data-fake-map="map"]'),i.lastActiveIndex=0,i.addEventListenerToButtons(),i}return r(a,[{key:"switchMap",value:function(e,t){this.$maps[this.lastActiveIndex].classList.remove("active"),this.$buttons[this.lastActiveIndex].classList.remove("active"),this.$maps[t].classList.add("active"),e.classList.add("active"),this.lastActiveIndex=t}},{key:"addEventListenerToButtons",value:function(){var e=this;this.$buttons.forEach((function(t,a){t.addEventListener("click",(function(n){e.switchMap(t,a),e.showFeedback(),n.preventDefault()}))}))}}]),a}(p),X=function(e){s(a,e);var t=h(a);function a(e,i){var r;return n(this,a),(r=t.call(this,e)).$media=r.target.querySelector("video"),r.options=Object(i),r.prefix=r.options.prefix||"media",r.lang=Object(r.options.lang),r.paused=null,r.currentTime=null,r.duration=null,r.interval=null,r.$document=r.target.ownerDocument,r.$controls=r.target.querySelector(".media-player-controls"),r.$play=r.$controls.querySelector("[data-player-control]"),r.$playSymbol=r.$play.querySelector(".media-play-symbol"),r.$pauseSymbol=r.$play.querySelector(".media-pause-symbol"),r.$time=r.$controls.querySelector("[data-video-time-progress]"),r.$timeMeter=r.$time.querySelector(".media-meter.media-time-meter"),r.$timeRange=r.$time.querySelector(".media-range.media-time-range"),r.$currentTimeText=r.$document.createTextNode(""),r.$currentTime=r.$controls.querySelector("[data-video-time-left]"),r.$currentTime.appendChild(r.$currentTimeText),r.durationTime=r.$media.duration,r.$durationTime=r.$controls.querySelector("[data-video-time-duration]"),r.$durationTime.innerText=_(r.durationTime),r.$durationTime.setAttribute("title","".concat(a.timeToAural(r.durationTime,r.lang.minutes||"minutes",r.lang.seconds||"seconds"))),r.$fullscreen=r.$controls.querySelector(".fullscreen-toggle"),r.$enterFullscreenSymbol=r.$fullscreen.querySelector(".media-enterFullscreen-symbol"),r.$leaveFullscreenSymbol=r.$fullscreen.querySelector(".media-leaveFullscreen-symbol"),r._fullscreenchange="onfullscreenchange"in r.target?"fullscreenchange":"onwebkitfullscreenchange"in r.target?"webkitfullscreenchange":"onMSFullscreenChange"in r.target?"MSFullscreenChange":"fullscreenchange",r._requestFullscreen=r.target.requestFullscreen||r.target.webkitRequestFullscreen||r.target.msRequestFullscreen,r.onCanPlayStart=r.onCanPlayStart.bind(d(r)),r.onLoadStart=r.onLoadStart.bind(d(r)),r.onLoadedData=r.onLoadedData.bind(d(r)),r.onPlayChange=r.onPlayChange.bind(d(r)),r.onTimeChange=r.onTimeChange.bind(d(r)),r.onPlayClick=r.onPlayClick.bind(d(r)),r.onTimeKeydown=r.onTimeKeydown.bind(d(r)),r.onTimeClick=r.onTimeClick.bind(d(r)),r.onTimeKeydown=r.onTimeKeydown.bind(d(r)),r.onFullscreenClick=r.onFullscreenClick.bind(d(r)),r.onFullscreenChange=r.onFullscreenChange.bind(d(r)),r.$media.addEventListener("canplaythrough",r.onCanPlayStart),r.$media.addEventListener("loadstart",r.onLoadStart),r.$media.addEventListener("loadeddata",r.onLoadedData),r.$media.addEventListener("pause",r.onPlayChange),r.$media.addEventListener("play",r.onPlayChange),r.$media.addEventListener("timeupdate",r.onTimeChange),r.$controls.addEventListener("click",r.onPlayClick,!1),r.$play.addEventListener("keydown",r.onTimeKeydown),r.$time.addEventListener("click",r.onTimeClick,!1),r.$time.addEventListener("keydown",r.onTimeKeydown),r.$fullscreen.addEventListener("click",r.onFullscreenClick,!1),document.addEventListener(r._fullscreenchange,r.onFullscreenChange),a.onDrag(r.$time,r.$timeRange,(function(e){r.$media.currentTime=r.duration*Math.max(0,Math.min(1,e)),r.onTimeChange()})),r.onLoadStart(),r}return r(a,[{key:"onPlayChange",value:function(){this.paused!==this.$media.paused&&(this.paused=this.$media.paused,this.$play.setAttribute("aria-label",this.paused?this.lang.play||"play":this.lang.pause||"pause"),this.target.setAttribute("data-player-state",this.paused?"paused":"playing"),this.$playSymbol.setAttribute("aria-hidden",!this.paused),this.$pauseSymbol.setAttribute("aria-hidden",this.paused),clearInterval(this.interval),this.paused||(this.interval=setInterval(this.onTimeChange,34)),this.$media.dispatchEvent(C.playchange))}},{key:"onTimeChange",value:function(){if(this.currentTime!==this.$media.currentTime||this.duration!==this.$media.duration){this.currentTime=this.$media.currentTime,this.duration=this.$media.duration||0;var e=this.currentTime/this.duration,t=_(this.currentTime);t!==this.$currentTimeText.nodeValue&&(this.$currentTimeText.nodeValue=t,this.$currentTime.setAttribute("title","".concat(a.timeToAural(this.currentTime,this.lang.minutes||"minutes",this.lang.seconds||"seconds")))),this.$time.setAttribute("aria-valuenow",this.currentTime),this.$time.setAttribute("aria-valuemin",0),this.$time.setAttribute("aria-valuemax",this.duration),this.$timeMeter.style.width="".concat(100*e,"%"),this.$media.dispatchEvent(C.timechange)}}},{key:"onLoadStart",value:function(){this.$media.removeEventListener("canplaythrough",this.onCanPlayStart),this.$media.addEventListener("canplaythrough",this.onCanPlayStart),this.onPlayChange(),this.onFullscreenChange(),this.onTimeChange()}},{key:"onLoadedData",value:function(){this.onTimeChange()}},{key:"onCanPlayStart",value:function(){this.$media.removeEventListener("canplaythrough",this.nCanPlayStart),this.$media.dispatchEvent(C.canplaystart),this.paused&&!this.$media.autoplay||this.$media.play()}},{key:"onFullscreenChange",value:function(){var e=this.target===a._fullscreenElement();this.$fullscreen.setAttribute("aria-label",e?this.lang.leaveFullscreen||"leave full screen":this.lang.enterFullscreen||"enter full screen"),this.$enterFullscreenSymbol.setAttribute("aria-hidden",e),this.$leaveFullscreenSymbol.setAttribute("aria-hidden",!e)}},{key:"onPlayClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.$media[this.$media.paused?"play":"pause"]()}},{key:"onTimeClick",value:function(e){e.stopPropagation(),e.pointerType||e.detail||this.onPlayClick(e)}},{key:"onFullscreenClick",value:function(e){var t=this;e.stopPropagation(),this._requestFullscreen?this.target===a._fullscreenElement()?a._exitFullscreen().call(document):(this._requestFullscreen.call(this.target),this.$fullscreen.focus(),setTimeout((function(){t.$fullscreen.focus()}),200)):this.$media.webkitSupportsFullscreen&&(this.$media.webkitDisplayingFullscreen?this.$media.webkitExitFullscreen():this.$media.webkitEnterFullscreen(),this.onFullscreenChange())}},{key:"onTimeKeydown",value:function(e){var t=e.keyCode,a=e.shiftKey;if(t>=37&&t<=40){e.preventDefault();var n=37===t||39===t?t-38:t-39;this.$media.currentTime=Math.max(0,Math.min(this.$media.duration,this.$media.currentTime+n*(a?10:1))),this.onTimeChange()}}}],[{key:"_fullscreenElement",value:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement}},{key:"_exitFullscreen",value:function(){return document.exitFullscreen||document.webkitCancelFullScreen||document.msExitFullscreen}},{key:"onDrag",value:function(e,t,a){var n,i,r,o=void 0!==e.onpointerup,s=void 0!==e.ontouchstart,c=o?"pointerdown":s?"touchstart":"mousedown",l=o?"pointermove":s?"touchmove":"mousemove",d=o?"pointerup":s?"touchend":"mouseup",u="clientX";function h(e){e.preventDefault();var t=u in e?e.clientX:e.touches&&e.touches[0]&&e.touches[0].clientX||0;a((t-i)/(r-i))}function g(){n.removeEventListener(l,h),n.removeEventListener(d,g)}e.addEventListener(c,(function(a){n=e.ownerDocument.defaultView;var o=t.getBoundingClientRect();i=o.left,r=o.right,h(a),n.addEventListener(l,h),n.addEventListener(d,g)}))}},{key:"timeToAural",value:function(e,t,a){return"".concat(Math.floor(e/60)," ").concat(t,", ").concat(Math.floor(e%60)," ").concat(a)}}]),a}(p),G=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).$settings=document.querySelector('[data-selectable-id-reference="'.concat(i.target.id,'"]')),i.feedback=JSON.parse(i.$settings.getAttribute("data-module-zpetnavazba")),i.settings=JSON.parse(i.$settings.getAttribute("data-module-settings")),i.$items=i.target.querySelectorAll(".selectable-item"),i.cache={answersCorrect:0,zpetnaVazba:!1,colors:[],checkedInput:0},i.$inputs=i.target.querySelectorAll("input"),i.$inputs.forEach((function(e){i._changeClassIfChecked(e),i._addEventListeners(e)})),i.feedback&&(i.cache.zpetnaVazba=!0,i.cache.colors=i.feedback.map((function(e){return e.barva}))),i}return r(a,[{key:"_addEventListeners",value:function(e){var t=this;e.addEventListener("change",(function(){t.$inputs.forEach((function(e){t._changeClassIfChecked(e)})),t._checkAndResolveFeedback(),t._dispatchEvent(e)}),!1)}},{key:"_changeClassIfChecked",value:function(e){e.closest(".selectable-item").classList.toggle("is-checked",!0===e.checked)}},{key:"_checkAndResolveFeedback",value:function(){var e=this;if(this.cache.answersCorrect=0,this.settings.viceOdpovedi?this.$items.forEach((function(t,a){e.$inputs[a].checked&&(e.cache.checkedInput+=1),e.$inputs[a].checked&&t.hasAttribute("data-select-spravnaodpoved")&&(e.cache.answersCorrect+=1),e.$inputs[a].checked||t.hasAttribute("data-select-spravnaodpoved")||(e.cache.answersCorrect+=1)})):this.$items.forEach((function(t,a){e.$inputs[a].checked&&(e.cache.checkedInput+=1),e.$inputs[a].checked&&t.hasAttribute("data-select-spravnaodpoved")&&(e.cache.answersCorrect+=1)})),0===this.cache.checkedInput&&!this.settings.vybrano||this.cache.checkedInput===this.$inputs.length&&this.settings.vybrano||this.settings.disableFeedback)this.hideFeedback();else{if(this.cache.zpetnaVazba){var t,a=this.feedback.find((function(t){return t.podminka.includes(e.cache.answersCorrect)}));(t=this.$buttonFeedback.classList).remove.apply(t,v(this.cache.colors)),this.$buttonFeedback.classList.add(a.barva),this.$buttonFeedbackText.innerText=a.text}this.showFeedback()}this.target.classList.toggle("has-checked",this.cache.checkedInput>0),this.cache.checkedInput=0}},{key:"_dispatchEvent",value:function(e){var t,a=e.parentNode.querySelector("label");"radio"===e.type?t="change":"checkbox"===e.type?t=e.checked?"select":"unselect":console.error("ERROR: Undefinated input type."),k(this.target,"selection.change",{},{id:this.target.id,task:t,itemId:e.id,itemData:e.getAttribute("data-selectable-data"),$node:a.firstChild})}}]),a}(p),U=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).dataFrom=i.target.parentNode.getAttribute("data-from"),i.dataSources=i.dataFrom?i.dataFrom.split(" "):[],i.id=e.getAttribute("id"),i.cache={tasks:[]},i.init(),i}return r(a,[{key:"init",value:function(){var e=this,t=this.target.parentNode.getAttribute("data-autofill");switch(t){case"columns":this._columnManager();break;case"rows":this._rowManager();break;case"cells":this.target.querySelectorAll(".table-new__cell").forEach((function(t){var a=t.getAttribute("data-column-id"),n=t.getAttribute("data-row-id");a&&n&&e._cellManager(t,a,n)}));break;default:console.log("NewTableERROR: Undefinated autofill key word!",t)}}},{key:"_rowManager",value:function(){var e=this;document.addEventListener("editor.change",(function(t){var n=t.detail.text;if(e.dataSources.includes(n.id)){var i,r=!0,o=e.target.previousSibling.firstChild.childNodes;switch(n.task){case"add":(i=document.createElement("div")).setAttribute("class","table-new__row"),o.forEach((function(t){var a=document.createElement("div");a.setAttribute("class","table-new__cell");var o=JSON.parse(t.getAttribute("data-type"));o.tagName&&o.tagName!==n.tagData.tagName?r=!1:e.fillCell(o,n,a),r&&i.appendChild(a)})),r&&e.target.appendChild(i);break;case"remove":e.target.childNodes.forEach((function(e){e.childNodes.forEach((function(t,r){var s=JSON.parse(o[r].getAttribute("data-type"));a.isRightToDeleteHelper(t,n.value,s)&&(i=e)}))})),i&&(i.childNodes.forEach((function(t){e._removeTaskFromCache(t)})),i.remove());break;default:console.log("NewTableERROR: Undefinated task for new table! (rowManager)")}}}))}},{key:"_columnManager",value:function(){var e=this;document.addEventListener("editor.change",(function(t){var n=t.detail.text;if(e.dataSources.includes(n.id)){var i=e.target.childNodes;switch(n.task){case"add":i.forEach((function(t){var a=document.createElement("div");a.setAttribute("class","table-new__cell");var i=t.firstChild,r=JSON.parse(i.getAttribute("data-type"));e.fillCell(r,n,a),t.appendChild(a)}));break;case"remove":var r;i.forEach((function(e){var t=e.firstChild,i=JSON.parse(t.getAttribute("data-type"));e.childNodes.forEach((function(e,t){a.isRightToDeleteHelper(e,n.value,i)&&(r=t)}))})),e.target.childNodes.forEach((function(t){e._removeTaskFromCache(t.childNodes[r]),t.childNodes[r].remove()}));break;default:console.log("NewTableERROR: Undefinated task for new table! (columnManager)")}}}))}},{key:"_cellManager",value:function(e,t,n){var i=this,r=JSON.parse(this._findCellType(e)),o=function(t){switch(t.task){case"add":var n=document.createElement("div");i.fillCell(r,t,e),e.appendChild(n);break;case"remove":for(var o=e.querySelectorAll("div"),s=!1,c=0;c<o.length;c+=1)!s&&a.isRightToDeleteHelper(o[c],t.value,r)&&(o[c].remove(),s=!0);break;default:console.log("NewTableERROR: Undefinated task for new table! (cellManager)")}};document.addEventListener("editor.change",(function(e){var a=e.detail.text;!i.dataSources.includes(a.id)||a.tagData.tagName!==n&&a.tagData.tagName!==t||r.textId&&r.textId!==a.id||o(a)})),document.addEventListener("draggable.drop",(function(e){var a=e.detail;if(i.dataSources.includes(a.id)&&e.detail.columnId===t){var n=a.$node.querySelector("span").cloneNode(!0);n.classList.add("node-selected","node-text-gray"),n.setAttribute("data-by","table-drop"),o({task:a.task,value:n})}}))}},{key:"fillCell",value:function(e,t,a){var n,i,r=this,o=0;if(this.cache.tasks.length>0){var s=this.cache.tasks[this.cache.tasks.length-1].id.split("-");o=+s[s.length-1]+1}switch(a.classList.add("table-new__cell--".concat(e.name),"table-new__cell--".concat(e.type)),e.name){case"dup-text":n=document.createElement("div"),"text"===e.type?n.innerHTML=t.value.textContent:"tag"===e.type&&n.appendChild(t.value.cloneNode(!0));break;case"select":i={id:"".concat(this.id,"-select-").concat(o),answer:"",rightAnswer:t.tagData},this.cache.tasks.push(i),(n=document.createElement(e.name)).setAttribute("id",i.id),n.setAttribute("data-save","value"),n.setAttribute("tabindex",-1),e.options.forEach((function(e){var t=document.createElement("option");t.innerHTML=e,n.appendChild(t)})),n.addEventListener("change",(function(e){return r._correctedAnswer(e,i)}));break;case"input":case"textarea":i={id:"".concat(this.id,"-input-").concat(o),answer:"",rightAnswer:t.tagData},this.cache.tasks.push(i),(n=document.createElement(e.name)).setAttribute("id",i.id),n.setAttribute("data-save","value"),n.setAttribute("tabindex",-1),"textarea"===e.name&&n.setAttribute("resize",i.id),Object.keys(e.attributes).forEach((function(t){n.setAttribute(t,e.attributes[t])})),n.addEventListener("change",(function(e){return r._correctedAnswer(e,i)}));break;case"drop":n=document.createElement("div");var c=e.number?e.number:-1;n.setAttribute("data-drop-place",c);break;default:n=document.createElement("div"),t.tagData[e.name]?n.innerHTML=t.tagData[e.name]:(n.innerHTML=" ",console.log("FillCellERROR: Undefinated object name.",e))}a.appendChild(n)}},{key:"_findCellType",value:function(e){var t=e.parentNode.firstChild.getAttribute("data-type");if(t)return t;var a=e.getAttribute("data-column-id"),n=this.target.parentNode.querySelector(".table-new__cell--header[data-column-id=".concat(a,"]"));return n?n.getAttribute("data-type"):"empty"}},{key:"_correctedAnswer",value:function(e,t){this.cache.tasks.forEach((function(a){a.id===t.id&&(a.answer=e.target.value)}))}},{key:"_removeTaskFromCache",value:function(e){var t=this;this.cache.tasks.forEach((function(a,n){"SELECT"!==e.firstChild.tagName&&"INPUT"!==e.firstChild.tagName&&"TEXTAREA"!==e.firstChild.tagName||e.firstChild.id===a.id&&t.cache.tasks.splice(n,1)}))}}],[{key:"isRightToDeleteHelper",value:function(e,t,a){return"dup-text"===a.name&&e.textContent===t.textContent}}]),a}(p),K=function(e){s(a,e);var t=h(a);function a(e){var i;return n(this,a),(i=t.call(this,e)).idPrefix="drag-item",i.dataFrom=i.target.getAttribute("data-from"),i.dataSources=i.dataFrom?i.dataFrom.split(" "):[],i.position={x:0,y:0,dx:0,dy:0},i.cache={items:{}},i.$targetPrevious=null,i.$targetCurrent=null,i.$draggedItem=null,i.objWidth=null,i.objHeight=null,i.lastEvent=null,i.init(),i}return r(a,[{key:"init",value:function(){var e=this;this.target.querySelectorAll(".draggable__item").forEach((function(t){var a=t.getAttribute("data-id");e.cache.items[a]=0,e.dragAndDropEvents(d3.select(t),a)})),this.handleDeleteItemFromSvgDrop(),this.handleAddTagsFromText()}},{key:"dragAndDropEvents",value:function(e,t){var a=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.call(d3.drag().container(this.$slide).on("start",(function(t){a.onStart(t,e)})).on("drag",(function(t){a.onDrag(t,e)})).on("end",(function(i){a.onDrop(i,e,t,n)})))}},{key:"onStart",value:function(e,t){this.$slide.classList.add("is-dragging"),this.$targetPrevious=e.sourceEvent.target;var a,n,i,r,o,s,c=t.node();if(this.objWidth=c.offsetWidth,this.objHeight=c.offsetHeight,this.position.dx=0,this.position.dy=0,e.sourceEvent.clientX)this.position.x=e.sourceEvent.clientX-e.sourceEvent.offsetX,this.position.y=e.sourceEvent.clientY-e.sourceEvent.offsetY;else{var l=$(e,t),d=(a=e.sourceEvent,n=a.target.getBoundingClientRect(),i=n.x,r=n.y,o=n.width,s=n.height,{x:(a.touches[0].clientX-i)/o*a.target.offsetWidth,y:(a.touches[0].clientY-r)/s*a.target.offsetHeight});this.position.x=l.x-d.x,this.position.y=l.y-d.y}if(c.parentNode.hasAttribute("data-drag-place"))this.$draggedItem=c.cloneNode(!0);else{this.$draggedItem=c;var u=c.closest(".table-new__body"),h=c.closest(".table-new__cell").getAttribute("data-column-id");k(document,"draggable.drop",{},{id:u.id,task:"remove",columnId:h,$node:c})}document.body.appendChild(this.$draggedItem),this.$draggedItem=d3.select(this.$draggedItem),this.$draggedItem.classed("is-dragged",!0).classed("was-dropped",!1).attr("style","top:".concat(this.position.y,"px; left:").concat(this.position.x,"px;")),this.lastEvent=e.sourceEvent}},{key:"onDrag",value:function(e,t){if(this.lastEvent=e.sourceEvent,this.position.dx+=e.dx,this.position.dy+=e.dy,this.$draggedItem.style("transform","translate3d(".concat(this.position.dx,"px, ").concat(this.position.dy,"px, 0) rotate(5deg)")),this.$targetCurrent=e.sourceEvent.target,this.$targetPrevious!==this.$targetCurrent){var a=this.$targetPrevious.querySelector(".draggable__item--placeholder");if(a&&a.remove(),this.$targetCurrent.hasAttribute("data-drop-place")){var n=this.$targetCurrent.getAttribute("data-drop-place"),i=this.$targetCurrent.childElementCount;if("-1"===n||+n>i){var r=t.clone(!0).classed("is-dragged",!1).classed("draggable__item--placeholder",!0).attr("style","outline: 0px;").node();this.$targetCurrent.appendChild(r)}}this.$targetPrevious=this.$targetCurrent}}},{key:"onDrop",value:function(e,t,a,n){var i=this;if(this.lastEvent.touches){var r=this.lastEvent.touches[0];this.$targetCurrent=document.elementFromPoint(r.clientX,r.clientY)}else this.$targetCurrent=e.sourceEvent.target;if(this.$targetCurrent.hasAttribute("data-drop-place")){var o=this.$targetCurrent.querySelector(".draggable__item--placeholder");if(o){var s=o.getAttribute("data-draggable-item");if(o.classList.remove("draggable__item--placeholder","was-dropped"),o.classList.add("dropped__item"),n&&(t.classed("was-dropped",!0),this.cache.items[a]+=1),"svg"===s){var c=o.querySelector('[data-fullscreen="toggle"]');c&&c.remove()}else{var l=o.firstElementChild,d=document.createElement("span");d.classList.add("node-close"),d.innerText="×",l.removeChild(l.lastElementChild),l.appendChild(d),d.addEventListener("click",(function(){i.removeDraggableItem(o,a,n)}))}this.dragAndDropEvents(d3.select(o),a,!1)}else o=t.clone(!0).classed("is-dragged",!1).attr("style","outline: 0px;").node(),this.$targetCurrent.appendChild(o),this.dragAndDropEvents(d3.select(o),a,!1);var u=this.$targetCurrent.closest(".table-new__body"),h=this.$targetCurrent.closest(".table-new__cell").getAttribute("data-column-id");k(document,"draggable.drop",{},{id:u.id,task:"add",columnId:h,$node:o}),this.$draggedItem.remove()}else{var g=this.$targetCurrent.closest("svg");if(!!g&&g.hasAttribute("data-svg-drop")){var v=$(this.lastEvent,g),m=this.$draggedItem.classed("is-dragged",!1).attr("style","outline: 0px;").node();t.classed("was-dropped",!0),this.cache.items[a]+=1,k(document,"svg.drop",{},{svg:{id:g.id,$node:m,type:m.getAttribute("data-draggable-item"),position:v,size:{width:this.objWidth,height:this.objHeight}}}),this.$draggedItem.remove()}else this.removeDraggableItem(this.$draggedItem,a,n)}this.$slide.classList.remove("is-dragging")}},{key:"handleDeleteItemFromSvgDrop",value:function(){var e=this;document.addEventListener("svg.drop.delete",(function(t){var a=t.detail.item,n=a.slideId,i=a.id;a.$object;var r=e.target.querySelector("div[data-id=".concat(i,"]"));r&&e.$slide.id===n&&(1===e.cache.items[i]&&r.classList.remove("was-dropped"),e.cache.items[i]-=1)}))}},{key:"handleAddTagsFromText",value:function(){var e=this,t=1;document.addEventListener("editor.change",(function(n){var i,r,o,s,c,l=n.detail.text,d=e.target.getAttribute("data-tagName");if(e.dataSources.includes(l.id)&&(!d||d===l.tagData.tagName))switch(l.task){case"add":(i=e.target.firstElementChild.cloneNode(!0)).classList.remove("hidden"),r=i.querySelector(".keywords-item"),"×"===(o=l.value.textContent)[o.length-1]&&(o=o.slice(0,-1)),r.firstElementChild.innerHTML=o,i.firstElementChild.classList.add("node-text-".concat(l.tagColor)),r.classList.add("node-text-".concat(l.tagColor)),(c=(s=i.getAttribute("data-id")).split("-")).splice(-1,1,"dup-".concat(t)),s=c.join("-"),i.setAttribute("data-id",s),e.cache.items[s]=0,t+=1,e.target.appendChild(i),e.dragAndDropEvents(d3.select(i),s);break;case"remove":e.target.childNodes.forEach((function(e){a.isRightToDeleteHelper(e,l.value,e.getAttribute("data-draggable-item"))&&e.remove()}));break;default:console.log("NewTableERROR: Undefinated task for new table! (cellManager)")}}))}},{key:"removeDraggableItem",value:function(e,t,a){1===this.cache.items[t]&&this.target.querySelector("div[data-id=".concat(t,"]")).classList.remove("was-dropped");a||(this.cache.items[t]-=1),e.remove()}}],[{key:"isRightToDeleteHelper",value:function(e,t,a){return("tag"===a&&"×"===e.textContent[e.textContent.length-1]?e.textContent.slice(0,-1):e.textContent)===t.textContent}}]),a}(p),Z=function(e){s(a,e);var t=h(a);function a(e){var i;n(this,a);var r=(i=t.call(this,e)).target.querySelectorAll(".selected-item"),o=i.target.querySelectorAll("[data-duplicate]");return r.forEach((function(e){return a.setSelectEvents(e)})),o.forEach((function(e){return a.setTextEvents(e)})),console.log(i.target,o),i}return r(a,null,[{key:"setSelectEvents",value:function(e){var t=e.id,n=e.querySelector(".selected-item__placeholder");document.addEventListener("selection.change",(function(i){if(t===i.detail.id){var r=i.detail,o="-duplicated";switch(r.task){case"change":a.removeItemFromSelect(e),a.addItemFromSelect(e,o,r);break;case"select":n.classList.add("is-hidden"),a.addItemFromSelect(e,o,r);break;case"unselect":a.removeItemFromSelect(e,r.itemId+o),1===e.childElementCount&&n.classList.remove("is-hidden");break;default:console.error("ERROR: Undefinated task type.")}}}))}},{key:"setTextEvents",value:function(e){var t=e.getAttribute("data-duplicate"),a=t?t.split(" "):[];document.addEventListener("text.change",(function(t){var n=t.detail.text;if(a.includes(n.id))switch(n.task){case"create":case"change":e.innerHTML=n.text;break;default:console.log("Nondefinated text events task. :(")}}))}},{key:"addItemFromSelect",value:function(e,t,a){var n=a.$node.cloneNode(!0);n.setAttribute("data-id",a.itemId+t),n.hasAttribute("data-player-audio")&&M.addEventListeners(n,(function(){})),e.appendChild(n)}},{key:"removeItemFromSelect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(t){var a=e.querySelector("[data-id=".concat(t,"]"));a.remove()}else e.firstChild.remove()}}]),a}(p),Q=function(){console.log("windowLoad:components");var e=document.querySelectorAll("[data-player-video]");e.length>0&&(e.forEach((function(e){new X(e)})),document.addEventListener("slide.change",(function(){T(e)})));var t=document.querySelectorAll('[data-player-audio="normal"]');t.length>0&&t.forEach((function(e){new V(e)}));var a=document.querySelectorAll('[data-player-audio="simple"]');a.length>0&&(a.forEach((function(e){new J(e)})),document.addEventListener("slide.change",(function(){T(a)})));var n=document.querySelectorAll('[data-fullscreen="toggle"]');n.length>0&&n.forEach((function(e){new j(e)}));var i=document.querySelectorAll("[data-lupa-target]");if(i.length>0)for(var r=0;r<i.length;r+=1)new y(i[r]);var o=document.querySelectorAll('[data-fake-map="target"]');if(o.length>0)for(var s=0;s<o.length;s+=1)new Y(o[s]);var c=document.querySelectorAll('[data-textarea-target=""]');c.length>0&&c.forEach((function(e){new W(e)}));var l=document.querySelectorAll("[data-svg-target]");if(l.length>0){if(!0!==HISTORYLAB.import.done){var d=document.querySelector("[data-radial-menu]");d&&new D(d,l)}l.forEach((function(e){new N(e)}))}var u=document.querySelectorAll("[data-editor]");if(u.length>0&&u.forEach((function(e){var t=new z(e);HISTORYLAB.tools[t.id]=t})),!0!==HISTORYLAB.import.done){var h=document.querySelectorAll("[data-target-test-quiz]");h.length>0&&h.forEach((function(e){var t=document.querySelector('[data-test-quiz-id-reference="'.concat(e.getAttribute("data-test-quiz-id"),'"]'));new H(e.getAttribute("data-test-quiz-id"),e,JSON.parse(t.getAttribute("data-module-settings"))).init()}));var g=document.querySelectorAll("[data-new-table]");g.length>0&&g.forEach((function(e){new U(e)}));var v=document.querySelectorAll("[data-draggable]");v.length>0&&v.forEach((function(e){new K(e)}));var m=document.querySelectorAll("[data-sortable-target]");m.length>0&&m.forEach((function(e){new O(e)}));var f=document.querySelectorAll("[data-selectable-target]");f.length>0&&f.forEach((function(e){new G(e)}));var p=document.querySelectorAll("[data-keywords]");p.length>0&&p.forEach((function(e){var t=e.hasAttribute("data-module-settings")?e.getAttribute("data-module-settings"):{};new B(e,JSON.parse(t)).init()}));var b=document.querySelectorAll("[data-gallery]");b.length>0&&b.forEach((function(e){new Z(e)}))}};!function(){if(function(){if(!Array.from||!Element.prototype.matches||!Element.prototype.closest||"function"!=typeof window.CustomEvent||"function"!=typeof Object.assign){console.warn("Not supported browser.");var e=document.querySelector("#unsupported");return e.querySelector("#unsupported-browser").innerHTML=" ".concat(platform.name," ").concat(platform.version," "),e.classList.remove("is-hidden"),!0}return!1}())return!1;document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",Q,!1)}()}();
//# sourceMappingURL=components.build.js.map
