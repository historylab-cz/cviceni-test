{"version":3,"file":"components.build.js","sources":["../../../../src/js/components/dom-load.js","../../../../src/js/components/component.js","../../../../src/js/components/magnifying-glass.js","../../../../src/js/lib/utils.js","../../../../src/js/components/media/media.js","../../../../src/js/components/media/audio-player.js","../../../../src/js/components/svg-lib/svg-dragndrop.js","../../../../src/js/components/svg-lib/svg-draw.js","../../../../src/js/components/svg-lib/svg-text.js","../../../../src/js/components/svg.js","../../../../src/js/components/sortable.js","../../../../src/js/components/svg-lib/svg-radial-menu.js","../../../../src/js/components/editor/selectionMenu.js","../../../../src/js/components/editor/writtingMenu.js","../../../../src/js/components/editor/schema.js","../../../../src/js/components/editor/editor.js","../../../../src/js/components/keywords.js","../../../../src/js/components/test-quiz.js","../../../../src/js/components/fullscreen.js","../../../../src/js/components/user-text.js","../../../../src/js/components/media/audio-player-normal.js","../../../../src/js/components/media/audio-player-simple.js","../../../../src/js/components/fake-map.js","../../../../src/js/components/media/video.js","../../../../src/js/components/selectable.js","../../../../src/js/components/new-table.js","../../../../src/js/components/draggable.js","../../../../src/js/components/gallery.js","../../../../src/js/components/window-load.js","../../../../src/js/components/components.js","../../../../src/js/lib/unsupported-browsers.js"],"sourcesContent":["\r\nconst domLoadComponents = () => {\r\n  console.log('domLoad:components');\r\n\r\n  // instantiate\r\n\r\n  // run\r\n\r\n};\r\n\r\nexport default domLoadComponents;\r\n","export default class Component {\r\n  constructor($element) {\r\n    this.target = $element;\r\n    this.$slide = this.target.closest('.slide');\r\n    this.lang = document.documentElement.getAttribute('lang');\r\n\r\n    if (!HISTORYLAB.import.done) {\r\n\r\n      if (this.$slide) {\r\n        this.$buttonFeedback = this.$slide.querySelector('[data-feedback-button]');\r\n\r\n        if (this.$buttonFeedback) {\r\n          this.$buttonFeedbackText = this.$buttonFeedback.querySelector('span');\r\n        }\r\n      }\r\n\r\n\r\n      this.showFeedback = this.showFeedback.bind(this);\r\n    }\r\n  }\r\n\r\n  showFeedback() {\r\n    if (this.$buttonFeedback && this.$buttonFeedback.classList.contains('button-hidden')) {\r\n      this.$buttonFeedback.classList.remove('button-hidden');\r\n    }\r\n  }\r\n\r\n  hideFeedback() {\r\n    this.$buttonFeedback.classList.add('button-hidden');\r\n  }\r\n}\r\n","import Component from './component';\r\n\r\nexport default class MagnifyingGlass extends Component {\r\n  // https://www.youtube.com/watch?v=e8IwM3iqnL0\r\n  constructor($element) {\r\n    super($element);\r\n    // SVG lupa a ještě dynamicky měnícího se SVG,\r\n    // který není na počátku známé?\r\n    // if (el.nodeName === 'svg') {\r\n    //   console.log('SVG');\r\n    //   el.children[0].getAttribute('xlink:href')\r\n    // }\r\n    this.$element = document.querySelector('[data-lupa]');\r\n    this.$canvas = document.querySelector('[data-lupa-canvas]');\r\n    this.ctx = this.$canvas.getContext('2d');\r\n\r\n    this._onStart = this._onStart.bind(this);\r\n    this._onMove = this._onMove.bind(this);\r\n    this._onEnd = this._onEnd.bind(this);\r\n    this._update = this._update.bind(this);\r\n    this._onResize = this._onResize.bind(this);\r\n\r\n    this.zoomGlassSize = 230;\r\n    this.targetBCR = null;\r\n    this.zoomed = 0;\r\n    this.targetZoomed = 0;\r\n\r\n    this.x = 0;\r\n    this.y = 0;\r\n    this.trackingTouch = false;\r\n    this.displayStyle = '';\r\n\r\n    this._addEventListeners();\r\n    this._initCanvas();\r\n    this._onResize();\r\n\r\n    window.requestAnimationFrame(this._update);\r\n  }\r\n\r\n  _initCanvas() {\r\n    const width = this.zoomGlassSize;\r\n    const height = this.zoomGlassSize;\r\n    // if retina makes canvas more dense\r\n    const dPR = window.devicePixelRation || 1;\r\n    this.$canvas.width = width * dPR;\r\n    this.$canvas.height = height * dPR;\r\n\r\n    this.$canvas.style.width = `${width}px`;\r\n    this.$canvas.style.height = `${height}px`;\r\n\r\n    this.ctx.scale(dPR, dPR);\r\n  }\r\n\r\n  _onResize() {\r\n    this.targetBCR = this.target.getBoundingClientRect();\r\n  }\r\n\r\n  _onStart(event) {\r\n    this.displayStyle = getComputedStyle(this.$element).display;\r\n    if (event.target !== this.target || this.displayStyle === 'none') {\r\n      return;\r\n    }\r\n\r\n    event.preventDefault();\r\n    this.x = event.pageX || event.touches[0].pageX;\r\n    this.y = event.pageY || event.touches[0].pageY;\r\n\r\n    this.trackingTouch = true;\r\n    this.targetZoomed = 1;\r\n    this.zoomed = 0;\r\n\r\n    window.requestAnimationFrame(this._update);\r\n  }\r\n\r\n  _onMove(event) {\r\n    if (!this.trackingTouch || this.displayStyle === 'none') {\r\n      return;\r\n    }\r\n\r\n    this.x = event.pageX || event.touches[0].pageX;\r\n    this.y = event.pageY || event.touches[0].pageY;\r\n  }\r\n\r\n  _onEnd() {\r\n    if (this.targetZoomed) {\r\n      // show OK button or feedback\r\n      this.showFeedback();\r\n    }\r\n\r\n    this.targetZoomed = 0;\r\n    this.trackingTouch = false;\r\n  }\r\n\r\n  _update() {\r\n    const TAU = Math.PI * 2;\r\n    const MAX_RADIUS = 100;\r\n    const radius = this.zoomed * MAX_RADIUS;\r\n\r\n    this.targetBCR = this.target.getBoundingClientRect();\r\n\r\n    // local coordinates (ratio <0,1>)\r\n    const ratioX =\r\n      // min. 0\r\n      Math.max(0,\r\n        // max. 1\r\n        Math.min(1, ((this.x - this.targetBCR.left) / this.targetBCR.width))\r\n      );\r\n    // console.log(ratioX);\r\n    const ratioY =\r\n      // min. 0\r\n      Math.max(0,\r\n        // max. 1\r\n        Math.min(1, ((this.y - this.targetBCR.top) / this.targetBCR.height))\r\n      );\r\n    // console.log(ratioY);\r\n\r\n    // actual zooming (scaling)\r\n    const imageScale = 2.5;\r\n    const scaledTargetWidth = this.targetBCR.width * imageScale;\r\n    const scaledTargetHeight = this.targetBCR.height * imageScale;\r\n\r\n    // Firefox on Windows has a bug because of the shadow\r\n    if (!(platform.os.family.indexOf('Windows') > -1 && platform.name.indexOf('Firefox') > -1)) {\r\n      // Shadow.\r\n      this.ctx.shadowColor = 'rgba(0,0,0,0.4)';\r\n      this.ctx.shadowBlur = 12;\r\n      this.ctx.shadowOffsetY = 8;\r\n    }\r\n\r\n    // Background.\r\n    this.ctx.clearRect(0, 0, this.zoomGlassSize, this.zoomGlassSize);\r\n    this.ctx.fillStyle = '#fff';\r\n    this.ctx.beginPath();\r\n    this.ctx.arc(\r\n      // x\r\n      this.zoomGlassSize / 2,\r\n      // y\r\n      (this.zoomGlassSize - 10) - radius,\r\n      // radius, startAngle, endAngle\r\n      radius, 0, TAU);\r\n    this.ctx.closePath();\r\n    this.ctx.fill();\r\n\r\n    // save the default state (without image)\r\n    this.ctx.save();\r\n\r\n    // Zoomed image.\r\n    this.ctx.beginPath();\r\n    this.ctx.arc(\r\n      // x\r\n      this.zoomGlassSize / 2,\r\n      // y\r\n      (this.zoomGlassSize - 10) - (radius + 1),\r\n      // radius, startAngle, endAngle\r\n      radius * 1.03, 0, TAU);\r\n    this.ctx.clip();\r\n    this.ctx.closePath();\r\n    this.ctx.drawImage(this.target,\r\n      // dx and dy (left and top)\r\n      (-ratioX * scaledTargetWidth) + (this.zoomGlassSize / 2),\r\n      (-ratioY * scaledTargetHeight) + (this.zoomGlassSize / 2),\r\n      // scaled width and height\r\n      scaledTargetWidth, scaledTargetHeight);\r\n\r\n    // go back to default state (without image)\r\n    // so next update starts fresh\r\n    this.ctx.restore();\r\n\r\n    // Position the parent $element.\r\n    this._setTransformStyle(this.x, this.y);\r\n\r\n    // Update the zoom value.\r\n    this.zoomed += (this.targetZoomed - this.zoomed) / 4;\r\n\r\n    // Schedule another update if the zoom is fairly non-zero.\r\n    if (this.zoomed > 0.001) {\r\n      // if (this.zoomed > 0.001 && this.zoomed < 0.998) {\r\n      window.requestAnimationFrame(this._update);\r\n      // } else if (this.zoomed >= 0.998) {\r\n      //   this.zoomed = 1;\r\n    } else {\r\n      this.zoomed = 0;\r\n    }\r\n  }\r\n\r\n  _addEventListeners() {\r\n    // touch events\r\n    document.addEventListener('touchstart', this._onStart);\r\n    document.addEventListener('touchmove', this._onMove);\r\n    document.addEventListener('touchend', this._onEnd);\r\n    // mouse events\r\n    document.addEventListener('mousedown', this._onStart);\r\n    document.addEventListener('mousemove', this._onMove);\r\n    document.addEventListener('mouseup', this._onEnd);\r\n    // window events\r\n    window.addEventListener('resize', this._onResize);\r\n  }\r\n\r\n  _setTransformStyle(x, y) {\r\n    const halfYoomGlassSize = this.zoomGlassSize / 2;\r\n    let betterX;\r\n    let betterY;\r\n\r\n    if (x - halfYoomGlassSize < 0) {\r\n      betterX = Math.abs(x) + halfYoomGlassSize + 18;\r\n    }\r\n    else if (x + halfYoomGlassSize > window.innerWidth) {\r\n      betterX = window.innerWidth - (x - window.innerWidth) - this.zoomGlassSize;\r\n    }\r\n    else {\r\n      betterX = x;\r\n    }\r\n\r\n    if (y - this.zoomGlassSize < 0) {\r\n      betterY = Math.abs(y) + this.zoomGlassSize + 18;\r\n    }\r\n    else {\r\n      betterY = y;\r\n    }\r\n\r\n    this.$element.style.transform = `translate(${betterX}px, ${betterY}px)`;\r\n  }\r\n}\r\n","export const specialClasses = [\n  'previous-slide', \n  'previous-to-active-slide', \n  'active-slide', \n  'next-slide', \n  'visited-slide'\n];\n\nexport function __isTouchEnabled() {\n  return ('ontouchstart' in window) ||\n    (navigator.maxTouchPoints > 0) ||\n    (navigator.msMaxTouchPoints > 0);\n}\n\n// Is touch: mql.matches === true\nexport function __isTouchOnly() {\n  return window.matchMedia('(hover: none)').matches;\n}\n\nexport function imageIsLoaded(src) {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => resolve(img);\n    img.onerror = reject;\n    img.src = src;\n  });\n}\n\nexport function __createNewCustomEvent(name, options = {}, data = null) {\n  const defaults = {\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Creating_and_triggering_events#Event_bubbling\n    bubbles: true,\n    // cancelBubble\n    // stopPropagation()\n    // cancelable\n    // composed\n    // currentTarget\n    // defaultPrevented\n    // preventDefault()\n    // eventPhase\n    // returnValue\n    // preventDefault()\n    // defaultPrevented\n    // target\n    // timeStamp\n    // type\n    // isTrusted\n  };\n\n  const properties = Object.assign(defaults, options);\n\n  return new CustomEvent(name, {\n    detail: data,\n    ...properties,\n  });\n}\n\nexport function __dispatchEvent($element, type, options, payload) {\n  const event = __createNewCustomEvent(type, options, payload);\n\n  // console.log(event);\n  $element.dispatchEvent(event);\n}\n\n/* https://plainjs.com/javascript/events/trigger-an-event-11/ */\nexport function __triggerEvent(el, type) {\n\n  if ('createEvent' in document) {\n    // modern browsers, IE9+\n    const e = new Event(type);\n    el.dispatchEvent(e);\n  } else {\n    // IE 8\n    const e = document.createEventObject();\n    e.eventType = type;\n    el.fireEvent('on' + e.eventType, e);\n  }\n}\n\nexport function __keycodeIsPrintableCharacter(keycode) {\n\n  const valid =\n    (keycode > 47 && keycode < 58) || // number keys\n    keycode == 32 || keycode == 13 || // spacebar & return key(s) (if you want to allow carriage returns)\n    (keycode > 64 && keycode < 91) || // letter keys\n    (keycode > 95 && keycode < 112) || // numpad keys\n    (keycode > 185 && keycode < 193) || // ;=,-./` (in order)\n    (keycode > 218 && keycode < 223); // [\\]' (in order)\n  // https://stackoverflow.com/questions/12467240/determine-if-javascript-e-keycode-is-a-printable-non-control-character#answer-12467610\n\n  return valid;\n\n}\n\nexport function __isObject(item) {\n  return (item && typeof item === 'object' && !Array.isArray(item));\n}\n\n// https://stackoverflow.com/questions/27936772/how-to-deep-merge-instead-of-shallow-merge\n// Maybe use lodash ? https://lodash.com/docs/4.17.10#defaultsDeep\nexport function __mergeDeep(target, source) {\n  const output = Object.assign({}, target);\n  if (__isObject(target) && __isObject(source)) {\n    Object.keys(source).forEach((key) => {\n      if (__isObject(source[key])) {\n        if (!(key in target)) {\n          Object.assign(output, { [key]: source[key] });\n        } else {\n          output[key] = __mergeDeep(target[key], source[key]);\n        }\n      } else {\n        Object.assign(output, { [key]: source[key] });\n      }\n    });\n  }\n  return output;\n}\n\nexport function __isObjectEmpty(object) {\n  return !Object.keys(object).length;\n}\n\nexport function __insertBefore(newNode, referenceNode) {\n  referenceNode.parentNode.insertBefore(newNode, referenceNode);\n}\n\nexport function __insertAfter(newNode, referenceNode) {\n\n  referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n\n}\n\nexport function __getRealDimensions(el, translated = true) {\n\n  const clonedElement = el.cloneNode(true);\n\n  clonedElement.style.visibility = 'hidden';\n  clonedElement.style.display = 'block';\n\n  __insertAfter(clonedElement, el);\n\n  const elDimensions = clonedElement.getBoundingClientRect();\n  const elPosition = (translated) ? __positionTranslated(clonedElement) : __position(clonedElement);\n\n\n  __remove(clonedElement);\n\n  return {\n    width: elDimensions.width,\n    height: elDimensions.height,\n    top: elPosition.top,\n    left: elPosition.left,\n  };\n\n}\n\nexport function __remove(el /* :HTMLElement */) {\n\n  el.parentNode.removeChild(el);\n\n}\n\n\nexport function __getHTML(node) {\n\n  if (!node || !node.tagName) { return; }\n  if (node.outerHTML) { return node.outerHTML; }\n\n  // polyfill:\n  const wrapper = document.createElement('div');\n  wrapper.appendChild(node.cloneNode(true));\n  return wrapper.innerHTML;\n\n}\n\nexport function __getText(el) {\n  return el.innerText || el.textContent;\n}\n\nexport function __globalPosition(event) {\n  // d3.event\n  // The current event, if any. This is set during the invocation of an event listener, and is reset after the listener terminates. Use this to access standard event fields such as event.timeStamp and methods such as event.preventDefault. While you can use the native event.pageX and event.pageY, it is often more convenient to transform the event position to the local coordinate system of the container that received the event using d3.mouse, d3.touch or d3.touches.\n  // If you use Babel, Webpack, or another ES6-to-ES5 bundler, be aware that the value of d3.event changes during an event! An import of d3.event must be a live binding, so you may need to configure the bundler to import from D3’s ES6 modules rather than from the generated UMD bundle; not all bundlers observe jsnext:main. Also beware of conflicts with the window.event global.\n  \n  // for mobile no need more then first finge touch\n  return {\n    x: event.pageX || event.touches[0].pageX,\n    y: event.pageY || event.touches[0].pageY,\n  };\n}\n\nexport function __localPosition(event, container) {\n  // d3.mouse\n  // Returns the x and y coordinates of the current event relative to the specified container. The container may be an HTML or SVG container element, such as a G element or an SVG element. The coordinates are returned as a two-element array of numbers [x, y].\n  // BUG: d3.mouse doesn’t observe CSS transform on Firefox — https://github.com/d3/d3-selection/issues/81\n  // TEMPORARY FIX: https://github.com/d3/d3-selection/issues/191#issuecomment-474987103\n\n  let position = [];\n\n  if (platform.name === 'Firefox' && event.target.closest('.half-slide-active')) {\n    // this works for Firefox even in transformed container\n    // if (platform.name === 'Firefox')\n    // but creates another bug when used on top of another SVG element (with different viewbox?),\n    // so make temporary fix only of .half-slide-active to fix the orginal bug with new bug\n    // console.log(d3.event.target.closest('.half-slide-active'));\n    position = [\n      event.offsetX,\n      event.offsetY,\n    ];\n  } else {\n    // this works for Chrome\n    position = d3.pointer(event, container);\n\n    // fix for ios\n    // https://github.com/d3/d3-selection/blob/main/src/pointer.js\n    // vs\n    // https://github.com/d3/d3-selection/blob/main/src/pointers.js\n    // both or nothing\n    if (!position[0]) {\n      [ position ] = d3.pointers(event, container);\n    }\n  }\n\n  return {\n    x: d3.format('.0f')(position[0]),\n    y: d3.format('.0f')(position[1]),\n  };\n}\n\nexport function __positionTranslated(el) {\n\n\n  const curTransform = new WebKitCSSMatrix(window.getComputedStyle(el).webkitTransform);\n\n  const body = document.body;\n\n  const scrollTop = window.pageYOffset || body.scrollTop;\n  const scrollLeft = window.pageXOffset || body.scrollLeft;\n\n  return {\n    left: el.offsetLeft + curTransform.m41,\n    top: el.offsetTop + curTransform.m42,\n  };\n\n}\n\nexport function __position(el) {\n\n  const elAttibutes = el.getBoundingClientRect();\n  const body = document.body;\n\n  const scrollTop = window.pageYOffset || body.scrollTop;\n  const scrollLeft = window.pageXOffset || body.scrollLeft;\n\n  return {\n    left: elAttibutes.left + scrollLeft,\n    top: elAttibutes.top + scrollTop,\n    height: elAttibutes.height,\n    width: elAttibutes.width,\n  };\n}\n\n// TODO: check for https://github.com/vladocar/nanoJS/\nexport function __toggleClass(element, cls) {\n  if (__hasClass(element, cls)) {\n    __removeClass(element, cls);\n  } else {\n    __addClass(element, cls);\n  }\n}\n\nexport function __hasClass(element, cls) {\n  // if there are no elements or classes, we're done\n  if (!element || !cls) return false;\n  return (element.classList) ? element.classList.contains(cls) : (`${element.className} `).indexOf(`${cls} `) > -1;\n}\n\nexport function __addClass(elements, classes) {\n  let _elements = elements;\n  let _classes = classes;\n\n  // if there are no elements or classes, we're done\n  if (!_elements || !_classes) { return; }\n\n  if (typeof (_elements) === 'string') {\n    // if we have a selector, get the chosen _elements\n    _elements = document.querySelectorAll(_elements);\n  } else if (_elements.tagName) {\n    // if we have a single DOM element, make it an array to simplify behavior\n    _elements = [_elements];\n  }\n\n  if (typeof (_classes) === 'string') {\n    // make an array from string _classes\n    _classes = _classes.split(' ');\n  } else {\n    console.log('Class argument must be string with spaces in between class names.');\n    return;\n  }\n\n  // add class to all chosen _elements\n  for (let i = 0; i < _elements.length; i += 1) {\n    // check classList support\n    if (_elements[i].classList) {\n      _elements[i].classList.add(..._classes);\n    } else if (!__hasClass(_elements[i], ..._classes)) {\n      for (let j = 0; j < _classes.length; j += 1) {\n        _elements[i].classes += ` ${_classes[j]}`;\n      }\n    }\n  }\n}\n\nexport function __removeClass(elements, classes) {\n  let _elements = elements;\n  let _classes = classes;\n\n  // if there are no elements or classes, we're done\n  if (!_elements || !_classes) { return; }\n\n  if (typeof (_elements) === 'string') {\n    // if we have a selector, get the chosen _elements\n    _elements = document.querySelectorAll(_elements);\n  } else if (_elements.tagName) {\n    // if we have a single DOM element, make it an array to simplify behavior\n    _elements = [_elements];\n  }\n\n  if (typeof (_classes) === 'string') {\n    // make an array from string _classes\n    _classes = _classes.split(' ');\n  } else {\n    console.log('Class argument must be string with spaces in between class names.');\n    return;\n  }\n\n  // remove class from all chosen _elements\n  for (let i = 0; i < _elements.length; i += 1) {\n    // check classList support\n    if (_elements[i].classList) {\n      _elements[i].classList.remove(..._classes);\n    } else {\n      for (let j = 0; j < _classes.length; j += 1) {\n        _elements[i].className = _elements[i].className.replace(new RegExp(`\\\\b${classes[j]}\\\\b`, 'g'), '');\n      }\n    }\n  }\n}\n\nexport function __getElementComputedValue(element, value) {\n  const values = getComputedStyle(element);\n  return values.getPropertyValue(value) || null;\n}\n\n/**\n * https://stackoverflow.com/questions/17130940/retrieve-the-same-offsetx-on-touch-like-mouse-event#answer-66858288\n * \n * @param {event} Event\n * @returns Object with { x: offsetX, y:offsetY }\n */\nexport function __offSetForTouchEvent(e) {\n  const {\n    x, y, width, height,\n  } = e.target.getBoundingClientRect();\n  const offsetX = ((e.touches[0].clientX - x) / width) * e.target.offsetWidth;\n  const offsetY = ((e.touches[0].clientY - y) / height) * e.target.offsetHeight;\n\n  return { x: offsetX, y: offsetY };\n}\n","import { __createNewCustomEvent } from '../../lib/utils';\r\n\r\nconst mediaEvents = {\r\n  playchange: __createNewCustomEvent('playchange'),\r\n  timechange: __createNewCustomEvent('timechange'),\r\n  canplaystart: __createNewCustomEvent('canplaystart'),\r\n};\r\n\r\nfunction stopPlayingVideoPlayers($players) {\r\n  // pause all other playing media tracks\r\n  $players.forEach(($player) => {\r\n    const $media = $player.querySelector('audio') || $player.querySelector('video');\r\n    if ($media && !$media.paused) {\r\n      $media.pause();\r\n      $player\r\n        .querySelector('[data-player-control]')\r\n        .setAttribute('data-player-control', 'paused');\r\n    }\r\n  });\r\n}\r\n\r\nfunction getSecondsMinutesFormat(seconds) {\r\n  const duration = {\r\n    seconds: Math.floor(seconds),\r\n    minutes: Math.floor(seconds / 60),\r\n  };\r\n\r\n  duration.seconds = (duration.seconds - (duration.minutes * 60)).toString(10);\r\n\r\n  return `${duration.minutes}:${(`0${duration.seconds}`).slice(-2)}`;\r\n}\r\n\r\nexport {\r\n  getSecondsMinutesFormat,\r\n  stopPlayingVideoPlayers,\r\n  mediaEvents,\r\n};\r\n","import Component from '../component';\r\nimport { getSecondsMinutesFormat, stopPlayingVideoPlayers } from './media';\r\n\r\nexport default class AudioPlayer extends Component {\r\n  // eslint-disable-next-line no-useless-constructor\r\n  constructor($element) {\r\n    super($element);\r\n  }\r\n\r\n  // TODO: move to audio-simple.js\r\n  static addEventListeners($item, showFeedback) {\r\n    const $players = document.querySelectorAll('[data-player-audio]');\r\n    const $audio = $item.querySelector('audio');\r\n    const $playButton = $item.querySelector('[data-player-control]');\r\n    const $timeLeft = $item.querySelector('[data-audio-time-left]');\r\n\r\n    $playButton.addEventListener('click', (event) => {\r\n      if ($playButton.getAttribute('data-player-control') === 'paused') {\r\n        // TODO: abstract\r\n        stopPlayingVideoPlayers($players);\r\n        $audio.play();\r\n        $playButton.setAttribute('data-player-control', 'playing');\r\n      } else {\r\n        // TODO: abstract\r\n        $audio.pause();\r\n        $playButton.setAttribute('data-player-control', 'paused');\r\n      }\r\n\r\n      showFeedback();\r\n\r\n      event.stopPropagation();\r\n    }, false);\r\n\r\n    // do not propagate audio control events higher into the dom\r\n    $playButton.addEventListener('mousedown', (event) => {\r\n      event.stopPropagation();\r\n    }, false);\r\n\r\n    $audio.addEventListener('timeupdate', () => {\r\n      $timeLeft.innerText = getSecondsMinutesFormat($audio.currentTime);\r\n    });\r\n\r\n    $audio.addEventListener('ended', () => {\r\n      $playButton.setAttribute('data-player-control', 'paused');\r\n    });\r\n  }\r\n}\r\n","export default class SVGDragNDrop {\n  // static drag(id) {\n  //   d3.drag()\n  //     .on('start', () => {\n  //       SVGDragNDrop.start(id);\n  //     })\n  //     .on('drag', () => {\n  //       SVGDragNDrop.dragged(id);\n  //     })\n  //     .on('end', () => {\n  //       SVGDragNDrop.end(id);\n  //     });\n  // }\n\n  static start($element) {\n    d3.select($element).raise().classed('is-dragged', true);\n  }\n\n  static dragged(event, $element, type, diff, $node) {\n    let [xZarov, yZarov] = this.getJustifiedCord(event, $element, type, diff, $node);\n    d3.select($element).attr('x', xZarov.toFixed()).attr('y', yZarov.toFixed());\n  }\n\n  static end(event, $element, type, diff, $node) {\n    let [xZarov, yZarov] = this.getJustifiedCord(event, $element, type, diff, $node);\n    d3.select($element)\n      .attr('x', xZarov.toFixed())\n      .attr('y', yZarov.toFixed())\n      // neumožňuje v jiných funkcí s tímto objektem dále pracovat,\n      // protože pracují s id\n      // .attr('id', `${type}-${d3.event.x.toFixed()}-${d3.event.y.toFixed()}`)\n      .classed('is-dragged', false);\n  }\n\n  /**\n   * Method which return additional offsets due the orientation of textarea\n   * @returns {Array} [x,y]\n   *\n   * @param {Object} orientation object of orentation of textarea against black dot\n   * @param {Object} elementResolution object of element resolution\n   */\n  static getOffsetOfText(orientation, elementResolution) {\n    if (orientation[0] === 'left' && orientation[1] === 'top') {\n      return [elementResolution.width - 10, elementResolution.height - 10];\n    }\n    if (orientation[0] === 'left' && orientation[1] === 'bottom') {\n      return [elementResolution.width - 10, 0];\n    }\n    if (orientation[0] === 'right' && orientation[1] === 'top') {\n      return [0, elementResolution.height - 10];\n    }\n    if (orientation[0] === 'right' && orientation[1] === 'bottom') {\n      return [0, 0];\n    }\n  }\n\n  static getJustifiedCord(event, $element, type, diff, $node) {\n    const elementResolution = {\n      height: $node.offsetHeight,\n      width: $node.offsetWidth,\n    };\n\n    const svgResolution = $element\n      .getAttribute('data-svg-resolution')\n      .split(', ')\n      .map((e) => parseInt(e, 10));\n\n    switch (type) {\n      case 'text':\n        return this.textJustified(\n          event,\n          $element,\n          diff,\n          elementResolution,\n          svgResolution,\n        );\n      case 'pretahovani':\n        return this.pretahovaniJustified(\n          event,\n          $element,\n          diff,\n          svgResolution,\n        );\n      default:\n        return this.circleJustified(event, svgResolution, diff, elementResolution);\n    }\n  }\n\n  static textJustified(event, $element, diff, elementResolution, svgResolution) {\n    const orientation = $element\n      .getAttribute('data-svg-text-orientation')\n      .split(', ');\n    const textCenter = this.getOffsetOfText(orientation, elementResolution);\n    let xZarov = 0;\n    let yZarov = 0;\n\n    // for x\n    if (event.x - diff.x <= 10 + textCenter[0]) {\n      xZarov = 10 + textCenter[0];\n    } else if (\n      event.x - diff.x >\n      svgResolution[0] - elementResolution.width + textCenter[0]\n    ) {\n      xZarov = svgResolution[0] - elementResolution.width + textCenter[0];\n    } else {\n      xZarov = event.x - diff.x;\n    }\n    // for y\n    if (event.y - diff.y <= 10 + textCenter[1]) {\n      yZarov = 10 + textCenter[1];\n    } else if (\n      event.y - diff.y >\n      svgResolution[1] - elementResolution.height + textCenter[1]\n    ) {\n      yZarov = svgResolution[1] - elementResolution.height + textCenter[1];\n    } else {\n      yZarov = event.y - diff.y;\n    }\n    return [xZarov, yZarov];\n  }\n\n  static pretahovaniJustified(event, $element, diff, svgResolution) {\n    const elementResolution = {\n      height: $element.attributes.height.value,\n      width: $element.attributes.width.value,\n    };\n    let xZarov = 0;\n    let yZarov = 0;\n    // FOR X\n    // left side\n    if (event.x - diff.x <= 0) {\n      xZarov = 0;\n    }\n    // right side\n    else if (event.x - diff.x > svgResolution[0] - elementResolution.width) {\n      xZarov = svgResolution[0] - elementResolution.width;\n    }\n    // else for X axis\n    else {\n      xZarov = event.x - diff.x;\n    }\n    // FOR Y\n    // upper side\n    if (event.y - diff.y <= 0) {\n      yZarov = 0;\n    }\n    // down side\n    else if (\n      event.y - diff.y >\n      svgResolution[1] - elementResolution.height\n    ) {\n      yZarov = svgResolution[1] - elementResolution.height;\n    }\n    // else for y\n    else {\n      yZarov = event.y - diff.y;\n    }\n    return [xZarov, yZarov];\n  }\n\n  static circleJustified(event, svgResolution, diff, elementResolution) {\n    let xZarov = 0;\n    let yZarov = 0;\n    // FOR X\n    // left side\n    if (event.x - diff.x <= elementResolution.width / 2) {\n      xZarov = elementResolution.width / 2;\n    }\n    // right side\n    else if (\n      event.x - diff.x >\n      svgResolution[0] - elementResolution.width / 2\n    ) {\n      xZarov = svgResolution[0] - elementResolution.width / 2;\n    }\n    // else for X axis\n    else {\n      xZarov = event.x - diff.x;\n    }\n    // FOR Y\n    // upper side\n    if (event.y - diff.y <= elementResolution.height / 2) {\n      yZarov = elementResolution.height / 2;\n    }\n    // down side\n    else if (\n      event.y - diff.y >\n      svgResolution[1] - elementResolution.height / 2\n    ) {\n      yZarov = svgResolution[1] - elementResolution.height / 2;\n    }\n    // else for y\n    else {\n      yZarov = event.y - diff.y;\n    }\n    return [xZarov, yZarov];\n  }\n\n  static circleMove(d3Element, event, svgResolution, diff, elementResolution) {\n    const [xZarov, yZarov] = this.circleJustified(event, svgResolution, diff, elementResolution);\n    d3Element.attr('cx', xZarov.toFixed()).attr('cy', yZarov.toFixed());\n  }\n}\n","import { __localPosition, __dispatchEvent, __getElementComputedValue } from '../../lib/utils';\n\n// import SVG from '../svg';\nimport SVGDragNDrop from './svg-dragndrop';\nimport SVG from '../svg';\n\nexport default class SVGDraw {\n  // static selectPath(svg) {\n  //   // https://bl.ocks.org/mbostock/8027637\n  // }\n\n  static renderPath(event, $svg, color, callback) {\n    if (event.sourceEvent.target.nodeName === 'image') {\n\n      const line = d3.line()\n        // removed smooth curve to get rid of loong decimals\n        // see https://github.com/d3/d3-path/issues/10\n        .curve(d3.curveLinear); // _dragStarted\n\n      const format = d3.format('.0f');\n      const d = event.subject;\n      // origin\n      let x0 = format(event.x);\n      let y0 = format(event.y);\n\n      const id = `${$svg.id}_path-${x0}-${y0}`;\n\n      const active = d3.select(`#${$svg.id} .svg-view`).append('svg:path')\n        // .attr('marker-start', 'url('#marker-circle-blue')')\n        // .attr('marker-end', 'url('#marker-arrow-blue')')\n        .attr('data-svg-path', '')\n        .attr('class', `svg-path ${color}`)\n        .attr('id', id)\n        .datum(d);\n\n      // github.com/d3/d3-drag#event_on\n      event\n        .on('drag', (dragEvent) => {\n          // current position\n          const x1 = format(dragEvent.x);\n          const y1 = format(dragEvent.y);\n          // distance from origin\n          const dx = x1 - x0;\n          const dy = y1 - y0;\n\n          // if the distance of drag event is too large, make new origin\n          if ((dx * dx) + (dy * dy) > 300) d.push([x0 = x1, y0 = y1]);\n          // smooth line, correct last point\n          else d[d.length - 1] = [x1, y1];\n\n          active.attr('d', line);\n        })\n        .on('end', () => {\n          const $thisPath = d3.select(`#${id}`);\n          if ($thisPath) {\n            if ($thisPath.attr('d')) {\n              if ($thisPath.attr('d').length < 40) {\n                $thisPath.remove();\n              }\n              else {\n                // dispatch event that svg has changed\n                __dispatchEvent(document, 'svg.change', {}, {\n                  svg: {\n                    id: $svg.id,\n                    task: 'create',\n                    node: $thisPath.node(),\n                    nodeName: $thisPath.node().nodeName,\n                    contextMenu: false,\n                  },\n                });\n              }\n            }\n            else if (!$thisPath.attr('d')) {\n              $thisPath.remove();\n            }\n          }\n\n          callback();\n        });\n\n      // add events to element\n      SVGDraw.pathEventsManager($svg, d3.select(`#${id}`).node());\n    }\n  }\n\n  // Draw a SVG circle on click\n  static createCircle(event, $svg, color) {\n    const svgGroup = d3.select($svg).select('.svg-view');\n    // d3.select(`#${$svg.id} .svg-view`);\n    // const canvas = document.querySelector(`#${$svg.id} .svg-view`);\n    const localPosition = __localPosition(event, $svg);\n    const id = `${$svg.id}_circle-${localPosition.x}-${localPosition.y}`;\n\n    const $circle = svgGroup.append('svg:circle')\n      .attr('data-svg-circle', '')\n      .attr('id', id)\n      .attr('cx', localPosition.x)\n      .attr('cy', localPosition.y)\n      .attr('data-svg-resolution', `${svgGroup.attr('width')}, ${svgGroup.attr('height')}`)\n      .attr('data-svg-type', 'circle')\n      .attr('class', `svg-circle ${color} unselectable`);\n\n    const $element = document.querySelector(`#${id}`);\n\n    // add events to element\n    SVGDraw.circleEventsManager($svg, $element);\n\n    // dispatch event that svg has changed\n    __dispatchEvent(document, 'svg.change', {}, {\n      svg: {\n        id: $svg.id,\n        task: 'create',\n        node: $element,\n        nodeName: $element.nodeName,\n        contextMenu: false,\n      },\n    });\n  }\n\n  static pathEventsManager($svg, $element) {\n    d3.select(`#${$element.id}`).on('click', (event) => {\n      // dispatch event that svg has changed\n      __dispatchEvent(document, 'svg.change', {}, {\n        svg: {\n          id: $svg.id,\n          task: 'remove',\n          node: event.target,\n          nodeName: event.target.nodeName,\n          contextMenu: false,\n        },\n      });\n\n      d3.select(`#${$element.id}`).remove();\n\n      event.preventDefault();\n    }, false);\n  }\n\n  static circleEventsManager($svg, $element) {\n    const $canvas = document.querySelector(`#${$svg.id} .svg-view`); // group <g>...</g>\n    const d3Element = d3.select($element);\n    const svgResolution = [\n      parseInt($canvas.getAttribute('width'), 10),\n      parseInt($canvas.getAttribute('height'), 10),\n    ];\n    const circleR = __getElementComputedValue($element, 'r');\n    const elementResolution = [\n      circleR * 2, // height\n      circleR * 2, // width\n    ];\n\n    // TODO:\n    // standalone function\n    // same for all draggable svg elements\n    let elementPosition = [\n      d3Element.attr('cx'),\n      d3Element.attr('cy'),\n    ];\n    let diff = {};\n\n    d3Element.on('click', (event) => {\n\n      // dispatch event that svg has changed\n      __dispatchEvent(document, 'svg.change', {}, {\n        svg: {\n          id: $svg.id,\n          task: 'remove',\n          node: $element,\n          nodeName: $element.nodeName,\n          contextMenu: false,\n        },\n      });\n\n      event.target.remove();\n    })\n      .call(d3.drag()\n        .container($canvas)\n        .subject($element)\n        .on('start', (event) => {\n          diff = {\n            x: event.x - elementPosition[0],\n            y: event.y - elementPosition[1],\n          };\n\n          SVGDragNDrop.start($element);\n\n          // dispatch event for radio menu - iOS fix\n          __dispatchEvent(document, 'event.propagation', {}, {\n            event: { from: 'circle.drag.start', data: event },\n          });\n        })\n        .on('drag', (event) => {\n          // dispatch event for radio menu - iOS fix\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\n          if (d3Element.attr('data-svg-selected') === 'true') return;\n\n          SVGDragNDrop.circleMove(d3Element, event, svgResolution, diff, elementResolution);\n        })\n        .on('end', (event) => {\n          // dispatch event for radio menu - iOS fix\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\n          if (d3Element.attr('data-svg-selected') === 'true') return;\n\n          const oldXCoordinate = elementPosition[0];\n          const oldYCoordinate = elementPosition[1];\n          let taskType = 'move';\n\n          SVGDragNDrop.circleMove(d3Element, event, svgResolution, diff, elementResolution);\n          d3Element.classed('is-dragged', false);\n\n          elementPosition = [\n            $element.getAttribute('cx'),\n            $element.getAttribute('cy'),\n          ];\n\n          // if clone is changed, then dispatch create event\n          if (SVG.removeCloneConnectionManager($element)) taskType = 'create';\n\n          if (elementPosition[0] !== oldXCoordinate || elementPosition[1] !== oldYCoordinate) {\n            // dispatch event that svg has changed\n            __dispatchEvent(document, 'svg.change', {}, {\n              svg: {\n                id: $svg.id,\n                task: taskType,\n                node: $element,\n                nodeName: $element.nodeName,\n                contextMenu: false,\n              },\n            });\n          }\n        }));\n  }\n\n  // it is mimular to circle EventManager but not same\n  static dropItemEventsManager($svg, $element) {\n    const $canvas = document.querySelector(`#${$svg.id} .svg-view`); // group <g>...</g>\n    const d3Element = d3.select($element);\n\n    // TODO:\n    // standalone function\n    // same for all draggable svg elements\n    let elementPosition = [\n      d3Element.attr('x'),\n      d3Element.attr('y'),\n    ];\n    let diff = {};\n\n    d3Element.on('click', () => {\n\n      // dispatch event that svg has changed\n      __dispatchEvent(document, 'svg.change', {}, {\n        svg: {\n          id: $svg.id,\n          task: 'remove',\n          node: $element,\n          nodeName: $element.nodeName,\n          contextMenu: false,\n        },\n      });\n\n      // dispatch event that drop item was deleted\n      const idParts = $element.id.split('_');\n      const $slide = $svg.closest('.slide');\n      if (idParts[idParts.length - 1] === 'dropItem') {\n        __dispatchEvent(document, 'svg.drop.delete', {}, {\n          item: {\n            slideId: $slide.id,\n            id: idParts[1],\n            $object: $element.firstChild,\n          },\n        });\n      }\n\n      $element.remove();\n    })\n      .call(d3.drag()\n        .container($canvas)\n        .subject($element)\n        .on('start', (event) => {\n          diff = {\n            x: event.x - elementPosition[0],\n            y: event.y - elementPosition[1],\n          };\n\n          SVGDragNDrop.start($element);\n\n          // dispatch event for radio menu - iOS fix\n          __dispatchEvent(document, 'event.propagation', {}, {\n            event: { from: 'circle.drag.start', data: event },\n          });\n        })\n        .on('drag', (event) => {\n          // dispatch event for radio menu - iOS fix\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\n          if (d3Element.attr('data-svg-selected') === 'true') return;\n\n          SVGDragNDrop.dragged(event, $element, 'pretahovani', diff, $element);\n        })\n        .on('end', (event) => {\n          // dispatch event for radio menu - iOS fix\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\n          if (d3Element.attr('data-svg-selected') === 'true') return;\n\n          const oldXCoordinate = elementPosition[0];\n          const oldYCoordinate = elementPosition[1];\n          let taskType = 'move';\n\n          SVGDragNDrop.end(event, $element, 'pretahovani', diff, $element);\n\n          d3Element.classed('is-dragged', false);\n\n          elementPosition = [\n            $element.getAttribute('x'),\n            $element.getAttribute('y'),\n          ];\n\n          // if clone is changed, then dispatch create event\n          if (SVG.removeCloneConnectionManager($element)) taskType = 'create';\n\n          if (elementPosition[0] !== oldXCoordinate || elementPosition[1] !== oldYCoordinate) {\n            // dispatch event that svg has changed\n            __dispatchEvent(document, 'svg.change', {}, {\n              svg: {\n                id: $svg.id,\n                task: taskType,\n                node: $element,\n                nodeName: $element.nodeName,\n                contextMenu: false,\n              },\n            });\n          }\n        }));\n  }\n}\n","import {\r\n  __addClass,\r\n  __removeClass,\r\n  __hasClass,\r\n  __dispatchEvent,\r\n} from '../../lib/utils';\r\n\r\nimport SVG from '../svg';\r\nimport SVGDragNDrop from './svg-dragndrop';\r\n\r\nexport default class SVGText {\r\n  static createText(maxLength = 333, minLength = 2) {\r\n    const defaultWidth = '15.2rem';\r\n    const defaultHeight = '55px';\r\n\r\n    const $svg = document.querySelector('[data-svg-active=\"true\"]');\r\n    const svgID = $svg.id;\r\n    const svgGroup = d3.select($svg).select('.svg-view');\r\n\r\n    // const $canvas = $svg.querySelector('.svg-view');\r\n    const $radialMenu = document.querySelector('[data-radial-menu]');\r\n    const localPosition = {\r\n      x: $radialMenu.getAttribute('data-local-x'),\r\n      y: $radialMenu.getAttribute('data-local-y'),\r\n    };\r\n    const id = `${svgID}_svg-text-${localPosition.x}-${localPosition.y}`;\r\n    const hash = `#${id}`;\r\n    const orientation = {\r\n      x: (svgGroup.attr('width') - localPosition.x) > 320 ? 'right' : 'left',\r\n      y: (svgGroup.attr('height') - localPosition.y) > 60 ? 'bottom' : 'top',\r\n    };\r\n    // let firstWrite = true;\r\n\r\n    // text wrapper\r\n    const foreignObject = svgGroup.append('svg:foreignObject')\r\n      .attr('class', `svg-text orientation-${orientation.x} orientation-${orientation.y} unselectable`)\r\n      .attr('data-svg-text', '')\r\n      .attr('x', localPosition.x)\r\n      .attr('y', localPosition.y)\r\n      .attr('data-svg-text-orientation', `${orientation.x}, ${orientation.y}`)\r\n      .attr('data-svg-resolution', `${svgGroup.attr('width')}, ${svgGroup.attr('height')}`)\r\n      .attr('style', `width: ${defaultWidth}; height: ${defaultHeight};`);\r\n\r\n    // create visual point of interest for text input\r\n    const circle = svgGroup.append('svg:circle')\r\n      .attr('id', `${id}-circle`)\r\n      .attr('cx', localPosition.x)\r\n      .attr('cy', localPosition.y)\r\n      .attr('class', 'svg-circle svg-circle-text do-not-remove unselectable');\r\n\r\n    // create text input\r\n    const textarea = foreignObject.append('xhtml:textarea')\r\n      .attr('maxlength', maxLength)\r\n      .attr('tabindex', '-1')\r\n      .attr('id', id)\r\n      .attr('class', 'svg-textarea')\r\n      .attr('data-save', '')\r\n      .attr('data-svg-textarea-target', svgID)\r\n      .attr('style', `width: ${defaultWidth}; height: ${defaultHeight};`);\r\n\r\n    // fix visual orientation on bottom\r\n    SVGText.fixVisualOrientation(foreignObject.node());\r\n\r\n    // set focus to the new text input\r\n    $svg.querySelector(hash).focus();\r\n\r\n    // add events to element\r\n    SVGText.textEventsManager($svg, textarea.node(), circle.node(), true, minLength);\r\n  }\r\n\r\n  static textEventsManager($svg, $textarea, $circle, isCreated, minLength = 2) {\r\n    const $canvas = $svg.querySelector('.svg-view');\r\n    const hash = `#${$textarea.id}`;\r\n    let firstWrite = isCreated;\r\n    let oldText = $textarea.value;\r\n\r\n    // TODO\r\n    // standalone function\r\n    // same for all draggable svg elements\r\n    const $element = $svg.querySelector(hash).parentElement;\r\n    let elementPosition = [\r\n      $element.getAttribute('x'),\r\n      $element.getAttribute('y'),\r\n    ];\r\n    let diff = {};\r\n\r\n    d3.select(hash)\r\n      // drag & drop\r\n      .call(d3.drag()\r\n        .container($canvas)\r\n        .subject($element)\r\n        .on('start', (event) => {\r\n          diff = {\r\n            x: event.x - elementPosition[0],\r\n            y: event.y - elementPosition[1],\r\n          };\r\n\r\n          SVGDragNDrop.start($element);\r\n\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.propagation', {}, {\r\n            event: { from: 'text.drag.start', data: event },\r\n          });\r\n        })\r\n        .on('drag', (event) => {\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\r\n\r\n          SVGDragNDrop.dragged(event, $element, 'text', diff, $textarea);\r\n\r\n          // circle is moving with text\r\n          $circle.setAttribute('cx', $element.getAttribute('x'));\r\n          $circle.setAttribute('cy', $element.getAttribute('y'));\r\n        })\r\n        .on('end', (event) => {\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\r\n          // enable editting created comment\r\n          $textarea.focus();\r\n\r\n          const oldXCoordinate = elementPosition[0];\r\n          const oldYCoordinate = elementPosition[1];\r\n          let taskType = 'move';\r\n\r\n          SVGDragNDrop.end(event, $element, 'text', diff, $textarea);\r\n\r\n          elementPosition = [\r\n            $element.getAttribute('x'),\r\n            $element.getAttribute('y'),\r\n          ];\r\n\r\n          // circle is moving with text\r\n          $circle.setAttribute('cx', elementPosition[0]);\r\n          $circle.setAttribute('cy', elementPosition[1]);\r\n\r\n          if (!firstWrite && (elementPosition[0] !== oldXCoordinate || elementPosition[1] !== oldYCoordinate)) {\r\n            // if clone is changed, then dispatch create event\r\n            if (SVG.removeCloneConnectionManager($element.childNodes[0])) {\r\n              taskType = 'create';\r\n              // also for circle\r\n              SVG.removeCloneConnectionManager($circle);\r\n            }\r\n\r\n            // dispatch event that svg has changed\r\n            __dispatchEvent(document, 'svg.change', {}, {\r\n              svg: {\r\n                id: $svg.id,\r\n                task: taskType,\r\n                node: $element.childNodes[0],\r\n                nodeName: $element.childNodes[0].nodeName,\r\n                circle: $circle,\r\n                contextMenu: false,\r\n              },\r\n            });\r\n          }\r\n\r\n          // fix for tablets and mobiles\r\n          // circle must be over text\r\n          d3.select($circle).raise();\r\n        }))\r\n      // keystroke\r\n      // control height of the text input on every key stroke\r\n      .on('keyup', (event) => {\r\n        SVGText.updateTextareaHeight(event.target);\r\n      })\r\n      // loss of focus\r\n      .on('blur', (event) => {\r\n        const $target = event.target;\r\n        const { value } = $target;\r\n        let taskType;\r\n        let wrongBool = false;\r\n\r\n        if (value.length === 0) {\r\n          SVG.removeItem(false, hash);\r\n          return;\r\n        }\r\n        if (value.length < minLength) {\r\n          __addClass($target, 'is-wrong');\r\n          wrongBool = true;\r\n        }\r\n        else if ((value.length >= minLength) && __hasClass($target, 'is-wrong')) {\r\n          __removeClass($target, 'is-wrong');\r\n          wrongBool = false;\r\n        }\r\n\r\n        if (oldText !== value) {\r\n          if (firstWrite) {\r\n            taskType = 'create';\r\n            firstWrite = false;\r\n          }\r\n          else {\r\n            taskType = 'change';\r\n          }\r\n          oldText = value;\r\n          // if clone is changed, then dispatch create event\r\n          if (SVG.removeCloneConnectionManager($target)) {\r\n            taskType = 'create';\r\n            // also for circle\r\n            SVG.removeCloneConnectionManager($circle);\r\n          }\r\n\r\n          // dispatch event that svg has changed\r\n          __dispatchEvent(document, 'svg.change', {}, {\r\n            svg: {\r\n              id: $svg.id,\r\n              task: taskType,\r\n              node: $target,\r\n              nodeName: $target.nodeName,\r\n              circle: $circle,\r\n              isWrong: wrongBool,\r\n              contextMenu: false,\r\n            },\r\n          });\r\n        }\r\n\r\n        // update oldText\r\n        oldText = value;\r\n        // fix ios text writing\r\n        event.target.classList.remove('unselectable');\r\n      })\r\n      // gain focus\r\n      .on('focus', () => {\r\n        d3.select($element).raise();\r\n        d3.select($circle).raise();\r\n      });\r\n  }\r\n\r\n  static updateTextareaHeight($target) {\r\n    $target.style.height = '1px';\r\n\r\n    const newHeight = `${22 + $target.scrollHeight}px`;\r\n    $target.style.height = newHeight;\r\n\r\n    // fix value for FO either\r\n    const $parent = $target.parentElement;\r\n    $parent.style.height = newHeight;\r\n    // fix visual orientation on bottom\r\n    SVGText.fixVisualOrientation($parent);\r\n  }\r\n\r\n  static fixVisualOrientation($element) {\r\n    const currentCommentWidth = $element.style.width;\r\n    const currentCommentHeight = $element.style.height;\r\n    if ($element.classList.contains('orientation-left') && $element.classList.contains('orientation-top')) {\r\n      $element.style.transform = `translate(-${currentCommentWidth}, -${currentCommentHeight})`;\r\n    }\r\n    else if ($element.classList.contains('orientation-top')) {\r\n      $element.style.transform = `translateY(-${currentCommentHeight})`;\r\n    }\r\n    else if ($element.classList.contains('orientation-left')) {\r\n      $element.style.transform = `translateX(-${currentCommentWidth})`;\r\n    }\r\n  }\r\n\r\n  static comicBubblesEventsManager($svg, $node) {\r\n    let firstWrite = true;\r\n    let oldText = $node.value;\r\n\r\n    d3.select($node).on('keyup', (event) => {\r\n      SVGText.updateTextareaHeight(event.target);\r\n    })\r\n      .on('blur', (event) => {\r\n        const $target = event.target;\r\n        const { value } = $target;\r\n        let taskType;\r\n\r\n        if (oldText !== value) {\r\n          if (firstWrite) {\r\n            taskType = 'create';\r\n            firstWrite = false;\r\n          }\r\n          else {\r\n            taskType = 'change';\r\n            if (value.length === 0) {\r\n              firstWrite = true;\r\n            }\r\n          }\r\n          oldText = value;\r\n          // if clone is changed, then dispatch create event\r\n          if (SVG.removeCloneConnectionManager($target)) taskType = 'create';\r\n\r\n          // dispatch event that svg has changed\r\n          __dispatchEvent(document, 'svg.change', {}, {\r\n            svg: {\r\n              id: $svg.id,\r\n              task: taskType,\r\n              node: $target,\r\n              nodeName: $target.nodeName,\r\n              isBubble: true,\r\n              contextMenu: false,\r\n            },\r\n          });\r\n        }\r\n\r\n        // update oldText\r\n        oldText = value;\r\n      });\r\n  }\r\n}\r\n","/**\n * čára:\n *  - nakreslit   ( drag'n'drop )\n *  - smazat      ( left click )\n *  - radial menu ( right click)\n *    - změnit barvu\n *    - smazaní\n *    - textový komentář\n * textové pole:\n *  - vytvořit    ( right click on svg )\n *    - nic => smaže se\n *    - málo znaků => zčervená\n *    - přes řádek textu => zvětší se\n *  - změnit      ( click on and write )\n *  - smazat      ( right click on textarea )\n *  - přenést     ( drag'n'drop )\n *  - radial menu ( right click on mark )\n *    - změnit barvu\n *    - smazaní\n *    - textový komentář\n * značka:\n *  - nakreslit   ( left click on svg )\n *  - přenést     ( drag'n'drop )\n *  - smazat      ( left click on mark )\n *  - radial menu ( right click)\n *    - změnit barvu\n *    - smazaní\n *    - textový komentář\n * komiksová bublina:  ( je již vytvořena předem )\n *  - napsat dovnitř\n *    - nic => zůstane\n *    - přes řádek textu => zvětší se\n */\n/* eslint-disable brace-style */\nimport Component from './component';\nimport { __dispatchEvent, __removeClass, __addClass, __globalPosition } from '../lib/utils';\nimport SVGDraw from './svg-lib/svg-draw';\nimport SVGText from './svg-lib/svg-text';\nimport SVGDragNDrop from './svg-lib/svg-dragndrop';\n\nexport default class SVG extends Component {\n  constructor($element) {\n    super($element);\n    this.$canvas = this.target.querySelector('.svg-view');\n\n    this.format = d3.format('.0f');\n\n    this._setSize();\n\n    this.init();\n    this._initWhenDone();\n  }\n\n  init() {\n    if (HISTORYLAB.import.done) return;\n\n    // duplicate source of different svg element\n    this.toDuplicate = this.target.getAttribute('data-duplicate-svg');\n\n    // make array from data-attributes (contains what kind of actions can user do on this svg)\n    const svgSpecificActions = this.target.getAttribute('data-svg-target').split(' ');\n\n    // get default color\n    const colors = this.target.getAttribute('data-svg-colors');\n\n    for (let i = 0; i < svgSpecificActions.length; i += 1) {\n      if (svgSpecificActions[i] === 'kresleni') {\n        const svgSpecificColor = colors ? colors.split(' ')[0] : 'yellow';\n        this._initPath(this.showFeedback, svgSpecificColor);\n      }\n      else if (svgSpecificActions[i] === 'znacky') {\n        const svgSpecificColor = colors ? colors.split(' ')[0] : 'blue';\n        this._initCircle(this.showFeedback, svgSpecificColor);\n      }\n      // else if (svgSpecificActions[i] === 'text') {\n      //   this._initText();\n      // }\n    }\n\n    // this._initZoom();\n    // comic bubbles if exists\n    this._initComicBubbles();\n\n    // listen events\n    this._getEvents();\n    this._getDropEvent();\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _initWhenDone() {\n    if (!HISTORYLAB.import.done) return;\n\n    d3.selectAll('[data-svg-text] textarea')\n      // local context needed because of `this`\n      // eslint-disable-next-line func-names\n      .on('mouseenter', function () {\n        d3.select(this.closest('foreignObject')).raise();\n      });\n  }\n\n  _setSize() {\n    // NOTE: Cannot set `width` because of change of width when on half slide.\n    // TODO: set size on window resize\n\n    // might not be needed when inside sortable or other higher level module\n    // TODO: add condition for other higher level modules\n    // if (this.target.closest('[data-sortable-target')) return false;\n\n    const viewbox = this.target.getAttribute('viewBox').split(' ');\n    const rect = this.target.getBoundingClientRect(); // max-height: 100vh\n    // const getMaxWidthAbsolute = () => {\n    //   if (matchMedia('screen and (min-width: 1025px)').matches) {\n    //     return window.innerWidth * .8; // max-width: 62vw\n    //   }\n\n    //   return window.innerWidth;\n    // };\n    const maxWidthAbsolute = window.innerWidth;\n    const maxHeightAbsolute = window.innerHeight * 0.9;\n    const getHeight = () => {\n      if (!rect.height) return viewbox[3];\n      if (rect.height > viewbox[3]) return viewbox[3];\n\n      return rect.height;\n    };\n\n    const height = getHeight() > maxHeightAbsolute ? maxHeightAbsolute : getHeight();\n\n    const scale = height / viewbox[3];\n    const maxWidth = viewbox[2] * scale;\n    const setMaxWidth = scale ? `${maxWidth < maxWidthAbsolute ? maxWidth : maxWidthAbsolute}px` : '';\n\n    this.target.style.maxWidth = setMaxWidth;\n\n    // fix for svg + draggable/gallery (horizontal layout) in Chrome\n    if (\n      this.target.getAttribute('data-svg-drop')\n      && !this.target.closest('.layout-vertical')\n    ) {\n      this.target.closest('.svgs-container').style.maxWidth = setMaxWidth;\n    }\n  }\n\n  // _initZoom() {\n  //   const view = d3.select(`#${this.target.id} .svg-view`);\n  //   const size = [\n  //     view.attr('width'),\n  //     view.attr('height'),\n  //   ];\n  //   SVGZoom.zoom(this.target, view, size);\n  // }\n\n  _initPath(callback, color) {\n    d3.select(this.target)\n      .call(d3.drag()\n        .container(() => this.target)\n        .subject((event) => {\n          const p = [event.x.toFixed(), event.y.toFixed()];\n\n          return [p, p];\n        })\n        .on('start', (event) => {\n          SVGDraw.renderPath(event, this.target, color, callback);\n        }));\n  }\n  // _initText() {\n  //   d3.select(this.target).on('click', () => {\n  //     SVGText.openTextDialog(this.target);\n  //     d3.event.preventDefault();\n  //   });\n  // }\n\n  _initCircle(callback, color) {\n    d3.select(this.target).on('click', (event) => {\n      const item = event.target;\n      const { nodeName } = item;\n      const validPlace = (nodeName === 'image');\n      // const isCircle = (__hasClass(item, 'svg-circle'));\n\n      if (!validPlace) {\n        return;\n      }\n\n      SVGDraw.createCircle(event, this.target, color);\n      callback();\n\n      event.preventDefault();\n    }, false);\n  }\n\n  _initComicBubbles() {\n    const $comicBubbles = this.target.querySelectorAll('.svg-komiks .svg-textarea');\n\n    if ($comicBubbles) {\n      $comicBubbles.forEach(($comicBubble) => {\n        SVGText.comicBubblesEventsManager(this.target, $comicBubble);\n      });\n    }\n  }\n\n  _generateNewID(oldID) {\n    const idParts = oldID.split('_');\n    // beware if it's a error, return oldID\n    if (idParts.length < 2) {\n      console.log('Svg ID error!', oldID);\n      return oldID;\n    }\n\n    // solve thirt part of id\n    if (idParts[idParts.length - 1] !== `clone-${idParts[0]}`) {\n      idParts.push(`clone-${idParts[0]}`);\n    }\n\n    // solve first part of id\n    idParts[0] = this.target.id;\n\n    const newID = idParts.join('_');\n    return newID;\n  }\n\n  _getEvents() {\n\n    const svgDuplicateSources = this.toDuplicate ? this.toDuplicate.split(' ') : [];\n\n    if (svgDuplicateSources[0]) {\n\n      document.addEventListener('svg.change', (e) => {\n        if (svgDuplicateSources.includes(e.detail.svg.id)) {\n          const $templateNode = e.detail.svg.node;\n          const $templateCircle = e.detail.svg.circle;\n          const { nodeName } = e.detail.svg;\n          const localNodeID = this._generateNewID($templateNode.id);\n          const $localNode = this.target.querySelector(`#${localNodeID}`);\n          let task;\n          // for creating new element or we edit the old one after created one\n          if ($localNode || e.detail.svg.task === 'create') {\n            task = e.detail.svg.task;\n          } else {\n            return;\n          }\n\n          /**\n           * 1. divided by node name\n           * 2. divided by task type\n           * path => svg lines\n           * TEXTAREA => text fields or comic bubbles\n           * foreignObject => svg circles\n           */\n          if (nodeName === 'path') {\n            switch (task) {\n              case 'create':\n                this._clonePath($templateNode, localNodeID);\n                break;\n              case 'color':\n                __removeClass($localNode, 'red blue');\n                __addClass($localNode, e.detail.svg.color);\n                break;\n              case 'remove':\n                $localNode.remove();\n                break;\n              default:\n                console.log('Nondefinated path events task. :(');\n            }\n          } else if (nodeName === 'TEXTAREA') {\n            if (e.detail.svg.isBubble) {\n              switch (task) {\n                case 'create':\n                  this._cloneComicBubbles($templateNode, localNodeID);\n                  break;\n                case 'change':\n                  if ($templateNode.value.length !== 0) {\n                    $localNode.value = $templateNode.value;\n                    // if needs resize\n                    if ($localNode.style.height !== $templateNode.style.height) {\n                      $localNode.style.height = $templateNode.style.height;\n                    }\n                  } else {\n                    $localNode.parentElement.remove();\n                  }\n                  break;\n                default:\n                  console.log('Nondefinated comicBubble events task. :(');\n              }\n            } else {\n              let templateCircleID;\n\n              // for removing from radial\n              if (!$templateCircle) {\n                const idParts = $templateNode.id.split('_');\n                // the middle part\n                // svg-text.js line 44\n                idParts[1] += '-circle';\n                templateCircleID = idParts.join('_');\n              } else {\n                templateCircleID = $templateCircle.id;\n              }\n\n              const localCircleID = this._generateNewID(templateCircleID);\n              const $localCircle = this.target.querySelector(`#${localCircleID}`);\n\n              switch (task) {\n                case 'create':\n                  this._cloneTextField(e.detail.svg.isWrong, $templateNode, $templateCircle, localNodeID, localCircleID);\n                  break;\n                case 'change':\n                  $localNode.value = $templateNode.value;\n                  // if is now wrong lenght\n                  if (e.detail.svg.isWrong) {\n                    __addClass($localNode, 'is-wrong');\n                  } else {\n                    __removeClass($localNode, 'is-wrong');\n                  }\n                  // if needs resize\n                  if ($localNode.style.height !== $templateNode.style.height) {\n                    $localNode.style.height = $templateNode.style.height;\n                  }\n                  break;\n                case 'color':\n                  __removeClass($localCircle, 'red blue');\n                  __addClass($localCircle, e.detail.svg.color);\n                  break;\n                case 'move':\n                  if ($localNode) {\n                    $localNode.parentElement.remove();\n                    $localCircle.remove();\n                  }\n                  this._cloneTextField(e.detail.svg.isWrong, $templateNode, $templateCircle, localNodeID, localCircleID);\n                  break;\n                case 'remove':\n                  $localNode.parentElement.remove();\n                  $localCircle.remove();\n                  break;\n                default:\n                  console.log('Nondefinated textField events task. :(');\n              }\n            }\n          } else if (nodeName === 'circle') {\n            switch (task) {\n              case 'create':\n                this._cloneCircle($templateNode, localNodeID);\n                break;\n              case 'color':\n                __removeClass($localNode, 'red blue');\n                __addClass($localNode, e.detail.svg.color);\n                break;\n              case 'move':\n                if ($localNode) {\n                  $localNode.remove();\n                }\n                this._cloneCircle($templateNode, localNodeID);\n                break;\n              case 'remove':\n                $localNode.remove();\n                break;\n              default:\n                console.log('Nondefinated circle events task. :(');\n            }\n          } else if (nodeName === 'foreignObject') {\n            switch (task) {\n              case 'create':\n                this._cloneDropItem($templateNode, localNodeID);\n                break;\n              case 'move':\n                if ($localNode) {\n                  $localNode.remove();\n                }\n                this._cloneDropItem($templateNode, localNodeID);\n                break;\n              case 'remove':\n                $localNode.remove();\n                break;\n              default:\n                console.log('Nondefinated drop item events task. :(');\n            }\n          } else {\n            console.log('Nondefinated events nodeName. :(', nodeName);\n          }\n\n          // dispatch event that svg has changed\n          __dispatchEvent(document, 'svg.change', {}, {\n            svg: {\n              id: this.target.id,\n              task: e.detail.svg.task,\n              node: $templateNode,\n              circle: $templateCircle,\n              nodeName,\n              contextMenu: false,\n            },\n          });\n        }\n      });\n    }\n  }\n\n  _getDropEvent() {\n    // need if we drop more than one same item\n    let idSalt = 0;\n\n    document.addEventListener('svg.drop', (event) => {\n\n      if (event.detail.svg.id === this.target.id) {\n\n        const {\n          $node, position, type, size,\n        } = event.detail.svg;\n\n        const getMultiply = () => {\n          // make images smaller when dropped\n          if (type === 'image' || type === 'svg') return 0.62;\n          // make tags larger when dropped to not jump on more lines\n          if (type === 'tag') return 1.075;\n\n          return 1;\n        };\n        const multiply = getMultiply();\n\n        size.width *= multiply;\n        size.height *= multiply;\n\n        const diff = {\n          x: this.format((size.width / 2)),\n          y: this.format((size.height / 2)),\n        };\n\n        const $d3canvas = d3.select(`#${this.target.id} .svg-view`);\n        const $d3foreignObject = $d3canvas.append('svg:foreignObject')\n          .attr('width', `${size.width}`)\n          .attr('height', `${size.height}`)\n          .attr('x', this.format(position.x - diff.x))\n          .attr('y', this.format(position.y - diff.y))\n          .attr('data-svg-resolution', `${$d3canvas.attr('width')}, ${$d3canvas.attr('height')}`)\n          .attr('data-svg-type', 'pretahovani')\n          .attr('id', `${this.target.id}_${$node.getAttribute('data-id')}_${idSalt}_dropItem`)\n          .attr('class', 'unselectable try-something');\n          // _dropItem is important identifier\n\n        const $dropItem = $d3foreignObject.append('xhtml:div')\n          .attr('class', `dropped__item dropped__item--${type} unselectable`)\n          .attr('style', `width: ${size.width}px; height: ${size.height}px;`)\n          .node();\n        \n        const $itemToAdd = $node.firstElementChild.firstElementChild;\n        $itemToAdd.classList.add('unselectable');\n        $itemToAdd.style.width = `${size.width}px`;\n        $itemToAdd.style.height = `${size.height}px`;\n\n        $dropItem.appendChild($itemToAdd);\n\n        const $foreignObject = $d3foreignObject.node();\n\n        // increment salt\n        idSalt += 1;\n\n        // add events to element\n        SVGDraw.dropItemEventsManager(this.target, $foreignObject);\n        // fix drop on corners\n        SVGDragNDrop.end(position, $foreignObject, 'pretahovani', diff, $node);\n\n        // dispatch event that svg has changed\n        __dispatchEvent(document, 'svg.change', {}, {\n          svg: {\n            id: this.target.id,\n            task: 'create',\n            node: $foreignObject,\n            nodeName: $foreignObject.nodeName,\n            contextMenu: false,\n          },\n        });\n      }\n    });\n  }\n\n  _clonePath($templateNode, localNodeID) {\n    const $localNode = $templateNode.cloneNode(true);\n    $localNode.id = localNodeID;\n    this.$canvas.appendChild($localNode);\n    // add events to element\n    SVGDraw.pathEventsManager(this.target, $localNode);\n  }\n\n  _cloneTextField(isWrong, $templateNode, $templateCircle, localNodeID, localCircleID) {\n    // clone comments mark\n    const $localCircle = $templateCircle.cloneNode(true);\n    $localCircle.id = localCircleID;\n    this.$canvas.appendChild($localCircle);\n\n    const $localNode = $templateNode.parentElement.cloneNode(true);\n    $localNode.childNodes[0].id = localNodeID;\n    this.$canvas.insertBefore($localNode, $localCircle);\n    if (isWrong) {\n      __addClass($localNode, 'is-wrong');\n    } else {\n      __removeClass($localNode, 'is-wrong');\n    }\n    // add events to element\n    SVGText.textEventsManager(this.target, $localNode.childNodes[0], $localCircle, false);\n  }\n\n  _cloneCircle($templateNode, localNodeID) {\n    const $localNode = $templateNode.cloneNode(true);\n    $localNode.id = localNodeID;\n    this.$canvas.appendChild($localNode);\n    SVGDraw.circleEventsManager(this.target, $localNode);\n\n    return $localNode;\n  }\n\n  _cloneDropItem($templateNode, localNodeID) {\n    const $localNode = $templateNode.cloneNode(true);\n    $localNode.id = localNodeID;\n    this.$canvas.appendChild($localNode);\n    SVGDraw.dropItemEventsManager(this.target, $localNode);\n\n    return $localNode;\n  }\n\n  _cloneComicBubbles($templateNode, localNodeID) {\n    const $localNode = $templateNode.parentElement.cloneNode(true);\n    $localNode.childNodes[1].id = localNodeID;\n    this.$canvas.appendChild($localNode);\n    // add events to element\n    SVGText.comicBubblesEventsManager(this.target, $localNode.childNodes[1]);\n  }\n\n  static selectItem(item) {\n    item.setAttribute('data-svg-selected', 'true');\n  }\n\n  // Remove 'selected' classname from element within SVG\n  static deselectItem() {\n    // previously \"selected\" elements\n    const selected = document.querySelectorAll('[data-svg-selected=\"true\"]');\n    // unselect them\n    for (let i = 0; i < selected.length; i += 1) {\n      selected[i].setAttribute('data-svg-selected', 'false');\n    }\n  }\n\n  // Remove element from within SVG\n  // [data-svg-selected=\"true\"] marks selected element in SVG\n  static removeItem(isRadial, element = '[data-svg-selected=\"true\"]') {\n    let $element = document.querySelector(element);\n    let nodeName = $element.nodeName;\n    const $parent = $element.parentElement; // for <foreignObject>\n\n    // TEXTAREA => text field(right click in textarea)\n    // DIV => text field(click in radial menu) or circle\n    switch (nodeName) {\n      case 'path':\n      case 'circle':\n        // $element = $element;\n        break;\n      case 'TEXTAREA':\n        // $element = $element;\n        break;\n      case 'DIV':\n        // tag\n        if ($parent.getAttribute('data-svg-type') === 'pretahovani') {\n          $element = $parent;\n        } // comment\n        else {\n          $element = $parent.childNodes[0];\n        }\n        nodeName = $element.nodeName;\n        break;\n      default:\n        console.log('Nondefinated node type. :(', nodeName);\n    }\n\n    // get svg id from object id\n    const svgID = $element.id.split('_')[0];\n\n    // dispatch event that svg has changed\n    __dispatchEvent(document, 'svg.change', {}, {\n      svg: {\n        id: svgID,\n        task: 'remove',\n        node: $element,\n        nodeName,\n        contextMenu: isRadial,\n      },\n    });\n\n    if ($parent.nodeName === 'foreignObject') {\n      // remove comment's circle\n      // id by svg-text.js line 44\n      const elemIdParts = $element.id.split('_');\n      d3.select(`[id^=\"${elemIdParts[0]}_${elemIdParts[1]}-circle\"`).remove();\n\n      d3.select($parent).remove();\n\n      // dispatch event that drop item was deleted\n      const idParts = $parent.id.split('_');\n      const $slide = document.querySelector(`#${svgID}`).closest('.slide');\n      if (idParts[idParts.length - 1] === 'dropItem') {\n        __dispatchEvent(document, 'svg.drop.delete', {}, {\n          item: {\n            slideId: $slide.id,\n            id: idParts[1],\n            $object: $element.firstChild,\n          },\n        });\n      }\n    } else {\n      d3.select($element).remove();\n    }\n  }\n\n  // Unmark all SVGs with 'svg-active' classname\n  static deactivate() {\n    const allActiveSvgs = document.querySelectorAll('[data-svg-active=\"true\"]');\n    for (let i = 0; i < allActiveSvgs.length; i += 1) {\n      allActiveSvgs[i].setAttribute('data-svg-active', 'false');\n    }\n  }\n\n  // Mark active SVG with 'svg-active' classname\n  static activate(svg) {\n    SVG.deactivate();\n    svg.setAttribute('data-svg-active', 'true');\n  }\n\n  // Remove connection between clone and template\n  // Remove third part of id if exists\n  static removeCloneConnectionManager($node) {\n    const idParts = $node.id.split('_');\n    if (idParts[idParts.length - 1].includes('clone')) {\n      idParts.pop();\n      $node.id = idParts.join('_');\n      return true;\n    }\n    return false;\n  }\n\n  // Find near elements if exist\n  // Do nothing if event target is element of svg\n  // Small black radial menu circle has d=14px (_radial-menu.scss #radial-menu) 6\n  // check coordinates for element:\n  //  -3,-3  0,-5  +3,-3\n  //  -5, 0        +5, 0\n  //  -3,+3  0,+5  +3,+3\n  static findNearElements(event) {\n    let $element = event.target;\n    const relativeCoords = [\n      [-3, -3], [0, -5], [3, -3], [-5, 0], [5, 0], [-3, 3], [0, 5], [3, 3],\n    ];\n    // svg-radial-menu filterMenuButtons(clickedItem, hasText, hasMoreColors) 418\n    if ($element.nodeName === 'image' || $element.nodeName === 'svg') {\n      relativeCoords.every((coord) => {\n        const globalPosition = __globalPosition(event);\n        const $nextElement = document.elementFromPoint(globalPosition.x + coord[0], globalPosition.y + coord[1]);\n        // fix for border where next can be nodes from outside of svg\n        if ($nextElement.nodeName === 'DIV' || $nextElement.nodeName === 'svg') {\n          return true;\n        }\n\n        $element = $nextElement;\n        return $element.nodeName === 'image';\n      });\n    }\n\n    return $element;\n  }\n}\n","import Component from './component';\r\nimport AudioPlayer from './media/audio-player';\r\nimport SVG from './svg';\r\nimport { stopPlayingVideoPlayers } from './media/media';\r\nimport { __dispatchEvent } from '../lib/utils';\r\n\r\nexport default class Sortable extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n    this.$settings = document.querySelector(\r\n      `[data-sortable-id-reference=\"${this.target.id}\"]`,\r\n    );\r\n    this.feedback = JSON.parse(\r\n      this.$settings.getAttribute('data-module-zpetnavazba'),\r\n    );\r\n    this.$container = this.target;\r\n    this.$items = this.target.querySelectorAll('[data-sortable-drag]');\r\n    this.$droppables = this.target.querySelectorAll('[data-sortable-drop]');\r\n    this.$placeholder = () => document.querySelector('#sortable-placeholder');\r\n    this.$players = this.$container.querySelectorAll('[data-player-audio]');\r\n    this.$inheritors = document.querySelectorAll(\r\n      `[data-sortable-inheritor=${this.target.id}]`,\r\n    );\r\n    this.inheritors = [];\r\n    this.order = [];\r\n\r\n    // get direction (type of sortable \"horizontalni\" or \"vertikalni\")\r\n    this.direction = this.target.getAttribute('data-sortable-target');\r\n    this.trackingTouch = false;\r\n    this.before = false;\r\n    this.after = false;\r\n    this.evaluation = undefined;\r\n\r\n    this.mouse = {\r\n      x: (event) => event.clientX || event.touches[0].clientX,\r\n      y: (event) => event.clientY || event.touches[0].clientY,\r\n      x0: 0,\r\n      y0: 0,\r\n      x1: 0,\r\n      y1: 0,\r\n    };\r\n\r\n    this.dragged = {\r\n      el: null,\r\n      clone: null,\r\n      posRel: {},\r\n      rect: () => this.dragged.el.getBoundingClientRect(),\r\n      size: {},\r\n      type: null,\r\n    };\r\n\r\n    this.siblings = {\r\n      prev: null,\r\n      next: null,\r\n    };\r\n\r\n    this._onStart = this._onStart.bind(this);\r\n    this._onMove = this._onMove.bind(this);\r\n    this._onEnd = this._onEnd.bind(this);\r\n    this._update = this._update.bind(this);\r\n\r\n    this._setupInitialOrder();\r\n    this._setupInheritors();\r\n    this._addEventListeners();\r\n\r\n    this.cache = {\r\n      colors: []\r\n    };\r\n\r\n    // get colors for all feedback variants\r\n    if (this.feedback) {\r\n      this.cache.colors = this.feedback.map(feedback => feedback.barva);\r\n    }\r\n  }\r\n\r\n  _onStart(event) {\r\n    if (!event.target.hasAttribute('data-sortable-drag')) {\r\n      return;\r\n    }\r\n\r\n    // TODO: zastavit všechno audio on drag start\r\n    if (this.$players.length > 0) {\r\n      stopPlayingVideoPlayers(this.$players);\r\n    }\r\n\r\n    this.trackingTouch = true;\r\n\r\n    this.dragged.el = event.target;\r\n    this.dragged.type = event.target.getAttribute('data-sortable-drag');\r\n    this.dragged.clone = this.dragged.el.cloneNode(true);\r\n    this.dragged.posRel.top = this.dragged.el.offsetTop;\r\n    this.dragged.posRel.left = this.dragged.el.offsetLeft;\r\n    this.dragged.size.width = this.dragged.el.offsetWidth;\r\n    this.dragged.size.height = this.dragged.el.offsetHeight;\r\n\r\n    this.dragged.el.style.top = `${this.dragged.posRel.top}px`;\r\n    this.dragged.el.style.left = `${this.dragged.posRel.left}px`;\r\n    this.dragged.el.style.width = `${this.dragged.size.width}px`;\r\n    this.dragged.el.style.height = `${this.dragged.size.height}px`;\r\n    this.dragged.el.classList.add('is-dragged');\r\n\r\n    this.$container.classList.add('is-dragged');\r\n\r\n    this._addPlaceholder(this.dragged.el);\r\n    this._onOver();\r\n\r\n    this.mouse.x0 = this.mouse.x(event);\r\n    this.mouse.y0 = this.mouse.y(event);\r\n\r\n    event.preventDefault();\r\n  }\r\n\r\n  _onMove(event) {\r\n    if (!this.trackingTouch) {\r\n      return;\r\n    }\r\n\r\n    this.mouse.x1 = this.mouse.x(event) - this.mouse.x0;\r\n    this.mouse.y1 = this.mouse.y(event) - this.mouse.y0;\r\n\r\n    window.requestAnimationFrame(this._update);\r\n\r\n    this._onOver();\r\n  }\r\n\r\n  _onEnd(event) {\r\n    if (!this.trackingTouch) {\r\n      return;\r\n    }\r\n\r\n    this.trackingTouch = false;\r\n    this.$container.classList.remove('is-dragged');\r\n    this.dragged.el.classList.remove('is-dragged');\r\n    this.dragged.el.style.top = '';\r\n    this.dragged.el.style.left = '';\r\n    this.dragged.el.style.width = '';\r\n    this.dragged.el.style.height = '';\r\n    this.dragged.el.style.transform = '';\r\n\r\n    const $placeholder = this.$placeholder();\r\n    const rect = $placeholder.getBoundingClientRect();\r\n\r\n    switch (this.direction) {\r\n      case 'horizontal':\r\n        if (rect.left <= this.mouse.x(event) <= rect.right) {\r\n          this._onDrop();\r\n        }\r\n        break;\r\n      case 'vertical':\r\n        if (rect.top <= this.mouse.y(event) <= rect.bottom) {\r\n          this._onDrop();\r\n        }\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n\r\n    this._removePlaceholder();\r\n    this._updateOrder();\r\n    this._updateOrderInInheritors();\r\n    this._dispatchEvent();\r\n    this._checkAndResolveFeedback();\r\n  }\r\n\r\n  // _onEnter() {}\r\n\r\n  _onOver() {\r\n    this.before = false;\r\n    this.after = false;\r\n\r\n    this._getReference();\r\n\r\n    if (\r\n      this.siblings.next\r\n      && this.siblings.next.hasAttribute('data-sortable-drop')\r\n    ) {\r\n      const next = this.siblings.next.getBoundingClientRect();\r\n\r\n      switch (this.direction) {\r\n        case 'horizontal':\r\n          if (this.dragged.rect().right > next.left + next.width / 1.5) {\r\n            this.after = true;\r\n            this._addPlaceholder(this.siblings.next);\r\n          }\r\n          break;\r\n        case 'vertical':\r\n          if (this.dragged.rect().bottom > next.top + next.height / 1.5) {\r\n            this.after = true;\r\n            this._addPlaceholder(this.siblings.next);\r\n          }\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (\r\n      this.siblings.prev\r\n      && this.siblings.prev.hasAttribute('data-sortable-drop')\r\n    ) {\r\n      const prev = this.siblings.prev.getBoundingClientRect();\r\n\r\n      switch (this.direction) {\r\n        case 'horizontal':\r\n          if (this.dragged.rect().left < prev.right - prev.width / 1.5) {\r\n            this.before = true;\r\n            this._addPlaceholder(this.siblings.prev);\r\n          }\r\n          break;\r\n        case 'vertical':\r\n          if (this.dragged.rect().top < prev.bottom - prev.height / 1.5) {\r\n            this.before = true;\r\n            this._addPlaceholder(this.siblings.prev);\r\n          }\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  // _onLeave() {}\r\n\r\n  _onDrop() {\r\n    const $placeholder = this.$placeholder();\r\n\r\n    this._addEventListenerToItem(this.dragged.clone);\r\n    // TODO: přiřadit eventListenery audio playerům\r\n    if (this.dragged.clone.querySelector('[data-player-audio]')) {\r\n      AudioPlayer.addEventListeners(this.dragged.clone, this.showFeedback);\r\n    }\r\n\r\n    this.$container.insertBefore(this.dragged.clone, $placeholder);\r\n    this.dragged.el.parentElement.removeChild(this.dragged.el);\r\n  }\r\n\r\n  _update() {\r\n    this.dragged.el.style.transform = `translate3d(${this.mouse.x1}px, ${this.mouse.y1}px, 0) rotate(5deg)`;\r\n  }\r\n\r\n  _addPlaceholder(item) {\r\n    this._removePlaceholder();\r\n\r\n    const $placeholder = document.createElement('div');\r\n    $placeholder.classList.add('sortable-item', 'sortable-placeholder');\r\n    $placeholder.setAttribute('id', 'sortable-placeholder');\r\n    $placeholder.style.minHeight = `${this.dragged.size.height}px`;\r\n\r\n    if (this.dragged.el.querySelector('img')) {\r\n      const src = this.dragged.el.querySelector('img').getAttribute('src');\r\n      const img = document.createElement('img');\r\n      img.setAttribute('src', src);\r\n      $placeholder.appendChild(img);\r\n    }\r\n\r\n    if (this.after) {\r\n      this.$container.insertBefore($placeholder, item.nextElementSibling);\r\n    } else if (this.before) {\r\n      this.$container.insertBefore($placeholder, item);\r\n    } else {\r\n      this.$container.insertBefore($placeholder, item);\r\n    }\r\n  }\r\n\r\n  _removePlaceholder() {\r\n    const $placeholder = this.$placeholder();\r\n    if ($placeholder) $placeholder.parentElement.removeChild($placeholder);\r\n  }\r\n\r\n  _getReference() {\r\n    const $placeholder = this.$placeholder();\r\n    this.siblings.prev =\r\n      $placeholder.previousElementSibling === this.dragged.el\r\n        ? this.dragged.el.previousElementSibling\r\n        : $placeholder.previousElementSibling;\r\n    this.siblings.next =\r\n      $placeholder.nextElementSibling === this.dragged.el\r\n        ? this.dragged.el.nextElementSibling\r\n        : $placeholder.nextElementSibling;\r\n  }\r\n\r\n  _addEventListenerToItem($item) {\r\n    // touch events\r\n    $item.addEventListener('touchstart', this._onStart, false);\r\n    // mouse events\r\n    $item.addEventListener('mousedown', this._onStart, false);\r\n\r\n    if (this.dragged.type === 'svg') {\r\n      const svg = new SVG($item.querySelector('[data-svg-target]'));\r\n    }\r\n  }\r\n\r\n  _addEventListeners() {\r\n    // touch events\r\n    document.addEventListener('touchmove', this._onMove);\r\n    document.addEventListener('touchend', this._onEnd);\r\n    // mouse events\r\n    document.addEventListener('mousemove', this._onMove);\r\n    document.addEventListener('mouseup', this._onEnd);\r\n\r\n    this.$items.forEach(($item) => {\r\n      this._addEventListenerToItem($item);\r\n    });\r\n  }\r\n\r\n  // Methods for check if the array is sorted or not\r\n  // Return True: array is in the right state, False: array is NOT in the right state\r\n  // Array looks like: [1,2,3,4]\r\n  // eslint-disable-next-line class-methods-use-this\r\n  checkIfTheArrayIsGood(array) {\r\n    // condition for function some(), return if there is item in array which is not in right position\r\n    const elementInWrongPosition = (element, index) => index !== (element - 1);\r\n    // all has to be negate, to return the right condition (true: sorted, false:not sorted)\r\n    return !array.some(elementInWrongPosition);\r\n  }\r\n\r\n  // Method which check how many steps needs to be done to sort array\r\n  // Return: 0 -> 0 steps, array is sorted\r\n  //        1 -> 1 steps is needed for sort the array\r\n  //        2 -> 2 and more steps is needed for sort the array\r\n  // Array looks like: [1,2,3,4]\r\n  oneMove(array) {\r\n    if (this.checkIfTheArrayIsGood(array)) return 0; // Check if the array is sorted\r\n    for (let i = 0; i < array.length; i += 1) {\r\n      if (array[i] !== i + 1) {\r\n        const changedArray = [...array];\r\n        const element = changedArray[i];\r\n        changedArray.splice(i, 1);\r\n        changedArray.splice(element - 1, 0, element);\r\n\r\n        if (this.checkIfTheArrayIsGood(changedArray)) return 1; // Check if the array after 1 step is sorted\r\n      }\r\n    }\r\n    return 2; // In every other results the array needs more than 2 steps to be sorted\r\n  }\r\n\r\n  // After interaction with modul razeni this method is called to resolve a feedback button\r\n  _checkAndResolveFeedback() {\r\n    if (this.feedback) {\r\n      // Get the array of items (gets only their correct position - in int), example -> [1,3,4,2]\r\n      const arrayOfItems = [\r\n        ...this.target.querySelectorAll('[data-sortable-drag]'),\r\n      ].map((item) => parseInt(item.dataset.sortableSpravnaodpoved, 10));\r\n\r\n      // variable to map a feedback which is got from condition in JSON\r\n      let feedbackResult = 0;\r\n\r\n      // Check if the zpetnaVazba is 2 or 3 conditional\r\n      if (this.feedback.length === 2) {\r\n        if (!this.checkIfTheArrayIsGood(arrayOfItems)) {\r\n          feedbackResult = 1;\r\n        }\r\n      }\r\n      else {\r\n        feedbackResult = this.oneMove(arrayOfItems);\r\n      }\r\n\r\n      // map feedback via feedbackResult\r\n      const feedbackActual = this.feedback.find((feedback) => feedback.podminka === feedbackResult);\r\n\r\n      this.$buttonFeedback.classList.remove(...this.cache.colors);\r\n      this.$buttonFeedback.classList.add(feedbackActual.barva);\r\n      this.$buttonFeedbackText.innerText = feedbackActual.text;\r\n      this.evaluation = feedbackActual.splneno;\r\n    }\r\n    this.showFeedback();\r\n  }\r\n\r\n  _setupInitialOrder() {\r\n    this._updateOrder();\r\n  }\r\n\r\n  _setupInheritors() {\r\n    if (this.$inheritors.length > 0) {\r\n      this.inheritors = Array.from(this.$inheritors).map(($inheritor) => ({\r\n        $inheritor,\r\n        $container: $inheritor.querySelector('[data-sortable-inheritor-item]')\r\n          .parentElement,\r\n      }));\r\n    }\r\n  }\r\n\r\n  _updateOrder() {\r\n    this.order = Array.from(\r\n      this.target.querySelectorAll('[data-sortable-drag]'),\r\n    ).map(($item) => ({ id: parseInt($item.dataset.sortableIndex, 10) }));\r\n  }\r\n\r\n  _updateOrderInInheritors() {\r\n    if (this.$inheritors.length > 0) {\r\n      this.inheritors.forEach((inheritor) => {\r\n        this.order.forEach((item) => {\r\n          inheritor.$container.appendChild(\r\n            inheritor.$container.querySelector(\r\n              `[data-sortable-inheritor-item=\"${item.id}\"]`,\r\n            ),\r\n          );\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  _dispatchEvent() {\r\n    __dispatchEvent(\r\n      this.target,\r\n      'sortable.change',\r\n      {},\r\n      {\r\n        id: this.target.id,\r\n        evaluation: this.evaluation,\r\n        order: this.order,\r\n      },\r\n    );\r\n  }\r\n}\r\n","/* eslint-disable brace-style */\r\nimport {\r\n  __addClass,\r\n  __removeClass,\r\n  __hasClass,\r\n  __localPosition,\r\n  __globalPosition,\r\n  __dispatchEvent,\r\n} from '../../lib/utils';\r\nimport SVG from '../svg';\r\nimport SVGText from './svg-text';\r\n\r\nexport default class SVGRadialMenu {\r\n\r\n  constructor($radialMenu, $svgs) {\r\n    this.$radialMenu = $radialMenu;\r\n    this.$radialMenuItems = this.$radialMenu.querySelectorAll('[data-radial-menu-item]');\r\n    this.$colorItems = this.$radialMenu.querySelectorAll('.radial-menu-color');\r\n    this.$textItems = this.$radialMenu.querySelectorAll('.radial-menu-text');\r\n    this.$createTextItem = this.$radialMenu.querySelector('#create-text');\r\n    this.$removeItem = this.$radialMenu.querySelector('#remove-content');\r\n    this.$tooltip = this.$radialMenu.querySelector('[data-radial-menu-tooltip]');\r\n    this.$svgs = $svgs;\r\n\r\n    this.initialSetUp = true;\r\n\r\n    this.menuRadius = parseInt(window.getComputedStyle(this.$radialMenu.querySelector('.radial-menu-wrapper'), null).getPropertyValue('width'), 10) / 2;\r\n    this.itemRadius = parseInt(window.getComputedStyle(this.$radialMenu.querySelector('.radial-menu-item'), null).getPropertyValue('width'), 10) / 2;\r\n\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    this.setUpRadialMenuItems();\r\n    this.addEventListenersToRadialMenu();\r\n\r\n    // activate radial menu when right click on svg\r\n    this.$svgs.forEach(($svg) => {\r\n      d3.select($svg)\r\n        .on('contextmenu', (event) => {\r\n          this.openRadialMenu(event, $svg);\r\n        });\r\n\r\n      this.iOSAddonEvents($svg);\r\n    });\r\n  }\r\n\r\n  static hasText($svg) {\r\n    const svgSpecificActions = $svg.getAttribute('data-svg-target').split(' ');\r\n    return svgSpecificActions.includes('text');\r\n  }\r\n\r\n  static hasMoreColors($svg) {\r\n    const colors = $svg.getAttribute('data-svg-colors');\r\n    const svgSpecificColor = colors ? colors.split(' ') : undefined;\r\n    return (svgSpecificColor && svgSpecificColor.length > 1) || !colors;\r\n  }\r\n\r\n  iOSAddonEvents($svg) {\r\n    // now it helping to fix to not selext text when menu display on comment\r\n    // it is depand on timeout for device hold selection event\r\n    // chosen experimentally\r\n    // TODO: find out proper way to define constant\r\n    const delay = 400;\r\n    // https://www.geeksforgeeks.org/detect-a-device-is-ios-or-not-using-javascript/\r\n    // https://github.com/victorqribeiro/radialMenu/blob/master/src/RadialMenu.js#L437\r\n    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\r\n    if (isIOS) {\r\n      console.log('This is a IOS device');\r\n      let timer;\r\n\r\n      // circle events\r\n      document.addEventListener('event.propagation', (e) => {\r\n        const event = e.detail.event.data.sourceEvent;\r\n\r\n        timer = setTimeout(() => {\r\n          event.preventDefault();\r\n          this.openRadialMenu(event, $svg);\r\n        }, delay);\r\n      });\r\n\r\n      document.addEventListener('event.stopPropagation', () => {\r\n        if (timer) clearTimeout(timer);\r\n      });\r\n\r\n      // image events\r\n      // d3 listeners are wrong option because they have stopPropagation\r\n      // where we dont need\r\n      // d3.select($svg).on('touchstart', ()=>{}).on('touchmove', ()=>{})...\r\n      $svg.addEventListener('touchstart', (event) => {\r\n        if (event.touches.length === 1) {\r\n          timer = setTimeout(() => {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            this.openRadialMenu(event, $svg);\r\n          }, delay);\r\n        }\r\n      });\r\n      $svg.addEventListener('touchmove', () => {\r\n        if (timer) clearTimeout(timer);\r\n      });\r\n      $svg.addEventListener('touchend', () => {\r\n        if (timer) clearTimeout(timer);\r\n      });\r\n      $svg.addEventListener('touchcancel', () => {\r\n        if (timer) clearTimeout(timer);\r\n      });\r\n    }\r\n  }\r\n\r\n  openRadialMenu(event, $svg) {\r\n    const hasText = SVGRadialMenu.hasText($svg);\r\n    const hasMoreColors = SVGRadialMenu.hasMoreColors($svg);\r\n    \r\n    // fix for drawing and helpful for touch devices\r\n    const $clickedItem = SVG.findNearElements(event);\r\n    // mark this SVG as the active one\r\n    SVG.activate($svg);\r\n    // deselect all previously selected items\r\n    SVG.deselectItem();\r\n    // show radial menu buttons based on clicked element\r\n    // and .select appropriate elements based on clicked element\r\n    this.filterMenuButtons($clickedItem, hasText, hasMoreColors);\r\n    this.showRadialMenu(event, $svg);\r\n    // prevent default 'contextmenu' event\r\n    event.preventDefault();\r\n\r\n    // for removing text selection\r\n    // no inpact for PC\r\n    window.getSelection().removeAllRanges();\r\n    this.initialSetUp = false;\r\n  }\r\n\r\n  setUpRadialMenuItems() {\r\n    // this.positionRadialMenuItems(this.$radialMenuItems);\r\n\r\n    this.$radialMenuItems.forEach(($item) => {\r\n      this.addEventListenersToRadialMenuItem($item);\r\n    });\r\n  }\r\n\r\n  positionRadialMenuItems($items) {\r\n    const _itemsLength = $items.length;\r\n    const _menuRadius = this.menuRadius;\r\n    const _itemRadius = this.itemRadius;\r\n    const _menuOffset = _menuRadius - _itemRadius;\r\n    const _interval = 0.6283185307;\r\n    // if more items center them\r\n    const _centerOffset = (-_interval / 2) + ((_itemsLength * _interval) / 2);\r\n\r\n    // make a \"flower\"\r\n    $items.forEach(($item, index) => {\r\n      // Calculate the angle at which the element will be placed.\r\n      // For a semicircle, we would use (index / _itemsLength) * Math.PI.\r\n      const angle = (Math.PI + ((index * _interval) * -1)) + _centerOffset;\r\n\r\n      // get position\r\n      const x = (_menuRadius * Math.sin(angle)) + _menuOffset;\r\n      const y = (_menuRadius * Math.cos(angle)) + _menuOffset;\r\n\r\n      $item.style.left = `${x.toFixed(1)}px`;\r\n      $item.style.top = `${y.toFixed(1)}px`;\r\n\r\n      // if (this.initialSetUp === true) {\r\n      //   this.addEventListenersToRadialMenuItem($item);\r\n      // }\r\n    });\r\n  }\r\n\r\n  addEventListenersToRadialMenu() {\r\n    this.onMouseLeave();\r\n\r\n    this.$radialMenu.addEventListener('click', (event) => {\r\n      this.hideRadialMenu(this.$radialMenu);\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.$radialMenu.addEventListener('contextmenu', (event) => {\r\n      this.hideRadialMenu(this.$radialMenu);\r\n      event.preventDefault();\r\n    });\r\n  }\r\n\r\n  addEventListenersToRadialMenuItem(item) {\r\n    const $item = item;\r\n\r\n    // actions\r\n    const action = $item.getAttribute('data-radial-menu-item');\r\n    // remove item\r\n    if (action === 'remove-content') {\r\n      $item.addEventListener('click', () => {\r\n        SVG.removeItem(true);\r\n        this.hideRadialMenu();\r\n      }, false);\r\n    }\r\n    // create user text\r\n    else if (action === 'create-text') {\r\n      d3.select($item).on('click', () => {\r\n        SVGText.createText();\r\n        this.hideRadialMenu();\r\n      }, false);\r\n    }\r\n    // označit podobnost\r\n    else if (action === 'color-point-blue') {\r\n      $item.addEventListener('click', () => {\r\n        SVGRadialMenu.changeColor('blue');\r\n        this.hideRadialMenu();\r\n      }, false);\r\n    }\r\n    // označit rozdil\r\n    else if (action === 'color-point-red') {\r\n      $item.addEventListener('click', () => {\r\n        SVGRadialMenu.changeColor('red');\r\n        this.hideRadialMenu();\r\n      }, false);\r\n    }\r\n    // označit rozdil\r\n    else if (action === 'color-point-red') {\r\n      $item.addEventListener('click', () => {\r\n        SVGRadialMenu.changeColor('red');\r\n        this.hideRadialMenu();\r\n      }, false);\r\n    }\r\n    // přiřadit kategorii\r\n    // else if (action === 'category') {\r\n    //   const category = $item.getAttribute('data-category');\r\n    //   const categoryLabel = $item.getAttribute('data-radial-menu-item-tooltip');\r\n\r\n    //   $item.addEventListener('click', () => {\r\n    //     const $selected = document.querySelector('[data-svg-selected=\"true\"]');\r\n    //     const $parentForeignObject = $selected.parentElement;\r\n    //     let $category = $parentForeignObject.querySelector('.svg-category-label');\r\n\r\n    //     $selected.setAttribute('data-svg-category', category);\r\n\r\n    //     if (!$category) {\r\n    //       $category = document.createElement('div');\r\n    //       $category.classList.add('svg-category-label');\r\n    //       $parentForeignObject.prepend($category);\r\n    //     }\r\n\r\n    //     $category.innerText = categoryLabel;\r\n\r\n    //     this.hideRadialMenu();\r\n    //   }, false);\r\n    // }\r\n\r\n    // tooltip\r\n    $item.addEventListener('mouseenter', (event) => {\r\n      this.$tooltip.innerHTML = event.currentTarget.getAttribute('data-radial-menu-item-tooltip');\r\n      this.$tooltip.style.display = 'block';\r\n    }, false);\r\n    $item.addEventListener('mouseleave', () => {\r\n      this.$tooltip.innerHTML = '';\r\n      this.$tooltip.style.display = 'none';\r\n    }, false);\r\n  }\r\n\r\n  // Draw a SVG circle on click\r\n  static changeColor(color, element = '[data-svg-selected=\"true\"]') {\r\n    let $element = document.querySelector(element);\r\n    let nodeName = $element.nodeName;\r\n    let taskType = 'color';\r\n\r\n    __removeClass($element, 'red blue');\r\n    __addClass($element, color);\r\n\r\n    // DIV => text field  or circle\r\n    switch (nodeName) {\r\n      case 'path':\r\n      case 'circle':\r\n        // $element = $element;\r\n        break;\r\n      case 'DIV':\r\n        if ($element.parentElement.childNodes[1]) {\r\n          $element = $element.parentElement.childNodes[1];\r\n        } else {\r\n          $element = $element.parentElement;\r\n        }\r\n        nodeName = $element.nodeName;\r\n        break;\r\n      default:\r\n        console.log('Nondefinated node type. :(', nodeName);\r\n    }\r\n\r\n    // if clone is changed, then dispatch create event\r\n    // if it is comments mark\r\n    if (nodeName === 'circle' && $element.id.includes('svg-text')) {\r\n      const commentID = $element.id.replace('-circle', '');\r\n      const $comment = document.querySelector(`#${commentID}`);\r\n      SVG.removeCloneConnectionManager($comment);\r\n    }\r\n\r\n    if (SVG.removeCloneConnectionManager($element)) {\r\n      taskType = 'create';\r\n    }\r\n\r\n    // get svg id from object id\r\n    const svgID = $element.id.split('_')[0];\r\n\r\n    // dispatch event that svg has changed\r\n    __dispatchEvent(document, 'svg.change', {}, {\r\n      svg: {\r\n        id: svgID,\r\n        task: taskType,\r\n        node: $element,\r\n        nodeName,\r\n        contextMenu: true,\r\n        color,\r\n      },\r\n    });\r\n  }\r\n\r\n  showRadialMenu(event, $activeSVG) {\r\n    const $svg = $activeSVG || document.querySelector('[data-svg-active=\"true\"]');\r\n    // get global position of the right click event\r\n    const globalPosition = __globalPosition(event);\r\n    const localPosition = __localPosition(event, $svg);\r\n    this.$radialMenu.setAttribute('data-local-x', localPosition.x);\r\n    this.$radialMenu.setAttribute('data-local-y', localPosition.y);\r\n    // set position of radial menu\r\n    // number of 13 is size of #radial-menu\r\n    this.$radialMenu.style.top = `${globalPosition.y - 7}px`;\r\n    this.$radialMenu.style.left = `${globalPosition.x - 7}px`;\r\n\r\n    // make a flower\r\n    const $activeRadialMenuItem = this.$radialMenu.querySelectorAll('.is-active');\r\n    this.positionRadialMenuItems($activeRadialMenuItem);\r\n\r\n    // show radial menu\r\n    __addClass(this.$radialMenu, 'is-active');\r\n\r\n    // return {\r\n    //   localPosition,\r\n    //   globalPosition,\r\n    // };\r\n  }\r\n\r\n  hideRadialMenu() {\r\n    // hide radial menu\r\n    __removeClass(this.$radialMenu, 'is-active');\r\n    // deactivate all SVGs\r\n    SVG.deactivate();\r\n    // deselect all SVG items\r\n    SVG.deselectItem();\r\n\r\n    // deactivate radial menu items when the menu is hidden\r\n    setTimeout(() => {\r\n      if (!__hasClass(this.$radialMenu, 'is-active')) {\r\n        this.$radialMenuItems.forEach(($item) => {\r\n          __removeClass($item, 'is-active');\r\n        });\r\n      }\r\n    }, 150);\r\n  }\r\n\r\n  onMouseLeave() {\r\n    let mouseLeaveDelay;\r\n\r\n    this.$radialMenu.addEventListener('mouseleave', () => {\r\n      mouseLeaveDelay = setTimeout(() => {\r\n        this.hideRadialMenu(this.$radialMenu);\r\n      }, 500);\r\n    });\r\n\r\n    this.$radialMenu.addEventListener('mouseenter', () => {\r\n      clearTimeout(mouseLeaveDelay);\r\n    });\r\n  }\r\n\r\n  filterMenuButtons(clickedItem, hasText, hasMoreColors) {\r\n    if (__hasClass(clickedItem, 'svg-path') || clickedItem.nodeName === 'path') {\r\n      if (hasText) {\r\n        __addClass(this.$createTextItem, 'is-active');\r\n      } else {\r\n        __removeClass(this.$createTextItem, 'is-active');\r\n      }\r\n      // __addClass(this.$removeItem, 'is-active');\r\n\r\n      if (hasMoreColors) {\r\n        this.$colorItems.forEach(($colorItem) => {\r\n          __addClass($colorItem, 'is-active');\r\n        });\r\n      }\r\n\r\n      this.$textItems.forEach(($textItem) => {\r\n        __removeClass($textItem, 'is-active');\r\n      });\r\n\r\n      // mark it as slected\r\n      // SVG.selectItem(clickedItem);\r\n    }\r\n    if (__hasClass(clickedItem, 'svg-circle')) {\r\n      if (hasText) {\r\n        __addClass(this.$createTextItem, 'is-active');\r\n      } else {\r\n        __removeClass(this.$createTextItem, 'is-active');\r\n      }\r\n      // __addClass(this.$removeItem, 'is-active');\r\n\r\n      if (hasMoreColors) {\r\n        this.$colorItems.forEach(($colorItem) => {\r\n          __addClass($colorItem, 'is-active');\r\n        });\r\n      }\r\n\r\n      this.$textItems.forEach(($textItem) => {\r\n        __removeClass($textItem, 'is-active');\r\n      });\r\n\r\n      // mark it as slected\r\n      // SVG.selectItem(clickedItem);\r\n    }\r\n    if (__hasClass(clickedItem, 'svg-textarea')) {\r\n      __removeClass(this.$createTextItem, 'is-active');\r\n      // __addClass(this.$removeItem, 'is-active');\r\n\r\n      if (!__hasClass(clickedItem, 'do-not-remove')) {\r\n        this.$colorItems.forEach(($colorItem) => {\r\n          __removeClass($colorItem, 'is-active');\r\n        });\r\n\r\n        this.$textItems.forEach(($textItem) => {\r\n          __addClass($textItem, 'is-active');\r\n        });\r\n      }\r\n\r\n      // mark it as slected\r\n      // SVG.selectItem(clickedItem);\r\n    }\r\n    if (clickedItem.nodeName === 'image') {\r\n      if (hasText) {\r\n        __addClass(this.$createTextItem, 'is-active');\r\n      } else {\r\n        __removeClass(this.$createTextItem, 'is-active');\r\n      }\r\n\r\n      __removeClass(this.$removeItem, 'is-active');\r\n\r\n      this.$colorItems.forEach(($colorItem) => {\r\n        __removeClass($colorItem, 'is-active');\r\n      });\r\n\r\n      this.$textItems.forEach(($textItem) => {\r\n        __removeClass($textItem, 'is-active');\r\n      });\r\n    }\r\n    else {\r\n      if (__hasClass(clickedItem, 'do-not-remove')) {\r\n        __removeClass(this.$removeItem, 'is-active');\r\n      } else {\r\n        if (hasText) {\r\n          __addClass(this.$createTextItem, 'is-active');\r\n        } else {\r\n          __removeClass(this.$createTextItem, 'is-active');\r\n        }\r\n        __addClass(this.$removeItem, 'is-active');\r\n      }\r\n      // mark it as slected\r\n      SVG.selectItem(clickedItem);\r\n    }\r\n  }\r\n}\r\n","import { __dispatchEvent } from '../../lib/utils';\r\n\r\n// plugin specification: https://prosemirror.net/docs/ref/#state.Plugin_System\r\nexport default class SelectionMenu {\r\n  constructor(editorId, schema, editorView, $menuTemplate) {\r\n    this.$menuBox = $menuTemplate;\r\n\r\n    this.init(editorId, schema, editorView);\r\n    this.update(editorView, null);\r\n  }\r\n\r\n  init(editorId, schema, editorView) {\r\n    const { nodes, marks } = schema;\r\n\r\n    // menu close buttom logic\r\n    // In Firefox still is selected text\r\n    const $closeButton = this.$menuBox.querySelector('a');\r\n    $closeButton.addEventListener('click', () => {\r\n      this.update(editorView);\r\n    });\r\n\r\n    // hide menu after unfocus editor\r\n    editorView.dom.parentNode.addEventListener('blur', (event) => {\r\n      if (event.relatedTarget\r\n        && !event.relatedTarget.classList.contains('menu-item') // no menu button\r\n        && !event.relatedTarget.classList.contains('contextual-menu-component')) { // no menu close button\r\n        this.update(editorView);\r\n      }\r\n    });\r\n\r\n    // menu items logic\r\n    const $menuItems = this.$menuBox.querySelectorAll('.menu-item');\r\n    // sugar for creating different data-tag-id\r\n    let sugar = 0;\r\n\r\n    if ($menuItems) {\r\n      $menuItems.forEach(($menuItem) => {\r\n        // get attributes for marked parts\r\n        const color = $menuItem.getAttribute('data-color');\r\n        const dataCommandName = $menuItem.getAttribute('data-command-name');\r\n\r\n        $menuItem.addEventListener('click', (event) => {\r\n          event.preventDefault();\r\n\r\n          if (!SelectionMenu.isAdded(marks.marker, editorView.state)) {\r\n            // create unique dataTagId\r\n            const dataTagId = `${this.$menuBox.id}-${sugar}`;\r\n            // add remove button from schema\r\n            SelectionMenu.addRemoveButton(editorView, nodes.removeButton);\r\n            // define command\r\n            // https://github.com/ProseMirror/prosemirror-commands/blob/91f86b300ba850d496cc6e142c0aed9ae81893f1/src/commands.js#L488\r\n            // https://github.com/ProseMirror/prosemirror-transform/blob/03a011ae1e098b958f9479c1cee1e997cef2ba4d/src/mark.js#L9\r\n            // https://github.com/ProseMirror/prosemirror-transform/blob/03a011ae1e098b958f9479c1cee1e997cef2ba4d/src/mark_step.js#L16\r\n            // https://github.com/ProseMirror/prosemirror-transform/blob/master/CHANGELOG.md#129-2021-01-19\r\n            const command = pm.toggleMark(marks.marker, { color, dataCommandName, dataTagId });\r\n            // marked selection part\r\n            command(editorView.state, editorView.dispatch, editorView);\r\n            // remember selection\r\n            const markedSelection = editorView.state.selection;\r\n            // set selection empty\r\n            SelectionMenu.closeSelection(editorView);\r\n            // increase sugar\r\n            sugar += 1;\r\n            // create one dispatchable dom element to dispatch from this tool\r\n            const $dispatchNode = SelectionMenu.connectAllSelectedParts(editorView, dataTagId);\r\n            // add removing marker logic\r\n            SelectionMenu.removingMarkerHandler({\r\n              editorId, editorView, markedSelection, $dispatchNode, dataTagId, dataCommandName, marker: marks.marker,\r\n            });\r\n            // dispatch event that editor has changed\r\n            __dispatchEvent(document, 'editor.change', {}, {\r\n              text: {\r\n                id: editorId,\r\n                task: 'add',\r\n                tagData: { tagName: dataCommandName },\r\n                value: $dispatchNode,\r\n                tagColor: color,\r\n              },\r\n            });\r\n          } // nothing will be marked\r\n          else {\r\n            this.update(editorView, null);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    // add to editor\r\n    editorView.dom.parentNode.appendChild(this.$menuBox);\r\n  }\r\n\r\n  // calling from editor every time when editor is updated\r\n  // manage showing and hiding menu and menu position\r\n  update(view, lastState) {\r\n    const { state, readOnly } = view;\r\n    const activeElementClasses = document.activeElement.classList;\r\n\r\n    // have to be canvas dom node\r\n    if (!state || readOnly || state.selection.empty || !activeElementClasses.contains('canvas')) {\r\n      if (!this.$menuBox.classList.contains('hidden')) {\r\n        this.$menuBox.classList.add('hidden');\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.$menuBox.classList.remove('hidden');\r\n\r\n    if (!this.$menuBox.offsetParent) {\r\n      if (!this.$menuBox.classList.contains('hidden')) {\r\n        this.$menuBox.classList.add('hidden');\r\n      }\r\n      return;\r\n    }\r\n    // Update the Content state before calculating the position\r\n    // this.contentUpdate(editorView.state);\r\n\r\n    const { from, to } = state.selection;\r\n\r\n    try {\r\n      const start = view.coordsAtPos(from);\r\n      const end = view.coordsAtPos(to);\r\n\r\n      const box = this.$menuBox.getBoundingClientRect();\r\n\r\n      const offsetParentBox = this.$menuBox.offsetParent.getBoundingClientRect();\r\n      let left = (((start.left + end.left) / 2) - (box.width / 2) - offsetParentBox.left);\r\n\r\n      if (left < 5) {\r\n        left = 5;\r\n      }\r\n\r\n      this.$menuBox.style.left = `${left}px`;\r\n      this.$menuBox.style.top = `${start.top - offsetParentBox.top - box.height}px`;\r\n    }\r\n    catch (err) {\r\n      console.error('Menu selection error', err);\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    if (this.$menuBox) {\r\n      this.$menuBox.remove();\r\n    }\r\n  }\r\n\r\n  // check if part of selection was marked\r\n  static isAdded(marker, state) {\r\n    const { ranges } = state.selection;\r\n    let has = false;\r\n\r\n    for (let i = 0; !has && i < ranges.length; i += 1) {\r\n      const { $from, $to } = ranges[i];\r\n      // https://prosemirror.net/docs/ref/#model.Node.rangeHasMark\r\n      has = state.doc.rangeHasMark($from.pos, $to.pos, marker);\r\n    }\r\n\r\n    return has;\r\n  }\r\n\r\n  // TODO: do in same transaction with toggleMark\r\n  static addRemoveButton(editorView, removeButton) {\r\n    const { state } = editorView;\r\n    const { ranges } = state.selection;\r\n\r\n    const lastPosition = ranges[ranges.length - 1].$to.pos;\r\n    // https://prosemirror.net/docs/ref/#state.EditorState.apply\r\n    // https://prosemirror.net/docs/ref/#transform.Transform.insert\r\n    // https://prosemirror.net/docs/ref/#model.NodeType.create\r\n    const newState = state.apply(state.tr.insert(lastPosition, removeButton.create()));\r\n    // update editor state\r\n    editorView.updateState(newState);\r\n  }\r\n\r\n  static closeSelection(editorView) {\r\n    const { state } = editorView;\r\n\r\n    // https://prosemirror.net/docs/ref/#state.EditorState.apply\r\n    // https://prosemirror.net/docs/ref/#state.Transaction.setSelection\r\n    // https://prosemirror.net/docs/ref/#state.TextSelection^create\r\n    const newState = state.apply(state.tr.setSelection(pm.TextSelection.create(state.doc, 0, 0)));\r\n    // update editor state\r\n    editorView.updateState(newState);\r\n  }\r\n\r\n  static removingMarkerHandler(inputs) {\r\n    const {\r\n      editorId, editorView, markedSelection, $dispatchNode, dataTagId, dataCommandName, marker,\r\n    } = inputs;\r\n    // find remove button at the end of marked part\r\n    const $removeButton = editorView.dom.querySelector(`[data-tag-id=${dataTagId}] > span.node-close`);\r\n\r\n    if ($removeButton) {\r\n      $removeButton.addEventListener('click', (event) => {\r\n        event.preventDefault();\r\n\r\n        // find all marked parts\r\n        const $markedParts = editorView.dom.querySelectorAll(`span[data-tag-id=${dataTagId}]`);\r\n        const { state } = editorView;\r\n        const { tr } = state;\r\n        // for all ranges\r\n        for (let index = 0; index < $markedParts.length; index += 1) {\r\n          const $markedPart = $markedParts[index];\r\n          // https://prosemirror.net/docs/ref/#view.EditorView.posAtDOM\r\n          const fromPos = editorView.posAtDOM($markedPart);\r\n          const toPos = fromPos + $markedPart.textContent.length + 2;\r\n          const matched = [];\r\n          const step = 0;\r\n\r\n          // better option but error\r\n          // tr.removeMark($from.pos, $to.pos, marker);\r\n\r\n          // copy pased from Transform.prototype.removeMark\r\n          // https://github.com/ProseMirror/prosemirror-transform/blob/master/src/mark.js\r\n          // https://prosemirror.net/docs/ref/#model.Node.nodesBetween\r\n          tr.doc.nodesBetween(fromPos, toPos, (node, pos) => {\r\n            if (!node.isInline) return;\r\n\r\n            let toRemove = null;\r\n            if (marker instanceof pm.MarkType) {\r\n              // https://prosemirror.net/docs/ref/#model.MarkType.isInSet\r\n              const found = marker.isInSet(node.marks);\r\n              if (found) toRemove = [found];\r\n            }\r\n            else if (marker) {\r\n              // https://prosemirror.net/docs/ref/#model.Mark.isInSet\r\n              if (marker.isInSet(node.marks)) toRemove = [marker];\r\n            }\r\n            else {\r\n              toRemove = node.marks;\r\n            }\r\n\r\n            if (toRemove && toRemove.length) {\r\n              const end = Math.min(pos + node.nodeSize, toPos);\r\n              for (let i = 0; i < toRemove.length; i += 1) {\r\n                const style = toRemove[i];\r\n                let found;\r\n                for (let j = 0; j < matched.length; j += 1) {\r\n                  const m = matched[j];\r\n                  // https://prosemirror.net/docs/ref/#model.Mark.eq\r\n                  if (m.step === step - 1 && style.eq(matched[j].style)) found = m;\r\n                }\r\n                if (found) {\r\n                  found.to = end;\r\n                  found.step = step;\r\n                }\r\n                else {\r\n                  matched.push({\r\n                    style, from: Math.max(pos, fromPos), to: end, step,\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          });\r\n          // https://prosemirror.net/docs/ref/#transform.Transform.step\r\n          // https://prosemirror.net/docs/ref/#transform.RemoveMarkStep\r\n          matched.forEach((m) => tr.step(new pm.RemoveMarkStep(m.from, m.to, m.style)));\r\n        }\r\n\r\n        // remove removeButton and update state\r\n        // https://prosemirror.net/docs/ref/#view.EditorView.posAtDOM\r\n        const fromPostRB = editorView.posAtDOM($removeButton);\r\n        tr.delete(fromPostRB - 1, fromPostRB + 1);\r\n\r\n        // update editor state\r\n        const newState = state.apply(tr);\r\n        editorView.updateState(newState);\r\n\r\n        // dispatch event that editor has changed\r\n        __dispatchEvent(document, 'editor.change', {}, {\r\n          text: {\r\n            id: editorId,\r\n            task: 'remove',\r\n            tagData: { tagName: dataCommandName },\r\n            value: $dispatchNode,\r\n          },\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  // helper function for dispatch event\r\n  // connect all marked parts\r\n  // clone first part and add here text content of other parts\r\n  static connectAllSelectedParts(view, dataTagId) {\r\n    const $nodes = view.dom.querySelectorAll(`span[data-tag-id=${dataTagId}]`);\r\n    if ($nodes.length === 1) return $nodes[0];\r\n    if ($nodes.length > 1) {\r\n      const $finalNode = $nodes[0].cloneNode(true);\r\n      let fullContent = $nodes[0].textContent;\r\n      for (let i = 1; i < $nodes.length; i += 1) {\r\n        fullContent += $nodes[i].textContent;\r\n      }\r\n      $finalNode.innerHTML = fullContent;\r\n      return $finalNode;\r\n    }\r\n\r\n    console.error(\"Error: Didn't find parts of marked part of text.\");\r\n    return null;\r\n  }\r\n}\r\n","// plugin specification: https://prosemirror.net/docs/ref/#state.Plugin_System\r\nexport default class WrittingMenu {\r\n  constructor(editorView, $menuTemplate) {\r\n    this.$removeAllChanges = $menuTemplate.querySelector('.editor-toolbar-action-reset');\r\n\r\n    this.init(editorView);\r\n  }\r\n\r\n  init(editorView) {\r\n    const firstState = editorView.state;\r\n\r\n    this.$removeAllChanges.addEventListener('click', () => {\r\n      // eslint-disable-next-line no-alert, no-restricted-globals\r\n      const isConfirmed = confirm('Opravdu chcete vrátit text do původní podoby? Vaše změny se tímto ztratí.');\r\n\r\n      if (isConfirmed) {\r\n        editorView.updateState(firstState);\r\n      }\r\n    });\r\n  }\r\n\r\n  static update(view, lastState) {\r\n    // const { state, readOnly } = view;\r\n  }\r\n\r\n  destroy() {\r\n    if (this.$removeAllChanges) {\r\n      this.$removeAllChanges.remove();\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Defined all supported html nodes in editor\r\n * Divided in nodes and marks\r\n * Nodes are static - https://prosemirror.net/docs/ref/#model.NodeSpec\r\n * Marks are dynamic - https://prosemirror.net/docs/ref/#model.MarkSpec\r\n * Example: https://github.com/ProseMirror/prosemirror-schema-basic/blob/master/src/schema-basic.js\r\n */\r\nconst schemaConfig = {\r\n  nodes: {\r\n    doc: { content: 'block+' },\r\n    heading: {\r\n      attrs: {\r\n        level: { default: 1 },\r\n        style: { default: false },\r\n      },\r\n      content: 'inline*',\r\n      group: 'block',\r\n      defining: true,\r\n      parseDOM: [{\r\n        tag: 'h1',\r\n        getAttrs(dom) {\r\n          return { level: 1, style: dom.getAttribute('style') };\r\n        },\r\n      },\r\n      {\r\n        tag: 'h2',\r\n        getAttrs(dom) {\r\n          return { level: 2, style: dom.getAttribute('style') };\r\n        },\r\n      },\r\n      {\r\n        tag: 'h3',\r\n        getAttrs(dom) {\r\n          return { level: 3, style: dom.getAttribute('style') };\r\n        },\r\n      },\r\n      {\r\n        tag: 'h4',\r\n        getAttrs(dom) {\r\n          return { level: 4, style: dom.getAttribute('style') };\r\n        },\r\n      },\r\n      {\r\n        tag: 'h5',\r\n        getAttrs(dom) {\r\n          return { level: 5, style: dom.getAttribute('style') };\r\n        },\r\n      },\r\n      {\r\n        tag: 'h6',\r\n        getAttrs(dom) {\r\n          return { level: 6, style: dom.getAttribute('style') };\r\n        },\r\n      }],\r\n      toDOM(node) { const { style } = node.attrs; return [`h${node.attrs.level}`, { style }, 0]; },\r\n    },\r\n    paragraph: {\r\n      content: 'inline*',\r\n      group: 'block',\r\n      defining: true,\r\n      attrs: {\r\n        style: { default: false },\r\n      },\r\n      parseDOM: [{\r\n        tag: 'p',\r\n        getAttrs(dom) {\r\n          return { style: dom.getAttribute('style') };\r\n        },\r\n      }],\r\n      toDOM(node) { const { style } = node.attrs; return ['p', { style }, 0]; },\r\n    },\r\n    list: {\r\n      content: 'block+',\r\n      group: 'block',\r\n      attrs: {\r\n        type: { default: false },\r\n      },\r\n      parseDOM: [{\r\n        tag: 'ol',\r\n        getAttrs(dom) {\r\n          return { type: dom.getAttribute('type') };\r\n        },\r\n      }],\r\n      toDOM(node) { const { type } = node.attrs; return ['ol', { type }, 0]; },\r\n    },\r\n    listItem: {\r\n      content: 'inline*',\r\n      group: 'block',\r\n      parseDOM: [{ tag: 'li' }],\r\n      toDOM() { return ['li', 0]; },\r\n    },\r\n    hard_break: {\r\n      group: 'block',\r\n      selectable: false,\r\n      parseDOM: [{ tag: 'br' }],\r\n      toDOM() { return ['br']; },\r\n    },\r\n    // hr: {\r\n    //   inline: true,\r\n    //   group: 'inline',\r\n    //   selectable: false,\r\n    //   parseDOM: [{ tag: 'hr' }],\r\n    //   toDOM() { return ['hr']; },\r\n    // },\r\n    text: {\r\n      inline: true,\r\n      group: 'inline',\r\n    },\r\n    // premarked parts\r\n    premarked: {\r\n      content: 'inline',\r\n      inline: true,\r\n      group: 'inline',\r\n      attrs: {\r\n        id: {},\r\n        textData: {},\r\n        className: {},\r\n      },\r\n      parseDOM: [{\r\n        tag: 'span.text-option',\r\n        getAttrs: ($dom) => {\r\n          const id = $dom.getAttribute('id');\r\n          const textData = $dom.getAttribute('data-text-option');\r\n          const className = $dom.getAttribute('class');\r\n          return { id, textData, className };\r\n        },\r\n      }],\r\n      toDOM: (node) => {\r\n        const { id, textData, className } = node.attrs;\r\n        return ['span', {\r\n          'id': id,\r\n          'class': className,\r\n          'data-text-option': textData,\r\n        }, 0];\r\n      },\r\n    },\r\n    // marker remove button\r\n    removeButton: {\r\n      inline: true,\r\n      group: 'inline',\r\n      selectable: false,\r\n      parseDOM: [{ tag: 'span.node-close' }],\r\n      toDOM() {\r\n        return ['span', { class: 'node-close' }, '×'];\r\n      },\r\n    },\r\n  },\r\n  marks: {\r\n    italic: {\r\n      parseDOM: [{ tag: 'i' }, { tag: 'em' }],\r\n      toDOM() { return ['em', 0]; },\r\n    },\r\n    bold: {\r\n      parseDOM: [{ tag: 'b' }],\r\n      toDOM() { return ['b', 0]; },\r\n    },\r\n    code: {\r\n      parseDOM: [{ tag: 'code' }],\r\n      toDOM() { return ['code', 0]; },\r\n    },\r\n    small: {\r\n      parseDOM: [{ tag: 'small' }],\r\n      toDOM() { return ['small', 0]; },\r\n    },\r\n    marker: {\r\n      attrs: {\r\n        color: {},\r\n        dataCommandName: {},\r\n        dataTagId: {},\r\n      },\r\n      parseDOM: [{\r\n        tag: 'span[data-tag-id]',\r\n        getAttrs: ($dom) => {\r\n          const color = $dom.getAttribute('data-color');\r\n          const dataCommandName = $dom.getAttribute('data-command-name');\r\n          const dataTagId = $dom.getAttribute('data-tag-id');\r\n          return { color, dataCommandName, dataTagId };\r\n        },\r\n      }],\r\n      toDOM: (node) => {\r\n        const { color, dataCommandName, dataTagId } = node.attrs;\r\n        return ['span', {\r\n          'class': `node-selected node-text-${color}`,\r\n          'data-command-name': dataCommandName,\r\n          'data-tag-id': dataTagId,\r\n          'data-color': color,\r\n        }, 0];\r\n      },\r\n    },\r\n    writtingInsertPart: {\r\n      attrs: {\r\n        id: {},\r\n      },\r\n      parseDOM: [{\r\n        tag: 'span.user-inserted-text.user-inserted-text-inner',\r\n        getAttrs: ($dom) => {\r\n          const id = $dom.getAttribute('data-add-id');\r\n          return { id };\r\n        },\r\n      }],\r\n      toDOM: (node) => {\r\n        const { id } = node.attrs;\r\n        return ['span', {\r\n          'class': 'user-inserted-text user-inserted-text-inner',\r\n          'data-add-id': id,\r\n        }, 0];\r\n      },\r\n    },\r\n    writtingRemovePart: {\r\n      attrs: {\r\n        id: {},\r\n      },\r\n      parseDOM: [{\r\n        tag: 'span.user-removed-text.user-removed-text-inner',\r\n        getAttrs: ($dom) => {\r\n          const id = $dom.getAttribute('data-remove-id');\r\n          return { id };\r\n        },\r\n      }],\r\n      toDOM: (node) => {\r\n        const { id } = node.attrs;\r\n        return ['span', {\r\n          'class': 'user-removed-text user-removed-text-inner',\r\n          'data-remove-id': id,\r\n        }, 0];\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nexport default schemaConfig;\r\n","import Component from '../component';\r\nimport SelectionMenu from './selectionMenu';\r\nimport WrittingMenu from './writtingMenu';\r\nimport schemaConfig from './schema';\r\nimport { __dispatchEvent } from '../../lib/utils';\r\n\r\nexport default class Editor extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n    this.editor = undefined;\r\n    this.id = this.target.id;\r\n    this.editorType = this.target.getAttribute('data-editor');\r\n    // find editor place in cviceni\r\n    this.$editor = this.target.querySelector(`#prosemirror-editor-${this.id}`);\r\n    // find editor content\r\n    this.$content = this.target.querySelector(`#prosemirror-content-${this.id}`);\r\n    this.schema = new pm.Schema(schemaConfig);\r\n\r\n    // only if cviceni isn't done load html\r\n    if (!HISTORYLAB.import.done) {\r\n      this.initHTML();\r\n    }\r\n    else {\r\n      this.initJSON();\r\n    }\r\n  }\r\n\r\n  // calling from save-data.js\r\n  getEditorJSON() {\r\n    if (this.editor) {\r\n      // get JSON format of last editor state\r\n      return this.editor.state.toJSON();\r\n    }\r\n    return {};\r\n  }\r\n\r\n  // type of editor is set here\r\n  initHTML() {\r\n    let plugins;\r\n    // add plugin by editor type\r\n    if (this.editorType === 'zvyraznovani') {\r\n      const bubbleMenu = this.selectionMenu(this.id);\r\n      plugins = [bubbleMenu];\r\n    }\r\n\r\n    if (this.editorType === 'predznaceny') {\r\n      const premarkedParts = Editor.premarkedParts(this.id, this.schema);\r\n      plugins = [premarkedParts];\r\n    }\r\n\r\n    if (this.editorType === 'psani') {\r\n      const writting = this.writting(pm.keydownHandler);\r\n      const histKeymap = pm.keymap({ 'Mod-z': pm.undo, 'Mod-y': pm.redo });\r\n      plugins = [pm.history(), histKeymap, writting];\r\n    }\r\n\r\n    // create editor instance by defining editor view\r\n    this.editor = new pm.EditorView(this.$editor, {\r\n      // state is created from html structure parsed from our text and array of plugins\r\n      state: pm.EditorState.create({\r\n        doc: pm.DOMParser.fromSchema(this.schema).parse(this.$content),\r\n        plugins,\r\n      }),\r\n    });\r\n  }\r\n\r\n  // only visualization of saved data\r\n  // load saved data from JSON format\r\n  initJSON() {\r\n    const data = JSON.parse(this.$content.textContent);\r\n    const readOnly = Editor.readOnlyMod();\r\n    const { schema } = this;\r\n\r\n    // create editor instance by defining editor view\r\n    this.editor = new pm.EditorView(this.$editor, {\r\n      // editor state is created from JSON object and schema\r\n      state: pm.EditorState.fromJSON({ schema, plugins: [readOnly] }, data),\r\n    });\r\n  }\r\n\r\n  // only diable editing editor\r\n  // https://prosemirror.net/docs/ref/#view.EditorProps.editable\r\n  static readOnlyMod() {\r\n    return new pm.Plugin({\r\n      props: {\r\n        editable() {\r\n          return false;\r\n        },\r\n      },\r\n      // plugin key has to be unique in editor\r\n      key: new pm.PluginKey('ReadOnlyMod'),\r\n    });\r\n  }\r\n\r\n  // manager of marker\r\n  selectionMenu(editorId) {\r\n    const { schema } = this;\r\n    // get menu from gulp\r\n    const $menuTemplate = this.target.querySelector(`#marker-menu-${this.target.id}`);\r\n    return new pm.Plugin({\r\n      // set plugin visualization means set definated marker menu as part of plugin\r\n      view(editorView) {\r\n        return new SelectionMenu(editorId, schema, editorView, $menuTemplate);\r\n      },\r\n      // when editable is false history doesn't work\r\n      props: {\r\n        editable() {\r\n          return false;\r\n        },\r\n      },\r\n      // plugin key has to be unique in editor\r\n      key: new pm.PluginKey('SelectionMenu'),\r\n    });\r\n  }\r\n\r\n  // manager of premarker\r\n  static premarkedParts(editorId, schema) {\r\n    return new pm.Plugin({\r\n      props: {\r\n        // when editable is false history doesn't work\r\n        editable() {\r\n          return false;\r\n        },\r\n        // https://prosemirror.net/docs/ref/#view.EditorProps.handleClickOn\r\n        handleClickOn(view, pos, node, nodePos) {\r\n          if (schema.nodes.premarked.name === node.type.name) {\r\n            // definition of class adding to selected node\r\n            const classSelectDefinition = 'selected';\r\n            const { state } = view;\r\n            const { tr } = state;\r\n\r\n            let newClassName;\r\n            let task;\r\n            // variable for extra data from cviceni JSON for dispatch event distribution\r\n            const tagData = JSON.parse(node.attrs.textData);\r\n            tagData.tagName = 'vyznacena-pasaz';\r\n\r\n            if (node.attrs.className.includes(classSelectDefinition)) {\r\n              newClassName = node.attrs.className.replace(` ${classSelectDefinition}`, '');\r\n              task = 'remove';\r\n            }\r\n            else {\r\n              newClassName = `${node.attrs.className} ${classSelectDefinition}`;\r\n              task = 'add';\r\n            }\r\n\r\n            // for create new state it's important to not change html node directly\r\n            // it's important to use prosemirror functions\r\n            const nodeAttrs = {\r\n              id: node.attrs.id,\r\n              className: newClassName,\r\n              textData: node.attrs.textData,\r\n            };\r\n\r\n            // replace old node on set position by new node with new attributes\r\n            tr.setNodeMarkup(nodePos, null, nodeAttrs);\r\n\r\n            // changing editor's state\r\n            const newState = state.apply(tr);\r\n            view.updateState(newState);\r\n\r\n            // dispatch event that editor has changed\r\n            const $node = view.dom.querySelector(`#${node.attrs.id}`);\r\n            __dispatchEvent(document, 'editor.change', {}, {\r\n              text: {\r\n                id: editorId,\r\n                task,\r\n                tagData,\r\n                value: $node.cloneNode(true),\r\n              },\r\n            });\r\n          }\r\n          return false;\r\n        },\r\n      },\r\n      // plugin key has to be unique in editor\r\n      key: new pm.PluginKey('PremarkedParts'),\r\n    });\r\n  }\r\n\r\n  // manager of writting\r\n  writting(keydownHandler) {\r\n    // get menu items from gulp\r\n    const $toolbarTemplate = this.target.querySelector(`#toolbar-${this.target.id}`);\r\n    // console.log($toolbarTemplate);\r\n    let sugar = 0;\r\n\r\n    // definition of deleted parts logic\r\n    const deletedParts = (state, dispatch) => {\r\n      // create unique id\r\n      const id = `remove-part-${sugar}`;\r\n      // define command\r\n      const command = pm.toggleMark(this.schema.marks.writtingRemovePart, { id });\r\n      // marked selection part\r\n      command(state, dispatch);\r\n      // increase sugar\r\n      sugar += 1;\r\n      return true;\r\n    };\r\n\r\n    return new pm.Plugin({\r\n      // set plugin visualization means set definated writting menu as part of plugin\r\n      view(editorView) {\r\n        return new WrittingMenu(editorView, $toolbarTemplate);\r\n      },\r\n      props: {\r\n        handleKeyDown: keydownHandler({ Delete: deletedParts, Backspace: deletedParts }),\r\n      },\r\n      // plugin key has to be unique in editor\r\n      key: new pm.PluginKey('Writting'),\r\n    });\r\n  }\r\n}\r\n","import { __toggleClass, __getHTML, __dispatchEvent } from '../lib/utils';\r\nimport Component from './component';\r\n\r\n// zoom the image\r\nexport default class Keywords extends Component {\r\n  constructor($element, opts = {}) {\r\n    super($element);\r\n    this.id = this.target.id;\r\n    this.function = this.target.getAttribute('data-keywords') || 'selekce-' || 'selekce+';\r\n    this.$controls = this.target.querySelectorAll('[data-keywords-control]');\r\n\r\n    this.opts = { ...Keywords.defaults, ...opts };\r\n\r\n    this.$itemsContainer = this.target.querySelector(`.${this.opts.itemsContainerClassName}`);\r\n\r\n    if (this.opts.inherit && this.opts.inherit.from.length > 0) {\r\n      // console.log(this.opts.inherit.from);\r\n      this.isInherited = true;\r\n    }\r\n    else {\r\n      this.$items = this.target.querySelectorAll(`.${this.opts.itemClassName}`);\r\n    }\r\n\r\n  }\r\n\r\n  init() {\r\n    switch (this.function) {\r\n      case 'selekce-':\r\n      case 'selekce+':\r\n        // we have data at the instantiation for importing\r\n        if (this.opts.import && this.opts.import.length > 0) {\r\n          this.$itemsContainer.innerHTML = Keywords._getHTMLFromItems(this.opts.import);\r\n        }\r\n\r\n        // console.log(this.id, this.isInherited);\r\n        if (this.isInherited) {\r\n          // if onInit, we copy the elements\r\n          // by their ids into the itemsContainer of this object\r\n          if (this.opts.inherit.onInit) {\r\n            this._regenerateItemsContainerFromInherited();\r\n          }\r\n        }\r\n\r\n        this._registerHandlers();\r\n        break;\r\n      case 'wordcloud':\r\n        this.$items.forEach(($item) => {\r\n          $item.setAttribute('data-keywords-item', 0);\r\n        });\r\n        this._changeSizeOfKeywordItem(this.opts.skala);\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  _changeSizeOfKeywordItem(maxLevel) {\r\n    maxLevel = maxLevel ? parseInt(maxLevel, 10) : 4;\r\n\r\n    function setNewLevelValue($keyword, number, feedback) {\r\n      const oldValue = parseInt($keyword.getAttribute('data-keywords-item'), 10);\r\n      const newValue = oldValue + number;\r\n      const value = Math.abs(newValue) > maxLevel ? oldValue : newValue;\r\n      $keyword.setAttribute('data-keywords-item', value);\r\n\r\n      feedback();\r\n    }\r\n\r\n    this.$controls.forEach(($control) => {\r\n      const $keyword = $control.parentElement.parentElement;\r\n      const controlFunction = $control.getAttribute('data-keywords-control');\r\n\r\n      switch (controlFunction) {\r\n        case 'minus':\r\n          $control.addEventListener('click', (event) => {\r\n            setNewLevelValue($keyword, -1, this.showFeedback);\r\n            event.preventDefault();\r\n          });\r\n          break;\r\n\r\n        case 'plus':\r\n          $control.addEventListener('click', (event) => {\r\n            setNewLevelValue($keyword, 1, this.showFeedback);\r\n            event.preventDefault();\r\n          });\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  _regenerateItemsContainerFromInherited() {\r\n    let tempContent = '';\r\n\r\n    this.opts.inherit.from.forEach((id) => {\r\n      const temp = document.getElementById(id).querySelector(`.${this.opts.itemsContainerClassName}`).innerHTML;\r\n      // rename ids of the original items to avoid duplicates in the DOM\r\n      tempContent += Keywords.renameItemsIds(id, this.id, temp);\r\n      // console.log(tempContent);\r\n    });\r\n\r\n    this.$itemsContainer.innerHTML = tempContent;\r\n\r\n    this.$items = this.target.querySelectorAll(`.${this.opts.itemClassName}`);\r\n  }\r\n\r\n  _registerHandlers() {\r\n\r\n    // this.target.querySelectorAll(`.${this.opts.itemClassName}`).forEach(($item) => {\r\n    this.$items.forEach(($item) => {\r\n      $item.addEventListener('click', this._clickEventHandler.bind(this), true);\r\n      document.addEventListener('keyword.change', (e) => { this._dispatchEventHandler(e, $item); }, false);\r\n    });\r\n\r\n  }\r\n\r\n\r\n  _clickEventHandler(e) {\r\n\r\n    if (e.type === 'click') {\r\n\r\n      __toggleClass(e.currentTarget, 'disabled');\r\n\r\n      // dispatch event that keyword has changed\r\n      __dispatchEvent(document, 'keyword.change', {}, {\r\n        keywords: {\r\n          id: this.id,\r\n          node: e.currentTarget,\r\n        },\r\n      });\r\n\r\n      this.showFeedback();\r\n    }\r\n  }\r\n\r\n  _dispatchEventHandler(e, $item) {\r\n    const { id, node } = e.detail.keywords;\r\n\r\n    if (this.isInherited && this.opts.inherit.from.includes(id)) {\r\n      const currentId = $item.id;\r\n      const nodeId = node.id;\r\n      const removeFeatureIdFromCurrentId = currentId.replace(this.id, '');\r\n      const removeFeatureIdFromNodeId = nodeId.replace(id, '');\r\n\r\n      if (removeFeatureIdFromCurrentId === removeFeatureIdFromNodeId) {\r\n        __toggleClass($item, 'disabled');\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nKeywords._getItemFromDOMElement = ($item) => ({\r\n  class: $item.className,\r\n  id: $item.getAttribute('id'),\r\n  text: $item.innerText,\r\n});\r\n\r\nKeywords._getItemsHTML = ($itemsContainer) => $itemsContainer.innerHTML;\r\n\r\nKeywords._getItemsFromHTML = ($itemsContainer, itemsClassName) => {\r\n  const $items = $itemsContainer.querySelectorAll(`.${itemsClassName}`);\r\n  const itemsArray = [];\r\n\r\n  $items.forEach(($item) => {\r\n    itemsArray.push(Keywords._getItemFromDOMElement($item));\r\n  });\r\n\r\n\r\n  return itemsArray;\r\n\r\n};\r\n\r\nKeywords._getDOMElementFromItem = (item) => {\r\n\r\n  const newDiv = document.createElement('div');\r\n  newDiv.setAttribute('class', item.class);\r\n  newDiv.setAttribute('id', item.id);\r\n  newDiv.innerHTML = item.text;\r\n\r\n  return __getHTML(newDiv);\r\n\r\n};\r\n\r\nKeywords._getHTMLFromItems = (items) => {\r\n\r\n  let contentHTML = '';\r\n\r\n  items.forEach((item) => {\r\n\r\n    contentHTML += Keywords._getDOMElementFromItem(item);\r\n\r\n  });\r\n\r\n  return contentHTML;\r\n\r\n};\r\n\r\n\r\nKeywords.renameItemsIds = (oldId, newId, itemsHTML) => {\r\n\r\n  const expString = new RegExp(oldId, 'g');\r\n\r\n  return itemsHTML.replace(expString, newId);\r\n\r\n};\r\n\r\nKeywords.defaults = {\r\n  itemsContainerClassName: 'keywords-items-container',\r\n  itemClassName: 'keywords-item',\r\n};\r\n","import { __removeClass, __toggleClass } from '../lib/utils';\r\nimport Component from './component';\r\n\r\n\r\nexport default class TestQuiz extends Component {\r\n\r\n  constructor(id, element, opts) {\r\n    super(element);\r\n\r\n    this.id = id;\r\n\r\n    this.opts = { ...TestQuiz.defaults, ...opts };\r\n\r\n    this.$questions = this.target.querySelectorAll(`.${this.opts.itemClass}`);\r\n    this.cache = {\r\n      answersCorrect: 0,\r\n      colors: [],\r\n      questions: [],\r\n    };\r\n\r\n    // get colors for all feedback variants\r\n    if (this.opts.zpetnaVazba) {\r\n      this.cache.colors = this.opts.zpetnaVazba.map((feedback) => feedback.barva);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    this._registerHandlers();\r\n  }\r\n\r\n  _registerHandlers() {\r\n\r\n    this.$questions.forEach(($question, questionIndex) => {\r\n      // all questions are without answer by default\r\n      this.cache.questions.push({ answered: false });\r\n\r\n      const answerCorrect = parseInt($question.getAttribute('data-module-answer'), 10);\r\n      const $answers = $question.querySelectorAll(`.${this.opts.optionClass}`);\r\n\r\n      $answers.forEach(($answer, answerIndex) => {\r\n        $answer.addEventListener('click', () => {\r\n          const $answerCurrent = $answer;\r\n\r\n          // if already selected do nothing\r\n          if ($answerCurrent.classList.contains('selected')) {\r\n            return;\r\n          }\r\n\r\n          // remove the selection\r\n          $answers.forEach(($answersItem) => __removeClass($answersItem, this.opts.selectedClass));\r\n          // select the clicked one\r\n          __toggleClass($answerCurrent, this.opts.selectedClass);\r\n\r\n          // get sum of all corect answers\r\n          if (this.opts.zpetnaVazba) {\r\n            if (answerIndex === answerCorrect) {\r\n              this.cache.answersCorrect += 1;\r\n            } else if (this.cache.answersCorrect !== 0 && this.cache.questions[questionIndex].answered === true) {\r\n              this.cache.answersCorrect -= 1;\r\n            }\r\n            // loop through all \"zpetnaVazba\" to get the one with the fullfilled condition\r\n            const feedbackActual = this.opts.zpetnaVazba.find((feedback) => feedback.podminka.includes(this.cache.answersCorrect));\r\n\r\n            // show the right feedback message\r\n            this.$buttonFeedback.classList.remove(...this.cache.colors);\r\n            this.$buttonFeedback.classList.add(feedbackActual.barva);\r\n            this.$buttonFeedbackText.innerText = feedbackActual.text;\r\n          }\r\n\r\n          // note that this question has been answered (whether true or false)\r\n          this.cache.questions[questionIndex].answered = true;\r\n\r\n          // show OK button with feedback only when all question have been answered\r\n          if (this.cache.questions.find((question) => !question.answered) === undefined) {\r\n            this.showFeedback();\r\n          }\r\n\r\n        }, false);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nTestQuiz.defaults = {\r\n  itemClass: 'test-quiz-item',\r\n  optionClass: 'option',\r\n  selectedClass: 'selected',\r\n};\r\n","/* eslint-disable max-classes-per-file */\r\n// [data-fullscreen]\r\nimport Component from './component';\r\nimport MagnifyingGlass from './magnifying-glass';\r\nimport { imageIsLoaded } from '../lib/utils';\r\n\r\nclass Fullscreen extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.$fullscreen = document.querySelector('[data-fullscreen=\"fullscreen\"]');\r\n    this.$fullscreenContainer = this.$fullscreen.querySelector('[data-fullscreen=\"container\"]');\r\n    this.$fullscreenTarget = this.$fullscreen.querySelector('[data-fullscreen=\"target\"]');\r\n\r\n    this.window = {};\r\n    this.image = {};\r\n\r\n    this.window.width = window.innerWidth;\r\n    this.window.height = window.innerHeight;\r\n    this.window.ratio = this.window.width / this.window.height;\r\n  }\r\n}\r\n\r\nexport default class FullscreenToggle extends Fullscreen {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.imageAlternative = this.target.getAttribute('data-fullscreen-image');\r\n\r\n    // TODO: do not rely on DOM .nextElementSibling, .firstElementChild, etc…\r\n    this.target.addEventListener('click', (event) => {\r\n      // Check if there is different image for zvetseni\r\n      if (this.imageAlternative) {\r\n        this.$fullscreenContainer.innerHTML = this.target.nextElementSibling.nextElementSibling.outerHTML;\r\n        this.$fullscreenTarget = this.$fullscreenContainer.firstElementChild;\r\n        this.$fullscreenTarget.classList.remove('is-hidden');\r\n      }\r\n      else {\r\n        this.$fullscreenContainer.innerHTML = this.target.nextElementSibling.outerHTML;\r\n        this.$fullscreenTarget = this.$fullscreenContainer.firstElementChild;\r\n      }\r\n\r\n      this.$fullscreenTarget.removeAttribute('style');\r\n      this.$fullscreenTarget.removeAttribute('id');\r\n\r\n      switch (this.target.nextElementSibling.nodeName.toLowerCase()) {\r\n        case 'img':\r\n          setTimeout(() => {\r\n            imageIsLoaded(this.$fullscreenTarget.currentSrc)\r\n              .then(() => {\r\n                this.image.width = this.$fullscreenTarget.naturalWidth;\r\n                this.image.height = this.$fullscreenTarget.naturalHeight;\r\n                this.image.ratio = this.image.width / this.image.height;\r\n\r\n                this.setSize();\r\n\r\n                const magnifyingGlass = new MagnifyingGlass(this.$fullscreenTarget);\r\n              });\r\n          }, 10);\r\n          break;\r\n\r\n        case 'svg':\r\n          // eslint-disable-next-line no-case-declarations\r\n          const viewbox = this.$fullscreenTarget.getAttribute('viewBox').split(' ');\r\n\r\n          [, , this.image.width, this.image.height] = viewbox;\r\n          this.image.ratio = this.image.width / this.image.height;\r\n\r\n          this.setSize();\r\n\r\n          // eslint-disable-next-line no-case-declarations\r\n          const $svgTexts = this.$fullscreenTarget.querySelectorAll('textarea');\r\n          if ($svgTexts.length > 0) {\r\n            $svgTexts.forEach(($svgText) => {\r\n              const { id } = $svgText;\r\n              $svgText.removeAttribute('id');\r\n              $svgText.value = document.getElementById(id).value;\r\n              $svgText.readOnly = true;\r\n            });\r\n          }\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n\r\n      this.$fullscreen.classList.toggle('hidden');\r\n\r\n      this.showFeedback();\r\n\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    }, false);\r\n\r\n  }\r\n\r\n  setSize() {\r\n    if (this.image.ratio >= this.window.ratio) {\r\n      this.$fullscreenTarget.style.width = '100%';\r\n      this.$fullscreenTarget.style.height = 'auto';\r\n    }\r\n    else {\r\n      this.$fullscreenTarget.style.width = 'auto';\r\n      this.$fullscreenTarget.style.height = `${this.window.height}px`;\r\n    }\r\n  }\r\n}\r\n","import Component from './component';\r\nimport { __dispatchEvent } from '../lib/utils';\r\n\r\nexport default class UserText extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.$item = this.target.closest('.user-text');\r\n    this.$counter = this.$item.querySelector('[data-usertext-counter]');\r\n    this.$counterWrapper = this.$item.querySelector('.user-text__counter');\r\n    this.$instruction = this.$item.querySelector('.user-text__question');\r\n\r\n    this.$userTexts = this.$slide.querySelectorAll('[data-textarea-target]');\r\n\r\n    this.feedback = JSON.parse(this.target.getAttribute('data-feedback'));\r\n\r\n    this.lengthExpected = {\r\n      min: parseInt(this.target.getAttribute('minlength') === '0' ? 1 : this.target.getAttribute('minlength'), 10),\r\n      avg: null,\r\n      max: parseInt(this.target.getAttribute('maxlength') / 2, 10),\r\n    };\r\n    this.lengthExpected.avg = Math.floor((this.lengthExpected.max - this.lengthExpected.min) / 4 + this.lengthExpected.min);\r\n\r\n    this.cache = {\r\n      answersCorrect: 0,\r\n      colors: [\r\n        'color-red',\r\n        'color-orange',\r\n        'color-green',\r\n      ],\r\n      questions: [],\r\n    };\r\n\r\n    this.lastValue = '';\r\n    this.hadData = this.target.value && this.target.value.length > 0;\r\n    this.wasUsed = false;\r\n\r\n    if (this.hadData) {\r\n      this.updateCharacterCounter();\r\n    }\r\n\r\n    if (!HISTORYLAB.import.done) {\r\n      // duplicate source of different text element\r\n      this.toDuplicate = this.target.getAttribute('data-duplicate-text');\r\n      this.textDuplicateSources = this.toDuplicate ? this.toDuplicate.split(' ') : [];\r\n\r\n      // listen events\r\n      this.getEvents();\r\n      this.addEventListeners();\r\n    }\r\n  }\r\n\r\n  updateCharacterCounter(length = this.target.value.length) {\r\n    this.$counterWrapper.classList.remove(...this.cache.colors);\r\n    if (length < this.lengthExpected.min) this.$counterWrapper.classList.add(this.cache.colors[0]);\r\n    else if (length <= this.lengthExpected.avg) this.$counterWrapper.classList.add(this.cache.colors[1]);\r\n    else if (length > this.lengthExpected.avg) this.$counterWrapper.classList.add(this.cache.colors[2]);\r\n\r\n    this.$counter.innerText = length;\r\n    this.target.classList.add('is-used', !this.wasUsed);\r\n    this.wasUsed = true;\r\n  }\r\n\r\n  updateFeedback(length = this.target.value.length) {\r\n    if (!this.$buttonFeedback) return;\r\n\r\n    this.$buttonFeedback.classList.remove(...this.cache.colors);\r\n    if (length < this.lengthExpected.min) {\r\n      this.$buttonFeedback.classList.add(this.cache.colors[0]);\r\n      this.$buttonFeedbackText.innerText = this.feedback.none;\r\n    } else {\r\n\r\n      if (length <= this.lengthExpected.avg) {\r\n        this.$buttonFeedback.classList.add(this.cache.colors[1]);\r\n        this.$buttonFeedbackText.innerText = this.feedback.short;\r\n      }\r\n      else if (length > this.lengthExpected.avg) {\r\n        this.$buttonFeedback.classList.add(this.cache.colors[2]);\r\n        this.$buttonFeedbackText.innerText = this.feedback.ok;\r\n      }\r\n\r\n      this.target.setAttribute('data-textarea-target', 'success');\r\n      // check if all conditions of the same component on the same slide are met\r\n      const conditionAll = Array.from(this.$userTexts).find(($userText) => ($userText.getAttribute('data-textarea-target') !== 'success'));\r\n\r\n      if (conditionAll === undefined) {\r\n        // show OK button or feedback\r\n        this.showFeedback();\r\n      }\r\n    }\r\n  }\r\n\r\n  addEventListeners() {\r\n    // BLUR\r\n    this.target.addEventListener('blur', (event) => {\r\n      this.updateCharacterCounter();\r\n\r\n      if (event.target.value !== this.lastValue) {\r\n        const taskName = (this.lastValue === '') ? 'create' : 'change';\r\n        this.lastValue = event.target.value;\r\n\r\n        // dispatch event that text has changed\r\n        __dispatchEvent(document, 'text.change', {}, {\r\n          text: {\r\n            id: event.target.id,\r\n            task: taskName,\r\n            text: event.target.value,\r\n          },\r\n        });\r\n\r\n        // remove connection of any textfields\r\n        this.textDuplicateSources = [];\r\n      }\r\n    });\r\n\r\n    // KEYUP\r\n    this.target.addEventListener('keyup', (event) => {\r\n      event.stopPropagation();\r\n\r\n      const valueLength = this.target.value.length;\r\n      this.updateCharacterCounter(valueLength);\r\n      this.updateFeedback(valueLength);\r\n    });\r\n  }\r\n\r\n  getEvents() {\r\n    // when Selectable module modify question in user text\r\n    if (this.$instruction && this.$instruction.hasAttribute('data-from')) {\r\n      const fromId = this.$instruction.getAttribute('data-from');\r\n\r\n      document.addEventListener('selection.change', (e) => {\r\n        if (fromId === e.detail.id && e.detail.itemData && typeof e.detail.itemData === 'string') {\r\n          this.$instruction.innerText = e.detail.itemData;\r\n        }\r\n      });\r\n    }\r\n\r\n    // when textarea value is taken from other textarea\r\n    if (this.textDuplicateSources[0]) {\r\n\r\n      document.addEventListener('text.change', (e) => {\r\n        if (this.textDuplicateSources.includes(e.detail.text.id)) {\r\n\r\n          const taskName = (this.target.value === '') ? 'create' : 'change';\r\n          switch (e.detail.text.task) {\r\n            case 'create':\r\n            case 'change':\r\n              // if is something already there\r\n              if (this.target.value !== '') this.target.value += '\\n';\r\n\r\n              // if array length is one it means that can by connection line\r\n              if (this.textDuplicateSources.length === 1) {\r\n                this.target.value = e.detail.text.text;\r\n              } else {\r\n                this.target.value += `${e.detail.text.text}\\n`;\r\n              }\r\n\r\n              // dispatch event that text has changed\r\n              __dispatchEvent(document, 'text.change', {}, {\r\n                text: {\r\n                  id: this.target.id,\r\n                  task: taskName,\r\n                  text: this.target.value,\r\n                },\r\n              });\r\n\r\n              // make different first value if is need\r\n              this.lastValue = this.target.value;\r\n\r\n              this.updateCharacterCounter();\r\n              break;\r\n            default:\r\n              console.log('Nondefinated text events task. :(');\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n","import Component from '../component';\r\n\r\nexport default class AudioPlayerNormal extends Component {\r\n\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.$playButton = this.target.querySelector('[data-player-control]');\r\n    this.$loadWave = this.target.querySelector('[data-audio-wave]');\r\n    this.$leftTime = this.target.querySelector('[data-audio-time-left]');\r\n    this.$audioDuration = this.target.querySelector('[data-audio-time-duration]');\r\n\r\n    this.wavesurfer = WaveSurfer.create({\r\n      container: this.$loadWave,\r\n      waveColor: '#A77977',\r\n      progressColor: '#FCE4E3',\r\n      height: 80,\r\n      responsive: true,\r\n      barWidth: 2,\r\n    });\r\n    this.wavesurfer.load(this.$loadWave.dataset.src);\r\n\r\n    this.initWave();\r\n  }\r\n\r\n  initWave() {\r\n    this.wavesurfer.on('ready', () => {\r\n      this.$leftTime.textContent = '0:00';\r\n      const duration = this.wavesurfer.getDuration();\r\n      const minutes = Math.floor((duration % 3600) / 60);\r\n      const seconds = (`00${Math.floor(duration % 60)}`).slice(-2);\r\n      this.$audioDuration.textContent = `${minutes}:${seconds}`;\r\n\r\n      this.addListenerAfterReady();\r\n    });\r\n  }\r\n\r\n  addListenerAfterReady() {\r\n    this.wavesurfer.on('audioprocess', (time) => {\r\n      const minutes = Math.floor((time % 3600) / 60);\r\n      const seconds = (`00${Math.floor(time % 60)}`).slice(-2);\r\n      this.$leftTime.textContent = `${minutes}:${seconds}`;\r\n    });\r\n\r\n    this.wavesurfer.on('finish', () => {\r\n      this.$playButton.setAttribute('data-player-control', 'paused');\r\n    });\r\n\r\n    this.$playButton.addEventListener('click', () => {\r\n      this.wavesurfer.playPause();\r\n\r\n      if (this.$playButton.getAttribute('data-player-control') === 'paused') {\r\n        this.$playButton.setAttribute('data-player-control', 'playing');\r\n      } else {\r\n        this.$playButton.setAttribute('data-player-control', 'paused');\r\n      }\r\n\r\n      this.showFeedback();\r\n    });\r\n\r\n    // stop audio prehravac kdyz se zapne dalsi slajd\r\n    const $nextSlides = document.querySelectorAll('[data-nav-button]');\r\n    $nextSlides.forEach(($nextSlide) => {\r\n      $nextSlide.addEventListener('click', () => {\r\n        if (this.$playButton.getAttribute('data-player-control') === 'playing') {\r\n          this.wavesurfer.playPause();\r\n          this.$playButton.setAttribute('data-player-control', 'paused');\r\n        }\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n}\r\n","import AudioPlayer from './audio-player';\r\nimport { getSecondsMinutesFormat } from './media';\r\n\r\nexport default class AudioPlayerSimple extends AudioPlayer {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.$audio = this.target.querySelector('audio');\r\n    this.$timeLeft = this.target.querySelector('[data-audio-time-left]');\r\n    this.$duration = this.target.querySelector('[data-audio-time-duration]');\r\n\r\n    this.$duration.innerText = `/${getSecondsMinutesFormat(this.$audio.duration)}`;\r\n\r\n    AudioPlayer.addEventListeners(this.target, this.showFeedback);\r\n  }\r\n}\r\n","import Component from './component';\r\n\r\nexport default class FakeMap extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.$buttons = this.target.querySelectorAll('[data-fake-map=\"toggle\"]');\r\n    this.$maps = this.target.querySelectorAll('[data-fake-map=\"map\"]');\r\n    this.lastActiveIndex = 0;\r\n\r\n    this.addEventListenerToButtons();\r\n  }\r\n\r\n  switchMap($button, index) {\r\n    this.$maps[this.lastActiveIndex].classList.remove('active');\r\n    this.$buttons[this.lastActiveIndex].classList.remove('active');\r\n\r\n    this.$maps[index].classList.add('active');\r\n    $button.classList.add('active');\r\n\r\n    this.lastActiveIndex = index;\r\n  }\r\n\r\n  addEventListenerToButtons() {\r\n    this.$buttons.forEach(($button, index) => {\r\n\r\n      $button.addEventListener('click', (event) => {\r\n        this.switchMap($button, index);\r\n        this.showFeedback();\r\n\r\n        event.preventDefault();\r\n      });\r\n\r\n    });\r\n  }\r\n}\r\n","/* eslint-disable no-nested-ternary */\r\nimport Component from '../component';\r\nimport { getSecondsMinutesFormat, mediaEvents } from './media';\r\n\r\nexport default class VideoPlayer extends Component {\r\n  constructor($element, options) {\r\n    super($element);\r\n\r\n    this.$media = this.target.querySelector('video');\r\n    this.options = Object(options);\r\n    this.prefix = this.options.prefix || 'media';\r\n    this.lang = Object(this.options.lang);\r\n    // lang.currentTime\r\n    // lang.play\r\n    // lang.pause\r\n    // lang.minutes\r\n    // lang.seconds\r\n    // lang.leaveFullscreen\r\n    // lang.enterFullscreen\r\n\r\n    this.paused = null;\r\n    this.currentTime = null;\r\n    this.duration = null;\r\n    this.interval = null;\r\n\r\n    this.$document = this.target.ownerDocument;\r\n    this.$controls = this.target.querySelector('.media-player-controls');\r\n    // play/pause toggle\r\n    this.$play = this.$controls.querySelector('[data-player-control]');\r\n    this.$playSymbol = this.$play.querySelector('.media-play-symbol');\r\n    this.$pauseSymbol = this.$play.querySelector('.media-pause-symbol');\r\n    // time slider\r\n    this.$time = this.$controls.querySelector('[data-video-time-progress]');\r\n    this.$timeMeter = this.$time.querySelector('.media-meter.media-time-meter');\r\n    this.$timeRange = this.$time.querySelector('.media-range.media-time-range');\r\n\r\n    // current time text\r\n    this.$currentTimeText = this.$document.createTextNode('');\r\n    this.$currentTime = this.$controls.querySelector('[data-video-time-left]');\r\n    this.$currentTime.appendChild(this.$currentTimeText);\r\n\r\n    // duration time text\r\n    this.durationTime = this.$media.duration;\r\n    this.$durationTime = this.$controls.querySelector('[data-video-time-duration]');\r\n    this.$durationTime.innerText = getSecondsMinutesFormat(this.durationTime);\r\n    this.$durationTime.setAttribute(\r\n      'title',\r\n      `${VideoPlayer.timeToAural(\r\n        this.durationTime,\r\n        this.lang.minutes || 'minutes',\r\n        this.lang.seconds || 'seconds',\r\n      )}`,\r\n    );\r\n\r\n    // fullscreen button\r\n    this.$fullscreen = this.$controls.querySelector(\r\n      '.fullscreen-toggle',\r\n    );\r\n    this.$enterFullscreenSymbol = this.$fullscreen.querySelector(\r\n      '.media-enterFullscreen-symbol',\r\n    );\r\n    this.$leaveFullscreenSymbol = this.$fullscreen.querySelector(\r\n      '.media-leaveFullscreen-symbol',\r\n    );\r\n\r\n    // fullscreen api\r\n    this._fullscreenchange = 'onfullscreenchange' in this.target\r\n      ? 'fullscreenchange'\r\n      : 'onwebkitfullscreenchange' in this.target\r\n        ? 'webkitfullscreenchange'\r\n        : 'onMSFullscreenChange' in this.target\r\n          ? 'MSFullscreenChange'\r\n          : 'fullscreenchange';\r\n\r\n    this._requestFullscreen = this.target.requestFullscreen\r\n    || this.target.webkitRequestFullscreen\r\n    // || this.target.mozRequestFullScreen\r\n    || this.target.msRequestFullscreen;\r\n\r\n    this.onCanPlayStart = this.onCanPlayStart.bind(this);\r\n    this.onLoadStart = this.onLoadStart.bind(this);\r\n    this.onLoadedData = this.onLoadedData.bind(this);\r\n    this.onPlayChange = this.onPlayChange.bind(this);\r\n    this.onTimeChange = this.onTimeChange.bind(this);\r\n    this.onPlayClick = this.onPlayClick.bind(this);\r\n    this.onTimeKeydown = this.onTimeKeydown.bind(this);\r\n    this.onTimeClick = this.onTimeClick.bind(this);\r\n    this.onTimeKeydown = this.onTimeKeydown.bind(this);\r\n    this.onFullscreenClick = this.onFullscreenClick.bind(this);\r\n    this.onFullscreenChange = this.onFullscreenChange.bind(this);\r\n\r\n    // add event listeners\r\n    this.$media.addEventListener('canplaythrough', this.onCanPlayStart);\r\n    this.$media.addEventListener('loadstart', this.onLoadStart);\r\n    this.$media.addEventListener('loadeddata', this.onLoadedData);\r\n    this.$media.addEventListener('pause', this.onPlayChange);\r\n    this.$media.addEventListener('play', this.onPlayChange);\r\n    this.$media.addEventListener('timeupdate', this.onTimeChange);\r\n    this.$controls.addEventListener('click', this.onPlayClick, false);\r\n    // this.$play.addEventListener('click', this.onPlayClick, false);\r\n    this.$play.addEventListener('keydown', this.onTimeKeydown);\r\n    this.$time.addEventListener('click', this.onTimeClick, false);\r\n    this.$time.addEventListener('keydown', this.onTimeKeydown);\r\n    this.$fullscreen.addEventListener('click', this.onFullscreenClick, false);\r\n    // listen for fullscreen changes\r\n    document.addEventListener(\r\n      this._fullscreenchange,\r\n      this.onFullscreenChange,\r\n    );\r\n\r\n    // pointer events from time control\r\n    VideoPlayer.onDrag(this.$time, this.$timeRange, (percentage) => {\r\n      this.$media.currentTime = this.duration * Math.max(0, Math.min(1, percentage));\r\n\r\n      this.onTimeChange();\r\n    });\r\n\r\n    this.onLoadStart();\r\n  }\r\n\r\n  static _fullscreenElement() {\r\n    return document.fullscreenElement\r\n    || document.webkitFullscreenElement\r\n    // || document.mozFullScreenElement\r\n    || document.msFullscreenElement;\r\n  }\r\n\r\n  static _exitFullscreen() {\r\n    return document.exitFullscreen\r\n    || document.webkitCancelFullScreen\r\n    // || document.mozCancelFullScreen\r\n    || document.msExitFullscreen;\r\n  }\r\n\r\n  // when the play state changes\r\n  onPlayChange() {\r\n    if (this.paused !== this.$media.paused) {\r\n      this.paused = this.$media.paused;\r\n\r\n      this.$play.setAttribute(\r\n        'aria-label',\r\n        this.paused ? this.lang.play || 'play' : this.lang.pause || 'pause',\r\n      );\r\n      this.target.setAttribute(\r\n        'data-player-state',\r\n        this.paused ? 'paused' : 'playing',\r\n      );\r\n      this.$playSymbol.setAttribute('aria-hidden', !this.paused);\r\n      this.$pauseSymbol.setAttribute('aria-hidden', this.paused);\r\n\r\n      clearInterval(this.interval);\r\n\r\n      if (!this.paused) {\r\n        // listen for time changes every 30th of a second\r\n        this.interval = setInterval(this.onTimeChange, 34);\r\n      }\r\n\r\n      // dispatch new \"playchange\" event\r\n      this.$media.dispatchEvent(mediaEvents.playchange);\r\n    }\r\n  }\r\n\r\n  // when the time changes\r\n  onTimeChange() {\r\n    if (\r\n      this.currentTime !== this.$media.currentTime\r\n      || this.duration !== this.$media.duration\r\n    ) {\r\n      this.currentTime = this.$media.currentTime;\r\n      this.duration = this.$media.duration || 0;\r\n\r\n      const currentTimePercentage = this.currentTime / this.duration;\r\n      // const currentTimeCode = VideoPlayer.timeToTimecode(this.currentTime);\r\n      const currentTimeCode = getSecondsMinutesFormat(this.currentTime);\r\n      // const remainingTimeCode = VideoPlayer.timeToTimecode(\r\n      //   this.duration - Math.floor(this.currentTime),\r\n      // );\r\n\r\n      if (currentTimeCode !== this.$currentTimeText.nodeValue) {\r\n        this.$currentTimeText.nodeValue = currentTimeCode;\r\n\r\n        this.$currentTime.setAttribute(\r\n          'title',\r\n          `${VideoPlayer.timeToAural(\r\n            this.currentTime,\r\n            this.lang.minutes || 'minutes',\r\n            this.lang.seconds || 'seconds',\r\n          )}`,\r\n        );\r\n      }\r\n\r\n      // if (remainingTimeCode !== this.$remainingTimeText.nodeValue) {\r\n      //   this.$remainingTimeText.nodeValue = remainingTimeCode;\r\n\r\n      //   $(this.$remainingTime, {\r\n      //     title: `${VideoPlayer.timeToAural(\r\n      //       this.duration - this.currentTime,\r\n      //       this.lang.minutes || 'minutes',\r\n      //       this.lang.seconds || 'seconds',\r\n      //     )}`,\r\n      //   });\r\n      // }\r\n\r\n      this.$time.setAttribute('aria-valuenow', this.currentTime);\r\n      this.$time.setAttribute('aria-valuemin', 0);\r\n      this.$time.setAttribute('aria-valuemax', this.duration);\r\n\r\n      this.$timeMeter.style.width = `${currentTimePercentage * 100}%`;\r\n\r\n      // dispatch new \"timechange\" event\r\n      this.$media.dispatchEvent(mediaEvents.timechange);\r\n    }\r\n  }\r\n\r\n  // when media loads for the first time\r\n  onLoadStart() {\r\n    this.$media.removeEventListener('canplaythrough', this.onCanPlayStart);\r\n    this.$media.addEventListener('canplaythrough', this.onCanPlayStart);\r\n\r\n    this.onPlayChange();\r\n    this.onFullscreenChange();\r\n    this.onTimeChange();\r\n  }\r\n\r\n  // when the immediate current playback position is available\r\n  onLoadedData() {\r\n    this.onTimeChange();\r\n  }\r\n\r\n  // when the media can play\r\n  onCanPlayStart() {\r\n    this.$media.removeEventListener('canplaythrough', this.nCanPlayStart);\r\n\r\n    // dispatch new \"canplaystart\" event\r\n    this.$media.dispatchEvent(mediaEvents.canplaystart);\r\n\r\n\r\n    if (!this.paused || this.$media.autoplay) {\r\n      this.$media.play();\r\n    }\r\n  }\r\n\r\n  onFullscreenChange() {\r\n    const isFullscreen = this.target === VideoPlayer._fullscreenElement();\r\n\r\n    this.$fullscreen.setAttribute(\r\n      'aria-label',\r\n      isFullscreen\r\n        ? this.lang.leaveFullscreen || 'leave full screen'\r\n        : this.lang.enterFullscreen || 'enter full screen',\r\n    );\r\n    this.$enterFullscreenSymbol.setAttribute('aria-hidden', isFullscreen);\r\n    this.$leaveFullscreenSymbol.setAttribute('aria-hidden', !isFullscreen);\r\n  }\r\n\r\n  // when the play control is clicked\r\n  onPlayClick(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    this.$media[this.$media.paused ? 'play' : 'pause']();\r\n  }\r\n\r\n  // when the time control\r\n  onTimeClick(event) {\r\n    event.stopPropagation();\r\n\r\n    // handle click if clicked without pointer\r\n    if (!event.pointerType && !event.detail) {\r\n      this.onPlayClick(event);\r\n    }\r\n  }\r\n\r\n  // click from fullscreen control\r\n  onFullscreenClick(event) {\r\n    event.stopPropagation();\r\n\r\n    if (this._requestFullscreen) {\r\n      if (this.target === VideoPlayer._fullscreenElement()) {\r\n        // exit fullscreen\r\n        VideoPlayer._exitFullscreen().call(document);\r\n      } else {\r\n        // enter fullscreen\r\n        this._requestFullscreen.call(this.target);\r\n\r\n        // maintain focus in internet explorer\r\n        this.$fullscreen.focus();\r\n\r\n        // maintain focus in safari\r\n        setTimeout(() => {\r\n          this.$fullscreen.focus();\r\n        }, 200);\r\n      }\r\n    } else if (this.$media.webkitSupportsFullscreen) {\r\n      // iOS allows fullscreen of the video itself\r\n      if (this.$media.webkitDisplayingFullscreen) {\r\n        // exit ios fullscreen\r\n        this.$media.webkitExitFullscreen();\r\n      } else {\r\n        // enter ios fullscreen\r\n        this.$media.webkitEnterFullscreen();\r\n      }\r\n\r\n      this.onFullscreenChange();\r\n    }\r\n  }\r\n\r\n  // keydown from play control or current time control\r\n  onTimeKeydown(event) {\r\n    const { keyCode, shiftKey } = event;\r\n\r\n    // 37: LEFT, 38: UP, 39: RIGHT, 40: DOWN\r\n    if (keyCode >= 37 && keyCode <= 40) {\r\n      event.preventDefault();\r\n\r\n      const offset = keyCode === 37 || keyCode === 39 ? keyCode - 38 : keyCode - 39;\r\n\r\n      this.$media.currentTime = Math.max(\r\n        0,\r\n        Math.min(\r\n          this.$media.duration,\r\n          this.$media.currentTime + offset * (shiftKey ? 10 : 1),\r\n        ),\r\n      );\r\n\r\n      this.onTimeChange();\r\n    }\r\n  }\r\n\r\n  // Handle Drag Ranges\r\n  static onDrag(target, innerTarget, listener) {\r\n    // eslint-disable-line max-params\r\n    const hasPointerEvent = undefined !== target.onpointerup;\r\n    const hasTouchEvent = undefined !== target.ontouchstart;\r\n    const pointerDown = hasPointerEvent\r\n      ? 'pointerdown'\r\n      : hasTouchEvent\r\n        ? 'touchstart'\r\n        : 'mousedown';\r\n    const pointerMove = hasPointerEvent\r\n      ? 'pointermove'\r\n      : hasTouchEvent\r\n        ? 'touchmove'\r\n        : 'mousemove';\r\n    const pointerUp = hasPointerEvent\r\n      ? 'pointerup'\r\n      : hasTouchEvent\r\n        ? 'touchend'\r\n        : 'mouseup';\r\n\r\n    // ...\r\n    const axisProp = 'clientX';\r\n\r\n    let window;\r\n    let start;\r\n    let end;\r\n\r\n    function onpointermove(event) {\r\n      // prevent browser actions on this event\r\n      event.preventDefault();\r\n\r\n      // the pointer coordinate\r\n      const position = axisProp in event\r\n        ? event[axisProp]\r\n        : (event.touches && event.touches[0] && event.touches[0][axisProp])\r\n            || 0;\r\n\r\n      // the percentage of the pointer along the container\r\n      const percentage = (position - start) / (end - start);\r\n\r\n      // call the listener with percentage\r\n      listener(percentage);\r\n    }\r\n\r\n    function onpointerdown(event) {\r\n      // window\r\n      window = target.ownerDocument.defaultView;\r\n\r\n      // client boundaries\r\n      const rect = innerTarget.getBoundingClientRect();\r\n\r\n      // the container start and end coordinates\r\n      start = rect.left;\r\n      end = rect.right;\r\n\r\n      onpointermove(event);\r\n\r\n      window.addEventListener(pointerMove, onpointermove);\r\n      window.addEventListener(pointerUp, onpointerup);\r\n    }\r\n\r\n    function onpointerup() {\r\n      window.removeEventListener(pointerMove, onpointermove);\r\n      window.removeEventListener(pointerUp, onpointerup);\r\n    }\r\n\r\n    // on pointer down\r\n    target.addEventListener(pointerDown, onpointerdown);\r\n  }\r\n\r\n  // Time To Timecode\r\n  // DEPRECATED (media.util)\r\n  // static timeToTimecode(time) {\r\n  //   return `${`0${Math.floor(time / 60)}`.slice(-2)}:${`0${Math.floor(\r\n  //     time % 60,\r\n  //   )}`.slice(-2)}`;\r\n  // }\r\n\r\n  // Time To Aural\r\n  // DEPRECATED (media.util)\r\n  static timeToAural(time, langMinutes, langSeconds) {\r\n    return `${Math.floor(time / 60)} ${langMinutes}, ${Math.floor(\r\n      time % 60,\r\n    )} ${langSeconds}`;\r\n  }\r\n}\r\n","/* eslint-disable linebreak-style */\r\nimport Component from './component';\r\nimport { __dispatchEvent } from '../lib/utils';\r\n\r\nexport default class Selectable extends Component {\r\n\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    // TODO: is DOM element before/after the editor itself.. move it to the editor?\r\n    this.$settings = document.querySelector(`[data-selectable-id-reference=\"${this.target.id}\"]`);\r\n\r\n    this.feedback = JSON.parse(this.$settings.getAttribute('data-module-zpetnavazba'));\r\n    this.settings = JSON.parse(this.$settings.getAttribute('data-module-settings'));\r\n\r\n    this.$items = this.target.querySelectorAll('.selectable-item');\r\n\r\n    this.cache = {\r\n      answersCorrect: 0,\r\n      zpetnaVazba: false,\r\n      colors: [],\r\n      checkedInput: 0,\r\n    };\r\n\r\n    this.$inputs = this.target.querySelectorAll('input');\r\n    this.$inputs.forEach(($input) => {\r\n      this._changeClassIfChecked($input);\r\n      this._addEventListeners($input);\r\n    });\r\n\r\n    // get colors for all feedback variants\r\n    if (this.feedback) {\r\n      this.cache.zpetnaVazba = true;\r\n      this.cache.colors = this.feedback.map((feedback) => feedback.barva);\r\n    }\r\n\r\n  }\r\n\r\n  _addEventListeners($input) {\r\n    $input.addEventListener('change', () => {\r\n\r\n      this.$inputs.forEach(($input_) => {\r\n        this._changeClassIfChecked($input_);\r\n      });\r\n\r\n      this._checkAndResolveFeedback();\r\n\r\n      this._dispatchEvent($input);\r\n    }, false);\r\n  }\r\n\r\n  /* eslint class-methods-use-this: [\"error\", { \"exceptMethods\": [\"_changeClassIfChecked\"] }] */\r\n  // TODO: might be possible with CSS only with `:checked` selector & sibling combinator`+` or `~`\r\n  _changeClassIfChecked($input) {\r\n    $input.closest('.selectable-item').classList.toggle('is-checked', $input.checked === true);\r\n  }\r\n\r\n  _checkAndResolveFeedback() {\r\n    this.cache.answersCorrect = 0;\r\n\r\n    if (this.settings.viceOdpovedi) {\r\n      this.$items.forEach(($item, index) => {\r\n        if (this.$inputs[index].checked) {\r\n          this.cache.checkedInput += 1;\r\n        }\r\n        if (this.$inputs[index].checked && $item.hasAttribute('data-select-spravnaodpoved')) {\r\n          this.cache.answersCorrect += 1;\r\n        }\r\n        if (!this.$inputs[index].checked && !$item.hasAttribute('data-select-spravnaodpoved')) {\r\n          this.cache.answersCorrect += 1;\r\n        }\r\n      });\r\n    }\r\n    else {\r\n      this.$items.forEach(($item, index) => {\r\n        if (this.$inputs[index].checked) {\r\n          this.cache.checkedInput += 1;\r\n        }\r\n        if (this.$inputs[index].checked && $item.hasAttribute('data-select-spravnaodpoved')) {\r\n          this.cache.answersCorrect += 1;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Display feedback button (if no checkbox is select, the button is hidden)\r\n    if ((this.cache.checkedInput === 0 && !this.settings.vybrano) || (this.cache.checkedInput === this.$inputs.length && this.settings.vybrano) || this.settings.disableFeedback) {\r\n      this.hideFeedback();\r\n    } else {\r\n\r\n      if (this.cache.zpetnaVazba) {\r\n        const feedbackActual = this.feedback.find((feedback) => feedback.podminka.includes(this.cache.answersCorrect));\r\n        this.$buttonFeedback.classList.remove(...this.cache.colors);\r\n        this.$buttonFeedback.classList.add(feedbackActual.barva);\r\n        this.$buttonFeedbackText.innerText = feedbackActual.text;\r\n      }\r\n\r\n      this.showFeedback();\r\n    }\r\n\r\n    this.target.classList.toggle('has-checked', this.cache.checkedInput > 0);\r\n\r\n    this.cache.checkedInput = 0;\r\n  }\r\n\r\n  _dispatchEvent($input) {\r\n    // const items = Array.from(this.$inputs).map(($input) => ({\r\n    //   checked: $input.checked,\r\n    //   id: $input.id,\r\n    // }));\r\n    const $label = $input.parentNode.querySelector('label');\r\n    let task;\r\n\r\n    if ($input.type === 'radio') {\r\n      task = 'change';\r\n    }\r\n    else if ($input.type === 'checkbox') {\r\n      task = ($input.checked) ? 'select' : 'unselect';\r\n    }\r\n    else {\r\n      console.error('ERROR: Undefinated input type.');\r\n    }\r\n\r\n    __dispatchEvent(this.target, 'selection.change', {}, {\r\n      id: this.target.id,\r\n      task,\r\n      itemId: $input.id,\r\n      itemData: $input.getAttribute('data-selectable-data'),\r\n      $node: $label.firstChild,\r\n    });\r\n  }\r\n}\r\n","/* eslint-disable no-case-declarations */\r\nimport Component from './component';\r\n\r\nexport default class NewTable extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n    // duplicate source of different editor elements\r\n    this.dataFrom = this.target.parentNode.getAttribute('data-from');\r\n    this.dataSources = this.dataFrom ? this.dataFrom.split(' ') : [];\r\n    this.id = $element.getAttribute('id');\r\n    this.cache = {\r\n      tasks: [],\r\n    };\r\n\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    const autofill = this.target.parentNode.getAttribute('data-autofill');\r\n\r\n    switch (autofill) {\r\n      case 'columns':\r\n        this._columnManager();\r\n        break;\r\n      case 'rows':\r\n        this._rowManager();\r\n        break;\r\n      case 'cells':\r\n        const allCells = this.target.querySelectorAll('.table-new__cell');\r\n\r\n        allCells.forEach(($cell) => {\r\n          const columnId = $cell.getAttribute('data-column-id');\r\n          const rowId = $cell.getAttribute('data-row-id');\r\n          // add listener only for cells in table\r\n          if (columnId && rowId) {\r\n            this._cellManager($cell, columnId, rowId);\r\n          }\r\n        });\r\n        break;\r\n      default:\r\n        console.log('NewTableERROR: Undefinated autofill key word!', autofill);\r\n    }\r\n  }\r\n\r\n  _rowManager() {\r\n    document.addEventListener('editor.change', (e) => {\r\n      const data = e.detail.text;\r\n\r\n      if (this.dataSources.includes(data.id)) {\r\n        let $tableRow;\r\n        let rightToAdd = true;\r\n\r\n        // get columns header\r\n        const $header = this.target.previousSibling;\r\n        const $headerCells = $header.firstChild.childNodes;\r\n\r\n        switch (data.task) {\r\n          case 'add':\r\n            $tableRow = document.createElement('div');\r\n            $tableRow.setAttribute('class', 'table-new__row');\r\n\r\n            $headerCells.forEach(($item) => {\r\n              const $rowCell = document.createElement('div');\r\n              $rowCell.setAttribute('class', 'table-new__cell');\r\n              const itemType = JSON.parse($item.getAttribute('data-type'));\r\n\r\n              // check if tagName is definated and than set variable to false\r\n              if (itemType.tagName && itemType.tagName !== data.tagData.tagName) {\r\n                rightToAdd = false;\r\n              }\r\n              else {\r\n                // add data to cell\r\n                this.fillCell(itemType, data, $rowCell);\r\n              }\r\n\r\n              // only add if it is right to add\r\n              if (rightToAdd) $tableRow.appendChild($rowCell);\r\n            });\r\n\r\n            // only add if it is right to add\r\n            if (rightToAdd) this.target.appendChild($tableRow);\r\n            break;\r\n          case 'remove':\r\n            const tableRows = this.target.childNodes;\r\n\r\n            tableRows.forEach(($row) => {\r\n              $row.childNodes.forEach(($cell, index) => {\r\n                const itemType = JSON.parse($headerCells[index].getAttribute('data-type'));\r\n\r\n                if (NewTable.isRightToDeleteHelper($cell, data.value, itemType)) {\r\n                  $tableRow = $row;\r\n\r\n                }\r\n              });\r\n            });\r\n\r\n            // olny if row for remove exists\r\n            if ($tableRow) {\r\n              // remove tasks from cache\r\n              $tableRow.childNodes.forEach(($cell) => {\r\n                this._removeTaskFromCache($cell);\r\n              });\r\n\r\n              $tableRow.remove();\r\n            }\r\n            break;\r\n          default:\r\n            console.log('NewTableERROR: Undefinated task for new table! (rowManager)');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // TODO: adding just specific tags names like in rowManager\r\n  _columnManager() {\r\n    document.addEventListener('editor.change', (e) => {\r\n      const data = e.detail.text;\r\n\r\n      if (this.dataSources.includes(data.id)) {\r\n        const $rows = this.target.childNodes;\r\n\r\n        switch (data.task) {\r\n          case 'add':\r\n            $rows.forEach(($row) => {\r\n              const $cell = document.createElement('div');\r\n              $cell.setAttribute('class', 'table-new__cell');\r\n\r\n              const $firstCell = $row.firstChild;\r\n              const itemType = JSON.parse($firstCell.getAttribute('data-type'));\r\n\r\n              // add data to cell\r\n              this.fillCell(itemType, data, $cell);\r\n\r\n              $row.appendChild($cell);\r\n            });\r\n            break;\r\n          case 'remove':\r\n            let columnIndex;\r\n            $rows.forEach(($row) => {\r\n              const $firstCell = $row.firstChild;\r\n              const itemType = JSON.parse($firstCell.getAttribute('data-type'));\r\n\r\n              $row.childNodes.forEach(($cell, index) => {\r\n                if (NewTable.isRightToDeleteHelper($cell, data.value, itemType)) {\r\n                  columnIndex = index;\r\n                }\r\n              });\r\n            });\r\n\r\n            this.target.childNodes.forEach(($row) => {\r\n              // remove tasks from cache\r\n              this._removeTaskFromCache($row.childNodes[columnIndex]);\r\n\r\n              $row.childNodes[columnIndex].remove();\r\n            });\r\n            break;\r\n          default:\r\n            console.log('NewTableERROR: Undefinated task for new table! (columnManager)');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  _cellManager($cell, columnId, rowId) {\r\n    const itemType = JSON.parse(this._findCellType($cell));\r\n    const cellController = (data) => {\r\n      switch (data.task) {\r\n        case 'add':\r\n          const $tag = document.createElement('div');\r\n          this.fillCell(itemType, data, $cell);\r\n\r\n          $cell.appendChild($tag);\r\n          break;\r\n        case 'remove':\r\n          const $tags = $cell.querySelectorAll('div');\r\n          let removed = false;\r\n          for (let i = 0; i < $tags.length; i += 1) {\r\n            if (!removed && NewTable.isRightToDeleteHelper($tags[i], data.value, itemType)) {\r\n              // TODO: remove only childrens of $elm => empty div is still there\r\n              $tags[i].remove();\r\n              removed = true;\r\n            }\r\n          }\r\n          break;\r\n        default:\r\n          console.log('NewTableERROR: Undefinated task for new table! (cellManager)');\r\n      }\r\n    };\r\n\r\n    document.addEventListener('editor.change', (e) => {\r\n      const data = e.detail.text;\r\n\r\n      if (this.dataSources.includes(data.id) && (data.tagData.tagName === rowId || data.tagData.tagName === columnId)) {\r\n\r\n        if (!itemType.textId || itemType.textId === data.id) {\r\n          cellController(data);\r\n        }\r\n      }\r\n    });\r\n    document.addEventListener('draggable.drop', (e) => {\r\n      const data = e.detail;\r\n\r\n      if (this.dataSources.includes(data.id) && e.detail.columnId === columnId) {\r\n        // get text\r\n        const $span = data.$node.querySelector('span').cloneNode(true);\r\n        $span.classList.add('node-selected', 'node-text-gray');\r\n        $span.setAttribute('data-by', 'table-drop');\r\n\r\n        cellController({ task: data.task, value: $span });\r\n      }\r\n    });\r\n  }\r\n\r\n  fillCell(itemType, data, $node) {\r\n    let $innerItem;\r\n    let cacheObj;\r\n\r\n    // seed init or generate\r\n    let seed = 0;\r\n    if (this.cache.tasks.length > 0) {\r\n      const lastId = this.cache.tasks[this.cache.tasks.length - 1].id;\r\n      const idParts = lastId.split('-');\r\n      seed = +idParts[idParts.length - 1] + 1;\r\n    }\r\n\r\n    $node.classList.add(`table-new__cell--${itemType.name}`, `table-new__cell--${itemType.type}`);\r\n\r\n    switch (itemType.name) {\r\n      case 'dup-text':\r\n        $innerItem = document.createElement('div');\r\n        if (itemType.type === 'text') {\r\n          $innerItem.innerHTML = data.value.textContent;\r\n        }\r\n        else if (itemType.type === 'tag') {\r\n          // have to by clone, because if not it will by duplicatet do more tables it will be just in last one\r\n          $innerItem.appendChild(data.value.cloneNode(true));\r\n        }\r\n        break;\r\n      case 'select':\r\n        // create task in cache\r\n        cacheObj = { id: `${this.id}-select-${seed}`, answer: '', rightAnswer: data.tagData };\r\n        this.cache.tasks.push(cacheObj);\r\n\r\n        // create node in html\r\n        $innerItem = document.createElement(itemType.name);\r\n\r\n        $innerItem.setAttribute('id', cacheObj.id);\r\n        $innerItem.setAttribute('data-save', 'value');\r\n        $innerItem.setAttribute('tabindex', -1);\r\n\r\n        itemType.options.forEach((value) => {\r\n          const $option = document.createElement('option');\r\n          $option.innerHTML = value;\r\n          $innerItem.appendChild($option);\r\n        });\r\n\r\n        // add event listener\r\n        $innerItem.addEventListener('change', (event) => this._correctedAnswer(event, cacheObj));\r\n        break;\r\n      case 'input':\r\n      case 'textarea':\r\n        // create task in cache\r\n        cacheObj = { id: `${this.id}-input-${seed}`, answer: '', rightAnswer: data.tagData };\r\n        this.cache.tasks.push(cacheObj);\r\n\r\n        // create node in html\r\n        $innerItem = document.createElement(itemType.name);\r\n\r\n        $innerItem.setAttribute('id', cacheObj.id);\r\n        $innerItem.setAttribute('data-save', 'value');\r\n        $innerItem.setAttribute('tabindex', -1);\r\n\r\n        if (itemType.name === 'textarea') {\r\n          $innerItem.setAttribute('resize', cacheObj.id);\r\n        }\r\n\r\n        Object.keys(itemType.attributes).forEach((key) => {\r\n          $innerItem.setAttribute(key, itemType.attributes[key]);\r\n        });\r\n\r\n        // add event listener\r\n        $innerItem.addEventListener('change', (event) => this._correctedAnswer(event, cacheObj));\r\n        break;\r\n      case 'drop':\r\n        $innerItem = document.createElement('div');\r\n        const numberOfDrops = itemType.number ? itemType.number : -1;\r\n        // set attribute for draggable logic\r\n        $innerItem.setAttribute('data-drop-place', numberOfDrops);\r\n        break;\r\n      default:\r\n        $innerItem = document.createElement('div');\r\n        /*\r\n          if item Type name is value of data object from delivered cviceni feature\r\n          then use it and it's value set in table\r\n          else set empry value and show error\r\n       */\r\n        if (data.tagData[itemType.name]) {\r\n          $innerItem.innerHTML = data.tagData[itemType.name];\r\n        }\r\n        else {\r\n          $innerItem.innerHTML = ' ';\r\n          console.log('FillCellERROR: Undefinated object name.', itemType);\r\n        }\r\n    }\r\n    $node.appendChild($innerItem);\r\n  }\r\n\r\n  // prepare for more types of duplicate types\r\n  static isRightToDeleteHelper(elm, deliveredValue, itemType) {\r\n    let result;\r\n    if (itemType.name === 'dup-text') {\r\n      result = elm.textContent === deliveredValue.textContent;\r\n    } // different type then dup-text hasn't duplicate option\r\n    else {\r\n      result = false;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  _findCellType($cell) {\r\n    const rowType = $cell.parentNode.firstChild.getAttribute('data-type');\r\n    if (rowType) return rowType;\r\n\r\n    // if rows header isn´t definated\r\n    const columnId = $cell.getAttribute('data-column-id');\r\n    const $columnHeader = this.target.parentNode.querySelector(`.table-new__cell--header[data-column-id=${columnId}]`);\r\n    if ($columnHeader) return $columnHeader.getAttribute('data-type');\r\n\r\n    return 'empty';\r\n  }\r\n\r\n  _correctedAnswer(event, cacheObj) {\r\n    this.cache.tasks.forEach((task) => {\r\n      if (task.id === cacheObj.id) {\r\n        task.answer = event.target.value;\r\n      }\r\n    });\r\n\r\n    // console.log('select change', this.cache);\r\n  }\r\n\r\n  _removeTaskFromCache($cell) {\r\n    this.cache.tasks.forEach((task, index) => {\r\n      if ($cell.firstChild.tagName === 'SELECT' || $cell.firstChild.tagName === 'INPUT' || $cell.firstChild.tagName === 'TEXTAREA') {\r\n        if ($cell.firstChild.id === task.id) {\r\n          this.cache.tasks.splice(index, 1);\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n","import Component from './component';\nimport { __dispatchEvent, __localPosition, __offSetForTouchEvent } from '../lib/utils';\n\nexport default class Draggable extends Component {\n  constructor($element) {\n    super($element);\n\n    this.idPrefix = 'drag-item';\n    // duplicate source of different editor elements\n    this.dataFrom = this.target.getAttribute('data-from');\n    this.dataSources = this.dataFrom ? this.dataFrom.split(' ') : [];\n\n    this.position = {\n      x: 0,\n      y: 0,\n      dx: 0,\n      dy: 0,\n    };\n    this.cache = {\n      // to know if draggable item was dropped or not and how many times\n      items: {},\n    };\n\n    this.$targetPrevious = null;\n    this.$targetCurrent = null;\n    this.$draggedItem = null;\n\n    this.objWidth = null;\n    this.objHeight = null;\n\n    this.lastEvent = null;\n\n    this.init();\n  }\n\n  init() {\n    const $dragItems = this.target.querySelectorAll('.draggable__item');\n    $dragItems.forEach(($dragItem) => {\n      // get id\n      const id = $dragItem.getAttribute('data-id');\n      // inicial drop numbers\n      this.cache.items[id] = 0;\n      // use d3 container for $dragItem\n      this.dragAndDropEvents(d3.select($dragItem), id);\n    });\n\n    // initial handler for dropped item to svg\n    this.handleDeleteItemFromSvgDrop();\n\n    // initial handler for adding tags from text\n    this.handleAddTagsFromText();\n  }\n\n  // dropToken is used for handle usecase when user drag from drop-place to drop-place\n  dragAndDropEvents($dragItem, itemId, dropToken = true) {\n    // drag & drop\n    $dragItem.call(d3.drag()\n      .container(this.$slide)\n      .on('start', (event) => { this.onStart(event, $dragItem); })\n      .on('drag', (event) => { this.onDrag(event, $dragItem); })\n      .on('end', (event) => { this.onDrop(event, $dragItem, itemId, dropToken); }));\n  }\n\n  onStart(event, $dragItem) {\n    this.$slide.classList.add('is-dragging');\n\n    this.$targetPrevious = event.sourceEvent.target;\n\n    // in this method is better to have classic html node\n    const $dragItemHTML = $dragItem.node();\n\n    // initial position\n    this.objWidth = $dragItemHTML.offsetWidth;\n    this.objHeight = $dragItemHTML.offsetHeight;\n    this.position.dx = 0;\n    this.position.dy = 0;\n\n    // touch event dont have clientX directly in event but in array of touches\n    if (event.sourceEvent.clientX) {\n      this.position.x = event.sourceEvent.clientX - event.sourceEvent.offsetX;\n      this.position.y = event.sourceEvent.clientY - event.sourceEvent.offsetY;\n    } // for touches optimize\n    else {\n      const position = __localPosition(event, $dragItem);\n      const offset = __offSetForTouchEvent(event.sourceEvent);\n      this.position.x = position.x - offset.x;\n      this.position.y = position.y - offset.y;\n    }\n\n    // get dragged node\n    // clone element if from DRAG place\n    if ($dragItemHTML.parentNode.hasAttribute('data-drag-place')) {\n      this.$draggedItem = $dragItemHTML.cloneNode(true);\n    }\n    // do not clone if from DROP place\n    else {\n      this.$draggedItem = $dragItemHTML;\n\n      // get table data\n      const $table = $dragItemHTML.closest('.table-new__body');\n      const $cell = $dragItemHTML.closest('.table-new__cell');\n      const columnId = $cell.getAttribute('data-column-id');\n\n      // dispatch event that item has been removed from drop place\n      __dispatchEvent(document, 'draggable.drop', {}, {\n        id: $table.id,\n        task: 'remove',\n        columnId,\n        // type: itemType,\n        $node: $dragItemHTML,\n      });\n    }\n\n    // add to body\n    document.body.appendChild(this.$draggedItem);\n    // convert back to d3 container\n    this.$draggedItem = d3.select(this.$draggedItem);\n\n    this.$draggedItem\n      .classed('is-dragged', true)\n      .classed('was-dropped', false)\n      .attr('style', `top:${this.position.y}px; left:${this.position.x}px;`);\n\n    // touchend doesnt have coordinates\n    this.lastEvent = event.sourceEvent;\n  }\n\n  onDrag(event, $dragItem) {\n    // touchend doesnt have coordinates\n    this.lastEvent = event.sourceEvent;\n    // console.log($dragItem.node());\n    // update position\n    this.position.dx += event.dx;\n    this.position.dy += event.dy;\n\n    // move with dragging element\n    this.$draggedItem.style('transform', `translate3d(${this.position.dx}px, ${this.position.dy}px, 0) rotate(5deg)`);\n\n    this.$targetCurrent = event.sourceEvent.target;\n    // check for make placeholder in drop place\n    if (this.$targetPrevious !== this.$targetCurrent) {\n\n      // remove placeholder in old target\n      const $placeholderOld = this.$targetPrevious.querySelector('.draggable__item--placeholder');\n      if ($placeholderOld) $placeholderOld.remove();\n\n      // create placeholder in new target\n      if (this.$targetCurrent.hasAttribute('data-drop-place')) {\n        const numberOfPossibleDrops = this.$targetCurrent.getAttribute('data-drop-place');\n        const numberOfDropsDone = this.$targetCurrent.childElementCount;\n\n        // console.log('ondrag', numberOfDropsDone);\n\n        if (numberOfPossibleDrops === '-1' || +numberOfPossibleDrops > numberOfDropsDone) {\n          // remove this class is important for creating placeholder from dragging item from drop place\n          const $placeholderNew = $dragItem.clone(true)\n            .classed('is-dragged', false)\n            .classed('draggable__item--placeholder', true)\n            .attr('style', 'outline: 0px;')\n            .node();\n\n          this.$targetCurrent.appendChild($placeholderNew);\n        }\n      }\n\n      // update target\n      this.$targetPrevious = this.$targetCurrent;\n    }\n  }\n\n  onDrop(event, $dragItem, itemId, dropToken) {\n    if (this.lastEvent.touches) {\n      const coords = this.lastEvent.touches[0];\n      this.$targetCurrent = document.elementFromPoint(coords.clientX, coords.clientY);\n    }\n    else {\n      this.$targetCurrent = event.sourceEvent.target;\n    }\n\n    // when dropping within droppable normal DOM node\n    if (this.$targetCurrent.hasAttribute('data-drop-place')) {\n\n      // get placeholder\n      let $dropItem = this.$targetCurrent.querySelector('.draggable__item--placeholder');\n\n      if ($dropItem) {\n        const itemType = $dropItem.getAttribute('data-draggable-item');\n\n        // remove unneeded classes for dropItem\n        $dropItem.classList.remove('draggable__item--placeholder', 'was-dropped');\n        $dropItem.classList.add('dropped__item');\n\n        // update drops num\n        if (dropToken) {\n          $dragItem.classed('was-dropped', true);\n          this.cache.items[itemId] += 1;\n        }\n\n        if (itemType === 'svg') {\n          const $fullScreenIcon = $dropItem.querySelector('[data-fullscreen=\"toggle\"]');\n          // replaced svg don't have full screen icon\n          if ($fullScreenIcon) {\n            $fullScreenIcon.remove();\n          }\n        }\n        else {\n          // add cross for remove item\n          const $rightElmChild = $dropItem.firstElementChild;\n          const $cross = document.createElement('span');\n          $cross.classList.add('node-close');\n          $cross.innerText = '×';\n\n          // remove svg from frop item\n          $rightElmChild.removeChild($rightElmChild.lastElementChild);\n          $rightElmChild.appendChild($cross);\n\n          // remove item after click on cross\n          $cross.addEventListener('click', () => {\n            this.removeDraggableItem($dropItem, itemId, dropToken);\n          });\n        }\n\n        // add events to clone for posible dragging back\n        // dropItem has to by in d3 container\n        this.dragAndDropEvents(d3.select($dropItem), itemId, false);\n      } // only click on drop item\n      else {\n        $dropItem = $dragItem.clone(true)\n          .classed('is-dragged', false)\n          .attr('style', 'outline: 0px;')\n          .node();\n\n        this.$targetCurrent.appendChild($dropItem);\n\n        // add events to clone for posible dragging back\n        // dropItem has to by in d3 container\n        this.dragAndDropEvents(d3.select($dropItem), itemId, false);\n      }\n\n      // get table data\n      const $table = this.$targetCurrent.closest('.table-new__body');\n      const $cell = this.$targetCurrent.closest('.table-new__cell');\n      const columnId = $cell.getAttribute('data-column-id');\n\n      // dispatch event that item has been dropped\n      __dispatchEvent(document, 'draggable.drop', {}, {\n        id: $table.id,\n        task: 'add',\n        columnId,\n        // type: itemType,\n        $node: $dropItem,\n      });\n\n      // remove draggedItem from DOM\n      this.$draggedItem.remove();\n    }\n    // when dropping within SVG\n    else {\n      // get svg\n      const $svg = this.$targetCurrent.closest('svg');\n      // check drop attribute\n      const svgCanDrop = $svg ? $svg.hasAttribute('data-svg-drop') : false;\n\n      // when dropping within droppable svg node\n      if (svgCanDrop) {\n        const position = __localPosition(this.lastEvent, $svg);\n        const $node = this.$draggedItem.classed('is-dragged', false)\n          .attr('style', 'outline: 0px;')\n          .node();\n\n        // update drops num\n        $dragItem.classed('was-dropped', true);\n        this.cache.items[itemId] += 1;\n\n        // add to svg\n        // dispatch event that svg has changed\n        __dispatchEvent(document, 'svg.drop', {}, {\n          svg: {\n            id: $svg.id,\n            $node,\n            type: $node.getAttribute('data-draggable-item'),\n            position,\n            size: {\n              width: this.objWidth,\n              height: this.objHeight,\n            },\n          },\n        });\n\n        this.$draggedItem.remove();\n\n      }\n      // when dropping outside of droppable area\n      else {\n        // if it's last drop then remove drop class\n        this.removeDraggableItem(this.$draggedItem, itemId, dropToken);\n      }\n\n    }\n\n    this.$slide.classList.remove('is-dragging');\n  }\n\n  handleDeleteItemFromSvgDrop() {\n\n    document.addEventListener('svg.drop.delete', (event) => {\n      const { slideId, id, $object } = event.detail.item;\n\n      // console.log('smazano', id, $object);\n      const $sameItemFromDragPlace = this.target.querySelector(`div[data-id=${id}]`);\n\n      if ($sameItemFromDragPlace && this.$slide.id === slideId) {\n        // if it's last drop then remove drop class\n        if (this.cache.items[id] === 1) {\n          $sameItemFromDragPlace.classList.remove('was-dropped');\n        }\n\n        // update drop number of concrete item\n        this.cache.items[id] -= 1;\n      }\n    });\n  }\n\n  handleAddTagsFromText() {\n    // need if we drop more than one same item\n    let idSalt = 1;\n\n    document.addEventListener('editor.change', (e) => {\n      const data = e.detail.text;\n      const concreteTagName = this.target.getAttribute('data-tagName');\n\n      // if concreteTagName\n      if (this.dataSources.includes(data.id) && (!concreteTagName || concreteTagName === data.tagData.tagName)) {\n        let $newDaggabletItem;\n        let $tagTextSpan;\n        let textToAdd;\n        let newId;\n        let idParts;\n\n        switch (data.task) {\n          case 'add':\n            // clone hidden tag\n            $newDaggabletItem = this.target.firstElementChild.cloneNode(true);\n            $newDaggabletItem.classList.remove('hidden');\n\n            // find place where to add tags text\n            $tagTextSpan = $newDaggabletItem.querySelector('.keywords-item');\n\n            // get right text to add\n            textToAdd = data.value.textContent;\n            if (textToAdd[textToAdd.length - 1] === '×') {\n              textToAdd = textToAdd.slice(0, -1);\n            }\n\n            // add text\n            $tagTextSpan.firstElementChild.innerHTML = textToAdd;\n\n            // add color to draggable item\n            $newDaggabletItem.firstElementChild.classList.add(`node-text-${data.tagColor}`);\n            $tagTextSpan.classList.add(`node-text-${data.tagColor}`);\n\n            // create new id\n            newId = $newDaggabletItem.getAttribute('data-id');\n            idParts = newId.split('-');\n            idParts.splice(-1, 1, `dup-${idSalt}`);\n            newId = idParts.join('-');\n\n            // set new id\n            $newDaggabletItem.setAttribute('data-id', newId);\n\n            // add to cache\n            this.cache.items[newId] = 0;\n\n            idSalt += 1;\n            this.target.appendChild($newDaggabletItem);\n\n            // add listeners for drag'n'drop\n            this.dragAndDropEvents(d3.select($newDaggabletItem), newId);\n            break;\n          case 'remove':\n            this.target.childNodes.forEach(($cell) => {\n              if (Draggable.isRightToDeleteHelper($cell, data.value, $cell.getAttribute('data-draggable-item'))) {\n                $cell.remove();\n              }\n            });\n            break;\n          default:\n            console.log('NewTableERROR: Undefinated task for new table! (cellManager)');\n        }\n      }\n    });\n  }\n\n  removeDraggableItem($draggedItem, itemId, dropToken) {\n    // if it's last drop then remove drop class\n    if (this.cache.items[itemId] === 1) {\n      const $sameItemFromDragPlace = this.target.querySelector(`div[data-id=${itemId}]`);\n      $sameItemFromDragPlace.classList.remove('was-dropped');\n    }\n\n    // update drop number of concrete item\n    if (!dropToken) {\n      this.cache.items[itemId] -= 1;\n    }\n\n    // remove draggedItem from DOM\n    $draggedItem.remove();\n  }\n\n  // prepare for more types of duplicate types\n  static isRightToDeleteHelper(elm, deliveredValue, itemType) {\n    // fix for tags\n    // table div textContent include '×' as last char\n    // because it is in self span\n    let elemTextContent;\n    if (itemType === 'tag' && elm.textContent[elm.textContent.length - 1] === '×') {\n      elemTextContent = elm.textContent.slice(0, -1);\n    }\n    else {\n      elemTextContent = elm.textContent;\n    }\n    return elemTextContent === deliveredValue.textContent;\n  }\n}\n","import Component from './component';\r\nimport AudioPlayer from './media/audio-player';\r\n\r\nexport default class Gallery extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    // select all right gallery items\r\n    const $selectableItemss = this.target.querySelectorAll('.selected-item');\r\n    const $dupItems = this.target.querySelectorAll('[data-duplicate]');\r\n\r\n    // set events for all found items\r\n    $selectableItemss.forEach(($item) => Gallery.setSelectEvents($item));\r\n    $dupItems.forEach(($item) => Gallery.setTextEvents($item));\r\n\r\n    console.log(this.target, $dupItems);\r\n  }\r\n\r\n  static setSelectEvents($item) {\r\n    const selectedId = $item.id;\r\n    const $placeholder = $item.querySelector('.selected-item__placeholder');\r\n\r\n    document.addEventListener('selection.change', (e) => {\r\n      if (selectedId === e.detail.id) {\r\n        const data = e.detail;\r\n        const idTail = '-duplicated';\r\n\r\n        switch (data.task) {\r\n          // singlechoice\r\n          case 'change':\r\n            Gallery.removeItemFromSelect($item);\r\n            Gallery.addItemFromSelect($item, idTail, data);\r\n            break;\r\n\r\n          // multichoice\r\n          case 'select':\r\n            // hide placeholder\r\n            $placeholder.classList.add('is-hidden');\r\n\r\n            Gallery.addItemFromSelect($item, idTail, data);\r\n            break;\r\n\r\n          case 'unselect':\r\n            Gallery.removeItemFromSelect($item, data.itemId + idTail);\r\n\r\n            // show placeholder if its have to\r\n            if ($item.childElementCount === 1) {\r\n              $placeholder.classList.remove('is-hidden');\r\n            }\r\n            break;\r\n\r\n          default:\r\n            console.error('ERROR: Undefinated task type.');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  static setTextEvents($item) {\r\n    const acceptedId = $item.getAttribute('data-duplicate');\r\n    const textDuplicateSources = acceptedId ? acceptedId.split(' ') : [];\r\n\r\n    document.addEventListener('text.change', (e) => {\r\n      const data = e.detail.text;\r\n\r\n      if (textDuplicateSources.includes(data.id)) {\r\n        switch (data.task) {\r\n          case 'create':\r\n          case 'change':\r\n            // TODO: More inputs to one output\r\n            $item.innerHTML = data.text;\r\n            break;\r\n          default:\r\n            console.log('Nondefinated text events task. :(');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  static addItemFromSelect($item, idTail, data) {\r\n    const $dupNode = data.$node.cloneNode(true);\r\n    $dupNode.setAttribute('data-id', data.itemId + idTail);\r\n\r\n    // add listeners to audio\r\n    if ($dupNode.hasAttribute('data-player-audio')) {\r\n      AudioPlayer.addEventListeners($dupNode, () => {});\r\n    }\r\n\r\n    $item.appendChild($dupNode);\r\n  }\r\n\r\n  static removeItemFromSelect($item, dataId = undefined) {\r\n    if (dataId) {\r\n      const $dupNode = $item.querySelector(`[data-id=${dataId}]`);\r\n      $dupNode.remove();\r\n    }\r\n    else {\r\n      $item.firstChild.remove();\r\n    }\r\n  }\r\n}\r\n","/* eslint-disable no-unused-vars */\r\nimport MagnifyingGlass from './magnifying-glass';\r\nimport Sortable from './sortable';\r\nimport SVG from './svg';\r\nimport SVGRadialMenu from './svg-lib/svg-radial-menu';\r\nimport Editor from './editor/editor';\r\nimport Keywords from './keywords';\r\nimport TestQuiz from './test-quiz';\r\nimport FullscreenToggle from './fullscreen';\r\nimport UserText from './user-text';\r\nimport AudioPlayerNormal from './media/audio-player-normal';\r\nimport AudioPlayerSimple from './media/audio-player-simple';\r\nimport FakeMap from './fake-map';\r\nimport { stopPlayingVideoPlayers } from './media/media';\r\nimport VideoPlayer from './media/video';\r\nimport Selectable from './selectable';\r\nimport NewTable from './new-table';\r\nimport Draggable from './draggable';\r\nimport Gallery from './gallery';\r\n\r\nconst windowLoadComponents = () => {\r\n  console.log('windowLoad:components');\r\n\r\n  // Video player - normal\r\n  const $videoPlayers = document.querySelectorAll('[data-player-video]');\r\n  if ($videoPlayers.length > 0) {\r\n    $videoPlayers.forEach(($videoPlayer) => {\r\n      // console.log('$videoPlayer', $videoPlayer);\r\n      const videoPlayer = new VideoPlayer($videoPlayer);\r\n    });\r\n\r\n    document.addEventListener('slide.change', () => {\r\n      stopPlayingVideoPlayers($videoPlayers);\r\n    });\r\n  }\r\n\r\n  // Audio player - normal\r\n  const $audioPlayerNormals = document.querySelectorAll('[data-player-audio=\"normal\"]');\r\n  if ($audioPlayerNormals.length > 0) {\r\n    $audioPlayerNormals.forEach(($audioPlayerNormal) => {\r\n      const audioPlayerNormal = new AudioPlayerNormal($audioPlayerNormal);\r\n    });\r\n\r\n    // TODO > audio-player-normal.js#61\r\n    // document.addEventListener('slide.change', () => {\r\n    //   stopPlayingVideoPlayers($audioPlayerNormals);\r\n    // });\r\n  }\r\n\r\n  // Audio player — simple\r\n  const $audioPlayerSimples = document.querySelectorAll('[data-player-audio=\"simple\"]');\r\n  if ($audioPlayerSimples.length > 0) {\r\n    $audioPlayerSimples.forEach(($audioPlayerSimple) => {\r\n      const audioPlayerSimple = new AudioPlayerSimple($audioPlayerSimple);\r\n    });\r\n\r\n    document.addEventListener('slide.change', () => {\r\n      stopPlayingVideoPlayers($audioPlayerSimples);\r\n    });\r\n  }\r\n\r\n  // Fullscreen\r\n  const $fullscreenToggles = document.querySelectorAll('[data-fullscreen=\"toggle\"]');\r\n  if ($fullscreenToggles.length > 0) {\r\n    $fullscreenToggles.forEach(($fullscreenToggle) => {\r\n      const fullscreenToggle = new FullscreenToggle($fullscreenToggle);\r\n    });\r\n  }\r\n\r\n  // Magnifying glass\r\n  const $magnifyingGlass = document.querySelectorAll('[data-lupa-target]');\r\n  if ($magnifyingGlass.length > 0) {\r\n    for (let i = 0; i < $magnifyingGlass.length; i += 1) {\r\n      const magnifyingGlass = new MagnifyingGlass($magnifyingGlass[i]);\r\n    }\r\n  }\r\n\r\n  // Fake Map\r\n  const $fakeMaps = document.querySelectorAll('[data-fake-map=\"target\"]');\r\n  if ($fakeMaps.length > 0) {\r\n    for (let i = 0; i < $fakeMaps.length; i += 1) {\r\n      const fakeMap = new FakeMap($fakeMaps[i]);\r\n    }\r\n  }\r\n\r\n  //\r\n  // load these below in working mode only\r\n\r\n  // User texts\r\n  // - preview/working mode logic inside the component\r\n  //  - show\r\n  const $userTexts = document.querySelectorAll('[data-textarea-target=\"\"]');\r\n  if ($userTexts.length > 0) {\r\n    $userTexts.forEach(($userText) => {\r\n      const userText = new UserText($userText);\r\n    });\r\n  }\r\n\r\n  // SVG + Radial menu\r\n  // - preview/working mode logic in side the component\r\n  //  - to set max-width\r\n  const $svgs = document.querySelectorAll('[data-svg-target]');\r\n  if ($svgs.length > 0) {\r\n\r\n    if (HISTORYLAB.import.done !== true) {\r\n      // radial menu\r\n      const $radialMenu = document.querySelector('[data-radial-menu]');\r\n      if ($radialMenu) {\r\n        const radialMenu = new SVGRadialMenu($radialMenu, $svgs);\r\n      }\r\n    }\r\n\r\n    // svgs\r\n    // setSize is needed\r\n    $svgs.forEach(($svg) => {\r\n      const svg = new SVG($svg);\r\n    });\r\n  }\r\n\r\n  // Editor\r\n  const $editors = document.querySelectorAll('[data-editor]');\r\n  if ($editors.length > 0) {\r\n    $editors.forEach(($editor) => {\r\n      const editor = new Editor($editor);\r\n      // important for getting data from editor\r\n      // each editor has to be add to list of cviceni tools\r\n      // editor id must to be unique\r\n      HISTORYLAB.tools[editor.id] = editor;\r\n    });\r\n  }\r\n\r\n  if (HISTORYLAB.import.done !== true) {\r\n    // Test Quizes\r\n    const $testQuizs = document.querySelectorAll('[data-target-test-quiz]');\r\n    if ($testQuizs.length > 0) {\r\n      $testQuizs.forEach(($testQuiz) => {\r\n        const settings = document.querySelector(\r\n          `[data-test-quiz-id-reference=\"${$testQuiz.getAttribute(\r\n            'data-test-quiz-id',\r\n          )}\"]`,\r\n        );\r\n\r\n        const testQuiz = new TestQuiz(\r\n          $testQuiz.getAttribute('data-test-quiz-id'),\r\n          $testQuiz,\r\n          JSON.parse(settings.getAttribute('data-module-settings')),\r\n        );\r\n        testQuiz.init();\r\n      });\r\n    }\r\n\r\n    // New table\r\n    const $newTables = document.querySelectorAll('[data-new-table]');\r\n    if ($newTables.length > 0) {\r\n      $newTables.forEach(($newTable) => {\r\n        const newTable = new NewTable($newTable);\r\n      });\r\n    }\r\n\r\n    // Pretahovani\r\n    const $draggables = document.querySelectorAll('[data-draggable]');\r\n    if ($draggables.length > 0) {\r\n      $draggables.forEach(($draggable) => {\r\n        const draggable = new Draggable($draggable);\r\n      });\r\n    }\r\n\r\n    // Sortable\r\n    const $sortables = document.querySelectorAll('[data-sortable-target]');\r\n    if ($sortables.length > 0) {\r\n      $sortables.forEach(($sortable) => {\r\n        const sortable = new Sortable($sortable);\r\n      });\r\n    }\r\n\r\n    // Selectable\r\n    const $selectables = document.querySelectorAll('[data-selectable-target]');\r\n    if ($selectables.length > 0) {\r\n      $selectables.forEach(($selectable) => {\r\n        const selectable = new Selectable($selectable);\r\n      });\r\n    }\r\n\r\n    // Keywords selection\r\n    const $keywords = document.querySelectorAll('[data-keywords]');\r\n    if ($keywords.length > 0) {\r\n      $keywords.forEach(($keyword) => {\r\n        const settings = $keyword.hasAttribute('data-module-settings')\r\n          ? $keyword.getAttribute('data-module-settings')\r\n          : {};\r\n        const keywords = new Keywords($keyword, JSON.parse(settings));\r\n        keywords.init();\r\n      });\r\n    }\r\n\r\n    // Gallery listener\r\n    const $galleries = document.querySelectorAll('[data-gallery]');\r\n    if ($galleries.length > 0) {\r\n      $galleries.forEach(($gallery) => {\r\n        const gallery = new Gallery($gallery);\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\nexport default windowLoadComponents;\r\n","/* eslint-disable consistent-return */\r\nimport domLoadComponents from './dom-load';\r\nimport windowLoadComponents from './window-load';\r\nimport unsupportedBrowsers from '../lib/unsupported-browsers';\r\n\r\n(() => {\r\n  if (unsupportedBrowsers()) return false;\r\n\r\n  // The DOMContentLoaded event fires when parsing of the current page is complete. DOMContentLoaded is a great event to use to hookup UI functionality to complex web pages.\r\n  document.addEventListener('DOMContentLoaded', domLoadComponents, false);\r\n\r\n  // The load event fires when all files have finished loading from all resources, including ads and images.\r\n  window.addEventListener('load', windowLoadComponents, false);\r\n})();\r\n","const unsupportedBrowsers = () => {\r\n\r\n  // feature detection for unsupported browsers\r\n  const isUnsupported = !Array.from\r\n    || !Element.prototype.matches\r\n    || !Element.prototype.closest\r\n    || typeof window.CustomEvent !== 'function'\r\n    || typeof Object.assign !== 'function';\r\n\r\n  if (isUnsupported) {\r\n    console.warn('Not supported browser.');\r\n\r\n    const $unsupported = document.querySelector('#unsupported');\r\n    $unsupported.querySelector('#unsupported-browser').innerHTML = ` ${platform.name} ${platform.version} `;\r\n    $unsupported.classList.remove('is-hidden');\r\n\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport default unsupportedBrowsers;\r\n"],"names":["domLoadComponents","console","log","Component","$element","_classCallCheck","this","target","$slide","closest","lang","document","documentElement","getAttribute","HISTORYLAB","done","$buttonFeedback","querySelector","$buttonFeedbackText","showFeedback","bind","classList","contains","remove","add","MagnifyingGlass","_this","$canvas","ctx","getContext","_onStart","_assertThisInitialized","_onMove","_onEnd","_update","_onResize","zoomGlassSize","targetBCR","zoomed","targetZoomed","x","y","trackingTouch","displayStyle","_addEventListeners","_initCanvas","window","requestAnimationFrame","width","height","dPR","devicePixelRation","style","scale","getBoundingClientRect","value","event","getComputedStyle","display","preventDefault","pageX","touches","pageY","TAU","Math","PI","radius","ratioX","max","min","left","ratioY","top","scaledTargetWidth","scaledTargetHeight","platform","os","family","indexOf","name","shadowColor","shadowBlur","shadowOffsetY","clearRect","fillStyle","beginPath","arc","closePath","fill","save","clip","drawImage","restore","_setTransformStyle","addEventListener","betterX","betterY","halfYoomGlassSize","abs","innerWidth","transform","__createNewCustomEvent","options","data","defaults","bubbles","properties","Object","assign","CustomEvent","_objectSpread","detail","__dispatchEvent","type","payload","dispatchEvent","__globalPosition","__localPosition","container","position","offsetX","offsetY","d3","pointer","_slicedToArray","pointers","format","__toggleClass","element","cls","__hasClass","__removeClass","__addClass","concat","className","elements","classes","_elements","_classes","querySelectorAll","tagName","split","i","length","_elements$i$classList","apply","_toConsumableArray","j","_elements$i$classList2","replace","RegExp","mediaEvents","playchange","timechange","canplaystart","stopPlayingVideoPlayers","$players","forEach","$player","$media","paused","pause","setAttribute","getSecondsMinutesFormat","seconds","duration","floor","minutes","toString","slice","AudioPlayer","_super","call","$item","$audio","$playButton","$timeLeft","play","stopPropagation","innerText","currentTime","SVGDragNDrop","select","raise","classed","diff","$node","_this$getJustifiedCor2","getJustifiedCord","xZarov","yZarov","attr","toFixed","_this$getJustifiedCor4","orientation","elementResolution","offsetHeight","offsetWidth","svgResolution","map","e","parseInt","textJustified","pretahovaniJustified","circleJustified","textCenter","getOffsetOfText","attributes","d3Element","_this$circleJustified2","SVGDraw","$svg","color","callback","sourceEvent","nodeName","line","curve","curveLinear","d","subject","x0","y0","id","active","append","datum","on","dragEvent","x1","y1","dx","dy","push","$thisPath","svg","task","node","contextMenu","pathEventsManager","svgGroup","localPosition","circleEventsManager","circleR","getPropertyValue","elementPosition","drag","start","from","circleMove","oldXCoordinate","oldYCoordinate","taskType","SVG","removeCloneConnectionManager","idParts","item","slideId","$object","firstChild","dragged","end","SVGText","maxLength","minLength","defaultWidth","defaultHeight","svgID","$radialMenu","hash","foreignObject","circle","textarea","fixVisualOrientation","focus","textEventsManager","$textarea","$circle","isCreated","firstWrite","oldText","parentElement","childNodes","updateTextareaHeight","$target","wrongBool","isWrong","removeItem","newHeight","scrollHeight","$parent","currentCommentWidth","currentCommentHeight","isBubble","_setSize","init","_initWhenDone","toDuplicate","svgSpecificActions","colors","svgSpecificColor","_initPath","_initCircle","_initComicBubbles","_getEvents","_getDropEvent","selectAll","viewbox","rect","maxWidthAbsolute","maxHeightAbsolute","innerHeight","getHeight","maxWidth","setMaxWidth","_this2","p","renderPath","_this3","createCircle","_this4","$comicBubbles","$comicBubble","comicBubblesEventsManager","oldID","join","_this5","svgDuplicateSources","includes","$templateNode","$templateCircle","localNodeID","_generateNewID","$localNode","_clonePath","_cloneComicBubbles","templateCircleID","localCircleID","$localCircle","_cloneTextField","_cloneCircle","_cloneDropItem","_this6","idSalt","_event$detail$svg","size","multiply","$d3canvas","$d3foreignObject","$dropItem","$itemToAdd","firstElementChild","appendChild","$foreignObject","dropItemEventsManager","cloneNode","insertBefore","selected","isRadial","elemIdParts","allActiveSvgs","deactivate","pop","every","coord","globalPosition","$nextElement","elementFromPoint","Sortable","$settings","feedback","JSON","parse","$container","$items","$droppables","$placeholder","$inheritors","inheritors","order","direction","before","after","evaluation","undefined","mouse","clientX","clientY","el","clone","posRel","siblings","prev","next","_setupInitialOrder","_setupInheritors","cache","barva","hasAttribute","offsetTop","offsetLeft","_addPlaceholder","_onOver","right","_onDrop","bottom","_removePlaceholder","_updateOrder","_updateOrderInInheritors","_dispatchEvent","_checkAndResolveFeedback","_getReference","_addEventListenerToItem","addEventListeners","removeChild","createElement","minHeight","src","img","nextElementSibling","previousElementSibling","array","some","index","checkIfTheArrayIsGood","changedArray","splice","_this$$buttonFeedback","arrayOfItems","dataset","sortableSpravnaodpoved","feedbackResult","oneMove","feedbackActual","find","podminka","text","splneno","Array","$inheritor","sortableIndex","inheritor","SVGRadialMenu","$svgs","$radialMenuItems","$colorItems","$textItems","$createTextItem","$removeItem","$tooltip","initialSetUp","menuRadius","itemRadius","setUpRadialMenuItems","addEventListenersToRadialMenu","openRadialMenu","iOSAddonEvents","timer","test","navigator","userAgent","MSStream","setTimeout","clearTimeout","hasText","hasMoreColors","$clickedItem","findNearElements","activate","deselectItem","filterMenuButtons","showRadialMenu","getSelection","removeAllRanges","addEventListenersToRadialMenuItem","_itemsLength","_menuRadius","_itemRadius","_menuOffset","_interval","_centerOffset","angle","sin","cos","onMouseLeave","hideRadialMenu","action","createText","changeColor","innerHTML","currentTarget","$activeSVG","$activeRadialMenuItem","positionRadialMenuItems","mouseLeaveDelay","_this7","clickedItem","$colorItem","$textItem","selectItem","commentID","$comment","SelectionMenu","editorId","schema","editorView","$menuTemplate","$menuBox","update","nodes","marks","dom","parentNode","relatedTarget","$menuItems","sugar","$menuItem","dataCommandName","isAdded","marker","state","dataTagId","addRemoveButton","removeButton","pm","toggleMark","command","dispatch","markedSelection","selection","closeSelection","$dispatchNode","connectAllSelectedParts","removingMarkerHandler","tagData","tagColor","view","lastState","readOnly","activeElementClasses","activeElement","empty","offsetParent","to","coordsAtPos","box","offsetParentBox","err","error","ranges","has","$from","$to","_ranges$i","doc","rangeHasMark","pos","lastPosition","newState","tr","insert","create","updateState","setSelection","TextSelection","inputs","$removeButton","$markedParts","_loop","$markedPart","fromPos","posAtDOM","toPos","textContent","matched","nodesBetween","isInline","toRemove","MarkType","found","isInSet","nodeSize","m","step","eq","RemoveMarkStep","fromPostRB","$nodes","$finalNode","fullContent","WrittingMenu","$removeAllChanges","firstState","confirm","schemaConfig","content","heading","attrs","level","default","group","defining","parseDOM","tag","getAttrs","toDOM","paragraph","list","listItem","hard_break","selectable","inline","premarked","textData","$dom","class","italic","bold","code","small","writtingInsertPart","writtingRemovePart","Editor","editor","editorType","$editor","$content","Schema","initJSON","initHTML","toJSON","plugins","selectionMenu","premarkedParts","writting","keydownHandler","histKeymap","keymap","undo","redo","history","EditorView","EditorState","DOMParser","fromSchema","readOnlyMod","fromJSON","Plugin","props","editable","key","PluginKey","$toolbarTemplate","deletedParts","handleKeyDown","Delete","Backspace","handleClickOn","nodePos","newClassName","classSelectDefinition","nodeAttrs","setNodeMarkup","Keywords","opts","$controls","$itemsContainer","itemsContainerClassName","inherit","isInherited","itemClassName","_getHTMLFromItems","onInit","_regenerateItemsContainerFromInherited","_registerHandlers","_changeSizeOfKeywordItem","skala","maxLevel","setNewLevelValue","$keyword","number","oldValue","newValue","$control","tempContent","temp","getElementById","renameItemsIds","_clickEventHandler","_dispatchEventHandler","keywords","_e$detail$keywords","currentId","nodeId","_getItemFromDOMElement","_getItemsHTML","_getItemsFromHTML","itemsClassName","itemsArray","_getDOMElementFromItem","newDiv","outerHTML","wrapper","__getHTML","items","contentHTML","oldId","newId","itemsHTML","expString","TestQuiz","$questions","itemClass","answersCorrect","questions","zpetnaVazba","$question","questionIndex","answered","answerCorrect","$answers","optionClass","$answer","answerIndex","$answerCurrent","$answersItem","selectedClass","_this2$$buttonFeedbac","question","FullscreenToggle","_super2","imageAlternative","$fullscreenContainer","$fullscreenTarget","removeAttribute","toLowerCase","currentSrc","Promise","resolve","reject","Image","onload","onerror","then","image","naturalWidth","naturalHeight","ratio","setSize","_viewbox","$svgTexts","$svgText","$fullscreen","toggle","Fullscreen","UserText","$counter","$counterWrapper","$instruction","$userTexts","lengthExpected","avg","lastValue","hadData","wasUsed","updateCharacterCounter","textDuplicateSources","getEvents","_this$$counterWrapper","arguments","none","ok","conditionAll","$userText","taskName","valueLength","updateFeedback","fromId","itemData","AudioPlayerNormal","$loadWave","$leftTime","$audioDuration","wavesurfer","WaveSurfer","waveColor","progressColor","responsive","barWidth","load","initWave","getDuration","addListenerAfterReady","time","playPause","$nextSlide","AudioPlayerSimple","$duration","FakeMap","$buttons","$maps","lastActiveIndex","addEventListenerToButtons","$button","switchMap","VideoPlayer","prefix","interval","$document","ownerDocument","$play","$playSymbol","$pauseSymbol","$time","$timeMeter","$timeRange","$currentTimeText","createTextNode","$currentTime","durationTime","$durationTime","timeToAural","$enterFullscreenSymbol","$leaveFullscreenSymbol","_fullscreenchange","_requestFullscreen","requestFullscreen","webkitRequestFullscreen","msRequestFullscreen","onCanPlayStart","onLoadStart","onLoadedData","onPlayChange","onTimeChange","onPlayClick","onTimeKeydown","onTimeClick","onFullscreenClick","onFullscreenChange","onDrag","percentage","clearInterval","setInterval","currentTimePercentage","currentTimeCode","nodeValue","removeEventListener","nCanPlayStart","autoplay","isFullscreen","_fullscreenElement","leaveFullscreen","enterFullscreen","pointerType","_exitFullscreen","webkitSupportsFullscreen","webkitDisplayingFullscreen","webkitExitFullscreen","webkitEnterFullscreen","keyCode","shiftKey","offset","fullscreenElement","webkitFullscreenElement","msFullscreenElement","exitFullscreen","webkitCancelFullScreen","msExitFullscreen","innerTarget","listener","hasPointerEvent","onpointerup","hasTouchEvent","ontouchstart","pointerDown","pointerMove","pointerUp","axisProp","onpointermove","defaultView","langMinutes","langSeconds","Selectable","settings","checkedInput","$inputs","$input","_changeClassIfChecked","$input_","checked","viceOdpovedi","vybrano","disableFeedback","hideFeedback","$label","itemId","NewTable","dataFrom","dataSources","tasks","autofill","_columnManager","_rowManager","$cell","columnId","rowId","_cellManager","$tableRow","rightToAdd","$headerCells","previousSibling","$rowCell","itemType","fillCell","$row","isRightToDeleteHelper","_removeTaskFromCache","$rows","$firstCell","columnIndex","_findCellType","cellController","$tag","$tags","removed","textId","$span","$innerItem","cacheObj","seed","answer","rightAnswer","$option","_correctedAnswer","keys","numberOfDrops","rowType","$columnHeader","elm","deliveredValue","Draggable","idPrefix","$targetPrevious","$targetCurrent","$draggedItem","objWidth","objHeight","lastEvent","$dragItem","dragAndDropEvents","handleDeleteItemFromSvgDrop","handleAddTagsFromText","dropToken","onStart","onDrop","_e$target$getBounding","$dragItemHTML","$table","body","$placeholderOld","numberOfPossibleDrops","numberOfDropsDone","childElementCount","$placeholderNew","coords","$fullScreenIcon","$rightElmChild","$cross","lastElementChild","removeDraggableItem","_event$detail$item","$sameItemFromDragPlace","$newDaggabletItem","$tagTextSpan","textToAdd","concreteTagName","Gallery","$selectableItemss","$dupItems","setSelectEvents","setTextEvents","selectedId","idTail","removeItemFromSelect","addItemFromSelect","acceptedId","$dupNode","dataId","windowLoadComponents","$videoPlayers","$videoPlayer","$audioPlayerNormals","$audioPlayerNormal","$audioPlayerSimples","$audioPlayerSimple","$fullscreenToggles","$fullscreenToggle","$magnifyingGlass","$fakeMaps","$editors","tools","$testQuizs","$testQuiz","$newTables","$newTable","$draggables","$draggable","$sortables","$sortable","$selectables","$selectable","$keywords","$galleries","$gallery","Element","prototype","matches","warn","$unsupported","version","unsupportedBrowsers"],"mappings":"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"}