!function(){"use strict";var e=function(){console.log("domLoad:components")};function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function r(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}(this,n)}}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||m(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v=function(){function e(t){i(this,e),this.target=t,this.$slide=this.target.closest(".slide"),this.lang=document.documentElement.getAttribute("lang"),HISTORYLAB.import.done||(this.$slide&&(this.$buttonFeedback=this.$slide.querySelector("[data-feedback-button]"),this.$buttonFeedback&&(this.$buttonFeedbackText=this.$buttonFeedback.querySelector("span"))),this.showFeedback=this.showFeedback.bind(this))}return o(e,[{key:"showFeedback",value:function(){this.$buttonFeedback&&this.$buttonFeedback.classList.contains("button-hidden")&&this.$buttonFeedback.classList.remove("button-hidden")}},{key:"hideFeedback",value:function(){this.$buttonFeedback.classList.add("button-hidden")}}]),e}(),y=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).$element=document.querySelector("[data-lupa]"),r.$canvas=document.querySelector("[data-lupa-canvas]"),r.ctx=r.$canvas.getContext("2d"),r._onStart=r._onStart.bind(u(r)),r._onMove=r._onMove.bind(u(r)),r._onEnd=r._onEnd.bind(u(r)),r._update=r._update.bind(u(r)),r._onResize=r._onResize.bind(u(r)),r.zoomGlassSize=230,r.targetBCR=null,r.zoomed=0,r.targetZoomed=0,r.x=0,r.y=0,r.trackingTouch=!1,r.displayStyle="",r._addEventListeners(),r._initCanvas(),r._onResize(),window.requestAnimationFrame(r._update),r}return o(n,[{key:"_initCanvas",value:function(){var e=this.zoomGlassSize,t=this.zoomGlassSize,n=window.devicePixelRation||1;this.$canvas.width=e*n,this.$canvas.height=t*n,this.$canvas.style.width="".concat(e,"px"),this.$canvas.style.height="".concat(t,"px"),this.ctx.scale(n,n)}},{key:"_onResize",value:function(){this.targetBCR=this.target.getBoundingClientRect()}},{key:"_onStart",value:function(e){this.displayStyle=getComputedStyle(this.$element).display,e.target===this.target&&"none"!==this.displayStyle&&(e.preventDefault(),this.x=e.pageX||e.touches[0].pageX,this.y=e.pageY||e.touches[0].pageY,this.trackingTouch=!0,this.targetZoomed=1,this.zoomed=0,window.requestAnimationFrame(this._update))}},{key:"_onMove",value:function(e){this.trackingTouch&&"none"!==this.displayStyle&&(this.x=e.pageX||e.touches[0].pageX,this.y=e.pageY||e.touches[0].pageY)}},{key:"_onEnd",value:function(){this.targetZoomed&&this.showFeedback(),this.targetZoomed=0,this.trackingTouch=!1}},{key:"_update",value:function(){var e=2*Math.PI,t=100*this.zoomed;this.targetBCR=this.target.getBoundingClientRect();var n=Math.max(0,Math.min(1,(this.x-this.targetBCR.left)/this.targetBCR.width)),r=Math.max(0,Math.min(1,(this.y-this.targetBCR.top)/this.targetBCR.height)),i=2.5*this.targetBCR.width,a=2.5*this.targetBCR.height;platform.os.family.indexOf("Windows")>-1&&platform.name.indexOf("Firefox")>-1||(this.ctx.shadowColor="rgba(0,0,0,0.4)",this.ctx.shadowBlur=12,this.ctx.shadowOffsetY=8),this.ctx.clearRect(0,0,this.zoomGlassSize,this.zoomGlassSize),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(this.zoomGlassSize/2,this.zoomGlassSize-10-t,t,0,e),this.ctx.closePath(),this.ctx.fill(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.zoomGlassSize/2,this.zoomGlassSize-10-(t+1),1.03*t,0,e),this.ctx.clip(),this.ctx.closePath(),this.ctx.drawImage(this.target,-n*i+this.zoomGlassSize/2,-r*a+this.zoomGlassSize/2,i,a),this.ctx.restore(),this._setTransformStyle(this.x,this.y),this.zoomed+=(this.targetZoomed-this.zoomed)/4,this.zoomed>.001?window.requestAnimationFrame(this._update):this.zoomed=0}},{key:"_addEventListeners",value:function(){document.addEventListener("touchstart",this._onStart),document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onEnd),document.addEventListener("mousedown",this._onStart),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onEnd),window.addEventListener("resize",this._onResize)}},{key:"_setTransformStyle",value:function(e,t){var n,r,i=this.zoomGlassSize/2;n=e-i<0?Math.abs(e)+i+18:e+i>window.innerWidth?window.innerWidth-(e-window.innerWidth)-this.zoomGlassSize:e,r=t-this.zoomGlassSize<0?Math.abs(t)+this.zoomGlassSize+18:t,this.$element.style.transform="translate(".concat(n,"px, ").concat(r,"px)")}}]),n}(v);function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=Object.assign({bubbles:!0},t);return new CustomEvent(e,n({detail:r},i))}function k(e,t,n,r){var i=b(t,n,r);e.dispatchEvent(i)}function w(e){return{x:e.pageX||e.touches[0].pageX,y:e.pageY||e.touches[0].pageY}}function x(e,t){var n=[];"Firefox"===platform.name&&e.target.closest(".half-slide-active")?n=[e.offsetX,e.offsetY]:(n=d3.pointer(e,t))[0]||(n=f(d3.pointers(e,t),1)[0]);return{x:d3.format(".0f")(n[0]),y:d3.format(".0f")(n[1])}}function S(e,t){E(e,t)?$(e,t):C(e,t)}function E(e,t){return!(!e||!t)&&(e.classList?e.classList.contains(t):"".concat(e.className," ").indexOf("".concat(t," "))>-1)}function C(e,t){var n=e,r=t;if(n&&r)if("string"==typeof n?n=document.querySelectorAll(n):n.tagName&&(n=[n]),"string"==typeof r){r=r.split(" ");for(var i=0;i<n.length;i+=1){var a;if(n[i].classList)(a=n[i].classList).add.apply(a,p(r));else if(!E.apply(void 0,[n[i]].concat(p(r))))for(var o=0;o<r.length;o+=1)n[i].classes+=" ".concat(r[o])}}else console.log("Class argument must be string with spaces in between class names.")}function $(e,t){var n=e,r=t;if(n&&r)if("string"==typeof n?n=document.querySelectorAll(n):n.tagName&&(n=[n]),"string"==typeof r){r=r.split(" ");for(var i=0;i<n.length;i+=1){var a;if(n[i].classList)(a=n[i].classList).remove.apply(a,p(r));else for(var o=0;o<r.length;o+=1)n[i].className=n[i].className.replace(new RegExp("\\b".concat(t[o],"\\b"),"g"),"")}}else console.log("Class argument must be string with spaces in between class names.")}var A={playchange:b("playchange"),timechange:b("timechange"),canplaystart:b("canplaystart")};function T(e){e.forEach((function(e){var t=e.querySelector("audio")||e.querySelector("video");t&&!t.paused&&(t.pause(),e.querySelector("[data-player-control]").setAttribute("data-player-control","paused"))}))}function M(e){var t={seconds:Math.floor(e),minutes:Math.floor(e/60)};return t.seconds=(t.seconds-60*t.minutes).toString(10),"".concat(t.minutes,":").concat("0".concat(t.seconds).slice(-2))}var N=function(e){l(n,e);var t=h(n);function n(e){return i(this,n),t.call(this,e)}return o(n,null,[{key:"addEventListeners",value:function(e,t){var n=document.querySelectorAll("[data-player-audio]"),r=e.querySelector("audio"),i=e.querySelector("[data-player-control]"),a=e.querySelector("[data-audio-time-left]");i.addEventListener("click",(function(e){"paused"===i.getAttribute("data-player-control")?(T(n),r.play(),i.setAttribute("data-player-control","playing")):(r.pause(),i.setAttribute("data-player-control","paused")),t(),e.stopPropagation()}),!1),i.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),r.addEventListener("timeupdate",(function(){a.innerText=M(r.currentTime)})),r.addEventListener("ended",(function(){i.setAttribute("data-player-control","paused")}))}}]),n}(v),O=function(){function e(){i(this,e)}return o(e,null,[{key:"start",value:function(e){d3.select(e).raise().classed("is-dragged",!0)}},{key:"dragged",value:function(e,t,n,r,i){var a=f(this.getJustifiedCord(e,t,n,r,i),2),o=a[0],s=a[1];d3.select(t).attr("x",o.toFixed()).attr("y",s.toFixed())}},{key:"end",value:function(e,t,n,r,i){var a=f(this.getJustifiedCord(e,t,n,r,i),2),o=a[0],s=a[1];d3.select(t).attr("x",o.toFixed()).attr("y",s.toFixed()).classed("is-dragged",!1)}},{key:"getOffsetOfText",value:function(e,t){return"left"===e[0]&&"top"===e[1]?[t.width-10,t.height-10]:"left"===e[0]&&"bottom"===e[1]?[t.width-10,0]:"right"===e[0]&&"top"===e[1]?[0,t.height-10]:"right"===e[0]&&"bottom"===e[1]?[0,0]:void 0}},{key:"getJustifiedCord",value:function(e,t,n,r,i){var a={height:i.offsetHeight,width:i.offsetWidth},o=t.getAttribute("data-svg-resolution").split(", ").map((function(e){return parseInt(e,10)}));switch(n){case"text":return this.textJustified(e,t,r,a,o);case"pretahovani":return this.pretahovaniJustified(e,t,r,o);default:return this.circleJustified(e,o,r,a)}}},{key:"textJustified",value:function(e,t,n,r,i){var a=t.getAttribute("data-svg-text-orientation").split(", "),o=this.getOffsetOfText(a,r);return[e.x-n.x<=10+o[0]?10+o[0]:e.x-n.x>i[0]-r.width+o[0]?i[0]-r.width+o[0]:e.x-n.x,e.y-n.y<=10+o[1]?10+o[1]:e.y-n.y>i[1]-r.height+o[1]?i[1]-r.height+o[1]:e.y-n.y]}},{key:"pretahovaniJustified",value:function(e,t,n,r){var i=t.attributes.height.value,a=t.attributes.width.value;return[e.x-n.x<=0?0:e.x-n.x>r[0]-a?r[0]-a:e.x-n.x,e.y-n.y<=0?0:e.y-n.y>r[1]-i?r[1]-i:e.y-n.y]}},{key:"circleJustified",value:function(e,t,n,r){return[e.x-n.x<=r.width/2?r.width/2:e.x-n.x>t[0]-r.width/2?t[0]-r.width/2:e.x-n.x,e.y-n.y<=r.height/2?r.height/2:e.y-n.y>t[1]-r.height/2?t[1]-r.height/2:e.y-n.y]}},{key:"circleMove",value:function(e,t,n,r,i){var a=f(this.circleJustified(t,n,r,i),2),o=a[0],s=a[1];e.attr("cx",o.toFixed()).attr("cy",s.toFixed())}}]),e}(),I=function(){function e(){i(this,e)}return o(e,null,[{key:"renderPath",value:function(t,n,r,i){if("image"===t.sourceEvent.target.nodeName){var a=d3.line().curve(d3.curveLinear),o=d3.format(".0f"),s=t.subject,l=o(t.x),c=o(t.y),d="".concat(n.id,"_path-").concat(l,"-").concat(c),u=d3.select("#".concat(n.id," .svg-view")).append("svg:path").attr("data-svg-path","").attr("class","svg-path ".concat(r)).attr("id",d).datum(s);t.on("drag",(function(e){var t=o(e.x),n=o(e.y),r=t-l,i=n-c;r*r+i*i>300?s.push([l=t,c=n]):s[s.length-1]=[t,n],u.attr("d",a)})).on("end",(function(){var e=d3.select("#".concat(d));e&&(e.attr("d")?e.attr("d").length<40?e.remove():k(document,"svg.change",{},{svg:{id:n.id,task:"create",node:e.node(),nodeName:e.node().nodeName,contextMenu:!1}}):e.attr("d")||e.remove()),i()})),e.pathEventsManager(n,d3.select("#".concat(d)).node())}}},{key:"createCircle",value:function(t,n,r){var i=d3.select(n).select(".svg-view"),a=x(t,n),o="".concat(n.id,"_circle-").concat(a.x,"-").concat(a.y);i.append("svg:circle").attr("data-svg-circle","").attr("id",o).attr("cx",a.x).attr("cy",a.y).attr("data-svg-resolution","".concat(i.attr("width"),", ").concat(i.attr("height"))).attr("data-svg-type","circle").attr("class","svg-circle ".concat(r," unselectable"));var s=document.querySelector("#".concat(o));e.circleEventsManager(n,s),k(document,"svg.change",{},{svg:{id:n.id,task:"create",node:s,nodeName:s.nodeName,contextMenu:!1}})}},{key:"pathEventsManager",value:function(e,t){d3.select("#".concat(t.id)).on("click",(function(n){k(document,"svg.change",{},{svg:{id:e.id,task:"remove",node:n.target,nodeName:n.target.nodeName,contextMenu:!1}}),d3.select("#".concat(t.id)).remove(),n.preventDefault()}),!1)}},{key:"circleEventsManager",value:function(e,t){var n,r=document.querySelector("#".concat(e.id," .svg-view")),i=d3.select(t),a=[parseInt(r.getAttribute("width"),10),parseInt(r.getAttribute("height"),10)],o=(n="r",getComputedStyle(t).getPropertyValue(n)||null),s=[2*o,2*o],l=[i.attr("cx"),i.attr("cy")],c={};i.on("click",(function(n){k(document,"svg.change",{},{svg:{id:e.id,task:"remove",node:t,nodeName:t.nodeName,contextMenu:!1}}),n.target.remove()})).call(d3.drag().container(r).subject(t).on("start",(function(e){c={x:e.x-l[0],y:e.y-l[1]},O.start(t),k(document,"event.propagation",{},{event:{from:"circle.drag.start",data:e}})})).on("drag",(function(e){k(document,"event.stopPropagation",{},{event:{}}),"true"!==i.attr("data-svg-selected")&&O.circleMove(i,e,a,c,s)})).on("end",(function(n){if(k(document,"event.stopPropagation",{},{event:{}}),"true"!==i.attr("data-svg-selected")){var r=l[0],o=l[1],d="move";O.circleMove(i,n,a,c,s),i.classed("is-dragged",!1),l=[t.getAttribute("cx"),t.getAttribute("cy")],D.removeCloneConnectionManager(t)&&(d="create"),l[0]===r&&l[1]===o||k(document,"svg.change",{},{svg:{id:e.id,task:d,node:t,nodeName:t.nodeName,contextMenu:!1}})}})))}},{key:"dropItemEventsManager",value:function(e,t){var n=document.querySelector("#".concat(e.id," .svg-view")),r=d3.select(t),i=[r.attr("x"),r.attr("y")],a={};r.on("click",(function(){k(document,"svg.change",{},{svg:{id:e.id,task:"remove",node:t,nodeName:t.nodeName,contextMenu:!1}});var n=t.id.split("_"),r=e.closest(".slide");"dropItem"===n[n.length-1]&&k(document,"svg.drop.delete",{},{item:{slideId:r.id,id:n[1],$object:t.firstChild}}),t.remove()})).call(d3.drag().container(n).subject(t).on("start",(function(e){a={x:e.x-i[0],y:e.y-i[1]},O.start(t),k(document,"event.propagation",{},{event:{from:"circle.drag.start",data:e}})})).on("drag",(function(e){k(document,"event.stopPropagation",{},{event:{}}),"true"!==r.attr("data-svg-selected")&&O.dragged(e,t,"pretahovani",a,t)})).on("end",(function(n){if(k(document,"event.stopPropagation",{},{event:{}}),"true"!==r.attr("data-svg-selected")){var o=i[0],s=i[1],l="move";O.end(n,t,"pretahovani",a,t),r.classed("is-dragged",!1),i=[t.getAttribute("x"),t.getAttribute("y")],D.removeCloneConnectionManager(t)&&(l="create"),i[0]===o&&i[1]===s||k(document,"svg.change",{},{svg:{id:e.id,task:l,node:t,nodeName:t.nodeName,contextMenu:!1}})}})))}}]),e}(),L=function(){function e(){i(this,e)}return o(e,null,[{key:"createText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:333,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r="15.2rem",i="55px",a=document.querySelector('[data-svg-active="true"]'),o=a.id,s=d3.select(a).select(".svg-view"),l=document.querySelector("[data-radial-menu]"),c={x:l.getAttribute("data-local-x"),y:l.getAttribute("data-local-y")},d="".concat(o,"_svg-text-").concat(c.x,"-").concat(c.y),u="#".concat(d),h={x:s.attr("width")-c.x>320?"right":"left",y:s.attr("height")-c.y>60?"bottom":"top"},f=s.append("svg:foreignObject").attr("class","svg-text orientation-".concat(h.x," orientation-").concat(h.y," unselectable")).attr("data-svg-text","").attr("x",c.x).attr("y",c.y).attr("data-svg-text-orientation","".concat(h.x,", ").concat(h.y)).attr("data-svg-resolution","".concat(s.attr("width"),", ").concat(s.attr("height"))).attr("style","width: ".concat(r,"; height: ").concat(i,";")),p=s.append("svg:circle").attr("id","".concat(d,"-circle")).attr("cx",c.x).attr("cy",c.y).attr("class","svg-circle svg-circle-text do-not-remove unselectable"),m=f.append("xhtml:textarea").attr("maxlength",t).attr("tabindex","-1").attr("id",d).attr("class","svg-textarea").attr("data-save","").attr("data-svg-textarea-target",o).attr("style","width: ".concat(r,"; height: ").concat(i,";"));e.fixVisualOrientation(f.node()),a.querySelector(u).focus(),e.textEventsManager(a,m.node(),p.node(),!0,n)}},{key:"textEventsManager",value:function(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=t.querySelector(".svg-view"),s="#".concat(n.id),l=i,c=n.value,d=t.querySelector(s).parentElement,u=[d.getAttribute("x"),d.getAttribute("y")],h={};d3.select(s).call(d3.drag().container(o).subject(d).on("start",(function(e){h={x:e.x-u[0],y:e.y-u[1]},O.start(d),k(document,"event.propagation",{},{event:{from:"text.drag.start",data:e}})})).on("drag",(function(e){k(document,"event.stopPropagation",{},{event:{}}),O.dragged(e,d,"text",h,n),r.setAttribute("cx",d.getAttribute("x")),r.setAttribute("cy",d.getAttribute("y"))})).on("end",(function(e){k(document,"event.stopPropagation",{},{event:{}}),n.focus();var i=u[0],a=u[1],o="move";O.end(e,d,"text",h,n),u=[d.getAttribute("x"),d.getAttribute("y")],r.setAttribute("cx",u[0]),r.setAttribute("cy",u[1]),l||u[0]===i&&u[1]===a||(D.removeCloneConnectionManager(d.childNodes[0])&&(o="create",D.removeCloneConnectionManager(r)),k(document,"svg.change",{},{svg:{id:t.id,task:o,node:d.childNodes[0],nodeName:d.childNodes[0].nodeName,circle:r,contextMenu:!1}})),d3.select(r).raise()}))).on("keyup",(function(t){e.updateTextareaHeight(t.target)})).on("blur",(function(e){var n,i=e.target,o=i.value,d=!1;0!==o.length?(o.length<a?(C(i,"is-wrong"),d=!0):o.length>=a&&E(i,"is-wrong")&&($(i,"is-wrong"),d=!1),c!==o&&(l?(n="create",l=!1):n="change",c=o,D.removeCloneConnectionManager(i)&&(n="create",D.removeCloneConnectionManager(r)),k(document,"svg.change",{},{svg:{id:t.id,task:n,node:i,nodeName:i.nodeName,circle:r,isWrong:d,contextMenu:!1}})),c=o,e.target.classList.remove("unselectable")):D.removeItem(!1,s)})).on("focus",(function(){d3.select(d).raise(),d3.select(r).raise()}))}},{key:"updateTextareaHeight",value:function(t){t.style.height="1px";var n="".concat(22+t.scrollHeight,"px");t.style.height=n;var r=t.parentElement;r.style.height=n,e.fixVisualOrientation(r)}},{key:"fixVisualOrientation",value:function(e){var t=e.style.width,n=e.style.height;e.classList.contains("orientation-left")&&e.classList.contains("orientation-top")?e.style.transform="translate(-".concat(t,", -").concat(n,")"):e.classList.contains("orientation-top")?e.style.transform="translateY(-".concat(n,")"):e.classList.contains("orientation-left")&&(e.style.transform="translateX(-".concat(t,")"))}},{key:"comicBubblesEventsManager",value:function(t,n){var r=!0,i=n.value;d3.select(n).on("keyup",(function(t){e.updateTextareaHeight(t.target)})).on("blur",(function(e){var n,a=e.target,o=a.value;i!==o&&(r?(n="create",r=!1):(n="change",0===o.length&&(r=!0)),i=o,D.removeCloneConnectionManager(a)&&(n="create"),k(document,"svg.change",{},{svg:{id:t.id,task:n,node:a,nodeName:a.nodeName,isBubble:!0,contextMenu:!1}})),i=o}))}}]),e}(),D=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).$canvas=r.target.querySelector(".svg-view"),r.format=d3.format(".0f"),r._setSize(),r.init(),r._initWhenDone(),r}return o(n,[{key:"init",value:function(){if(!HISTORYLAB.import.done){this.toDuplicate=this.target.getAttribute("data-duplicate-svg");for(var e=this.target.getAttribute("data-svg-target").split(" "),t=this.target.getAttribute("data-svg-colors"),n=0;n<e.length;n+=1)if("kresleni"===e[n]){var r=t?t.split(" ")[0]:"yellow";this._initPath(this.showFeedback,r)}else if("znacky"===e[n]){var i=t?t.split(" ")[0]:"blue";this._initCircle(this.showFeedback,i)}this._initComicBubbles(),this._getEvents(),this._getDropEvent()}}},{key:"_initWhenDone",value:function(){HISTORYLAB.import.done&&d3.selectAll("[data-svg-text] textarea").on("mouseenter",(function(){d3.select(this.closest("foreignObject")).raise()}))}},{key:"_setSize",value:function(){var e=this.target.getAttribute("viewBox").split(" "),t=this.target.getBoundingClientRect(),n=window.innerWidth,r=.9*window.innerHeight,i=function(){return t.height?t.height>e[3]?e[3]:t.height:e[3]},a=(i()>r?r:i())/e[3],o=e[2]*a,s=a?"".concat(o<n?o:n,"px"):"";this.target.style.maxWidth=s,this.target.getAttribute("data-svg-drop")&&!this.target.closest(".layout-vertical")&&(this.target.closest(".svgs-container").style.maxWidth=s)}},{key:"_initPath",value:function(e,t){var n=this;d3.select(this.target).call(d3.drag().container((function(){return n.target})).subject((function(e){var t=[e.x.toFixed(),e.y.toFixed()];return[t,t]})).on("start",(function(r){I.renderPath(r,n.target,t,e)})))}},{key:"_initCircle",value:function(e,t){var n=this;d3.select(this.target).on("click",(function(r){"image"===r.target.nodeName&&(I.createCircle(r,n.target,t),e(),r.preventDefault())}),!1)}},{key:"_initComicBubbles",value:function(){var e=this,t=this.target.querySelectorAll(".svg-komiks .svg-textarea");t&&t.forEach((function(t){L.comicBubblesEventsManager(e.target,t)}))}},{key:"_generateNewID",value:function(e){var t=e.split("_");return t.length<2?(console.log("Svg ID error!",e),e):(t[t.length-1]!=="clone-".concat(t[0])&&t.push("clone-".concat(t[0])),t[0]=this.target.id,t.join("_"))}},{key:"_getEvents",value:function(){var e=this,t=this.toDuplicate?this.toDuplicate.split(" "):[];t[0]&&document.addEventListener("svg.change",(function(n){if(t.includes(n.detail.svg.id)){var r,i=n.detail.svg.node,a=n.detail.svg.circle,o=n.detail.svg.nodeName,s=e._generateNewID(i.id),l=e.target.querySelector("#".concat(s));if(!l&&"create"!==n.detail.svg.task)return;if(r=n.detail.svg.task,"path"===o)switch(r){case"create":e._clonePath(i,s);break;case"color":$(l,"red blue"),C(l,n.detail.svg.color);break;case"remove":l.remove();break;default:console.log("Nondefinated path events task. :(")}else if("TEXTAREA"===o)if(n.detail.svg.isBubble)switch(r){case"create":e._cloneComicBubbles(i,s);break;case"change":0!==i.value.length?(l.value=i.value,l.style.height!==i.style.height&&(l.style.height=i.style.height)):l.parentElement.remove();break;default:console.log("Nondefinated comicBubble events task. :(")}else{var c;if(a)c=a.id;else{var d=i.id.split("_");d[1]+="-circle",c=d.join("_")}var u=e._generateNewID(c),h=e.target.querySelector("#".concat(u));switch(r){case"create":e._cloneTextField(n.detail.svg.isWrong,i,a,s,u);break;case"change":l.value=i.value,n.detail.svg.isWrong?C(l,"is-wrong"):$(l,"is-wrong"),l.style.height!==i.style.height&&(l.style.height=i.style.height);break;case"color":$(h,"red blue"),C(h,n.detail.svg.color);break;case"move":l&&(l.parentElement.remove(),h.remove()),e._cloneTextField(n.detail.svg.isWrong,i,a,s,u);break;case"remove":l.parentElement.remove(),h.remove();break;default:console.log("Nondefinated textField events task. :(")}}else if("circle"===o)switch(r){case"create":e._cloneCircle(i,s);break;case"color":$(l,"red blue"),C(l,n.detail.svg.color);break;case"move":l&&l.remove(),e._cloneCircle(i,s);break;case"remove":l.remove();break;default:console.log("Nondefinated circle events task. :(")}else if("foreignObject"===o)switch(r){case"create":e._cloneDropItem(i,s);break;case"move":l&&l.remove(),e._cloneDropItem(i,s);break;case"remove":l.remove();break;default:console.log("Nondefinated drop item events task. :(")}else console.log("Nondefinated events nodeName. :(",o);k(document,"svg.change",{},{svg:{id:e.target.id,task:n.detail.svg.task,node:i,circle:a,nodeName:o,contextMenu:!1}})}}))}},{key:"_getDropEvent",value:function(){var e=this,t=0;document.addEventListener("svg.drop",(function(n){if(n.detail.svg.id===e.target.id){var r=n.detail.svg,i=r.$node,a=r.position,o=r.type,s=r.size,l="image"===o||"svg"===o?.62:"tag"===o?1.075:1;s.width*=l,s.height*=l;var c={x:e.format(s.width/2),y:e.format(s.height/2)},d={h:e.format(s.height),w:e.format(s.width)},u=d3.select("#".concat(e.target.id," .svg-view")),h=u.append("svg:foreignObject").attr("width","".concat(d.w)).attr("height","".concat(d.h)).attr("x",e.format(a.x-c.x)).attr("y",e.format(a.y-c.y)).attr("data-svg-resolution","".concat(u.attr("width"),", ").concat(u.attr("height"))).attr("data-svg-type","pretahovani").attr("id","".concat(e.target.id,"_").concat(i.getAttribute("data-id"),"_").concat(t,"_dropItem")).attr("class","unselectable try-something"),f=h.append("xhtml:div").attr("class","dropped__item dropped__item--".concat(o," unselectable")).attr("style","width: ".concat(d.w,"px; height: ").concat(d.h,"px;")).node(),p=i.firstElementChild.firstElementChild;p.classList.add("unselectable"),p.style.width="".concat(d.w,"px"),p.style.height="".concat(d.h,"px"),p.style.paddingLeft="".concat(e.format(.1*d.w),"px");var m=p.querySelector("span");m.style.width="".concat(e.format(.75*d.w),"px"),m.style.paddingLeft="".concat(e.format(.05*d.w),"px"),f.appendChild(p);var g=h.node();t+=1,I.dropItemEventsManager(e.target,g),O.end(a,g,"pretahovani",c,i),k(document,"svg.change",{},{svg:{id:e.target.id,task:"create",node:g,nodeName:g.nodeName,contextMenu:!1}})}}))}},{key:"_clonePath",value:function(e,t){var n=e.cloneNode(!0);n.id=t,this.$canvas.appendChild(n),I.pathEventsManager(this.target,n)}},{key:"_cloneTextField",value:function(e,t,n,r,i){var a=n.cloneNode(!0);a.id=i,this.$canvas.appendChild(a);var o=t.parentElement.cloneNode(!0);o.childNodes[0].id=r,this.$canvas.insertBefore(o,a),e?C(o,"is-wrong"):$(o,"is-wrong"),L.textEventsManager(this.target,o.childNodes[0],a,!1)}},{key:"_cloneCircle",value:function(e,t){var n=e.cloneNode(!0);return n.id=t,this.$canvas.appendChild(n),I.circleEventsManager(this.target,n),n}},{key:"_cloneDropItem",value:function(e,t){var n=e.cloneNode(!0);return n.id=t,this.$canvas.appendChild(n),I.dropItemEventsManager(this.target,n),n}},{key:"_cloneComicBubbles",value:function(e,t){var n=e.parentElement.cloneNode(!0);n.childNodes[1].id=t,this.$canvas.appendChild(n),L.comicBubblesEventsManager(this.target,n.childNodes[1])}}],[{key:"selectItem",value:function(e){e.setAttribute("data-svg-selected","true")}},{key:"deselectItem",value:function(){for(var e=document.querySelectorAll('[data-svg-selected="true"]'),t=0;t<e.length;t+=1)e[t].setAttribute("data-svg-selected","false")}},{key:"removeItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'[data-svg-selected="true"]',n=document.querySelector(t),r=n.nodeName,i=n.parentElement;switch(r){case"path":case"circle":case"TEXTAREA":break;case"DIV":r=(n="pretahovani"===i.getAttribute("data-svg-type")?i:i.childNodes[0]).nodeName;break;default:console.log("Nondefinated node type. :(",r)}var a=n.id.split("_")[0];if(k(document,"svg.change",{},{svg:{id:a,task:"remove",node:n,nodeName:r,contextMenu:e}}),"foreignObject"===i.nodeName){var o=n.id.split("_");d3.select('[id^="'.concat(o[0],"_").concat(o[1],'-circle"')).remove(),d3.select(i).remove();var s=i.id.split("_"),l=document.querySelector("#".concat(a)).closest(".slide");"dropItem"===s[s.length-1]&&k(document,"svg.drop.delete",{},{item:{slideId:l.id,id:s[1],$object:n.firstChild}})}else d3.select(n).remove()}},{key:"deactivate",value:function(){for(var e=document.querySelectorAll('[data-svg-active="true"]'),t=0;t<e.length;t+=1)e[t].setAttribute("data-svg-active","false")}},{key:"activate",value:function(e){n.deactivate(),e.setAttribute("data-svg-active","true")}},{key:"removeCloneConnectionManager",value:function(e){var t=e.id.split("_");return!!t[t.length-1].includes("clone")&&(t.pop(),e.id=t.join("_"),!0)}},{key:"findNearElements",value:function(e){var t=e.target;return"image"!==t.nodeName&&"svg"!==t.nodeName||[[-3,-3],[0,-5],[3,-3],[-5,0],[5,0],[-3,3],[0,5],[3,3]].every((function(n){var r=w(e),i=document.elementFromPoint(r.x+n[0],r.y+n[1]);return"DIV"===i.nodeName||"svg"===i.nodeName||"image"===(t=i).nodeName})),t}}]),n}(v),_=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).$settings=document.querySelector('[data-sortable-id-reference="'.concat(r.target.id,'"]')),r.feedback=JSON.parse(r.$settings.getAttribute("data-module-zpetnavazba")),r.$container=r.target,r.$items=r.target.querySelectorAll("[data-sortable-drag]"),r.$droppables=r.target.querySelectorAll("[data-sortable-drop]"),r.$placeholder=function(){return document.querySelector("#sortable-placeholder")},r.$players=r.$container.querySelectorAll("[data-player-audio]"),r.$inheritors=document.querySelectorAll("[data-sortable-inheritor=".concat(r.target.id,"]")),r.inheritors=[],r.order=[],r.direction=r.target.getAttribute("data-sortable-target"),r.trackingTouch=!1,r.before=!1,r.after=!1,r.evaluation=void 0,r.mouse={x:function(e){return e.clientX||e.touches[0].clientX},y:function(e){return e.clientY||e.touches[0].clientY},x0:0,y0:0,x1:0,y1:0},r.dragged={el:null,clone:null,posRel:{},rect:function(){return r.dragged.el.getBoundingClientRect()},size:{},type:null},r.siblings={prev:null,next:null},r._onStart=r._onStart.bind(u(r)),r._onMove=r._onMove.bind(u(r)),r._onEnd=r._onEnd.bind(u(r)),r._update=r._update.bind(u(r)),r._setupInitialOrder(),r._setupInheritors(),r._addEventListeners(),r.cache={colors:[]},r.feedback&&(r.cache.colors=r.feedback.map((function(e){return e.barva}))),r}return o(n,[{key:"_onStart",value:function(e){e.target.hasAttribute("data-sortable-drag")&&(this.$players.length>0&&T(this.$players),this.trackingTouch=!0,this.dragged.el=e.target,this.dragged.type=e.target.getAttribute("data-sortable-drag"),this.dragged.clone=this.dragged.el.cloneNode(!0),this.dragged.posRel.top=this.dragged.el.offsetTop,this.dragged.posRel.left=this.dragged.el.offsetLeft,this.dragged.size.width=this.dragged.el.offsetWidth,this.dragged.size.height=this.dragged.el.offsetHeight,this.dragged.el.style.top="".concat(this.dragged.posRel.top,"px"),this.dragged.el.style.left="".concat(this.dragged.posRel.left,"px"),this.dragged.el.style.width="".concat(this.dragged.size.width,"px"),this.dragged.el.style.height="".concat(this.dragged.size.height,"px"),this.dragged.el.classList.add("is-dragged"),this.$container.classList.add("is-dragged"),this._addPlaceholder(this.dragged.el),this._onOver(),this.mouse.x0=this.mouse.x(e),this.mouse.y0=this.mouse.y(e),e.preventDefault())}},{key:"_onMove",value:function(e){this.trackingTouch&&(this.mouse.x1=this.mouse.x(e)-this.mouse.x0,this.mouse.y1=this.mouse.y(e)-this.mouse.y0,window.requestAnimationFrame(this._update),this._onOver())}},{key:"_onEnd",value:function(e){if(this.trackingTouch){this.trackingTouch=!1,this.$container.classList.remove("is-dragged"),this.dragged.el.classList.remove("is-dragged"),this.dragged.el.style.top="",this.dragged.el.style.left="",this.dragged.el.style.width="",this.dragged.el.style.height="",this.dragged.el.style.transform="";var t=this.$placeholder().getBoundingClientRect();switch(this.direction){case"horizontal":t.left<=this.mouse.x(e)<=t.right&&this._onDrop();break;case"vertical":t.top<=this.mouse.y(e)<=t.bottom&&this._onDrop()}this._removePlaceholder(),this._updateOrder(),this._updateOrderInInheritors(),this._dispatchEvent(),this._checkAndResolveFeedback()}}},{key:"_onOver",value:function(){if(this.before=!1,this.after=!1,this._getReference(),this.siblings.next&&this.siblings.next.hasAttribute("data-sortable-drop")){var e=this.siblings.next.getBoundingClientRect();switch(this.direction){case"horizontal":this.dragged.rect().right>e.left+e.width/1.5&&(this.after=!0,this._addPlaceholder(this.siblings.next));break;case"vertical":this.dragged.rect().bottom>e.top+e.height/1.5&&(this.after=!0,this._addPlaceholder(this.siblings.next))}}if(this.siblings.prev&&this.siblings.prev.hasAttribute("data-sortable-drop")){var t=this.siblings.prev.getBoundingClientRect();switch(this.direction){case"horizontal":this.dragged.rect().left<t.right-t.width/1.5&&(this.before=!0,this._addPlaceholder(this.siblings.prev));break;case"vertical":this.dragged.rect().top<t.bottom-t.height/1.5&&(this.before=!0,this._addPlaceholder(this.siblings.prev))}}}},{key:"_onDrop",value:function(){var e=this.$placeholder();this._addEventListenerToItem(this.dragged.clone),this.dragged.clone.querySelector("[data-player-audio]")&&N.addEventListeners(this.dragged.clone,this.showFeedback),this.$container.insertBefore(this.dragged.clone,e),this.dragged.el.parentElement.removeChild(this.dragged.el)}},{key:"_update",value:function(){this.dragged.el.style.transform="translate3d(".concat(this.mouse.x1,"px, ").concat(this.mouse.y1,"px, 0) rotate(5deg)")}},{key:"_addPlaceholder",value:function(e){this._removePlaceholder();var t=document.createElement("div");if(t.classList.add("sortable-item","sortable-placeholder"),t.setAttribute("id","sortable-placeholder"),t.style.minHeight="".concat(this.dragged.size.height,"px"),this.dragged.el.querySelector("img")){var n=this.dragged.el.querySelector("img").getAttribute("src"),r=document.createElement("img");r.setAttribute("src",n),t.appendChild(r)}this.after?this.$container.insertBefore(t,e.nextElementSibling):(this.before,this.$container.insertBefore(t,e))}},{key:"_removePlaceholder",value:function(){var e=this.$placeholder();e&&e.parentElement.removeChild(e)}},{key:"_getReference",value:function(){var e=this.$placeholder();this.siblings.prev=e.previousElementSibling===this.dragged.el?this.dragged.el.previousElementSibling:e.previousElementSibling,this.siblings.next=e.nextElementSibling===this.dragged.el?this.dragged.el.nextElementSibling:e.nextElementSibling}},{key:"_addEventListenerToItem",value:function(e){e.addEventListener("touchstart",this._onStart,!1),e.addEventListener("mousedown",this._onStart,!1),"svg"===this.dragged.type&&new D(e.querySelector("[data-svg-target]"))}},{key:"_addEventListeners",value:function(){var e=this;document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onEnd),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onEnd),this.$items.forEach((function(t){e._addEventListenerToItem(t)}))}},{key:"checkIfTheArrayIsGood",value:function(e){return!e.some((function(e,t){return t!==e-1}))}},{key:"oneMove",value:function(e){if(this.checkIfTheArrayIsGood(e))return 0;for(var t=0;t<e.length;t+=1)if(e[t]!==t+1){var n=p(e),r=n[t];if(n.splice(t,1),n.splice(r-1,0,r),this.checkIfTheArrayIsGood(n))return 1}return 2}},{key:"_checkAndResolveFeedback",value:function(){if(this.feedback){var e,t=p(this.target.querySelectorAll("[data-sortable-drag]")).map((function(e){return parseInt(e.dataset.sortableSpravnaodpoved,10)})),n=0;2===this.feedback.length?this.checkIfTheArrayIsGood(t)||(n=1):n=this.oneMove(t);var r=this.feedback.find((function(e){return e.podminka===n}));(e=this.$buttonFeedback.classList).remove.apply(e,p(this.cache.colors)),this.$buttonFeedback.classList.add(r.barva),this.$buttonFeedbackText.innerText=r.text,this.evaluation=r.splneno}this.showFeedback()}},{key:"_setupInitialOrder",value:function(){this._updateOrder()}},{key:"_setupInheritors",value:function(){this.$inheritors.length>0&&(this.inheritors=Array.from(this.$inheritors).map((function(e){return{$inheritor:e,$container:e.querySelector("[data-sortable-inheritor-item]").parentElement}})))}},{key:"_updateOrder",value:function(){this.order=Array.from(this.target.querySelectorAll("[data-sortable-drag]")).map((function(e){return{id:parseInt(e.dataset.sortableIndex,10)}}))}},{key:"_updateOrderInInheritors",value:function(){var e=this;this.$inheritors.length>0&&this.inheritors.forEach((function(t){e.order.forEach((function(e){t.$container.appendChild(t.$container.querySelector('[data-sortable-inheritor-item="'.concat(e.id,'"]')))}))}))}},{key:"_dispatchEvent",value:function(){k(this.target,"sortable.change",{},{id:this.target.id,evaluation:this.evaluation,order:this.order})}}]),n}(v),R=function(){function e(t,n){i(this,e),this.$radialMenu=t,this.$radialMenuItems=this.$radialMenu.querySelectorAll("[data-radial-menu-item]"),this.$colorItems=this.$radialMenu.querySelectorAll(".radial-menu-color"),this.$textItems=this.$radialMenu.querySelectorAll(".radial-menu-text"),this.$createTextItem=this.$radialMenu.querySelector("#create-text"),this.$removeItem=this.$radialMenu.querySelector("#remove-content"),this.$tooltip=this.$radialMenu.querySelector("[data-radial-menu-tooltip]"),this.$svgs=n,this.initialSetUp=!0,this.menuRadius=parseInt(window.getComputedStyle(this.$radialMenu.querySelector(".radial-menu-wrapper"),null).getPropertyValue("width"),10)/2,this.itemRadius=parseInt(window.getComputedStyle(this.$radialMenu.querySelector(".radial-menu-item"),null).getPropertyValue("width"),10)/2,this.init()}return o(e,[{key:"init",value:function(){var e=this;this.setUpRadialMenuItems(),this.addEventListenersToRadialMenu(),this.$svgs.forEach((function(t){d3.select(t).on("contextmenu",(function(t){e.openRadialMenu(t)})),e.iOSAddonEvents(t)}))}},{key:"iOSAddonEvents",value:function(e){var t,n=this;/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(console.log("This is a IOS device"),document.addEventListener("event.propagation",(function(e){var r=e.detail.event.data.sourceEvent;t=setTimeout((function(){r.preventDefault(),n.openRadialMenu(r)}),400)})),document.addEventListener("event.stopPropagation",(function(){t&&clearTimeout(t)})),e.addEventListener("touchstart",(function(e){1===e.touches.length&&(t=setTimeout((function(){e.preventDefault(),e.stopPropagation(),n.openRadialMenu(e)}),400))})),e.addEventListener("touchmove",(function(){t&&clearTimeout(t)})),e.addEventListener("touchend",(function(){t&&clearTimeout(t)})),e.addEventListener("touchcancel",(function(){t&&clearTimeout(t)})))}},{key:"openRadialMenu",value:function(t){var n=t.target.closest("svg"),r=e.hasText(n),i=e.hasMoreColors(n),a=D.findNearElements(t);D.activate(n),D.deselectItem(),this.filterMenuButtons(a,r,i),this.showRadialMenu(t,n),t.preventDefault(),window.getSelection().removeAllRanges(),this.initialSetUp=!1}},{key:"setUpRadialMenuItems",value:function(){var e=this;this.$radialMenuItems.forEach((function(t){e.addEventListenersToRadialMenuItem(t)}))}},{key:"positionRadialMenuItems",value:function(e){var t=e.length,n=this.menuRadius,r=this.itemRadius,i=n-r,a=.6283185307,o=-a/2+t*a/2;e.forEach((function(e,t){var r=Math.PI+t*a*-1+o,s=n*Math.sin(r)+i,l=n*Math.cos(r)+i;e.style.left="".concat(s.toFixed(1),"px"),e.style.top="".concat(l.toFixed(1),"px")}))}},{key:"addEventListenersToRadialMenu",value:function(){var e=this;this.onMouseLeave(),this.$radialMenu.addEventListener("click",(function(t){e.hideRadialMenu(e.$radialMenu),t.preventDefault()})),this.$radialMenu.addEventListener("contextmenu",(function(t){e.hideRadialMenu(e.$radialMenu),t.preventDefault()}))}},{key:"addEventListenersToRadialMenuItem",value:function(t){var n=this,r=t,i=r.getAttribute("data-radial-menu-item");"remove-content"===i?r.addEventListener("click",(function(){D.removeItem(!0),n.hideRadialMenu()}),!1):"create-text"===i?d3.select(r).on("click",(function(){L.createText(),n.hideRadialMenu()}),!1):"color-point-blue"===i?r.addEventListener("click",(function(){e.changeColor("blue"),n.hideRadialMenu()}),!1):("color-point-red"===i||"color-point-red"===i)&&r.addEventListener("click",(function(){e.changeColor("red"),n.hideRadialMenu()}),!1),r.addEventListener("mouseenter",(function(e){n.$tooltip.innerHTML=e.currentTarget.getAttribute("data-radial-menu-item-tooltip"),n.$tooltip.style.display="block"}),!1),r.addEventListener("mouseleave",(function(){n.$tooltip.innerHTML="",n.$tooltip.style.display="none"}),!1)}},{key:"showRadialMenu",value:function(e,t){var n=t||document.querySelector('[data-svg-active="true"]'),r=w(e),i=x(e,n);this.$radialMenu.setAttribute("data-local-x",i.x),this.$radialMenu.setAttribute("data-local-y",i.y),this.$radialMenu.style.top="".concat(r.y-7,"px"),this.$radialMenu.style.left="".concat(r.x-7,"px");var a=this.$radialMenu.querySelectorAll(".is-active");this.positionRadialMenuItems(a),C(this.$radialMenu,"is-active")}},{key:"hideRadialMenu",value:function(){var e=this;$(this.$radialMenu,"is-active"),D.deactivate(),D.deselectItem(),setTimeout((function(){E(e.$radialMenu,"is-active")||e.$radialMenuItems.forEach((function(e){$(e,"is-active")}))}),150)}},{key:"onMouseLeave",value:function(){var e,t=this;this.$radialMenu.addEventListener("mouseleave",(function(){e=setTimeout((function(){t.hideRadialMenu(t.$radialMenu)}),500)})),this.$radialMenu.addEventListener("mouseenter",(function(){clearTimeout(e)}))}},{key:"filterMenuButtons",value:function(e,t,n){(E(e,"svg-path")||"path"===e.nodeName)&&(t?C(this.$createTextItem,"is-active"):$(this.$createTextItem,"is-active"),n&&this.$colorItems.forEach((function(e){C(e,"is-active")})),this.$textItems.forEach((function(e){$(e,"is-active")}))),E(e,"svg-circle")&&(t?C(this.$createTextItem,"is-active"):$(this.$createTextItem,"is-active"),n&&this.$colorItems.forEach((function(e){C(e,"is-active")})),this.$textItems.forEach((function(e){$(e,"is-active")}))),E(e,"svg-textarea")&&($(this.$createTextItem,"is-active"),E(e,"do-not-remove")||(this.$colorItems.forEach((function(e){$(e,"is-active")})),this.$textItems.forEach((function(e){C(e,"is-active")})))),"image"===e.nodeName?(t?C(this.$createTextItem,"is-active"):$(this.$createTextItem,"is-active"),$(this.$removeItem,"is-active"),this.$colorItems.forEach((function(e){$(e,"is-active")})),this.$textItems.forEach((function(e){$(e,"is-active")}))):(E(e,"do-not-remove")?$(this.$removeItem,"is-active"):(t?C(this.$createTextItem,"is-active"):$(this.$createTextItem,"is-active"),C(this.$removeItem,"is-active")),D.selectItem(e))}}],[{key:"hasText",value:function(e){return e.getAttribute("data-svg-target").split(" ").includes("text")}},{key:"hasMoreColors",value:function(e){var t=e.getAttribute("data-svg-colors"),n=t?t.split(" "):void 0;return n&&n.length>1||!t}},{key:"changeColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'[data-svg-selected="true"]',n=document.querySelector(t),r=n.nodeName,i="color";switch($(n,"red blue"),C(n,e),r){case"path":case"circle":break;case"DIV":r=(n=n.parentElement.childNodes[1]?n.parentElement.childNodes[1]:n.parentElement).nodeName;break;default:console.log("Nondefinated node type. :(",r)}if("circle"===r&&n.id.includes("svg-text")){var a=n.id.replace("-circle",""),o=document.querySelector("#".concat(a));D.removeCloneConnectionManager(o)}D.removeCloneConnectionManager(n)&&(i="create");var s=n.id.split("_")[0];k(document,"svg.change",{},{svg:{id:s,task:i,node:n,nodeName:r,contextMenu:!0,color:e}})}}]),e}();function q(e,t,n){for(let r=0;;r++){if(r==e.childCount||r==t.childCount)return e.childCount==t.childCount?null:n;let i=e.child(r),a=t.child(r);if(i!=a){if(!i.sameMarkup(a))return n;if(i.isText&&i.text!=a.text){for(let e=0;i.text[e]==a.text[e];e++)n++;return n}if(i.content.size||a.content.size){let e=q(i.content,a.content,n+1);if(null!=e)return e}n+=i.nodeSize}else n+=i.nodeSize}}function F(e,t,n,r){for(let i=e.childCount,a=t.childCount;;){if(0==i||0==a)return i==a?null:{a:n,b:r};let o=e.child(--i),s=t.child(--a),l=o.nodeSize;if(o!=s){if(!o.sameMarkup(s))return{a:n,b:r};if(o.isText&&o.text!=s.text){let e=0,t=Math.min(o.text.length,s.text.length);for(;e<t&&o.text[o.text.length-e-1]==s.text[s.text.length-e-1];)e++,n--,r--;return{a:n,b:r}}if(o.content.size||s.content.size){let e=F(o.content,s.content,n-1,r-1);if(e)return e}n-=l,r-=l}else n-=l,r-=l}}class z{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let t=0;t<e.length;t++)this.size+=e[t].nodeSize}nodesBetween(e,t,n,r=0,i){for(let a=0,o=0;o<t;a++){let s=this.content[a],l=o+s.nodeSize;if(l>e&&!1!==n(s,r+o,i||null,a)&&s.content.size){let i=o+1;s.nodesBetween(Math.max(0,e-i),Math.min(s.content.size,t-i),n,r+i)}o=l}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,r){let i="",a=!0;return this.nodesBetween(e,t,((o,s)=>{let l=o.isText?o.text.slice(Math.max(e,s)-s,t-s):o.isLeaf?r?"function"==typeof r?r(o):r:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&l||o.isTextblock)&&n&&(a?a=!1:i+=n),i+=l}),0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,r=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(n)&&(r[r.length-1]=t.withText(t.text+n.text),i=1);i<e.content.length;i++)r.push(e.content[i]);return new z(r,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let n=[],r=0;if(t>e)for(let i=0,a=0;a<t;i++){let o=this.content[i],s=a+o.nodeSize;s>e&&((a<e||s>t)&&(o=o.isText?o.cut(Math.max(0,e-a),Math.min(o.text.length,t-a)):o.cut(Math.max(0,e-a-1),Math.min(o.content.size,t-a-1))),n.push(o),r+=o.nodeSize),a=s}return new z(n,r)}cutByIndex(e,t){return e==t?z.empty:0==e&&t==this.content.length?this:new z(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let r=this.content.slice(),i=this.size+t.nodeSize-n.nodeSize;return r[e]=t,new z(r,i)}addToStart(e){return new z([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new z(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let r=this.content[t];e(r,n,t),n+=r.nodeSize}}findDiffStart(e,t=0){return q(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return F(this,e,t,n)}findIndex(e,t=-1){if(0==e)return B(0,e);if(e==this.size)return B(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=r+this.child(n).nodeSize;if(i>=e)return i==e||t>0?B(n+1,i):B(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((e=>e.toJSON())):null}static fromJSON(e,t){if(!t)return z.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new z(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return z.empty;let t,n=0;for(let r=0;r<e.length;r++){let i=e[r];n+=i.nodeSize,r&&i.isText&&e[r-1].sameMarkup(i)?(t||(t=e.slice(0,r)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new z(t||e,n)}static from(e){if(!e)return z.empty;if(e instanceof z)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new z([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}z.empty=new z([],0);const P={index:0,offset:0};function B(e,t){return P.index=e,P.offset=t,P}function J(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!J(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!J(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}class j{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let r=0;r<e.length;r++){let i=e[r];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,r));else{if(i.type.excludes(this.type))return e;!n&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,r)),t.push(this),n=!0),t&&t.push(i)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&J(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let r=n.create(t.attrs);return n.checkAttrs(r.attrs),r}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&0==e.length)return j.none;if(e instanceof j)return[e];let t=e.slice();return t.sort(((e,t)=>e.type.rank-t.type.rank)),t}}j.none=[];class H extends Error{}class V{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=K(this.content,e+this.openStart,t);return n&&new V(n,this.openStart,this.openEnd)}removeBetween(e,t){return new V(W(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return V.empty;let n=t.openStart||0,r=t.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new V(z.fromJSON(e,t.content),n,r)}static maxOpen(e,t=!0){let n=0,r=0;for(let r=e.firstChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.firstChild)n++;for(let n=e.lastChild;n&&!n.isLeaf&&(t||!n.type.spec.isolating);n=n.lastChild)r++;return new V(e,n,r)}}function W(e,t,n){let{index:r,offset:i}=e.findIndex(t),a=e.maybeChild(r),{index:o,offset:s}=e.findIndex(n);if(i==t||a.isText){if(s!=n&&!e.child(o).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return e.replaceChild(r,a.copy(W(a.content,t-i-1,n-i-1)))}function K(e,t,n,r){let{index:i,offset:a}=e.findIndex(t),o=e.maybeChild(i);if(a==t||o.isText)return r&&!r.canReplace(i,i,n)?null:e.cut(0,t).append(n).append(e.cut(t));let s=K(o.content,t-a-1,n);return s&&e.replaceChild(i,o.copy(s))}V.empty=new V(z.empty,0,0);class Y{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach((e=>{if(function(e){return null!=e.tag}(e))this.tags.push(e);else if(function(e){return null!=e.style}(e)){let t=/[^=]*/.exec(e.style)[0];n.indexOf(t)<0&&n.push(t),this.styles.push(e)}})),this.normalizeLists=!this.tags.some((t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)}))}parse(e,t={}){let n=new ee(this,t,!1);return n.addAll(e,j.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new ee(this,t,!0);return n.addAll(e,j.none,t.from,t.to),V.maxOpen(n.finish())}matchTag(e,t,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let n=this.tags[r];if(te(e,n.tag)&&(void 0===n.namespace||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(!1===t)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,r){for(let i=r?this.styles.indexOf(r)+1:0;i<this.styles.length;i++){let r=this.styles[i],a=r.style;if(!(0!=a.indexOf(e)||r.context&&!n.matchesContext(r.context)||a.length>e.length&&(61!=a.charCodeAt(e.length)||a.slice(e.length+1)!=t))){if(r.getAttrs){let e=r.getAttrs(t);if(!1===e)continue;r.attrs=e||void 0}return r}}}static schemaRules(e){let t=[];function n(e){let n=null==e.priority?50:e.priority,r=0;for(;r<t.length;r++){let e=t[r];if((null==e.priority?50:e.priority)<n)break}t.splice(r,0,e)}for(let t in e.marks){let r=e.marks[t].spec.parseDOM;r&&r.forEach((e=>{n(e=ne(e)),e.mark||e.ignore||e.clearMark||(e.mark=t)}))}for(let t in e.nodes){let r=e.nodes[t].spec.parseDOM;r&&r.forEach((e=>{n(e=ne(e)),e.node||e.ignore||e.mark||(e.node=t)}))}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Y(e,Y.schemaRules(e)))}}const G={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},U={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},X={ol:!0,ul:!0};function Z(e,t,n){return null!=t?(t?1:0)|("full"===t?2:0):e&&"pre"==e.whitespace?3:-5&n}class Q{constructor(e,t,n,r,i,a){this.type=e,this.attrs=t,this.marks=n,this.solid=r,this.options=a,this.content=[],this.activeMarks=j.none,this.match=i||(4&a?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(z.from(e));if(!t){let t,n=this.type.contentMatch;return(t=n.findWrapping(e.type))?(this.match=n,t):null}this.match=this.type.contentMatch.matchFragment(t)}return this.match.findWrapping(e.type)}finish(e){if(!(1&this.options)){let e,t=this.content[this.content.length-1];if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let n=t;t.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length))}}let t=z.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(z.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!G.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class ee{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let r,i=t.topNode,a=Z(null,t.preserveWhitespace,0)|(n?4:0);r=i?new Q(i.type,i.attrs,j.none,!0,t.topMatch||i.type.contentMatch,a):new Q(n?null:e.schema.topNodeType,null,j.none,!0,null,a),this.nodes=[r],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){3==e.nodeType?this.addTextNode(e,t):1==e.nodeType&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,r=this.top,i=2&r.options?"full":this.localPreserveWS||(1&r.options)>0;if("full"===i||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(i)n="full"!==i?n.replace(/\r?\n|\r/g," "):n.replace(/\r\n?/g,"\n");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let t=r.content[r.content.length-1],i=e.previousSibling;(!t||i&&"BR"==i.nodeName||t.isText&&/[ \t\r\n\u000c]$/.test(t.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),t),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let r=this.localPreserveWS,i=this.top;("PRE"==e.tagName||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let a,o=e.nodeName.toLowerCase();X.hasOwnProperty(o)&&this.parser.normalizeLists&&function(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&X.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):"li"==e?n=t:e&&(n=null)}}(e);let s=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(s?s.ignore:U.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!s||s.skip||s.closeParent){s&&s.closeParent?this.open=Math.max(0,this.open-1):s&&s.skip.nodeType&&(e=s.skip);let n,r=this.needsBlock;if(G.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),n=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let a=s&&s.skip?t:this.readStyles(e,t);a&&this.addAll(e,a),n&&this.sync(i),this.needsBlock=r}else{let n=this.readStyles(e,t);n&&this.addElementByRule(e,s,n,!1===s.consuming?a:void 0)}this.localPreserveWS=r}leafFallback(e,t){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"),t)}ignoreFallback(e,t){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),t)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let e=0;e<this.parser.matchedStyles.length;e++){let r=this.parser.matchedStyles[e],i=n.getPropertyValue(r);if(i)for(let e;;){let n=this.parser.matchStyle(r,i,this,e);if(!n)break;if(n.ignore)return null;if(t=n.clearMark?t.filter((e=>!n.clearMark(e))):t.concat(this.parser.schema.marks[n.mark].create(n.attrs)),!1!==n.consuming)break;e=n}}return t}addElementByRule(e,t,n,r){let i,a;if(t.node)if(a=this.parser.schema.nodes[t.node],a.isLeaf)this.insertNode(a.create(t.attrs),n)||this.leafFallback(e,n);else{let e=this.enter(a,t.attrs||null,n,t.preserveWhitespace);e&&(i=!0,n=e)}else{let e=this.parser.schema.marks[t.mark];n=n.concat(e.create(t.attrs))}let o=this.top;if(a&&a.isLeaf)this.findInside(e);else if(r)this.addElement(e,n,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach((e=>this.insertNode(e,n)));else{let r=e;"string"==typeof t.contentElement?r=e.querySelector(t.contentElement):"function"==typeof t.contentElement?r=t.contentElement(e):t.contentElement&&(r=t.contentElement),this.findAround(e,r,!0),this.addAll(r,n),this.findAround(e,r,!1)}i&&this.sync(o)&&this.open--}addAll(e,t,n,r){let i=n||0;for(let a=n?e.childNodes[n]:e.firstChild,o=null==r?null:e.childNodes[r];a!=o;a=a.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(a,t);this.findAtPoint(e,i)}findPlace(e,t){let n,r;for(let t=this.open;t>=0;t--){let i=this.nodes[t],a=i.findWrapping(e);if(a&&(!n||n.length>a.length)&&(n=a,r=i,!a.length))break;if(i.solid)break}if(!n)return null;this.sync(r);for(let e=0;e<n.length;e++)t=this.enterInner(n[e],null,t,!1);return t}insertNode(e,t){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&(t=this.enterInner(e,null,t))}let n=this.findPlace(e,t);if(n){this.closeExtra();let t=this.top;t.match&&(t.match=t.match.matchType(e.type));let r=j.none;for(let i of n.concat(e.marks))(t.type?t.type.allowsMarkType(i.type):re(i.type,e.type))&&(r=i.addToSet(r));return t.content.push(e.mark(r)),!0}return!1}enter(e,t,n,r){let i=this.findPlace(e.create(t),n);return i&&(i=this.enterInner(e,t,n,!0,r)),i}enterInner(e,t,n,r=!1,i){this.closeExtra();let a=this.top;a.match=a.match&&a.match.matchType(e);let o=Z(e,i,a.options);4&a.options&&0==a.content.length&&(o|=4);let s=j.none;return n=n.filter((t=>!(a.type?a.type.allowsMarkType(t.type):re(t.type,e))||(s=t.addToSet(s),!1))),this.nodes.push(new Q(e,t,s,r,null,o)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!(!this.isOpen&&!this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=1)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==e.nodeType&&e.contains(this.find[r].node)){t.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,r=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),i=-(n?n.depth+1:0)+(r?0:1),a=(e,o)=>{for(;e>=0;e--){let s=t[e];if(""==s){if(e==t.length-1||0==e)continue;for(;o>=i;o--)if(a(e-1,o))return!0;return!1}{let e=o>0||0==o&&r?this.nodes[o].type:n&&o>=i?n.node(o-i).type:null;if(!e||e.name!=s&&!e.isInGroup(s))return!1;o--}}return!0};return a(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}}function te(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function ne(e){let t={};for(let n in e)t[n]=e[n];return t}function re(e,t){let n=t.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(e))continue;let a=[],o=e=>{a.push(e);for(let n=0;n<e.edgeCount;n++){let{type:r,next:i}=e.edge(n);if(r==t)return!0;if(a.indexOf(i)<0&&o(i))return!0}};if(o(i.contentMatch))return!0}}class ie{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=oe(t).createDocumentFragment());let r=n,i=[];return e.forEach((e=>{if(i.length||e.marks.length){let n=0,a=0;for(;n<i.length&&a<e.marks.length;){let t=e.marks[a];if(this.marks[t.type.name]){if(!t.eq(i[n][0])||!1===t.type.spec.spanning)break;n++,a++}else a++}for(;n<i.length;)r=i.pop()[1];for(;a<e.marks.length;){let n=e.marks[a++],o=this.serializeMark(n,e.isInline,t);o&&(i.push([n,r]),r.appendChild(o.dom),r=o.contentDOM||o.dom)}}r.appendChild(this.serializeNodeInner(e,t))})),n}serializeNodeInner(e,t){let{dom:n,contentDOM:r}=ce(oe(t),this.nodes[e.type.name](e),null,e.attrs);if(r){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,r)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let r=e.marks.length-1;r>=0;r--){let i=this.serializeMark(e.marks[r],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n}serializeMark(e,t,n={}){let r=this.marks[e.type.name];return r&&ce(oe(n),r(e,t),null,e.attrs)}static renderSpec(e,t,n=null,r){return ce(e,t,n,r)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new ie(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=ae(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return ae(e.marks)}}function ae(e){let t={};for(let n in e){let r=e[n].spec.toDOM;r&&(t[n]=r)}return t}function oe(e){return e.document||window.document}const se=new WeakMap;function le(e){let t=se.get(e);return void 0===t&&se.set(e,t=function(e){let t=null;function n(e){if(e&&"object"==typeof e)if(Array.isArray(e))if("string"==typeof e[0])t||(t=[]),t.push(e);else for(let t=0;t<e.length;t++)n(e[t]);else for(let t in e)n(e[t])}return n(e),t}(e)),t}function ce(e,t,n,r){if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let i,a=t[0];if("string"!=typeof a)throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=le(r))&&i.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o,s=a.indexOf(" ");s>0&&(n=a.slice(0,s),a=a.slice(s+1));let l=n?e.createElementNS(n,a):e.createElement(a),c=t[1],d=1;if(c&&"object"==typeof c&&null==c.nodeType&&!Array.isArray(c)){d=2;for(let e in c)if(null!=c[e]){let t=e.indexOf(" ");t>0?l.setAttributeNS(e.slice(0,t),e.slice(t+1),c[e]):l.setAttribute(e,c[e])}}for(let i=d;i<t.length;i++){let a=t[i];if(0===a){if(i<t.length-1||i>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}{let{dom:t,contentDOM:i}=ce(e,a,n,r);if(l.appendChild(t),i){if(o)throw new RangeError("Multiple content holes");o=i}}}return{dom:l,contentDOM:o}}const de=Math.pow(2,16);function ue(e){return 65535&e}class he{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class fe{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&fe.empty)return fe.empty}recover(e){let t=0,n=ue(e);if(!this.inverted)for(let e=0;e<n;e++)t+=this.ranges[3*e+2]-this.ranges[3*e+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/de}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let r=0,i=this.inverted?2:1,a=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let s=this.ranges[o]-(this.inverted?r:0);if(s>e)break;let l=this.ranges[o+i],c=this.ranges[o+a],d=s+l;if(e<=d){let i=s+r+((l?e==s?-1:e==d?1:t:t)<0?0:c);if(n)return i;let a=e==(t<0?s:d)?null:o/3+(e-s)*de,u=e==s?2:e==d?1:4;return(t<0?e!=s:e!=d)&&(u|=8),new he(i,u,a)}r+=c-l}return n?e+r:new he(e+r,0,null)}touches(e,t){let n=0,r=ue(t),i=this.inverted?2:1,a=this.inverted?1:2;for(let t=0;t<this.ranges.length;t+=3){let o=this.ranges[t]-(this.inverted?n:0);if(o>e)break;let s=this.ranges[t+i];if(e<=o+s&&t==3*r)return!0;n+=this.ranges[t+a]-s}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,i=0;r<this.ranges.length;r+=3){let a=this.ranges[r],o=a-(this.inverted?i:0),s=a+(this.inverted?0:i),l=this.ranges[r+t],c=this.ranges[r+n];e(o,o+l,s,s+c),i+=c-l}}invert(){return new fe(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?fe.empty:new fe(e<0?[0,-e,0]:[0,0,e])}}fe.empty=new fe([]);const pe=Object.create(null);class me{getMap(){return fe.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=pe[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in pe)throw new RangeError("Duplicate use of step JSON ID "+e);return pe[e]=t,t.prototype.jsonID=e,t}}class ge{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new ge(e,null)}static fail(e){return new ge(null,e)}static fromReplace(e,t,n,r){try{return ge.ok(e.replace(t,n,r))}catch(e){if(e instanceof H)return ge.fail(e.message);throw e}}}function ve(e,t,n){let r=[];for(let i=0;i<e.childCount;i++){let a=e.child(i);a.content.size&&(a=a.copy(ve(a.content,t,a))),a.isInline&&(a=t(a,n,i)),r.push(a)}return z.fromArray(r)}class ye extends me{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),r=n.node(n.sharedDepth(this.to)),i=new V(ve(t.content,((e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e),r),t.openStart,t.openEnd);return ge.fromReplace(e,this.from,this.to,i)}invert(){return new be(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new ye(t.pos,n.pos,this.mark)}merge(e){return e instanceof ye&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ye(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ye(t.from,t.to,e.markFromJSON(t.mark))}}me.jsonID("addMark",ye);class be extends me{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new V(ve(t.content,(e=>e.mark(this.mark.removeFromSet(e.marks))),e),t.openStart,t.openEnd);return ge.fromReplace(e,this.from,this.to,n)}invert(){return new ye(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new be(t.pos,n.pos,this.mark)}merge(e){return e instanceof be&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new be(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new be(t.from,t.to,e.markFromJSON(t.mark))}}me.jsonID("removeMark",be);class ke extends me{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return ge.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return ge.fromReplace(e,this.pos,this.pos+1,new V(z.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(e))return new ke(this.pos,t.marks[n]);return new ke(this.pos,this.mark)}}return new we(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new ke(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new ke(t.pos,e.markFromJSON(t.mark))}}me.jsonID("addNodeMark",ke);class we extends me{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return ge.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return ge.fromReplace(e,this.pos,this.pos+1,new V(z.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new ke(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new we(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new we(t.pos,e.markFromJSON(t.mark))}}me.jsonID("removeNodeMark",we);class xe extends me{constructor(e,t,n,r=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=r}apply(e){return this.structure&&Ee(e,this.from,this.to)?ge.fail("Structure replace would overwrite content"):ge.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new fe([this.from,this.to-this.from,this.slice.size])}invert(e){return new xe(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new xe(t.pos,Math.max(t.pos,n.pos),this.slice)}merge(e){if(!(e instanceof xe)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?V.empty:new V(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new xe(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?V.empty:new V(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new xe(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new xe(t.from,t.to,V.fromJSON(e,t.slice),!!t.structure)}}me.jsonID("replace",xe);class Se extends me{constructor(e,t,n,r,i,a,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=r,this.slice=i,this.insert=a,this.structure=o}apply(e){if(this.structure&&(Ee(e,this.from,this.gapFrom)||Ee(e,this.gapTo,this.to)))return ge.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return ge.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?ge.fromReplace(e,this.from,this.to,n):ge.fail("Content does not fit in gap")}getMap(){return new fe([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Se(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),r=e.map(this.gapFrom,-1),i=e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||r<t.pos||i>n.pos?null:new Se(t.pos,n.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Se(t.from,t.to,t.gapFrom,t.gapTo,V.fromJSON(e,t.slice),t.insert,!!t.structure)}}function Ee(e,t,n){let r=e.resolve(t),i=n-t,a=r.depth;for(;i>0&&a>0&&r.indexAfter(a)==r.node(a).childCount;)a--,i--;if(i>0){let e=r.node(a).maybeChild(r.indexAfter(a));for(;i>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,i--}}return!1}me.jsonID("replaceAround",Se);class Ce extends me{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return ge.fail("No node at attribute step's position");let n=Object.create(null);for(let e in t.attrs)n[e]=t.attrs[e];n[this.attr]=this.value;let r=t.type.create(n,null,t.marks);return ge.fromReplace(e,this.pos,this.pos+1,new V(z.from(r),0,t.isLeaf?0:1))}getMap(){return fe.empty}invert(e){return new Ce(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ce(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new Ce(t.pos,t.attr,t.value)}}me.jsonID("attr",Ce);class $e extends me{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let n in e.attrs)t[n]=e.attrs[n];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return ge.ok(n)}getMap(){return fe.empty}invert(e){return new $e(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if("string"!=typeof t.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new $e(t.attr,t.value)}}me.jsonID("docAttr",$e);let Ae=class extends Error{};Ae=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(Ae.prototype=Object.create(Error.prototype)).constructor=Ae,Ae.prototype.name="TransformError";const Te=Object.create(null);class Me{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Ne(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=V.empty){let n=t.content.lastChild,r=null;for(let e=0;e<t.openEnd;e++)r=n,n=n.lastChild;let i=e.steps.length,a=this.ranges;for(let o=0;o<a.length;o++){let{$from:s,$to:l}=a[o],c=e.mapping.slice(i);e.replaceRange(c.map(s.pos),c.map(l.pos),o?V.empty:t),0==o&&Pe(e,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){let{$from:a,$to:o}=r[i],s=e.mapping.slice(n),l=s.map(a.pos),c=s.map(o.pos);i?e.deleteRange(l,c):(e.replaceRangeWith(l,c,t),Pe(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new Le(e):ze(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let r=e.depth-1;r>=0;r--){let i=t<0?ze(e.node(0),e.node(r),e.before(r+1),e.index(r),t,n):ze(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,n);if(i)return i}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new qe(e.node(0))}static atStart(e){return ze(e,e,0,0,1)||new qe(e)}static atEnd(e){return ze(e,e,e.content.size,e.childCount,-1)||new qe(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=Te[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Te)throw new RangeError("Duplicate use of selection JSON ID "+e);return Te[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Le.between(this.$anchor,this.$head).getBookmark()}}Me.prototype.visible=!0;class Ne{constructor(e,t){this.$from=e,this.$to=t}}let Oe=!1;function Ie(e){Oe||e.parent.inlineContent||(Oe=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class Le extends Me{constructor(e,t=e){Ie(e),Ie(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Me.near(n);let r=e.resolve(t.map(this.anchor));return new Le(r.parent.inlineContent?r:n,n)}replace(e,t=V.empty){if(super.replace(e,t),t==V.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof Le&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new De(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new Le(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(e,t,n){let r=e.pos-t.pos;if(n&&!r||(n=r>=0?1:-1),!t.parent.inlineContent){let e=Me.findFrom(t,n,!0)||Me.findFrom(t,-n,!0);if(!e)return Me.near(t,n);t=e.$head}return e.parent.inlineContent||(0==r||(e=(Me.findFrom(e,-n,!0)||Me.findFrom(e,n,!0)).$anchor).pos<t.pos!=r<0)&&(e=t),new Le(e,t)}}Me.jsonID("text",Le);class De{constructor(e,t){this.anchor=e,this.head=t}map(e){return new De(e.map(this.anchor),e.map(this.head))}resolve(e){return Le.between(e.resolve(this.anchor),e.resolve(this.head))}}class _e extends Me{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:r}=t.mapResult(this.anchor),i=e.resolve(r);return n?Me.near(i):new _e(i)}content(){return new V(z.from(this.node),0,0)}eq(e){return e instanceof _e&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Re(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new _e(e.resolve(t.anchor))}static create(e,t){return new _e(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}_e.prototype.visible=!1,Me.jsonID("node",_e);class Re{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new De(n,n):new Re(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&_e.isSelectable(n)?new _e(t):Me.near(t)}}class qe extends Me{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=V.empty){if(t==V.empty){e.delete(0,e.doc.content.size);let t=Me.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new qe(e)}map(e){return new qe(e)}eq(e){return e instanceof qe}getBookmark(){return Fe}}Me.jsonID("all",qe);const Fe={map(){return this},resolve:e=>new qe(e)};function ze(e,t,n,r,i,a=!1){if(t.inlineContent)return Le.create(e,n);for(let o=r-(i>0?0:1);i>0?o<t.childCount:o>=0;o+=i){let r=t.child(o);if(r.isAtom){if(!a&&_e.isSelectable(r))return _e.create(e,n-(i<0?r.nodeSize:0))}else{let t=ze(e,r,n+i,i<0?r.childCount:0,i,a);if(t)return t}n+=r.nodeSize*i}return null}function Pe(e,t,n){let r=e.steps.length-1;if(r<t)return;let i,a=e.steps[r];(a instanceof xe||a instanceof Se)&&(e.mapping.maps[r].forEach(((e,t,n,r)=>{null==i&&(i=r)})),e.setSelection(Me.near(e.doc.resolve(i),n)))}function Be(e,t){return t&&e?e.bind(t):e}class Je{constructor(e,t,n){this.name=e,this.init=Be(t.init,n),this.apply=Be(t.apply,n)}}new Je("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new Je("selection",{init:(e,t)=>e.selection||Me.atStart(t.doc),apply:e=>e.selection}),new Je("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,n,r)=>r.selection.$cursor?e.storedMarks:null}),new Je("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t});const je=function(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t},He=function(e,t,n,r){return n&&(We(e,t,n,r,-1)||We(e,t,n,r,1))},Ve=/^(img|br|input|textarea|hr)$/i;function We(e,t,n,r,i){for(;;){if(e==n&&t==r)return!0;if(t==(i<0?0:Ke(e))){let n=e.parentNode;if(!n||1!=n.nodeType||Ye(e)||Ve.test(e.nodeName)||"false"==e.contentEditable)return!1;t=je(e)+(i<0?0:1),e=n}else{if(1!=e.nodeType)return!1;if("false"==(e=e.childNodes[t+(i<0?-1:0)]).contentEditable)return!1;t=i<0?Ke(e):0}}}function Ke(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function Ye(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const Ge=function(e){return e.focusNode&&He(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function Ue(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}const Xe="undefined"!=typeof navigator?navigator:null,Ze="undefined"!=typeof document?document:null,Qe=Xe&&Xe.userAgent||"",et=/Edge\/(\d+)/.exec(Qe),tt=/MSIE \d/.exec(Qe),nt=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Qe),rt=!!(tt||nt||et),it=tt?document.documentMode:nt?+nt[1]:et?+et[1]:0,at=!rt&&/gecko\/(\d+)/i.test(Qe);at&&(/Firefox\/(\d+)/.exec(Qe)||[0,0])[1];const ot=!rt&&/Chrome\/(\d+)/.exec(Qe),st=!!ot,lt=ot?+ot[1]:0,ct=!rt&&!!Xe&&/Apple Computer/.test(Xe.vendor),dt=ct&&(/Mobile\/\w+/.test(Qe)||!!Xe&&Xe.maxTouchPoints>2),ut=dt||!!Xe&&/Mac/.test(Xe.platform),ht=!!Xe&&/Win/.test(Xe.platform),ft=/Android \d/.test(Qe),pt=!!Ze&&"webkitFontSmoothing"in Ze.documentElement.style,mt=pt?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function gt(e,t=null){let n=e.domSelectionRange(),r=e.state.doc;if(!n.focusNode)return null;let i=e.docView.nearestDesc(n.focusNode),a=i&&0==i.size,o=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let s,l,c=r.resolve(o);if(Ge(n)){for(s=o;i&&!i.node;)i=i.parent;let e=i.node;if(i&&e.isAtom&&_e.isSelectable(e)&&i.parent&&(!e.isInline||!function(e,t,n){for(let r=0==t,i=t==Ke(e);r||i;){if(e==n)return!0;let t=je(e);if(!(e=e.parentNode))return!1;r=r&&0==t,i=i&&t==Ke(e)}}(n.focusNode,n.focusOffset,i.dom))){let e=i.posBefore;l=new _e(o==e?c:r.resolve(e))}}else{if(n instanceof e.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let t=o,i=o;for(let r=0;r<n.rangeCount;r++){let a=n.getRangeAt(r);t=Math.min(t,e.docView.posFromDOM(a.startContainer,a.startOffset,1)),i=Math.max(i,e.docView.posFromDOM(a.endContainer,a.endOffset,-1))}if(t<0)return null;[s,o]=i==e.state.selection.anchor?[i,t]:[t,i],c=r.resolve(o)}else s=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(s<0)return null}let d=r.resolve(s);if(!l){l=Et(e,d,c,"pointer"==t||e.state.selection.head<c.pos&&!a?1:-1)}return l}function vt(e){return e.editable?e.hasFocus():function(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(e){return!1}}(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function yt(e,t=!1){let n=e.state.selection;if(function(e,t){if(t instanceof _e){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(St(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else St(e)}(e,n),vt(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&st){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&He(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset))return e.input.mouseDown.delayedSelectionSync=!0,void e.domObserver.setCurSelection()}if(e.domObserver.disconnectSelection(),e.cursorWrapper)!function(e){let t=e.domSelection(),n=document.createRange();if(!t)return;let r=e.cursorWrapper.dom,i="IMG"==r.nodeName;i?n.setStart(r.parentNode,je(r)+1):n.setStart(r,0);n.collapse(!0),t.removeAllRanges(),t.addRange(n),!i&&!e.state.selection.visible&&rt&&it<=11&&(r.disabled=!0,r.disabled=!1)}(e);else{let r,i,{anchor:a,head:o}=n;!bt||n instanceof Le||(n.$from.parent.inlineContent||(r=kt(e,n.from)),n.empty||n.$from.parent.inlineContent||(i=kt(e,n.to))),e.docView.setSelection(a,o,e,t),bt&&(r&&xt(r),i&&xt(i)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{n.anchorNode==r&&n.anchorOffset==i||(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout((()=>{vt(e)&&!e.state.selection.visible||e.dom.classList.remove("ProseMirror-hideselection")}),20))})}(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const bt=ct||st&&lt<63;function kt(e,t){let{node:n,offset:r}=e.docView.domFromPos(t,0),i=r<n.childNodes.length?n.childNodes[r]:null,a=r?n.childNodes[r-1]:null;if(ct&&i&&"false"==i.contentEditable)return wt(i);if(!(i&&"false"!=i.contentEditable||a&&"false"!=a.contentEditable)){if(i)return wt(i);if(a)return wt(a)}}function wt(e){return e.contentEditable="true",ct&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function xt(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function St(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function Et(e,t,n,r){return e.someProp("createSelectionBetween",(r=>r(e,t,n)))||Le.between(t,n,r)}function Ct(e,t){let{$anchor:n,$head:r}=e.selection,i=t>0?n.max(r):n.min(r),a=i.parent.inlineContent?i.depth?e.doc.resolve(t>0?i.after():i.before()):null:i;return a&&Me.findFrom(a,t)}function $t(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function At(e,t,n){let r=e.state.selection;if(!(r instanceof Le)){if(r instanceof _e&&r.node.isInline)return $t(e,new Le(t>0?r.$to:r.$from));{let n=Ct(e.state,t);return!!n&&$t(e,n)}}if(n.indexOf("s")>-1){let{$head:n}=r,i=n.textOffset?null:t<0?n.nodeBefore:n.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let a=e.state.doc.resolve(n.pos+i.nodeSize*(t<0?-1:1));return $t(e,new Le(r.$anchor,a))}if(!r.empty)return!1;if(e.endOfTextblock(t>0?"forward":"backward")){let n=Ct(e.state,t);return!!(n&&n instanceof _e)&&$t(e,n)}if(!(ut&&n.indexOf("m")>-1)){let n,i=r.$head,a=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter;if(!a||a.isText)return!1;let o=t<0?i.pos-a.nodeSize:i.pos;return!!(a.isAtom||(n=e.docView.descAt(o))&&!n.contentDOM)&&(_e.isSelectable(a)?$t(e,new _e(t<0?e.state.doc.resolve(i.pos-a.nodeSize):i)):!!pt&&$t(e,new Le(e.state.doc.resolve(t<0?o:o+a.nodeSize))))}}function Tt(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function Mt(e,t){let n=e.pmViewDesc;return n&&0==n.size&&(t<0||e.nextSibling||"BR"!=e.nodeName)}function Nt(e,t){return t<0?function(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let i,a,o=!1;at&&1==n.nodeType&&r<Tt(n)&&Mt(n.childNodes[r],-1)&&(o=!0);for(;;)if(r>0){if(1!=n.nodeType)break;{let e=n.childNodes[r-1];if(Mt(e,-1))i=n,a=--r;else{if(3!=e.nodeType)break;n=e,r=n.nodeValue.length}}}else{if(Ot(n))break;{let t=n.previousSibling;for(;t&&Mt(t,-1);)i=n.parentNode,a=je(t),t=t.previousSibling;if(t)n=t,r=Tt(n);else{if(n=n.parentNode,n==e.dom)break;r=0}}}o?It(e,n,r):i&&It(e,i,a)}(e):function(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let i,a,o=Tt(n);for(;;)if(r<o){if(1!=n.nodeType)break;if(!Mt(n.childNodes[r],1))break;i=n,a=++r}else{if(Ot(n))break;{let t=n.nextSibling;for(;t&&Mt(t,1);)i=t.parentNode,a=je(t)+1,t=t.nextSibling;if(t)n=t,r=0,o=Tt(n);else{if(n=n.parentNode,n==e.dom)break;r=o=0}}}i&&It(e,i,a)}(e)}function Ot(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function It(e,t,n){if(3!=t.nodeType){let e,r;(r=function(e,t){for(;e&&t==e.childNodes.length&&!Ye(e);)t=je(e)+1,e=e.parentNode;for(;e&&t<e.childNodes.length;){let n=e.childNodes[t];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;e=n,t=0}}(t,n))?(t=r,n=0):(e=function(e,t){for(;e&&!t&&!Ye(e);)t=je(e),e=e.parentNode;for(;e&&t;){let n=e.childNodes[t-1];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;t=(e=n).childNodes.length}}(t,n))&&(t=e,n=e.nodeValue.length)}let r=e.domSelection();if(!r)return;if(Ge(r)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),r.removeAllRanges(),r.addRange(e)}else r.extend&&r.extend(t,n);e.domObserver.setCurSelection();let{state:i}=e;setTimeout((()=>{e.state==i&&yt(e)}),50)}function Lt(e,t){let n=e.state.doc.resolve(t);if(!st&&!ht&&n.parent.inlineContent){let r=e.coordsAtPos(t);if(t>n.start()){let n=e.coordsAtPos(t-1),i=(n.top+n.bottom)/2;if(i>r.top&&i<r.bottom&&Math.abs(n.left-r.left)>1)return n.left<r.left?"ltr":"rtl"}if(t<n.end()){let n=e.coordsAtPos(t+1),i=(n.top+n.bottom)/2;if(i>r.top&&i<r.bottom&&Math.abs(n.left-r.left)>1)return n.left>r.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(e.dom).direction?"rtl":"ltr"}function Dt(e,t,n){let r=e.state.selection;if(r instanceof Le&&!r.empty||n.indexOf("s")>-1)return!1;if(ut&&n.indexOf("m")>-1)return!1;let{$from:i,$to:a}=r;if(!i.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let n=Ct(e.state,t);if(n&&n instanceof _e)return $t(e,n)}if(!i.parent.inlineContent){let n=t<0?i:a,o=r instanceof qe?Me.near(n,t):Me.findFrom(n,t);return!!o&&$t(e,o)}return!1}function _t(e,t){if(!(e.state.selection instanceof Le))return!0;let{$head:n,$anchor:r,empty:i}=e.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let a=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(a&&!a.isText){let r=e.state.tr;return t<0?r.delete(n.pos-a.nodeSize,n.pos):r.delete(n.pos,n.pos+a.nodeSize),e.dispatch(r),!0}return!1}function Rt(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function qt(e,t){let n=t.keyCode,r=function(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}(t);if(8==n||ut&&72==n&&"c"==r)return _t(e,-1)||Nt(e,-1);if(46==n&&!t.shiftKey||ut&&68==n&&"c"==r)return _t(e,1)||Nt(e,1);if(13==n||27==n)return!0;if(37==n||ut&&66==n&&"c"==r){let t=37==n?"ltr"==Lt(e,e.state.selection.from)?-1:1:-1;return At(e,t,r)||Nt(e,t)}if(39==n||ut&&70==n&&"c"==r){let t=39==n?"ltr"==Lt(e,e.state.selection.from)?1:-1:1;return At(e,t,r)||Nt(e,t)}return 38==n||ut&&80==n&&"c"==r?Dt(e,-1,r)||Nt(e,-1):40==n||ut&&78==n&&"c"==r?function(e){if(!ct||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&1==t.nodeType&&0==n&&t.firstChild&&"false"==t.firstChild.contentEditable){let n=t.firstChild;Rt(e,n,"true"),setTimeout((()=>Rt(e,n,"false")),20)}return!1}(e)||Dt(e,1,r)||Nt(e,1):r==(ut?"m":"c")&&(66==n||73==n||89==n||90==n)}function Ft(e,t){e.someProp("transformCopied",(n=>{t=n(t,e)}));let n=[],{content:r,openStart:i,openEnd:a}=t;for(;i>1&&a>1&&1==r.childCount&&1==r.firstChild.childCount;){i--,a--;let e=r.firstChild;n.push(e.type.name,e.attrs!=e.type.defaultAttrs?e.attrs:null),r=e.content}let o=e.someProp("clipboardSerializer")||ie.fromSchema(e.state.schema),s=Yt(),l=s.createElement("div");l.appendChild(o.serializeFragment(r,{document:s}));let c,d=l.firstChild,u=0;for(;d&&1==d.nodeType&&(c=Wt[d.nodeName.toLowerCase()]);){for(let e=c.length-1;e>=0;e--){let t=s.createElement(c[e]);for(;l.firstChild;)t.appendChild(l.firstChild);l.appendChild(t),u++}d=l.firstChild}return d&&1==d.nodeType&&d.setAttribute("data-pm-slice",`${i} ${a}${u?` -${u}`:""} ${JSON.stringify(n)}`),{dom:l,text:e.someProp("clipboardTextSerializer",(n=>n(t,e)))||t.content.textBetween(0,t.content.size,"\n\n"),slice:t}}function zt(e,t,n,r,i){let a,o,s=i.parent.type.spec.code;if(!n&&!t)return null;let l=t&&(r||s||!n);if(l){if(e.someProp("transformPastedText",(n=>{t=n(t,s||r,e)})),s)return t?new V(z.from(e.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0):V.empty;let n=e.someProp("clipboardTextParser",(n=>n(t,i,r,e)));if(n)o=n;else{let n=i.marks(),{schema:r}=e.state,o=ie.fromSchema(r);a=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach((e=>{let t=a.appendChild(document.createElement("p"));e&&t.appendChild(o.serializeNode(r.text(e,n)))}))}}else e.someProp("transformPastedHTML",(t=>{n=t(n,e)})),a=function(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n,r=Yt().createElement("div"),i=/<([a-z][^>\s]+)/i.exec(e);(n=i&&Wt[i[1].toLowerCase()])&&(e=n.map((e=>"<"+e+">")).join("")+e+n.map((e=>"</"+e+">")).reverse().join(""));if(r.innerHTML=function(e){let t=window.trustedTypes;if(!t)return e;Gt||(Gt=t.createPolicy("ProseMirrorClipboard",{createHTML:e=>e}));return Gt.createHTML(e)}(e),n)for(let e=0;e<n.length;e++)r=r.querySelector(n[e])||r;return r}(n),pt&&function(e){let t=e.querySelectorAll(st?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let r=t[n];1==r.childNodes.length&&" "==r.textContent&&r.parentNode&&r.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),r)}}(a);let c=a&&a.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let e=+d[3];e>0;e--){let e=a.firstChild;for(;e&&1!=e.nodeType;)e=e.nextSibling;if(!e)break;a=e}if(!o){let t=e.someProp("clipboardParser")||e.someProp("domParser")||Y.fromSchema(e.state.schema);o=t.parseSlice(a,{preserveWhitespace:!(!l&&!d),context:i,ruleFromNode:e=>"BR"!=e.nodeName||e.nextSibling||!e.parentNode||Pt.test(e.parentNode.nodeName)?null:{ignore:!0}})}if(d)o=function(e,t){if(!e.size)return e;let n,r=e.content.firstChild.type.schema;try{n=JSON.parse(t)}catch(t){return e}let{content:i,openStart:a,openEnd:o}=e;for(let e=n.length-2;e>=0;e-=2){let t=r.nodes[n[e]];if(!t||t.hasRequiredAttrs())break;i=z.from(t.create(n[e+1],i)),a++,o++}return new V(i,a,o)}(Vt(o,+d[1],+d[2]),d[4]);else if(o=V.maxOpen(function(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let r,i=t.node(n).contentMatchAt(t.index(n)),a=[];if(e.forEach((e=>{if(!a)return;let t,n=i.findWrapping(e.type);if(!n)return a=null;if(t=a.length&&r.length&&Jt(n,r,e,a[a.length-1],0))a[a.length-1]=t;else{a.length&&(a[a.length-1]=jt(a[a.length-1],r.length));let t=Bt(e,n);a.push(t),i=i.matchType(t.type),r=n}})),a)return z.from(a)}return e}(o.content,i),!0),o.openStart||o.openEnd){let e=0,t=0;for(let t=o.content.firstChild;e<o.openStart&&!t.type.spec.isolating;e++,t=t.firstChild);for(let e=o.content.lastChild;t<o.openEnd&&!e.type.spec.isolating;t++,e=e.lastChild);o=Vt(o,e,t)}return e.someProp("transformPasted",(t=>{o=t(o,e)})),o}const Pt=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Bt(e,t,n=0){for(let r=t.length-1;r>=n;r--)e=t[r].create(null,z.from(e));return e}function Jt(e,t,n,r,i){if(i<e.length&&i<t.length&&e[i]==t[i]){let a=Jt(e,t,n,r.lastChild,i+1);if(a)return r.copy(r.content.replaceChild(r.childCount-1,a));if(r.contentMatchAt(r.childCount).matchType(i==e.length-1?n.type:e[i+1]))return r.copy(r.content.append(z.from(Bt(n,e,i+1))))}}function jt(e,t){if(0==t)return e;let n=e.content.replaceChild(e.childCount-1,jt(e.lastChild,t-1)),r=e.contentMatchAt(e.childCount).fillBefore(z.empty,!0);return e.copy(n.append(r))}function Ht(e,t,n,r,i,a){let o=t<0?e.firstChild:e.lastChild,s=o.content;return e.childCount>1&&(a=0),i<r-1&&(s=Ht(s,t,n,r,i+1,a)),i>=n&&(s=t<0?o.contentMatchAt(0).fillBefore(s,a<=i).append(s):s.append(o.contentMatchAt(o.childCount).fillBefore(z.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,o.copy(s))}function Vt(e,t,n){return t<e.openStart&&(e=new V(Ht(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new V(Ht(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}const Wt={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Kt=null;function Yt(){return Kt||(Kt=document.implementation.createHTMLDocument("title"))}let Gt=null;const Ut={},Xt={};function Zt(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function Qt(e){return{left:e.clientX,top:e.clientY}}function en(e,t,n,r,i){if(-1==r)return!1;let a=e.state.doc.resolve(r);for(let r=a.depth+1;r>0;r--)if(e.someProp(t,(t=>r>a.depth?t(e,n,a.nodeAfter,a.before(r),i,!0):t(e,n,a.node(r),a.before(r),i,!1))))return!0;return!1}function tn(e,t,n){if(e.focused||e.focus(),e.state.selection.eq(t))return;let r=e.state.tr.setSelection(t);"pointer"==n&&r.setMeta("pointer",!0),e.dispatch(r)}function nn(e,t,n,r,i){return en(e,"handleClickOn",t,n,r)||e.someProp("handleClick",(n=>n(e,t,r)))||(i?function(e,t){if(-1==t)return!1;let n,r,i=e.state.selection;i instanceof _e&&(n=i.node);let a=e.state.doc.resolve(t);for(let e=a.depth+1;e>0;e--){let t=e>a.depth?a.nodeAfter:a.node(e);if(_e.isSelectable(t)){r=n&&i.$from.depth>0&&e>=i.$from.depth&&a.before(i.$from.depth+1)==i.$from.pos?a.before(i.$from.depth):a.before(e);break}}return null!=r&&(tn(e,_e.create(e.state.doc,r),"pointer"),!0)}(e,n):function(e,t){if(-1==t)return!1;let n=e.state.doc.resolve(t),r=n.nodeAfter;return!!(r&&r.isAtom&&_e.isSelectable(r))&&(tn(e,new _e(n),"pointer"),!0)}(e,n))}function rn(e,t,n,r){return en(e,"handleDoubleClickOn",t,n,r)||e.someProp("handleDoubleClick",(n=>n(e,t,r)))}function an(e,t,n,r){return en(e,"handleTripleClickOn",t,n,r)||e.someProp("handleTripleClick",(n=>n(e,t,r)))||function(e,t,n){if(0!=n.button)return!1;let r=e.state.doc;if(-1==t)return!!r.inlineContent&&(tn(e,Le.create(r,0,r.content.size),"pointer"),!0);let i=r.resolve(t);for(let t=i.depth+1;t>0;t--){let n=t>i.depth?i.nodeAfter:i.node(t),a=i.before(t);if(n.inlineContent)tn(e,Le.create(r,a+1,a+1+n.content.size),"pointer");else{if(!_e.isSelectable(n))continue;tn(e,_e.create(r,a),"pointer")}return!0}}(e,n,r)}function on(e){return fn(e)}Xt.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=16==n.keyCode||n.shiftKey,!cn(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!ft||!st||13!=n.keyCode))if(229!=n.keyCode&&e.domObserver.forceFlush(),!dt||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)e.someProp("handleKeyDown",(t=>t(e,n)))||qt(e,n)?n.preventDefault():Zt(e,"key");else{let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{e.input.lastIOSEnter==t&&(e.someProp("handleKeyDown",(t=>t(e,Ue(13,"Enter")))),e.input.lastIOSEnter=0)}),200)}},Xt.keyup=(e,t)=>{16==t.keyCode&&(e.input.shiftKey=!1)},Xt.keypress=(e,t)=>{let n=t;if(cn(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||ut&&n.metaKey)return;if(e.someProp("handleKeyPress",(t=>t(e,n))))return void n.preventDefault();let r=e.state.selection;if(!(r instanceof Le&&r.$from.sameParent(r.$to))){let t=String.fromCharCode(n.charCode);/[\r\n]/.test(t)||e.someProp("handleTextInput",(n=>n(e,r.$from.pos,r.$to.pos,t)))||e.dispatch(e.state.tr.insertText(t).scrollIntoView()),n.preventDefault()}};const sn=ut?"metaKey":"ctrlKey";Ut.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let r=on(e),i=Date.now(),a="singleClick";i-e.input.lastClick.time<500&&function(e,t){let n=t.x-e.clientX,r=t.y-e.clientY;return n*n+r*r<100}(n,e.input.lastClick)&&!n[sn]&&("singleClick"==e.input.lastClick.type?a="doubleClick":"doubleClick"==e.input.lastClick.type&&(a="tripleClick")),e.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:a};let o=e.posAtCoords(Qt(n));o&&("singleClick"==a?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new ln(e,o,n,!!r)):("doubleClick"==a?rn:an)(e,o.pos,o.inside,n)?n.preventDefault():Zt(e,"pointer"))};class ln{constructor(e,t,n,r){let i,a;if(this.view=e,this.pos=t,this.event=n,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[sn],this.allowDefault=n.shiftKey,t.inside>-1)i=e.state.doc.nodeAt(t.inside),a=t.inside;else{let n=e.state.doc.resolve(t.pos);i=n.parent,a=n.depth?n.before():0}const o=r?null:n.target,s=o?e.docView.nearestDesc(o,!0):null;this.target=s&&1==s.dom.nodeType?s.dom:null;let{selection:l}=e.state;(0==n.button&&i.type.spec.draggable&&!1!==i.type.spec.selectable||l instanceof _e&&l.from<=a&&l.to>a)&&(this.mightDrag={node:i,pos:a,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!at||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Zt(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>yt(this.view))),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(Qt(e))),this.updateAllowDefault(e),this.allowDefault||!t?Zt(this.view,"pointer"):nn(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||ct&&this.mightDrag&&!this.mightDrag.node.isAtom||st&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(tn(this.view,Me.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):Zt(this.view,"pointer")}move(e){this.updateAllowDefault(e),Zt(this.view,"pointer"),0==e.buttons&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}function cn(e,t){return!!e.composing||!!(ct&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500)&&(e.input.compositionEndedAt=-2e8,!0)}Ut.touchstart=e=>{e.input.lastTouch=Date.now(),on(e),Zt(e,"pointer")},Ut.touchmove=e=>{e.input.lastTouch=Date.now(),Zt(e,"pointer")},Ut.contextmenu=e=>on(e);const dn=ft?5e3:-1;function un(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout((()=>fn(e)),t))}function hn(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=function(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function fn(e,t=!1){if(!(ft&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),hn(e),t||e.docView&&e.docView.dirty){let n=gt(e);return n&&!n.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(n)):!e.markCursor&&!t||e.state.selection.empty?e.updateState(e.state):e.dispatch(e.state.tr.deleteSelection()),!0}return!1}}Xt.compositionstart=Xt.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$to;if(t.selection instanceof Le&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((e=>!1===e.type.spec.inclusive))))e.markCursor=e.state.storedMarks||n.marks(),fn(e,!0),e.markCursor=null;else if(fn(e,!t.selection.empty),at&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,r=t.focusOffset;n&&1==n.nodeType&&0!=r;){let t=r<0?n.lastChild:n.childNodes[r-1];if(!t)break;if(3==t.nodeType){let n=e.domSelection();n&&n.collapse(t,t.nodeValue.length);break}n=t,r=-1}}e.input.composing=!0}un(e,dn)},Xt.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionPendingChanges=e.domObserver.pendingRecords().length?e.input.compositionID:0,e.input.compositionNode=null,e.input.compositionPendingChanges&&Promise.resolve().then((()=>e.domObserver.flush())),e.input.compositionID++,un(e,20))};const pn=rt&&it<15||dt&&mt<604;function mn(e,t,n,r,i){let a=zt(e,t,n,r,e.state.selection.$from);if(e.someProp("handlePaste",(t=>t(e,i,a||V.empty))))return!0;if(!a)return!1;let o=function(e){return 0==e.openStart&&0==e.openEnd&&1==e.content.childCount?e.content.firstChild:null}(a),s=o?e.state.tr.replaceSelectionWith(o,r):e.state.tr.replaceSelection(a);return e.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function gn(e){let t=e.getData("text/plain")||e.getData("Text");if(t)return t;let n=e.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Ut.copy=Xt.cut=(e,t)=>{let n=t,r=e.state.selection,i="cut"==n.type;if(r.empty)return;let a=pn?null:n.clipboardData,o=r.content(),{dom:s,text:l}=Ft(e,o);a?(n.preventDefault(),a.clearData(),a.setData("text/html",s.innerHTML),a.setData("text/plain",l)):function(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(t),e.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()}),50)}(e,s),i&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},Xt.paste=(e,t)=>{let n=t;if(e.composing&&!ft)return;let r=pn?null:n.clipboardData,i=e.input.shiftKey&&45!=e.input.lastKeyCode;r&&mn(e,gn(r),r.getData("text/html"),i,n)?n.preventDefault():function(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,r=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=e.input.shiftKey&&45!=e.input.lastKeyCode;setTimeout((()=>{e.focus(),r.parentNode&&r.parentNode.removeChild(r),n?mn(e,r.value,null,i,t):mn(e,r.textContent,r.innerHTML,i,t)}),50)}(e,n)};class vn{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}}const yn=ut?"altKey":"ctrlKey";Ut.dragstart=(e,t)=>{let n=t,r=e.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i,a=e.state.selection,o=a.empty?null:e.posAtCoords(Qt(n));if(o&&o.pos>=a.from&&o.pos<=(a instanceof _e?a.to-1:a.to));else if(r&&r.mightDrag)i=_e.create(e.state.doc,r.mightDrag.pos);else if(n.target&&1==n.target.nodeType){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&(i=_e.create(e.state.doc,t.posBefore))}let s=(i||e.state.selection).content(),{dom:l,text:c,slice:d}=Ft(e,s);(!n.dataTransfer.files.length||!st||lt>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(pn?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",pn||n.dataTransfer.setData("text/plain",c),e.dragging=new vn(d,!n[yn],i)},Ut.dragend=e=>{let t=e.dragging;window.setTimeout((()=>{e.dragging==t&&(e.dragging=null)}),50)},Xt.dragover=Xt.dragenter=(e,t)=>t.preventDefault(),Xt.drop=(e,t)=>{let n=t,r=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let i=e.posAtCoords(Qt(n));if(!i)return;let a=e.state.doc.resolve(i.pos),o=r&&r.slice;o?e.someProp("transformPasted",(t=>{o=t(o,e)})):o=zt(e,gn(n.dataTransfer),pn?null:n.dataTransfer.getData("text/html"),!1,a);let s=!(!r||n[yn]);if(e.someProp("handleDrop",(t=>t(e,n,o||V.empty,s))))return void n.preventDefault();if(!o)return;n.preventDefault();let l=o?function(e,t,n){let r=e.resolve(t);if(!n.content.size)return t;let i=n.content;for(let e=0;e<n.openStart;e++)i=i.firstChild.content;for(let e=1;e<=(0==n.openStart&&n.size?2:1);e++)for(let t=r.depth;t>=0;t--){let n=t==r.depth?0:r.pos<=(r.start(t+1)+r.end(t+1))/2?-1:1,a=r.index(t)+(n>0?1:0),o=r.node(t),s=!1;if(1==e)s=o.canReplace(a,a,i);else{let e=o.contentMatchAt(a).findWrapping(i.firstChild.type);s=e&&o.canReplaceWith(a,a,e[0])}if(s)return 0==n?r.pos:n<0?r.before(t+1):r.after(t+1)}return null}(e.state.doc,a.pos,o):a.pos;null==l&&(l=a.pos);let c=e.state.tr;if(s){let{node:e}=r;e?e.replace(c):c.deleteSelection()}let d=c.mapping.map(l),u=0==o.openStart&&0==o.openEnd&&1==o.content.childCount,h=c.doc;if(u?c.replaceRangeWith(d,d,o.content.firstChild):c.replaceRange(d,d,o),c.doc.eq(h))return;let f=c.doc.resolve(d);if(u&&_e.isSelectable(o.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new _e(f));else{let t=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach(((e,n,r,i)=>t=i)),c.setSelection(Et(e,f,c.doc.resolve(t)))}e.focus(),e.dispatch(c.setMeta("uiEvent","drop"))},Ut.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout((()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&yt(e)}),20))},Ut.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},Ut.beforeinput=(e,t)=>{if(st&&ft&&"deleteContentBackward"==t.inputType){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout((()=>{if(e.input.domChangeCount!=t)return;if(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",(t=>t(e,Ue(8,"Backspace")))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}),50)}};for(let e in Xt)Ut[e]=Xt[e];function bn(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}class kn{constructor(e,t){this.toDOM=e,this.spec=t||Cn,this.side=this.spec.side||0}map(e,t,n,r){let{pos:i,deleted:a}=e.mapResult(t.from+r,this.side<0?-1:1);return a?null:new Sn(i-n,i-n,this)}valid(){return!0}eq(e){return this==e||e instanceof kn&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&bn(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class wn{constructor(e,t){this.attrs=e,this.spec=t||Cn}map(e,t,n,r){let i=e.map(t.from+r,this.spec.inclusiveStart?-1:1)-n,a=e.map(t.to+r,this.spec.inclusiveEnd?1:-1)-n;return i>=a?null:new Sn(i,a,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof wn&&bn(this.attrs,e.attrs)&&bn(this.spec,e.spec)}static is(e){return e.type instanceof wn}destroy(){}}class xn{constructor(e,t){this.attrs=e,this.spec=t||Cn}map(e,t,n,r){let i=e.mapResult(t.from+r,1);if(i.deleted)return null;let a=e.mapResult(t.to+r,-1);return a.deleted||a.pos<=i.pos?null:new Sn(i.pos-n,a.pos-n,this)}valid(e,t){let n,{index:r,offset:i}=e.content.findIndex(t.from);return i==t.from&&!(n=e.child(r)).isText&&i+n.nodeSize==t.to}eq(e){return this==e||e instanceof xn&&bn(this.attrs,e.attrs)&&bn(this.spec,e.spec)}destroy(){}}class Sn{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new Sn(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new Sn(e,e,new kn(t,n))}static inline(e,t,n,r){return new Sn(e,t,new wn(n,r))}static node(e,t,n,r){return new Sn(e,t,new xn(n,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof wn}get widget(){return this.type instanceof kn}}const En=[],Cn={};class $n{constructor(e,t){this.local=e.length?e:En,this.children=t.length?t:En}static create(e,t){return t.length?In(t,e,0,Cn):An}find(e,t,n){let r=[];return this.findInner(null==e?0:e,null==t?1e9:t,r,0,n),r}findInner(e,t,n,r,i){for(let a=0;a<this.local.length;a++){let o=this.local[a];o.from<=t&&o.to>=e&&(!i||i(o.spec))&&n.push(o.copy(o.from+r,o.to+r))}for(let a=0;a<this.children.length;a+=3)if(this.children[a]<t&&this.children[a+1]>e){let o=this.children[a]+1;this.children[a+2].findInner(e-o,t-o,n,r+o,i)}}map(e,t,n){return this==An||0==e.maps.length?this:this.mapInner(e,t,0,0,n||Cn)}mapInner(e,t,n,r,i){let a;for(let o=0;o<this.local.length;o++){let s=this.local[o].map(e,n,r);s&&s.type.valid(t,s)?(a||(a=[])).push(s):i.onRemove&&i.onRemove(this.local[o].spec)}return this.children.length?function(e,t,n,r,i,a,o){let s=e.slice();for(let e=0,t=a;e<n.maps.length;e++){let r=0;n.maps[e].forEach(((e,n,i,a)=>{let o=a-i-(n-e);for(let i=0;i<s.length;i+=3){let a=s[i+1];if(a<0||e>a+t-r)continue;let l=s[i]+t-r;n>=l?s[i+1]=e<=l?-2:-1:e>=t&&o&&(s[i]+=o,s[i+1]+=o)}r+=o})),t=n.maps[e].map(t,-1)}let l=!1;for(let t=0;t<s.length;t+=3)if(s[t+1]<0){if(-2==s[t+1]){l=!0,s[t+1]=-1;continue}let c=n.map(e[t]+a),d=c-i;if(d<0||d>=r.content.size){l=!0;continue}let u=n.map(e[t+1]+a,-1)-i,{index:h,offset:f}=r.content.findIndex(d),p=r.maybeChild(h);if(p&&f==d&&f+p.nodeSize==u){let r=s[t+2].mapInner(n,p,c+1,e[t]+a+1,o);r!=An?(s[t]=d,s[t+1]=u,s[t+2]=r):(s[t+1]=-2,l=!0)}else l=!0}if(l){let l=function(e,t,n,r,i,a,o){function s(e,t){for(let a=0;a<e.local.length;a++){let s=e.local[a].map(r,i,t);s?n.push(s):o.onRemove&&o.onRemove(e.local[a].spec)}for(let n=0;n<e.children.length;n+=3)s(e.children[n+2],e.children[n]+t+1)}for(let n=0;n<e.length;n+=3)-1==e[n+1]&&s(e[n+2],t[n]+a+1);return n}(s,e,t,n,i,a,o),c=In(l,r,0,o);t=c.local;for(let e=0;e<s.length;e+=3)s[e+1]<0&&(s.splice(e,3),e-=3);for(let e=0,t=0;e<c.children.length;e+=3){let n=c.children[e];for(;t<s.length&&s[t]<n;)t+=3;s.splice(t,0,c.children[e],c.children[e+1],c.children[e+2])}}return new $n(t.sort(Ln),s)}(this.children,a||[],e,t,n,r,i):a?new $n(a.sort(Ln),En):An}add(e,t){return t.length?this==An?$n.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let r,i=0;e.forEach(((e,a)=>{let o,s=a+n;if(o=Nn(t,e,s)){for(r||(r=this.children.slice());i<r.length&&r[i]<a;)i+=3;r[i]==a?r[i+2]=r[i+2].addInner(e,o,s+1):r.splice(i,0,a,a+e.nodeSize,In(o,e,s+1,Cn)),i+=3}}));let a=Mn(i?On(t):t,-n);for(let t=0;t<a.length;t++)a[t].type.valid(e,a[t])||a.splice(t--,1);return new $n(a.length?this.local.concat(a).sort(Ln):this.local,r||this.children)}remove(e){return 0==e.length||this==An?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,r=this.local;for(let r=0;r<n.length;r+=3){let i,a=n[r]+t,o=n[r+1]+t;for(let t,n=0;n<e.length;n++)(t=e[n])&&t.from>a&&t.to<o&&(e[n]=null,(i||(i=[])).push(t));if(!i)continue;n==this.children&&(n=this.children.slice());let s=n[r+2].removeInner(i,a+1);s!=An?n[r+2]=s:(n.splice(r,3),r-=3)}if(r.length)for(let n,i=0;i<e.length;i++)if(n=e[i])for(let e=0;e<r.length;e++)r[e].eq(n,t)&&(r==this.local&&(r=this.local.slice()),r.splice(e--,1));return n==this.children&&r==this.local?this:r.length||n.length?new $n(r,n):An}forChild(e,t){if(this==An)return this;if(t.isLeaf)return $n.empty;let n,r;for(let t=0;t<this.children.length;t+=3)if(this.children[t]>=e){this.children[t]==e&&(n=this.children[t+2]);break}let i=e+1,a=i+t.content.size;for(let e=0;e<this.local.length;e++){let t=this.local[e];if(t.from<a&&t.to>i&&t.type instanceof wn){let e=Math.max(i,t.from)-i,n=Math.min(a,t.to)-i;e<n&&(r||(r=[])).push(t.copy(e,n))}}if(r){let e=new $n(r.sort(Ln),En);return n?new Tn([e,n]):e}return n||An}eq(e){if(this==e)return!0;if(!(e instanceof $n)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Dn(this.localsInner(e))}localsInner(e){if(this==An)return En;if(e.inlineContent||!this.local.some(wn.is))return this.local;let t=[];for(let e=0;e<this.local.length;e++)this.local[e].type instanceof wn||t.push(this.local[e]);return t}forEachSet(e){e(this)}}$n.empty=new $n([],[]),$n.removeOverlap=Dn;const An=$n.empty;class Tn{constructor(e){this.members=e}map(e,t){const n=this.members.map((n=>n.map(e,t,Cn)));return Tn.from(n)}forChild(e,t){if(t.isLeaf)return $n.empty;let n=[];for(let r=0;r<this.members.length;r++){let i=this.members[r].forChild(e,t);i!=An&&(i instanceof Tn?n=n.concat(i.members):n.push(i))}return Tn.from(n)}eq(e){if(!(e instanceof Tn)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let r=0;r<this.members.length;r++){let i=this.members[r].localsInner(e);if(i.length)if(t){n&&(t=t.slice(),n=!1);for(let e=0;e<i.length;e++)t.push(i[e])}else t=i}return t?Dn(n?t:t.sort(Ln)):En}static from(e){switch(e.length){case 0:return An;case 1:return e[0];default:return new Tn(e.every((e=>e instanceof $n))?e:e.reduce(((e,t)=>e.concat(t instanceof $n?t:t.members)),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function Mn(e,t){if(!t||!e.length)return e;let n=[];for(let r=0;r<e.length;r++){let i=e[r];n.push(new Sn(i.from+t,i.to+t,i.type))}return n}function Nn(e,t,n){if(t.isLeaf)return null;let r=n+t.nodeSize,i=null;for(let t,a=0;a<e.length;a++)(t=e[a])&&t.from>n&&t.to<r&&((i||(i=[])).push(t),e[a]=null);return i}function On(e){let t=[];for(let n=0;n<e.length;n++)null!=e[n]&&t.push(e[n]);return t}function In(e,t,n,r){let i=[],a=!1;t.forEach(((t,o)=>{let s=Nn(e,t,o+n);if(s){a=!0;let e=In(s,t,n+o+1,r);e!=An&&i.push(o,o+t.nodeSize,e)}}));let o=Mn(a?On(e):e,-n).sort(Ln);for(let e=0;e<o.length;e++)o[e].type.valid(t,o[e])||(r.onRemove&&r.onRemove(o[e].spec),o.splice(e--,1));return o.length||i.length?new $n(o,i):An}function Ln(e,t){return e.from-t.from||e.to-t.to}function Dn(e){let t=e;for(let n=0;n<t.length-1;n++){let r=t[n];if(r.from!=r.to)for(let i=n+1;i<t.length;i++){let a=t[i];if(a.from!=r.from){a.from<r.to&&(t==e&&(t=e.slice()),t[n]=r.copy(r.from,a.from),_n(t,i,r.copy(a.from,r.to)));break}a.to!=r.to&&(t==e&&(t=e.slice()),t[i]=a.copy(a.from,r.to),_n(t,i+1,a.copy(r.to,a.to)))}}return t}function _n(e,t,n){for(;t<e.length&&Ln(n,e[t])>0;)t++;e.splice(t,0,n)}var Rn=function(){function e(t,n,r,a){i(this,e),this.$menuBox=a,this.init(t,n,r),this.update(r,null),this.assistence=!0}return o(e,[{key:"init",value:function(t,n,r){var i=this;n.nodes;var a=n.marks;this.$menuBox.querySelector("a").addEventListener("click",(function(){i.update(r)})),r.dom.parentNode.addEventListener("blur",(function(e){!e.relatedTarget||e.relatedTarget.classList.contains("menu-item")||e.relatedTarget.classList.contains("contextual-menu-component")||i.update(r)}));var o=this.$menuBox.querySelectorAll(".menu-item"),s=0;o&&o.forEach((function(n){var o=n.getAttribute("data-color"),l=n.getAttribute("data-command-name");n.addEventListener("click",(function(n){if(n.preventDefault(),e.isAdded(a.marker,r.state))i.update(r,null);else{if(i.assistence){var c=r.state.selection,d=c.from,u=c.to,h=e.expandSelectionToWordBoundaries(r.state,d,u,[" ","-",",",".",";",":","!","?"]),f=h.newFrom,p=h.newTo,m=r.state.tr.setSelection(pm.TextSelection.create(r.state.doc,f,p));r.dispatch(m)}var g="".concat(i.$menuBox.id,"-").concat(s);pm.toggleMark(a.marker,{color:o,dataCommandName:l,dataTagId:g})(r.state,r.dispatch,r),e.closeSelection(r),s+=1;var v=e.connectAllSelectedParts(r,g);k(document,"editor.change",{},{text:{id:t,task:"add",tagData:{tagName:l},value:v,tagColor:o}})}}))})),r.dom.parentNode.appendChild(this.$menuBox)}},{key:"update",value:function(e,t){var n=e.state,r=e.readOnly,i=document.activeElement.classList;if(n&&!r&&!n.selection.empty&&i.contains("canvas"))if(this.$menuBox.classList.remove("hidden"),this.$menuBox.offsetParent){var a=n.selection,o=a.from,s=a.to;try{var l=e.coordsAtPos(o),c=e.coordsAtPos(s),d=this.$menuBox.getBoundingClientRect(),u=this.$menuBox.offsetParent.getBoundingClientRect(),h=(l.left+c.left)/2-d.width/2-u.left;h<5&&(h=5),this.$menuBox.style.left="".concat(h,"px"),this.$menuBox.style.top="".concat(l.top-u.top-d.height,"px")}catch(e){console.error("Menu selection error",e)}}else this.$menuBox.classList.contains("hidden")||this.$menuBox.classList.add("hidden");else this.$menuBox.classList.contains("hidden")||this.$menuBox.classList.add("hidden")}},{key:"destroy",value:function(){this.$menuBox&&this.$menuBox.remove()}},{key:"setAssistence",value:function(e){this.assistence=e}}],[{key:"isAdded",value:function(e,t){for(var n=t.selection.ranges,r=!1,i=0;!r&&i<n.length;i+=1){var a=n[i],o=a.$from,s=a.$to;r=t.doc.rangeHasMark(o.pos,s.pos,e)}return r}},{key:"closeSelection",value:function(e){var t=e.state,n=t.apply(t.tr.setSelection(pm.TextSelection.create(t.doc,0,0)));e.updateState(n)}},{key:"removingMarkerHandler",value:function(e){var t=e.editorId,n=e.editorView,r=e.markedSelection,i=e.$dispatchNode,a=e.dataTagId,o=e.dataCommandName,s=e.marker;n.dom.querySelector("[data-tag-id=".concat(a,"]")).addEventListener("click",(function(e){var a=n.state,l=n.dispatch,c=a.tr,d=r.from,u=r.to;c.removeMark(d,u,s),l(c),k(document,"editor.change",{},{text:{id:t,task:"remove",tagData:{tagName:o},value:i}})}))}},{key:"connectAllSelectedParts",value:function(e,t){var n=e.dom.querySelectorAll("span[data-tag-id=".concat(t,"]"));if(1===n.length)return n[0];if(n.length>1){for(var r=n[0].cloneNode(!0),i=n[0].textContent,a=1;a<n.length;a+=1)i+=n[a].textContent;return r.innerHTML=i,r}return console.error("Error: Didn't find parts of marked part of text."),null}},{key:"expandSelectionToWordBoundaries",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[" ","-"],i=t,a=n,o=e.doc,s=o.textBetween(i,i+1,null,"\0"),l=!r.includes(s),c=o.textBetween(a-1,a,null,"\0"),d=!r.includes(c);if(l)for(;i>0;){var u=o.textBetween(i-1,i,null,"\0");if(r.includes(u))break;i-=1}if(d)for(;a<o.content.size;){var h=o.textBetween(a,a+1,null,"\0");if(r.includes(h))break;a+=1}return{newFrom:i,newTo:a}}}]),e}(),qn=function(){function e(t,n){i(this,e),this.$removeAllChanges=n.querySelector(".editor-toolbar-action-reset"),this.init(t)}return o(e,[{key:"init",value:function(e){var t=e.state;this.$removeAllChanges.addEventListener("click",(function(){confirm("Opravdu chcete vrátit text do původní podoby? Vaše změny se tímto ztratí.")&&e.updateState(t)}))}},{key:"destroy",value:function(){this.$removeAllChanges&&this.$removeAllChanges.remove()}}],[{key:"update",value:function(e,t){}}]),e}(),Fn={nodes:{doc:{content:"block+"},heading:{attrs:{level:{default:1},style:{default:!1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",getAttrs:function(e){return{level:1,style:e.getAttribute("style")}}},{tag:"h2",getAttrs:function(e){return{level:2,style:e.getAttribute("style")}}},{tag:"h3",getAttrs:function(e){return{level:3,style:e.getAttribute("style")}}},{tag:"h4",getAttrs:function(e){return{level:4,style:e.getAttribute("style")}}},{tag:"h5",getAttrs:function(e){return{level:5,style:e.getAttribute("style")}}},{tag:"h6",getAttrs:function(e){return{level:6,style:e.getAttribute("style")}}}],toDOM:function(e){var t=e.attrs.style;return["h".concat(e.attrs.level),{style:t},0]}},paragraph:{content:"inline*",group:"block",defining:!0,attrs:{style:{default:!1}},parseDOM:[{tag:"p",getAttrs:function(e){return{style:e.getAttribute("style")}}}],toDOM:function(e){return["p",{style:e.attrs.style},0]}},list:{content:"block+",group:"block",attrs:{type:{default:!1}},parseDOM:[{tag:"ol",getAttrs:function(e){return{type:e.getAttribute("type")}}}],toDOM:function(e){return["ol",{type:e.attrs.type},0]}},listItem:{content:"inline*",group:"block",parseDOM:[{tag:"li"}],toDOM:function(){return["li",0]}},hard_break:{group:"block",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return["br"]}},text:{inline:!0,group:"inline"},premarked:{content:"inline",inline:!0,group:"inline",attrs:{id:{},textData:{},className:{}},parseDOM:[{tag:"span.text-option",getAttrs:function(e){return{id:e.getAttribute("id"),textData:e.getAttribute("data-text-option"),className:e.getAttribute("class")}}}],toDOM:function(e){var t=e.attrs,n=t.id,r=t.textData;return["span",{id:n,class:t.className,"data-text-option":r},0]}},removeButton:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"span.node-close"}],toDOM:function(){return["span",{class:"node-close"},"×"]}}},marks:{italic:{parseDOM:[{tag:"i"},{tag:"em"}],toDOM:function(){return["em",0]}},bold:{parseDOM:[{tag:"b"}],toDOM:function(){return["b",0]}},code:{parseDOM:[{tag:"code"}],toDOM:function(){return["code",0]}},small:{parseDOM:[{tag:"small"}],toDOM:function(){return["small",0]}},marker:{attrs:{color:{},dataCommandName:{},dataTagId:{}},parseDOM:[{tag:"span[data-tag-id]",getAttrs:function(e){return{color:e.getAttribute("data-color"),dataCommandName:e.getAttribute("data-command-name"),dataTagId:e.getAttribute("data-tag-id")}}}],toDOM:function(e){var t=e.attrs,n=t.color,r=t.dataCommandName,i=t.dataTagId;return["span",{class:"node-selected node-text-".concat(n),"data-command-name":r,"data-tag-id":i,"data-color":n},0]}},writtingInsertPart:{attrs:{id:{}},parseDOM:[{tag:"span.user-inserted-text.user-inserted-text-inner",getAttrs:function(e){return{id:e.getAttribute("data-add-id")}}}],toDOM:function(e){return["span",{class:"user-inserted-text user-inserted-text-inner","data-add-id":e.attrs.id},0]}},writtingRemovePart:{attrs:{id:{}},parseDOM:[{tag:"span.user-removed-text.user-removed-text-inner",getAttrs:function(e){return{id:e.getAttribute("data-remove-id")}}}],toDOM:function(e){return["span",{class:"user-removed-text user-removed-text-inner","data-remove-id":e.attrs.id},0]}}}},zn=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).editor=void 0,r.id=r.target.id,r.editorType=r.target.getAttribute("data-editor"),r.$editor=r.target.querySelector("#prosemirror-editor-".concat(r.id)),r.$content=r.target.querySelector("#prosemirror-content-".concat(r.id)),r.schema=new pm.Schema(Fn),r.selectionMenuInstance=null,HISTORYLAB.import.done?r.initJSON():r.initHTML(),r.addAssistenceToggle(),r}return o(n,[{key:"getEditorJSON",value:function(){return this.editor?this.editor.state.toJSON():{}}},{key:"initHTML",value:function(){function e(e,t){var n=new Map;return e.descendants((function(e,r){e.marks.forEach((function(i){if(i.type===t){var a=i.attrs.dataTagId,o=i.attrs.dataCommandName;if(n.has(a)){var s=n.get(a);s.to=Math.max(s.to,r+e.nodeSize),n.set(a,s)}else n.set(a,{id:a,from:r,to:r+e.nodeSize,dataCommandName:o})}}))})),Array.from(n.values())}var t,r=null;function i(t){return new pm.Plugin({view:function(e){return r=e,{destroy:function(){r=null}}},props:{decorations:function(n){var i=e(n.doc,n.schema.marks.marker),a=[];return i.forEach((function(i){var o=i.id,s=i.to,l=i.dataCommandName,c=document.createElement("button");c.className="remove-marker-button",c.dataset.markerId=o,c.setAttribute("aria-label","Remove selection"),c.setAttribute("title","Remove selection"),c.addEventListener("click",(function(i){if(i.preventDefault(),i.stopPropagation(),r){var a=r.dispatch,s=n.schema.marks.marker,c=Rn.connectAllSelectedParts(r,o);if(!s)return void console.error("Marker mark not found in schema.");var d=e(n.doc,s).filter((function(e){return e.id===o})),u=n.tr;d.forEach((function(e){u=u.removeMark(e.from,e.to,s)})),a(u),k(document,"editor.change",{},{text:{id:t,task:"remove",tagData:{tagName:l},value:c}})}})),a.push(Sn.widget(s,c,{side:1,block:!1}))})),$n.create(n.doc,a)}},key:new pm.PluginKey("removeSelection")})}"zvyraznovani"===this.editorType&&(t=[this.selectionMenu(this.id),i(this.id)]);"predznaceny"===this.editorType&&(t=[n.premarkedParts(this.id,this.schema),i(this.id)]);if("psani"===this.editorType){var a=this.writting(pm.keydownHandler),o=pm.keymap({"Mod-z":pm.undo,"Mod-y":pm.redo});t=[pm.history(),o,a]}this.editor=new pm.EditorView(this.$editor,{state:pm.EditorState.create({doc:pm.DOMParser.fromSchema(this.schema).parse(this.$content),plugins:t})})}},{key:"initJSON",value:function(){var e=JSON.parse(this.$content.textContent),t=n.readOnlyMod(),r=this.schema;this.editor=new pm.EditorView(this.$editor,{state:pm.EditorState.fromJSON({schema:r,plugins:[t]},e)})}},{key:"selectionMenu",value:function(e){var t=this.schema,n=this.target.querySelector("#marker-menu-".concat(this.target.id)),r=this;return new pm.Plugin({view:function(i){var a=new Rn(e,t,i,n);return r.selectionMenuInstance=a,a},props:{editable:function(){return!1}},key:new pm.PluginKey("SelectionMenu")})}},{key:"writting",value:function(e){var t=this,n=this.target.querySelector("#toolbar-".concat(this.target.id)),r=0,i=function(e,n){var i="remove-part-".concat(r);return pm.toggleMark(t.schema.marks.writtingRemovePart,{id:i})(e,n),r+=1,!0};return new pm.Plugin({view:function(e){return new qn(e,n)},props:{handleKeyDown:e({Delete:i,Backspace:i})},key:new pm.PluginKey("Writting")})}},{key:"addAssistenceToggle",value:function(){var e=this;if("zvyraznovani"===this.editorType){var t=this.target.querySelector("#assistence-switch-".concat(this.id));t&&t.addEventListener("change",(function(t){e.selectionMenuInstance?e.selectionMenuInstance.setAssistence(t.target.checked):console.warn("SelectionMenu instance not found.")}))}}}],[{key:"readOnlyMod",value:function(){return new pm.Plugin({props:{editable:function(){return!1}},key:new pm.PluginKey("ReadOnlyMod")})}},{key:"premarkedParts",value:function(e,t){return new pm.Plugin({props:{editable:function(){return!1},handleClickOn:function(n,r,i,a){if(t.nodes.premarked.name===i.type.name){var o,s,l="selected",c=n.state,d=c.tr,u=JSON.parse(i.attrs.textData);u.tagName="vyznacena-pasaz",i.attrs.className.includes(l)?(o=i.attrs.className.replace(" ".concat(l),""),s="remove"):(o="".concat(i.attrs.className," ").concat(l),s="add");var h={id:i.attrs.id,className:o,textData:i.attrs.textData};d.setNodeMarkup(a,null,h);var f=c.apply(d);n.updateState(f);var p=n.dom.querySelector("#".concat(i.attrs.id));k(document,"editor.change",{},{text:{id:e,task:s,tagData:u,value:p.cloneNode(!0)}})}return!1}},key:new pm.PluginKey("PremarkedParts")})}}]),n}(v),Pn=function(e){l(r,e);var t=h(r);function r(e){var a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(this,r),(a=t.call(this,e)).id=a.target.id,a.function=a.target.getAttribute("data-keywords")||"selekce-",a.$controls=a.target.querySelectorAll("[data-keywords-control]"),a.opts=n(n({},r.defaults),o),a.$itemsContainer=a.target.querySelector(".".concat(a.opts.itemsContainerClassName)),a.opts.inherit&&a.opts.inherit.from.length>0?a.isInherited=!0:a.$items=a.target.querySelectorAll(".".concat(a.opts.itemClassName)),a}return o(r,[{key:"init",value:function(){switch(this.function){case"selekce-":case"selekce+":this.opts.import&&this.opts.import.length>0&&(this.$itemsContainer.innerHTML=r._getHTMLFromItems(this.opts.import)),this.isInherited&&this.opts.inherit.onInit&&this._regenerateItemsContainerFromInherited(),this._registerHandlers();break;case"wordcloud":this.$items.forEach((function(e){e.setAttribute("data-keywords-item",0)})),this._changeSizeOfKeywordItem(this.opts.skala)}}},{key:"_changeSizeOfKeywordItem",value:function(e){var t=this;function n(t,n,r){var i=parseInt(t.getAttribute("data-keywords-item"),10),a=i+n,o=Math.abs(a)>e?i:a;t.setAttribute("data-keywords-item",o),r()}e=e?parseInt(e,10):4,this.$controls.forEach((function(e){var r=e.parentElement.parentElement;switch(e.getAttribute("data-keywords-control")){case"minus":e.addEventListener("click",(function(e){n(r,-1,t.showFeedback),e.preventDefault()}));break;case"plus":e.addEventListener("click",(function(e){n(r,1,t.showFeedback),e.preventDefault()}))}}))}},{key:"_regenerateItemsContainerFromInherited",value:function(){var e=this,t="";this.opts.inherit.from.forEach((function(n){var i=document.getElementById(n).querySelector(".".concat(e.opts.itemsContainerClassName)).innerHTML;t+=r.renameItemsIds(n,e.id,i)})),this.$itemsContainer.innerHTML=t,this.$items=this.target.querySelectorAll(".".concat(this.opts.itemClassName))}},{key:"_registerHandlers",value:function(){var e=this;this.$items.forEach((function(t){t.addEventListener("click",e._clickEventHandler.bind(e),!0),document.addEventListener("keyword.change",(function(n){e._dispatchEventHandler(n,t)}),!1)}))}},{key:"_clickEventHandler",value:function(e){"click"===e.type&&(S(e.currentTarget,"disabled"),k(document,"keyword.change",{},{keywords:{id:this.id,node:e.currentTarget}}),this.showFeedback())}},{key:"_dispatchEventHandler",value:function(e,t){var n=e.detail.keywords,r=n.id,i=n.node;if(this.isInherited&&this.opts.inherit.from.includes(r)){var a=t.id,o=i.id;a.replace(this.id,"")===o.replace(r,"")&&S(t,"disabled")}}}]),r}(v);Pn._getItemFromDOMElement=function(e){return{class:e.className,id:e.getAttribute("id"),text:e.innerText}},Pn._getItemsHTML=function(e){return e.innerHTML},Pn._getItemsFromHTML=function(e,t){var n=e.querySelectorAll(".".concat(t)),r=[];return n.forEach((function(e){r.push(Pn._getItemFromDOMElement(e))})),r},Pn._getDOMElementFromItem=function(e){var t=document.createElement("div");return t.setAttribute("class",e.class),t.setAttribute("id",e.id),t.innerHTML=e.text,function(e){if(e&&e.tagName){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}}(t)},Pn._getHTMLFromItems=function(e){var t="";return e.forEach((function(e){t+=Pn._getDOMElementFromItem(e)})),t},Pn.renameItemsIds=function(e,t,n){var r=new RegExp(e,"g");return n.replace(r,t)},Pn.defaults={itemsContainerClassName:"keywords-items-container",itemClassName:"keywords-item"};var Bn=function(e){l(r,e);var t=h(r);function r(e,a,o){var s;return i(this,r),(s=t.call(this,a)).id=e,s.opts=n(n({},r.defaults),o),s.$questions=s.target.querySelectorAll(".".concat(s.opts.itemClass)),s.cache={answersCorrect:0,colors:[],questions:[]},s.opts.zpetnaVazba&&(s.cache.colors=s.opts.zpetnaVazba.map((function(e){return e.barva}))),s}return o(r,[{key:"init",value:function(){this._registerHandlers()}},{key:"_registerHandlers",value:function(){var e=this;this.$questions.forEach((function(t,n){e.cache.questions.push({answered:!1});var r=parseInt(t.getAttribute("data-module-answer"),10),i=t.querySelectorAll(".".concat(e.opts.optionClass));i.forEach((function(t,a){t.addEventListener("click",(function(){var o=t;if(!o.classList.contains("selected")){if(i.forEach((function(t){return $(t,e.opts.selectedClass)})),S(o,e.opts.selectedClass),e.opts.zpetnaVazba){var s;a===r?e.cache.answersCorrect+=1:0!==e.cache.answersCorrect&&!0===e.cache.questions[n].answered&&(e.cache.answersCorrect-=1);var l=e.opts.zpetnaVazba.find((function(t){return t.podminka.includes(e.cache.answersCorrect)}));(s=e.$buttonFeedback.classList).remove.apply(s,p(e.cache.colors)),e.$buttonFeedback.classList.add(l.barva),e.$buttonFeedbackText.innerText=l.text}e.cache.questions[n].answered=!0,void 0===e.cache.questions.find((function(e){return!e.answered}))&&e.showFeedback()}}),!1)}))}))}}]),r}(v);Bn.defaults={itemClass:"test-quiz-item",optionClass:"option",selectedClass:"selected"};var Jn=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).imageAlternative=r.target.getAttribute("data-fullscreen-image"),r.target.addEventListener("click",(function(e){switch(r.imageAlternative?(r.$fullscreenContainer.innerHTML=r.target.nextElementSibling.nextElementSibling.outerHTML,r.$fullscreenTarget=r.$fullscreenContainer.firstElementChild,r.$fullscreenTarget.classList.remove("is-hidden")):(r.$fullscreenContainer.innerHTML=r.target.nextElementSibling.outerHTML,r.$fullscreenTarget=r.$fullscreenContainer.firstElementChild),r.$fullscreenTarget.removeAttribute("style"),r.$fullscreenTarget.removeAttribute("id"),r.target.nextElementSibling.nodeName.toLowerCase()){case"img":setTimeout((function(){var e;(e=r.$fullscreenTarget.currentSrc,new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src=e}))).then((function(){r.image.width=r.$fullscreenTarget.naturalWidth,r.image.height=r.$fullscreenTarget.naturalHeight,r.image.ratio=r.image.width/r.image.height,r.setSize(),new y(r.$fullscreenTarget)}))}),10);break;case"svg":var t=f(r.$fullscreenTarget.getAttribute("viewBox").split(" "),4);r.image.width=t[2],r.image.height=t[3],r.image.ratio=r.image.width/r.image.height,r.setSize();var n=r.$fullscreenTarget.querySelectorAll("textarea");n.length>0&&n.forEach((function(e){var t=e.id;e.removeAttribute("id"),e.value=document.getElementById(t).value,e.readOnly=!0}))}r.$fullscreen.classList.toggle("hidden"),r.showFeedback(),e.preventDefault(),e.stopPropagation()}),!1),r}return o(n,[{key:"setSize",value:function(){this.image.ratio>=this.window.ratio?(this.$fullscreenTarget.style.width="100%",this.$fullscreenTarget.style.height="auto"):(this.$fullscreenTarget.style.width="auto",this.$fullscreenTarget.style.height="".concat(this.window.height,"px"))}}]),n}(function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).$fullscreen=document.querySelector('[data-fullscreen="fullscreen"]'),r.$fullscreenContainer=r.$fullscreen.querySelector('[data-fullscreen="container"]'),r.$fullscreenTarget=r.$fullscreen.querySelector('[data-fullscreen="target"]'),r.window={},r.image={},r.window.width=window.innerWidth,r.window.height=window.innerHeight,r.window.ratio=r.window.width/r.window.height,r}return o(n)}(v)),jn=function(e){l(n,e);var t=h(n);function n(e){var r;if(i(this,n),(r=t.call(this,e)).$item=r.target.closest(".user-text"),r.$counter=r.$item.querySelector("[data-usertext-counter]"),r.$counterWrapper=r.$item.querySelector(".user-text__counter"),r.$instruction=r.$item.querySelector(".user-text__question"),r.$userTexts=r.$slide.querySelectorAll("[data-textarea-target]"),r.feedback=JSON.parse(r.target.getAttribute("data-feedback")),r.lengthExpected={min:parseInt("0"===r.target.getAttribute("minlength")?1:r.target.getAttribute("minlength"),10),avg:null,max:parseInt(r.target.getAttribute("maxlength")/2,10)},r.lengthExpected.avg=Math.floor((r.lengthExpected.max-r.lengthExpected.min)/4+r.lengthExpected.min),r.cache={answersCorrect:0,colors:["color-red","color-orange","color-green"],questions:[]},r.lastValue="",r.hadData=r.target.value&&r.target.value.length>0,r.wasUsed=!1,r.hadData&&r.updateCharacterCounter(),HISTORYLAB.import.done){if(r.$instruction&&r.$instruction.hasAttribute("data-from")){var a="data-selectable-data",o=r.$instruction.getAttribute("data-from"),s=document.querySelector("#".concat(o," .is-checked [").concat(a,"]"));s&&s.getAttribute(a)&&(r.$instruction.innerText=s.getAttribute(a))}}else r.toDuplicate=r.target.getAttribute("data-duplicate-text"),r.textDuplicateSources=r.toDuplicate?r.toDuplicate.split(" "):[],r.getEvents(),r.addEventListeners();return r}return o(n,[{key:"updateCharacterCounter",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.target.value.length;(e=this.$counterWrapper.classList).remove.apply(e,p(this.cache.colors)),t<this.lengthExpected.min?this.$counterWrapper.classList.add(this.cache.colors[0]):t<=this.lengthExpected.avg?this.$counterWrapper.classList.add(this.cache.colors[1]):t>this.lengthExpected.avg&&this.$counterWrapper.classList.add(this.cache.colors[2]),this.$counter.innerText=t,this.target.classList.add("is-used",!this.wasUsed),this.wasUsed=!0}},{key:"updateFeedback",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.target.value.length;this.$buttonFeedback&&((e=this.$buttonFeedback.classList).remove.apply(e,p(this.cache.colors)),t<this.lengthExpected.min?(this.$buttonFeedback.classList.add(this.cache.colors[0]),this.$buttonFeedbackText.innerText=this.feedback.none):(t<=this.lengthExpected.avg?(this.$buttonFeedback.classList.add(this.cache.colors[1]),this.$buttonFeedbackText.innerText=this.feedback.short):t>this.lengthExpected.avg&&(this.$buttonFeedback.classList.add(this.cache.colors[2]),this.$buttonFeedbackText.innerText=this.feedback.ok),this.target.setAttribute("data-textarea-target","success"),void 0===Array.from(this.$userTexts).find((function(e){return"success"!==e.getAttribute("data-textarea-target")}))&&this.showFeedback()))}},{key:"addEventListeners",value:function(){var e=this;this.target.addEventListener("blur",(function(t){if(e.updateCharacterCounter(),t.target.value!==e.lastValue){var n=""===e.lastValue?"create":"change";e.lastValue=t.target.value,k(document,"text.change",{},{text:{id:t.target.id,task:n,text:t.target.value}}),e.textDuplicateSources=[]}})),this.target.addEventListener("keyup",(function(t){t.stopPropagation();var n=e.target.value.length;e.updateCharacterCounter(n),e.updateFeedback(n)}))}},{key:"getEvents",value:function(){var e=this;if(this.$instruction&&this.$instruction.hasAttribute("data-from")){var t=this.$instruction.getAttribute("data-from");document.addEventListener("selection.change",(function(n){t===n.detail.id&&n.detail.itemData&&"string"==typeof n.detail.itemData&&(e.$instruction.innerText=n.detail.itemData)}))}this.textDuplicateSources[0]&&document.addEventListener("text.change",(function(t){if(e.textDuplicateSources.includes(t.detail.text.id)){var n=""===e.target.value?"create":"change";switch(t.detail.text.task){case"create":case"change":""!==e.target.value&&(e.target.value+="\n"),1===e.textDuplicateSources.length?e.target.value=t.detail.text.text:e.target.value+="".concat(t.detail.text.text,"\n"),k(document,"text.change",{},{text:{id:e.target.id,task:n,text:e.target.value}}),e.lastValue=e.target.value,e.updateCharacterCounter();break;default:console.log("Nondefinated text events task. :(")}}}))}}]),n}(v),Hn=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).$playButton=r.target.querySelector("[data-player-control]"),r.$loadWave=r.target.querySelector("[data-audio-wave]"),r.$leftTime=r.target.querySelector("[data-audio-time-left]"),r.$audioDuration=r.target.querySelector("[data-audio-time-duration]"),r.wavesurfer=WaveSurfer.create({container:r.$loadWave,waveColor:"#A77977",progressColor:"#FCE4E3",height:80,responsive:!0,barWidth:2}),r.wavesurfer.load(r.$loadWave.dataset.src),r.initWave(),r}return o(n,[{key:"initWave",value:function(){var e=this;this.wavesurfer.on("ready",(function(){e.$leftTime.textContent="0:00";var t=e.wavesurfer.getDuration(),n=Math.floor(t%3600/60),r="00".concat(Math.floor(t%60)).slice(-2);e.$audioDuration.textContent="".concat(n,":").concat(r),e.addListenerAfterReady()}))}},{key:"addListenerAfterReady",value:function(){var e=this;this.wavesurfer.on("audioprocess",(function(t){var n=Math.floor(t%3600/60),r="00".concat(Math.floor(t%60)).slice(-2);e.$leftTime.textContent="".concat(n,":").concat(r)})),this.wavesurfer.on("finish",(function(){e.$playButton.setAttribute("data-player-control","paused")})),this.$playButton.addEventListener("click",(function(){e.wavesurfer.playPause(),"paused"===e.$playButton.getAttribute("data-player-control")?e.$playButton.setAttribute("data-player-control","playing"):e.$playButton.setAttribute("data-player-control","paused"),e.showFeedback()})),document.querySelectorAll("[data-nav-button]").forEach((function(t){t.addEventListener("click",(function(){"playing"===e.$playButton.getAttribute("data-player-control")&&(e.wavesurfer.playPause(),e.$playButton.setAttribute("data-player-control","paused"))}))}))}}]),n}(v),Vn=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).$audio=r.target.querySelector("audio"),r.$timeLeft=r.target.querySelector("[data-audio-time-left]"),r.$duration=r.target.querySelector("[data-audio-time-duration]"),r.$duration.innerText="/".concat(M(r.$audio.duration)),N.addEventListeners(r.target,r.showFeedback),r}return o(n)}(N),Wn=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).$buttons=r.target.querySelectorAll('[data-fake-map="toggle"]'),r.$maps=r.target.querySelectorAll('[data-fake-map="map"]'),r.lastActiveIndex=0,r.addEventListenerToButtons(),r}return o(n,[{key:"switchMap",value:function(e,t){this.$maps[this.lastActiveIndex].classList.remove("active"),this.$buttons[this.lastActiveIndex].classList.remove("active"),this.$maps[t].classList.add("active"),e.classList.add("active"),this.lastActiveIndex=t}},{key:"addEventListenerToButtons",value:function(){var e=this;this.$buttons.forEach((function(t,n){t.addEventListener("click",(function(r){e.switchMap(t,n),e.showFeedback(),r.preventDefault()}))}))}}]),n}(v),Kn=function(e){l(n,e);var t=h(n);function n(e,r){var a;return i(this,n),(a=t.call(this,e)).$media=a.target.querySelector("video"),a.options=Object(r),a.prefix=a.options.prefix||"media",a.lang=Object(a.options.lang),a.paused=null,a.currentTime=null,a.duration=null,a.interval=null,a.$document=a.target.ownerDocument,a.$controls=a.target.querySelector(".media-player-controls"),a.$play=a.$controls.querySelector("[data-player-control]"),a.$playSymbol=a.$play.querySelector(".media-play-symbol"),a.$pauseSymbol=a.$play.querySelector(".media-pause-symbol"),a.$time=a.$controls.querySelector("[data-video-time-progress]"),a.$timeMeter=a.$time.querySelector(".media-meter.media-time-meter"),a.$timeRange=a.$time.querySelector(".media-range.media-time-range"),a.$currentTimeText=a.$document.createTextNode(""),a.$currentTime=a.$controls.querySelector("[data-video-time-left]"),a.$currentTime.appendChild(a.$currentTimeText),a.durationTime=a.$media.duration,a.$durationTime=a.$controls.querySelector("[data-video-time-duration]"),a.$durationTime.innerText=M(a.durationTime),a.$durationTime.setAttribute("title","".concat(n.timeToAural(a.durationTime,a.lang.minutes||"minutes",a.lang.seconds||"seconds"))),a.$fullscreen=a.$controls.querySelector(".fullscreen-toggle"),a.$enterFullscreenSymbol=a.$fullscreen.querySelector(".media-enterFullscreen-symbol"),a.$leaveFullscreenSymbol=a.$fullscreen.querySelector(".media-leaveFullscreen-symbol"),a._fullscreenchange="onfullscreenchange"in a.target?"fullscreenchange":"onwebkitfullscreenchange"in a.target?"webkitfullscreenchange":"onMSFullscreenChange"in a.target?"MSFullscreenChange":"fullscreenchange",a._requestFullscreen=a.target.requestFullscreen||a.target.webkitRequestFullscreen||a.target.msRequestFullscreen,a.onCanPlayStart=a.onCanPlayStart.bind(u(a)),a.onLoadStart=a.onLoadStart.bind(u(a)),a.onLoadedData=a.onLoadedData.bind(u(a)),a.onPlayChange=a.onPlayChange.bind(u(a)),a.onTimeChange=a.onTimeChange.bind(u(a)),a.onPlayClick=a.onPlayClick.bind(u(a)),a.onTimeKeydown=a.onTimeKeydown.bind(u(a)),a.onTimeClick=a.onTimeClick.bind(u(a)),a.onTimeKeydown=a.onTimeKeydown.bind(u(a)),a.onFullscreenClick=a.onFullscreenClick.bind(u(a)),a.onFullscreenChange=a.onFullscreenChange.bind(u(a)),a.$media.addEventListener("canplaythrough",a.onCanPlayStart),a.$media.addEventListener("loadstart",a.onLoadStart),a.$media.addEventListener("loadeddata",a.onLoadedData),a.$media.addEventListener("pause",a.onPlayChange),a.$media.addEventListener("play",a.onPlayChange),a.$media.addEventListener("timeupdate",a.onTimeChange),a.$controls.addEventListener("click",a.onPlayClick,!1),a.$play.addEventListener("keydown",a.onTimeKeydown),a.$time.addEventListener("click",a.onTimeClick,!1),a.$time.addEventListener("keydown",a.onTimeKeydown),a.$fullscreen.addEventListener("click",a.onFullscreenClick,!1),document.addEventListener(a._fullscreenchange,a.onFullscreenChange),n.onDrag(a.$time,a.$timeRange,(function(e){a.$media.currentTime=a.duration*Math.max(0,Math.min(1,e)),a.onTimeChange()})),a.onLoadStart(),a}return o(n,[{key:"onPlayChange",value:function(){this.paused!==this.$media.paused&&(this.paused=this.$media.paused,this.$play.setAttribute("aria-label",this.paused?this.lang.play||"play":this.lang.pause||"pause"),this.target.setAttribute("data-player-state",this.paused?"paused":"playing"),this.$playSymbol.setAttribute("aria-hidden",!this.paused),this.$pauseSymbol.setAttribute("aria-hidden",this.paused),clearInterval(this.interval),this.paused||(this.interval=setInterval(this.onTimeChange,34)),this.$media.dispatchEvent(A.playchange))}},{key:"onTimeChange",value:function(){if(this.currentTime!==this.$media.currentTime||this.duration!==this.$media.duration){this.currentTime=this.$media.currentTime,this.duration=this.$media.duration||0;var e=this.currentTime/this.duration,t=M(this.currentTime);t!==this.$currentTimeText.nodeValue&&(this.$currentTimeText.nodeValue=t,this.$currentTime.setAttribute("title","".concat(n.timeToAural(this.currentTime,this.lang.minutes||"minutes",this.lang.seconds||"seconds")))),this.$time.setAttribute("aria-valuenow",this.currentTime),this.$time.setAttribute("aria-valuemin",0),this.$time.setAttribute("aria-valuemax",this.duration),this.$timeMeter.style.width="".concat(100*e,"%"),this.$media.dispatchEvent(A.timechange)}}},{key:"onLoadStart",value:function(){this.$media.removeEventListener("canplaythrough",this.onCanPlayStart),this.$media.addEventListener("canplaythrough",this.onCanPlayStart),this.onPlayChange(),this.onFullscreenChange(),this.onTimeChange()}},{key:"onLoadedData",value:function(){this.onTimeChange()}},{key:"onCanPlayStart",value:function(){this.$media.removeEventListener("canplaythrough",this.nCanPlayStart),this.$media.dispatchEvent(A.canplaystart),this.paused&&!this.$media.autoplay||this.$media.play()}},{key:"onFullscreenChange",value:function(){var e=this.target===n._fullscreenElement();this.$fullscreen.setAttribute("aria-label",e?this.lang.leaveFullscreen||"leave full screen":this.lang.enterFullscreen||"enter full screen"),this.$enterFullscreenSymbol.setAttribute("aria-hidden",e),this.$leaveFullscreenSymbol.setAttribute("aria-hidden",!e)}},{key:"onPlayClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.$media[this.$media.paused?"play":"pause"]()}},{key:"onTimeClick",value:function(e){e.stopPropagation(),e.pointerType||e.detail||this.onPlayClick(e)}},{key:"onFullscreenClick",value:function(e){var t=this;e.stopPropagation(),this._requestFullscreen?this.target===n._fullscreenElement()?n._exitFullscreen().call(document):(this._requestFullscreen.call(this.target),this.$fullscreen.focus(),setTimeout((function(){t.$fullscreen.focus()}),200)):this.$media.webkitSupportsFullscreen&&(this.$media.webkitDisplayingFullscreen?this.$media.webkitExitFullscreen():this.$media.webkitEnterFullscreen(),this.onFullscreenChange())}},{key:"onTimeKeydown",value:function(e){var t=e.keyCode,n=e.shiftKey;if(t>=37&&t<=40){e.preventDefault();var r=37===t||39===t?t-38:t-39;this.$media.currentTime=Math.max(0,Math.min(this.$media.duration,this.$media.currentTime+r*(n?10:1))),this.onTimeChange()}}}],[{key:"_fullscreenElement",value:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement}},{key:"_exitFullscreen",value:function(){return document.exitFullscreen||document.webkitCancelFullScreen||document.msExitFullscreen}},{key:"onDrag",value:function(e,t,n){var r,i,a,o=void 0!==e.onpointerup,s=void 0!==e.ontouchstart,l=o?"pointerdown":s?"touchstart":"mousedown",c=o?"pointermove":s?"touchmove":"mousemove",d=o?"pointerup":s?"touchend":"mouseup",u="clientX";function h(e){e.preventDefault();var t=u in e?e[u]:e.touches&&e.touches[0]&&e.touches[0][u]||0;n((t-i)/(a-i))}function f(){r.removeEventListener(c,h),r.removeEventListener(d,f)}e.addEventListener(l,(function(n){r=e.ownerDocument.defaultView;var o=t.getBoundingClientRect();i=o.left,a=o.right,h(n),r.addEventListener(c,h),r.addEventListener(d,f)}))}},{key:"timeToAural",value:function(e,t,n){return"".concat(Math.floor(e/60)," ").concat(t,", ").concat(Math.floor(e%60)," ").concat(n)}}]),n}(v),Yn=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).$settings=document.querySelector('[data-selectable-id-reference="'.concat(r.target.id,'"]')),r.feedback=JSON.parse(r.$settings.getAttribute("data-module-zpetnavazba")),r.settings=JSON.parse(r.$settings.getAttribute("data-module-settings")),r.$items=r.target.querySelectorAll(".selectable-item"),r.cache={answersCorrect:0,zpetnaVazba:!1,colors:[],checkedInput:0},r.$inputs=r.target.querySelectorAll("input"),r.$inputs.forEach((function(e){r._changeClassIfChecked(e),r._addEventListeners(e)})),r.feedback&&(r.cache.zpetnaVazba=!0,r.cache.colors=r.feedback.map((function(e){return e.barva}))),r}return o(n,[{key:"_addEventListeners",value:function(e){var t=this;e.addEventListener("change",(function(){t.$inputs.forEach((function(e){t._changeClassIfChecked(e)})),t._checkAndResolveFeedback(),t._dispatchEvent(e)}),!1)}},{key:"_changeClassIfChecked",value:function(e){e.closest(".selectable-item").classList.toggle("is-checked",!0===e.checked)}},{key:"_checkAndResolveFeedback",value:function(){var e=this;if(this.cache.answersCorrect=0,this.settings.viceOdpovedi?this.$items.forEach((function(t,n){e.$inputs[n].checked&&(e.cache.checkedInput+=1),e.$inputs[n].checked&&t.hasAttribute("data-select-spravnaodpoved")&&(e.cache.answersCorrect+=1),e.$inputs[n].checked||t.hasAttribute("data-select-spravnaodpoved")||(e.cache.answersCorrect+=1)})):this.$items.forEach((function(t,n){e.$inputs[n].checked&&(e.cache.checkedInput+=1),e.$inputs[n].checked&&t.hasAttribute("data-select-spravnaodpoved")&&(e.cache.answersCorrect+=1)})),0===this.cache.checkedInput&&!this.settings.vybrano||this.cache.checkedInput===this.$inputs.length&&this.settings.vybrano||this.settings.disableFeedback)this.hideFeedback();else{if(this.cache.zpetnaVazba){var t,n=this.feedback.find((function(t){return t.podminka.includes(e.cache.answersCorrect)}));(t=this.$buttonFeedback.classList).remove.apply(t,p(this.cache.colors)),this.$buttonFeedback.classList.add(n.barva),this.$buttonFeedbackText.innerText=n.text}this.showFeedback()}this.target.classList.toggle("has-checked",this.cache.checkedInput>0),this.cache.checkedInput=0}},{key:"_dispatchEvent",value:function(e){var t,n=e.parentNode.querySelector("label");"radio"===e.type?t="change":"checkbox"===e.type?t=e.checked?"select":"unselect":console.error("ERROR: Undefinated input type."),k(this.target,"selection.change",{},{id:this.target.id,task:t,itemId:e.id,itemData:e.getAttribute("data-selectable-data"),$node:n.firstChild})}}]),n}(v),Gn=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).dataFrom=r.target.parentNode.getAttribute("data-from"),r.dataSources=r.dataFrom?r.dataFrom.split(" "):[],r.id=e.getAttribute("id"),r.cache={tasks:[]},r.init(),r}return o(n,[{key:"init",value:function(){var e=this,t=this.target.parentNode.getAttribute("data-autofill");switch(t){case"columns":this._columnManager();break;case"rows":this._rowManager();break;case"cells":this.target.querySelectorAll(".table-new__cell").forEach((function(t){var n=t.getAttribute("data-column-id"),r=t.getAttribute("data-row-id");n&&r&&e._cellManager(t,n,r)}));break;default:console.log("NewTableERROR: Undefinated autofill key word!",t)}}},{key:"_rowManager",value:function(){var e=this;document.addEventListener("editor.change",(function(t){var r=t.detail.text;if(e.dataSources.includes(r.id)){var i,a=!0,o=e.target.previousSibling.firstChild.childNodes;switch(r.task){case"add":(i=document.createElement("div")).setAttribute("class","table-new__row"),o.forEach((function(t){var n=document.createElement("div");n.setAttribute("class","table-new__cell");var o=JSON.parse(t.getAttribute("data-type"));o.tagName&&o.tagName!==r.tagData.tagName?a=!1:e.fillCell(o,r,n),a&&i.appendChild(n)})),a&&e.target.appendChild(i);break;case"remove":e.target.childNodes.forEach((function(e){e.childNodes.forEach((function(t,a){var s=JSON.parse(o[a].getAttribute("data-type")),l=r.value.getAttribute("data-tag-id");document.querySelectorAll('[data-marker-id="'.concat(l,'"]')).forEach((function(e){return e.remove()})),n.isRightToDeleteHelper(t,r.value,s)&&(i=e)}))})),i&&(i.childNodes.forEach((function(t){e._removeTaskFromCache(t)})),i.remove());break;default:console.log("NewTableERROR: Undefinated task for new table! (rowManager)")}}}))}},{key:"_columnManager",value:function(){var e=this;document.addEventListener("editor.change",(function(t){var r=t.detail.text;if(e.dataSources.includes(r.id)){var i=e.target.childNodes;switch(r.task){case"add":i.forEach((function(t){var n=document.createElement("div");n.setAttribute("class","table-new__cell");var i=t.firstChild,a=JSON.parse(i.getAttribute("data-type"));e.fillCell(a,r,n),t.appendChild(n)}));break;case"remove":var a;i.forEach((function(e){var t=e.firstChild,i=JSON.parse(t.getAttribute("data-type"));e.childNodes.forEach((function(e,t){n.isRightToDeleteHelper(e,r.value,i)&&(a=t)}))})),e.target.childNodes.forEach((function(t){e._removeTaskFromCache(t.childNodes[a]),t.childNodes[a].remove()}));break;default:console.log("NewTableERROR: Undefinated task for new table! (columnManager)")}}}))}},{key:"_cellManager",value:function(e,t,r){var i=this,a=JSON.parse(this._findCellType(e)),o=function(t){switch(t.task){case"add":var r=document.createElement("div");i.fillCell(a,t,e),e.appendChild(r);break;case"remove":for(var o=e.querySelectorAll("div"),s=!1,l=0;l<o.length;l+=1)!s&&n.isRightToDeleteHelper(o[l],t.value,a)&&(o[l].remove(),s=!0);break;default:console.log("NewTableERROR: Undefinated task for new table! (cellManager)")}};document.addEventListener("editor.change",(function(e){var n=e.detail.text;!i.dataSources.includes(n.id)||n.tagData.tagName!==r&&n.tagData.tagName!==t||a.textId&&a.textId!==n.id||o(n)})),document.addEventListener("draggable.drop",(function(e){var n=e.detail;if(i.dataSources.includes(n.id)&&e.detail.columnId===t){var r=n.$node.querySelector("span").cloneNode(!0);r.classList.add("node-selected","node-text-gray"),r.setAttribute("data-by","table-drop"),o({task:n.task,value:r})}}))}},{key:"fillCell",value:function(e,t,n){var r,i,a=this,o=0;if(this.cache.tasks.length>0){var s=this.cache.tasks[this.cache.tasks.length-1].id.split("-");o=+s[s.length-1]+1}switch(n.classList.add("table-new__cell--".concat(e.name),"table-new__cell--".concat(e.type)),e.name){case"dup-text":r=document.createElement("div"),"text"===e.type?r.innerHTML=t.value.textContent:"tag"===e.type&&r.appendChild(t.value.cloneNode(!0));break;case"select":i={id:"".concat(this.id,"-select-").concat(o),answer:"",rightAnswer:t.tagData},this.cache.tasks.push(i),(r=document.createElement(e.name)).setAttribute("id",i.id),r.setAttribute("data-save","value"),r.setAttribute("tabindex",-1),e.options.forEach((function(e){var t=document.createElement("option");t.innerHTML=e,r.appendChild(t)})),r.addEventListener("change",(function(e){return a._correctedAnswer(e,i)}));break;case"input":case"textarea":i={id:"".concat(this.id,"-input-").concat(o),answer:"",rightAnswer:t.tagData},this.cache.tasks.push(i),(r=document.createElement(e.name)).setAttribute("id",i.id),r.setAttribute("data-save","value"),r.setAttribute("tabindex",-1),"textarea"===e.name&&r.setAttribute("resize",i.id),Object.keys(e.attributes).forEach((function(t){r.setAttribute(t,e.attributes[t])})),r.addEventListener("change",(function(e){return a._correctedAnswer(e,i)}));break;case"drop":r=document.createElement("div");var l=e.number?e.number:-1;r.setAttribute("data-drop-place",l);break;default:r=document.createElement("div"),t.tagData[e.name]?r.innerHTML=t.tagData[e.name]:(r.innerHTML=" ",console.log("FillCellERROR: Undefinated object name.",e))}n.appendChild(r)}},{key:"_findCellType",value:function(e){var t=e.parentNode.firstChild.getAttribute("data-type");if(t)return t;var n=e.getAttribute("data-column-id"),r=this.target.parentNode.querySelector(".table-new__cell--header[data-column-id=".concat(n,"]"));return r?r.getAttribute("data-type"):"empty"}},{key:"_correctedAnswer",value:function(e,t){this.cache.tasks.forEach((function(n){n.id===t.id&&(n.answer=e.target.value)}))}},{key:"_removeTaskFromCache",value:function(e){var t=this;this.cache.tasks.forEach((function(n,r){"SELECT"!==e.firstChild.tagName&&"INPUT"!==e.firstChild.tagName&&"TEXTAREA"!==e.firstChild.tagName||e.firstChild.id===n.id&&t.cache.tasks.splice(r,1)}))}}],[{key:"isRightToDeleteHelper",value:function(e,t,n){return"dup-text"===n.name&&e.textContent===t.textContent}}]),n}(v),Un=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).idPrefix="drag-item",r.dataFrom=r.target.getAttribute("data-from"),r.dataSources=r.dataFrom?r.dataFrom.split(" "):[],r.position={x:0,y:0,dx:0,dy:0},r.cache={items:{}},r.$targetPrevious=null,r.$targetCurrent=null,r.$draggedItem=null,r.objWidth=null,r.objHeight=null,r.lastEvent=null,r.init(),r}return o(n,[{key:"init",value:function(){var e=this;this.target.querySelectorAll(".draggable__item").forEach((function(t){var n=t.getAttribute("data-id");e.cache.items[n]=0,e.dragAndDropEvents(d3.select(t),n)})),this.handleDeleteItemFromSvgDrop(),this.handleAddTagsFromText()}},{key:"dragAndDropEvents",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.call(d3.drag().container(this.$slide).on("start",(function(t){n.onStart(t,e)})).on("drag",(function(t){n.onDrag(t,e)})).on("end",(function(i){n.onDrop(i,e,t,r)})))}},{key:"onStart",value:function(e,t){this.$slide.classList.add("is-dragging"),this.$targetPrevious=e.sourceEvent.target;var n,r,i,a,o,s,l=t.node();if(this.objWidth=l.offsetWidth,this.objHeight=l.offsetHeight,this.position.dx=0,this.position.dy=0,e.sourceEvent.clientX)this.position.x=e.sourceEvent.clientX-e.sourceEvent.offsetX,this.position.y=e.sourceEvent.clientY-e.sourceEvent.offsetY;else{var c=x(e,t),d=(n=e.sourceEvent,r=n.target.getBoundingClientRect(),i=r.x,a=r.y,o=r.width,s=r.height,{x:(n.touches[0].clientX-i)/o*n.target.offsetWidth,y:(n.touches[0].clientY-a)/s*n.target.offsetHeight});this.position.x=c.x-d.x,this.position.y=c.y-d.y}if(l.parentNode.hasAttribute("data-drag-place"))this.$draggedItem=l.cloneNode(!0);else{this.$draggedItem=l;var u=l.closest(".table-new__body"),h=l.closest(".table-new__cell").getAttribute("data-column-id");k(document,"draggable.drop",{},{id:u.id,task:"remove",columnId:h,$node:l})}document.body.appendChild(this.$draggedItem),this.$draggedItem=d3.select(this.$draggedItem),this.$draggedItem.classed("is-dragged",!0).classed("was-dropped",!1).attr("style","top:".concat(this.position.y,"px; left:").concat(this.position.x,"px;")),this.lastEvent=e.sourceEvent}},{key:"onDrag",value:function(e,t){if(this.lastEvent=e.sourceEvent,this.position.dx+=e.dx,this.position.dy+=e.dy,this.$draggedItem.style("transform","translate3d(".concat(this.position.dx,"px, ").concat(this.position.dy,"px, 0) rotate(5deg)")),this.$targetCurrent=e.sourceEvent.target,this.$targetPrevious!==this.$targetCurrent){var n=this.$targetPrevious.querySelector(".draggable__item--placeholder");if(n&&n.remove(),this.$targetCurrent.hasAttribute("data-drop-place")){var r=this.$targetCurrent.getAttribute("data-drop-place"),i=this.$targetCurrent.childElementCount;if("-1"===r||+r>i){var a=t.clone(!0).classed("is-dragged",!1).classed("draggable__item--placeholder",!0).attr("style","outline: 0px;").node();this.$targetCurrent.appendChild(a)}}this.$targetPrevious=this.$targetCurrent}}},{key:"onDrop",value:function(e,t,n,r){var i=this;if(this.lastEvent.touches){var a=this.lastEvent.touches[0];this.$targetCurrent=document.elementFromPoint(a.clientX,a.clientY)}else this.$targetCurrent=e.sourceEvent.target;if(this.$targetCurrent.hasAttribute("data-drop-place")){var o=this.$targetCurrent.querySelector(".draggable__item--placeholder");if(o){var s=o.getAttribute("data-draggable-item");if(o.classList.remove("draggable__item--placeholder","was-dropped"),o.classList.add("dropped__item"),r&&(t.classed("was-dropped",!0),this.cache.items[n]+=1),"svg"===s){var l=o.querySelector('[data-fullscreen="toggle"]');l&&l.remove()}else{var c=o.firstElementChild,d=document.createElement("span");d.classList.add("node-close"),d.innerText="×",c.removeChild(c.lastElementChild),c.appendChild(d),d.addEventListener("click",(function(){i.removeDraggableItem(o,n,r)}))}this.dragAndDropEvents(d3.select(o),n,!1)}else o=t.clone(!0).classed("is-dragged",!1).attr("style","outline: 0px;").node(),this.$targetCurrent.appendChild(o),this.dragAndDropEvents(d3.select(o),n,!1);var u=this.$targetCurrent.closest(".table-new__body"),h=this.$targetCurrent.closest(".table-new__cell").getAttribute("data-column-id");k(document,"draggable.drop",{},{id:u.id,task:"add",columnId:h,$node:o}),this.$draggedItem.remove()}else{var f=this.$targetCurrent.closest("svg");if(!!f&&f.hasAttribute("data-svg-drop")){var p=x(this.lastEvent,f),m=this.$draggedItem.classed("is-dragged",!1).attr("style","outline: 0px;").node();t.classed("was-dropped",!0),this.cache.items[n]+=1,k(document,"svg.drop",{},{svg:{id:f.id,$node:m,type:m.getAttribute("data-draggable-item"),position:p,size:{width:this.objWidth,height:this.objHeight}}}),this.$draggedItem.remove()}else this.removeDraggableItem(this.$draggedItem,n,r)}this.$slide.classList.remove("is-dragging")}},{key:"handleDeleteItemFromSvgDrop",value:function(){var e=this;document.addEventListener("svg.drop.delete",(function(t){var n=t.detail.item,r=n.slideId,i=n.id;n.$object;var a=e.target.querySelector("div[data-id=".concat(i,"]"));a&&e.$slide.id===r&&(1===e.cache.items[i]&&a.classList.remove("was-dropped"),e.cache.items[i]-=1)}))}},{key:"handleAddTagsFromText",value:function(){var e=this,t=1;document.addEventListener("editor.change",(function(r){var i,a,o,s,l,c=r.detail.text,d=e.target.getAttribute("data-tagName");if(e.dataSources.includes(c.id)&&(!d||d===c.tagData.tagName))switch(c.task){case"add":(i=e.target.firstElementChild.cloneNode(!0)).classList.remove("hidden"),a=i.querySelector(".keywords-item"),"×"===(o=c.value.textContent)[o.length-1]&&(o=o.slice(0,-1)),a.firstElementChild.innerHTML=o,i.firstElementChild.classList.add("node-text-".concat(c.tagColor)),a.classList.add("node-text-".concat(c.tagColor)),(l=(s=i.getAttribute("data-id")).split("-")).splice(-1,1,"dup-".concat(t)),s=l.join("-"),i.setAttribute("data-id",s),c.value.getAttribute("data-tag-id")&&i.setAttribute("data-marker-id",c.value.getAttribute("data-tag-id")),e.cache.items[s]=0,t+=1,e.target.appendChild(i),e.dragAndDropEvents(d3.select(i),s);break;case"remove":e.target.childNodes.forEach((function(e){n.isRightToDeleteHelper(e,c.value,e.getAttribute("data-draggable-item"))&&e.remove()}));break;default:console.log("NewTableERROR: Undefinated task for new table! (cellManager)")}}))}},{key:"removeDraggableItem",value:function(e,t,n){1===this.cache.items[t]&&this.target.querySelector("div[data-id=".concat(t,"]")).classList.remove("was-dropped");n||(this.cache.items[t]-=1),e.remove()}}],[{key:"isRightToDeleteHelper",value:function(e,t,n){return("tag"===n&&"×"===e.textContent[e.textContent.length-1]?e.textContent.slice(0,-1):e.textContent)===t.textContent}}]),n}(v),Xn=function(e){l(n,e);var t=h(n);function n(e){var r;i(this,n);var a=(r=t.call(this,e)).target.querySelectorAll(".selected-item"),o=r.target.querySelectorAll("[data-duplicate]");return HISTORYLAB.import.done?a.forEach((function(e){e.querySelector(".selected-item__placeholder").classList.add("is-hidden");var t=document.querySelector("#".concat(e.getAttribute("data-selectedId")," .is-checked"));t&&n.addItemFromSelect(e,"-loaded",{$node:t})})):(a.forEach((function(e){return n.setSelectEvents(e)})),o.forEach((function(e){return n.setTextEvents(e)}))),r}return o(n,null,[{key:"setSelectEvents",value:function(e){var t=e.getAttribute("data-selectedId"),r=e.querySelector(".selected-item__placeholder");document.addEventListener("selection.change",(function(i){if(t===i.detail.id){var a=i.detail,o="-duplicated";switch(a.task){case"change":n.removeItemFromSelect(e),n.addItemFromSelect(e,o,a);break;case"select":r.classList.add("is-hidden"),n.addItemFromSelect(e,o,a);break;case"unselect":n.removeItemFromSelect(e,a.itemId+o),1===e.childElementCount&&r.classList.remove("is-hidden");break;default:console.error("ERROR: Undefinated task type.")}}}))}},{key:"setTextEvents",value:function(e){var t=e.getAttribute("data-duplicate"),n=t?t.split(" "):[];document.addEventListener("text.change",(function(t){var r=t.detail.text;if(n.includes(r.id))switch(r.task){case"create":case"change":e.innerHTML=r.text;break;default:console.log("Nondefinated text events task. :(")}}))}},{key:"addItemFromSelect",value:function(e,t,n){var r=n.$node.cloneNode(!0);r.setAttribute("data-id",n.itemId+t),r.hasAttribute("data-player-audio")&&N.addEventListeners(r,(function(){})),e.appendChild(r)}},{key:"removeItemFromSelect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t?e.querySelector("[data-id=".concat(t,"]")).remove():e.firstChild.remove()}}]),n}(v),Zn=function(e){l(n,e);var t=h(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).$video=r.target.querySelector("video"),r.$stampItems=r.target.querySelectorAll("[data-stamp]"),r.stampsWrapper=n.createStampsWrapper(r.target),r.$stampItems.forEach((function(e){r._addEventListeners(e)})),r.feedback&&(r.cache.zpetnaVazba=!0,r.cache.colors=r.feedback.map((function(e){return e.barva}))),r}return o(n,[{key:"_addEventListeners",value:function(e){var t=this;e.addEventListener("click",(function(){if(0!==t.$video.currentTime){var r={stamp:e.innerHTML,currentTime:t.$video.currentTime,videoDuration:t.$video.duration,removable:!0,stampsWrapper:t.stampsWrapper};n.addStamp(r)}}),!1)}},{key:"_dispatchEvent",value:function(e){}}]),n}(v);s(Zn,"createStampsWrapper",(function(e){var t=e.querySelector("[data-video-time-progress]"),n=document.createElement("div");return n.classList.add("stamp-wrapper"),n.setAttribute("data-stamp-wrapper",""),t.appendChild(n),n})),s(Zn,"addStamp",(function(e){var t=document.createElement("div");t.className="mark",t.setAttribute("data-stamp-time",e.currentTime),t.setAttribute("data-stamp-mark","");var n=e.currentTime/e.videoDuration;t.style.left="".concat(100*n,"%");var r=document.createElement("div");r.className="stamp ".concat(e.removable&&"removable-stamp"),r.innerHTML=e.stamp,t.appendChild(r),e.removable&&r.addEventListener("click",(function(e){e.target.closest("div[data-stamp-mark]").remove()})),e.stampsWrapper.appendChild(t)}));var Qn=function(){console.log("windowLoad:components");var e=document.querySelectorAll("[data-player-video]");e.length>0&&(e.forEach((function(e){new Kn(e)})),document.addEventListener("slide.change",(function(){T(e)})));var t=document.querySelectorAll('[data-player-audio="normal"]');t.length>0&&t.forEach((function(e){new Hn(e)}));var n=document.querySelectorAll('[data-player-audio="simple"]');n.length>0&&(n.forEach((function(e){new Vn(e)})),document.addEventListener("slide.change",(function(){T(n)})));var r=document.querySelectorAll('[data-fullscreen="toggle"]');r.length>0&&r.forEach((function(e){new Jn(e)}));var i=document.querySelectorAll("[data-lupa-target]");if(i.length>0)for(var a=0;a<i.length;a+=1)new y(i[a]);var o=document.querySelectorAll('[data-fake-map="target"]');if(o.length>0)for(var s=0;s<o.length;s+=1)new Wn(o[s]);var l=document.querySelectorAll('[data-textarea-target=""]');l.length>0&&l.forEach((function(e){new jn(e)}));var c=document.querySelectorAll("[data-svg-target]");if(c.length>0){if(!0!==HISTORYLAB.import.done){var d=document.querySelector("[data-radial-menu]");d&&new R(d,c)}c.forEach((function(e){new D(e)}))}var u=document.querySelectorAll("[data-editor]");u.length>0&&u.forEach((function(e){var t=new zn(e);HISTORYLAB.tools[t.id]=t}));var h=document.querySelectorAll("[data-gallery]");if(h.length>0&&h.forEach((function(e){new Xn(e)})),!0!==HISTORYLAB.import.done){var f=document.querySelectorAll("[data-target-test-quiz]");f.length>0&&f.forEach((function(e){var t=document.querySelector('[data-test-quiz-id-reference="'.concat(e.getAttribute("data-test-quiz-id"),'"]'));new Bn(e.getAttribute("data-test-quiz-id"),e,JSON.parse(t.getAttribute("data-module-settings"))).init()}));var p=document.querySelectorAll("[data-new-table]");p.length>0&&p.forEach((function(e){new Gn(e)}));var m=document.querySelectorAll("[data-draggable]");m.length>0&&m.forEach((function(e){new Un(e)}));var g=document.querySelectorAll("[data-sortable-target]");g.length>0&&g.forEach((function(e){new _(e)}));var v=document.querySelectorAll("[data-selectable-target]");v.length>0&&v.forEach((function(e){new Yn(e)}));var b=document.querySelectorAll("[data-keywords]");b.length>0&&b.forEach((function(e){var t=e.hasAttribute("data-module-settings")?e.getAttribute("data-module-settings"):{};new Pn(e,JSON.parse(t)).init()}));var k=document.querySelectorAll("[data-video-stamp]");k.length>0&&k.forEach((function(e){new Zn(e)}))}};!function(){if(function(){if(!Array.from||!Element.prototype.matches||!Element.prototype.closest||"function"!=typeof window.CustomEvent||"function"!=typeof Object.assign){console.warn("Not supported browser.");var e=document.querySelector("#unsupported");return e.querySelector("#unsupported-browser").innerHTML=" ".concat(platform.name," ").concat(platform.version," "),e.classList.remove("is-hidden"),!0}return!1}())return!1;document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",Qn,!1)}()}();
//# sourceMappingURL=components.build.js.map
