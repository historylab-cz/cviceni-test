{"version":3,"file":"components.build.js","sources":["../../../../src/js/components/dom-load.js","../../../../src/js/components/component.js","../../../../src/js/components/magnifying-glass.js","../../../../src/js/lib/utils.js","../../../../src/js/components/media/media.js","../../../../src/js/components/media/audio-player.js","../../../../src/js/components/svg-lib/svg-dragndrop.js","../../../../src/js/components/svg-lib/svg-draw.js","../../../../src/js/components/svg-lib/svg-text.js","../../../../src/js/components/svg.js","../../../../src/js/components/sortable.js","../../../../src/js/components/svg-lib/svg-radial-menu.js","../../../../src/js/components/editor/selectionMenu.js","../../../../src/js/components/editor/writtingMenu.js","../../../../src/js/components/editor/schema.js","../../../../src/js/components/editor/editor.js","../../../../src/js/components/keywords.js","../../../../src/js/components/test-quiz.js","../../../../src/js/components/fullscreen.js","../../../../src/js/components/user-text.js","../../../../src/js/components/media/audio-player-normal.js","../../../../src/js/components/media/audio-player-simple.js","../../../../src/js/components/fake-map.js","../../../../src/js/components/media/video.js","../../../../src/js/components/selectable.js","../../../../src/js/components/new-table.js","../../../../src/js/components/draggable.js","../../../../src/js/components/gallery.js","../../../../src/js/components/window-load.js","../../../../src/js/components/components.js","../../../../src/js/lib/unsupported-browsers.js"],"sourcesContent":["\r\nconst domLoadComponents = () => {\r\n  console.log('domLoad:components');\r\n\r\n  // instantiate\r\n\r\n  // run\r\n\r\n};\r\n\r\nexport default domLoadComponents;\r\n","export default class Component {\r\n  constructor($element) {\r\n    this.target = $element;\r\n    this.$slide = this.target.closest('.slide');\r\n    this.lang = document.documentElement.getAttribute('lang');\r\n\r\n    if (!HISTORYLAB.import.done) {\r\n\r\n      if (this.$slide) {\r\n        this.$buttonFeedback = this.$slide.querySelector('[data-feedback-button]');\r\n\r\n        if (this.$buttonFeedback) {\r\n          this.$buttonFeedbackText = this.$buttonFeedback.querySelector('span');\r\n        }\r\n      }\r\n\r\n\r\n      this.showFeedback = this.showFeedback.bind(this);\r\n    }\r\n  }\r\n\r\n  showFeedback() {\r\n    if (this.$buttonFeedback && this.$buttonFeedback.classList.contains('button-hidden')) {\r\n      this.$buttonFeedback.classList.remove('button-hidden');\r\n    }\r\n  }\r\n\r\n  hideFeedback() {\r\n    this.$buttonFeedback.classList.add('button-hidden');\r\n  }\r\n}\r\n","import Component from './component';\r\n\r\nexport default class MagnifyingGlass extends Component {\r\n  // https://www.youtube.com/watch?v=e8IwM3iqnL0\r\n  constructor($element) {\r\n    super($element);\r\n    // SVG lupa a ještě dynamicky měnícího se SVG,\r\n    // který není na počátku známé?\r\n    // if (el.nodeName === 'svg') {\r\n    //   console.log('SVG');\r\n    //   el.children[0].getAttribute('xlink:href')\r\n    // }\r\n    this.$element = document.querySelector('[data-lupa]');\r\n    this.$canvas = document.querySelector('[data-lupa-canvas]');\r\n    this.ctx = this.$canvas.getContext('2d');\r\n\r\n    this._onStart = this._onStart.bind(this);\r\n    this._onMove = this._onMove.bind(this);\r\n    this._onEnd = this._onEnd.bind(this);\r\n    this._update = this._update.bind(this);\r\n    this._onResize = this._onResize.bind(this);\r\n\r\n    this.zoomGlassSize = 230;\r\n    this.targetBCR = null;\r\n    this.zoomed = 0;\r\n    this.targetZoomed = 0;\r\n\r\n    this.x = 0;\r\n    this.y = 0;\r\n    this.trackingTouch = false;\r\n    this.displayStyle = '';\r\n\r\n    this._addEventListeners();\r\n    this._initCanvas();\r\n    this._onResize();\r\n\r\n    window.requestAnimationFrame(this._update);\r\n  }\r\n\r\n  _initCanvas() {\r\n    const width = this.zoomGlassSize;\r\n    const height = this.zoomGlassSize;\r\n    // if retina makes canvas more dense\r\n    const dPR = window.devicePixelRation || 1;\r\n    this.$canvas.width = width * dPR;\r\n    this.$canvas.height = height * dPR;\r\n\r\n    this.$canvas.style.width = `${width}px`;\r\n    this.$canvas.style.height = `${height}px`;\r\n\r\n    this.ctx.scale(dPR, dPR);\r\n  }\r\n\r\n  _onResize() {\r\n    this.targetBCR = this.target.getBoundingClientRect();\r\n  }\r\n\r\n  _onStart(event) {\r\n    this.displayStyle = getComputedStyle(this.$element).display;\r\n    if (event.target !== this.target || this.displayStyle === 'none') {\r\n      return;\r\n    }\r\n\r\n    event.preventDefault();\r\n    this.x = event.pageX || event.touches[0].pageX;\r\n    this.y = event.pageY || event.touches[0].pageY;\r\n\r\n    this.trackingTouch = true;\r\n    this.targetZoomed = 1;\r\n    this.zoomed = 0;\r\n\r\n    window.requestAnimationFrame(this._update);\r\n  }\r\n\r\n  _onMove(event) {\r\n    if (!this.trackingTouch || this.displayStyle === 'none') {\r\n      return;\r\n    }\r\n\r\n    this.x = event.pageX || event.touches[0].pageX;\r\n    this.y = event.pageY || event.touches[0].pageY;\r\n  }\r\n\r\n  _onEnd() {\r\n    if (this.targetZoomed) {\r\n      // show OK button or feedback\r\n      this.showFeedback();\r\n    }\r\n\r\n    this.targetZoomed = 0;\r\n    this.trackingTouch = false;\r\n  }\r\n\r\n  _update() {\r\n    const TAU = Math.PI * 2;\r\n    const MAX_RADIUS = 100;\r\n    const radius = this.zoomed * MAX_RADIUS;\r\n\r\n    this.targetBCR = this.target.getBoundingClientRect();\r\n\r\n    // local coordinates (ratio <0,1>)\r\n    const ratioX =\r\n      // min. 0\r\n      Math.max(0,\r\n        // max. 1\r\n        Math.min(1, ((this.x - this.targetBCR.left) / this.targetBCR.width))\r\n      );\r\n    // console.log(ratioX);\r\n    const ratioY =\r\n      // min. 0\r\n      Math.max(0,\r\n        // max. 1\r\n        Math.min(1, ((this.y - this.targetBCR.top) / this.targetBCR.height))\r\n      );\r\n    // console.log(ratioY);\r\n\r\n    // actual zooming (scaling)\r\n    const imageScale = 2.5;\r\n    const scaledTargetWidth = this.targetBCR.width * imageScale;\r\n    const scaledTargetHeight = this.targetBCR.height * imageScale;\r\n\r\n    // Firefox on Windows has a bug because of the shadow\r\n    if (!(platform.os.family.indexOf('Windows') > -1 && platform.name.indexOf('Firefox') > -1)) {\r\n      // Shadow.\r\n      this.ctx.shadowColor = 'rgba(0,0,0,0.4)';\r\n      this.ctx.shadowBlur = 12;\r\n      this.ctx.shadowOffsetY = 8;\r\n    }\r\n\r\n    // Background.\r\n    this.ctx.clearRect(0, 0, this.zoomGlassSize, this.zoomGlassSize);\r\n    this.ctx.fillStyle = '#fff';\r\n    this.ctx.beginPath();\r\n    this.ctx.arc(\r\n      // x\r\n      this.zoomGlassSize / 2,\r\n      // y\r\n      (this.zoomGlassSize - 10) - radius,\r\n      // radius, startAngle, endAngle\r\n      radius, 0, TAU);\r\n    this.ctx.closePath();\r\n    this.ctx.fill();\r\n\r\n    // save the default state (without image)\r\n    this.ctx.save();\r\n\r\n    // Zoomed image.\r\n    this.ctx.beginPath();\r\n    this.ctx.arc(\r\n      // x\r\n      this.zoomGlassSize / 2,\r\n      // y\r\n      (this.zoomGlassSize - 10) - (radius + 1),\r\n      // radius, startAngle, endAngle\r\n      radius * 1.03, 0, TAU);\r\n    this.ctx.clip();\r\n    this.ctx.closePath();\r\n    this.ctx.drawImage(this.target,\r\n      // dx and dy (left and top)\r\n      (-ratioX * scaledTargetWidth) + (this.zoomGlassSize / 2),\r\n      (-ratioY * scaledTargetHeight) + (this.zoomGlassSize / 2),\r\n      // scaled width and height\r\n      scaledTargetWidth, scaledTargetHeight);\r\n\r\n    // go back to default state (without image)\r\n    // so next update starts fresh\r\n    this.ctx.restore();\r\n\r\n    // Position the parent $element.\r\n    this._setTransformStyle(this.x, this.y);\r\n\r\n    // Update the zoom value.\r\n    this.zoomed += (this.targetZoomed - this.zoomed) / 4;\r\n\r\n    // Schedule another update if the zoom is fairly non-zero.\r\n    if (this.zoomed > 0.001) {\r\n      // if (this.zoomed > 0.001 && this.zoomed < 0.998) {\r\n      window.requestAnimationFrame(this._update);\r\n      // } else if (this.zoomed >= 0.998) {\r\n      //   this.zoomed = 1;\r\n    } else {\r\n      this.zoomed = 0;\r\n    }\r\n  }\r\n\r\n  _addEventListeners() {\r\n    // touch events\r\n    document.addEventListener('touchstart', this._onStart);\r\n    document.addEventListener('touchmove', this._onMove);\r\n    document.addEventListener('touchend', this._onEnd);\r\n    // mouse events\r\n    document.addEventListener('mousedown', this._onStart);\r\n    document.addEventListener('mousemove', this._onMove);\r\n    document.addEventListener('mouseup', this._onEnd);\r\n    // window events\r\n    window.addEventListener('resize', this._onResize);\r\n  }\r\n\r\n  _setTransformStyle(x, y) {\r\n    const halfYoomGlassSize = this.zoomGlassSize / 2;\r\n    let betterX;\r\n    let betterY;\r\n\r\n    if (x - halfYoomGlassSize < 0) {\r\n      betterX = Math.abs(x) + halfYoomGlassSize + 18;\r\n    }\r\n    else if (x + halfYoomGlassSize > window.innerWidth) {\r\n      betterX = window.innerWidth - (x - window.innerWidth) - this.zoomGlassSize;\r\n    }\r\n    else {\r\n      betterX = x;\r\n    }\r\n\r\n    if (y - this.zoomGlassSize < 0) {\r\n      betterY = Math.abs(y) + this.zoomGlassSize + 18;\r\n    }\r\n    else {\r\n      betterY = y;\r\n    }\r\n\r\n    this.$element.style.transform = `translate(${betterX}px, ${betterY}px)`;\r\n  }\r\n}\r\n","export const specialClasses = [\r\n  'previous-slide', \r\n  'previous-to-active-slide', \r\n  'active-slide', \r\n  'next-slide', \r\n  'visited-slide'\r\n];\r\n\r\nexport function __isTouchEnabled() {\r\n  return ('ontouchstart' in window) ||\r\n    (navigator.maxTouchPoints > 0) ||\r\n    (navigator.msMaxTouchPoints > 0);\r\n}\r\n\r\n// Is touch: mql.matches === true\r\nexport function __isTouchOnly() {\r\n  return window.matchMedia('(hover: none)').matches;\r\n}\r\n\r\nexport function imageIsLoaded(src) {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image();\r\n    img.onload = () => resolve(img);\r\n    img.onerror = reject;\r\n    img.src = src;\r\n  });\r\n}\r\n\r\nexport function __createNewCustomEvent(name, options = {}, data = null) {\r\n  const defaults = {\r\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Creating_and_triggering_events#Event_bubbling\r\n    bubbles: true,\r\n    // cancelBubble\r\n    // stopPropagation()\r\n    // cancelable\r\n    // composed\r\n    // currentTarget\r\n    // defaultPrevented\r\n    // preventDefault()\r\n    // eventPhase\r\n    // returnValue\r\n    // preventDefault()\r\n    // defaultPrevented\r\n    // target\r\n    // timeStamp\r\n    // type\r\n    // isTrusted\r\n  };\r\n\r\n  const properties = Object.assign(defaults, options);\r\n\r\n  return new CustomEvent(name, {\r\n    detail: data,\r\n    ...properties,\r\n  });\r\n}\r\n\r\nexport function __dispatchEvent($element, type, options, payload) {\r\n  const event = __createNewCustomEvent(type, options, payload);\r\n\r\n  // console.log(event);\r\n  $element.dispatchEvent(event);\r\n}\r\n\r\n/* https://plainjs.com/javascript/events/trigger-an-event-11/ */\r\nexport function __triggerEvent(el, type) {\r\n\r\n  if ('createEvent' in document) {\r\n    // modern browsers, IE9+\r\n    const e = new Event(type);\r\n    el.dispatchEvent(e);\r\n  } else {\r\n    // IE 8\r\n    const e = document.createEventObject();\r\n    e.eventType = type;\r\n    el.fireEvent('on' + e.eventType, e);\r\n  }\r\n}\r\n\r\nexport function __keycodeIsPrintableCharacter(keycode) {\r\n\r\n  const valid =\r\n    (keycode > 47 && keycode < 58) || // number keys\r\n    keycode == 32 || keycode == 13 || // spacebar & return key(s) (if you want to allow carriage returns)\r\n    (keycode > 64 && keycode < 91) || // letter keys\r\n    (keycode > 95 && keycode < 112) || // numpad keys\r\n    (keycode > 185 && keycode < 193) || // ;=,-./` (in order)\r\n    (keycode > 218 && keycode < 223); // [\\]' (in order)\r\n  // https://stackoverflow.com/questions/12467240/determine-if-javascript-e-keycode-is-a-printable-non-control-character#answer-12467610\r\n\r\n  return valid;\r\n\r\n}\r\n\r\nexport function __isObject(item) {\r\n  return (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\n\r\n// https://stackoverflow.com/questions/27936772/how-to-deep-merge-instead-of-shallow-merge\r\n// Maybe use lodash ? https://lodash.com/docs/4.17.10#defaultsDeep\r\nexport function __mergeDeep(target, source) {\r\n  const output = Object.assign({}, target);\r\n  if (__isObject(target) && __isObject(source)) {\r\n    Object.keys(source).forEach((key) => {\r\n      if (__isObject(source[key])) {\r\n        if (!(key in target)) {\r\n          Object.assign(output, { [key]: source[key] });\r\n        } else {\r\n          output[key] = __mergeDeep(target[key], source[key]);\r\n        }\r\n      } else {\r\n        Object.assign(output, { [key]: source[key] });\r\n      }\r\n    });\r\n  }\r\n  return output;\r\n}\r\n\r\nexport function __isObjectEmpty(object) {\r\n  return !Object.keys(object).length;\r\n}\r\n\r\nexport function __insertBefore(newNode, referenceNode) {\r\n  referenceNode.parentNode.insertBefore(newNode, referenceNode);\r\n}\r\n\r\nexport function __insertAfter(newNode, referenceNode) {\r\n\r\n  referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\r\n\r\n}\r\n\r\nexport function __getRealDimensions(el, translated = true) {\r\n\r\n  const clonedElement = el.cloneNode(true);\r\n\r\n  clonedElement.style.visibility = 'hidden';\r\n  clonedElement.style.display = 'block';\r\n\r\n  __insertAfter(clonedElement, el);\r\n\r\n  const elDimensions = clonedElement.getBoundingClientRect();\r\n  const elPosition = (translated) ? __positionTranslated(clonedElement) : __position(clonedElement);\r\n\r\n\r\n  __remove(clonedElement);\r\n\r\n  return {\r\n    width: elDimensions.width,\r\n    height: elDimensions.height,\r\n    top: elPosition.top,\r\n    left: elPosition.left,\r\n  };\r\n\r\n}\r\n\r\nexport function __remove(el /* :HTMLElement */) {\r\n\r\n  el.parentNode.removeChild(el);\r\n\r\n}\r\n\r\n\r\nexport function __getHTML(node) {\r\n\r\n  if (!node || !node.tagName) { return; }\r\n  if (node.outerHTML) { return node.outerHTML; }\r\n\r\n  // polyfill:\r\n  const wrapper = document.createElement('div');\r\n  wrapper.appendChild(node.cloneNode(true));\r\n  return wrapper.innerHTML;\r\n\r\n}\r\n\r\nexport function __getText(el) {\r\n  return el.innerText || el.textContent;\r\n}\r\n\r\nexport function __globalPosition(event) {\r\n  // d3.event\r\n  // The current event, if any. This is set during the invocation of an event listener, and is reset after the listener terminates. Use this to access standard event fields such as event.timeStamp and methods such as event.preventDefault. While you can use the native event.pageX and event.pageY, it is often more convenient to transform the event position to the local coordinate system of the container that received the event using d3.mouse, d3.touch or d3.touches.\r\n  // If you use Babel, Webpack, or another ES6-to-ES5 bundler, be aware that the value of d3.event changes during an event! An import of d3.event must be a live binding, so you may need to configure the bundler to import from D3’s ES6 modules rather than from the generated UMD bundle; not all bundlers observe jsnext:main. Also beware of conflicts with the window.event global.\r\n  \r\n  // for mobile no need more then first finge touch\r\n  return {\r\n    x: event.pageX || event.touches[0].pageX,\r\n    y: event.pageY || event.touches[0].pageY,\r\n  };\r\n}\r\n\r\nexport function __localPosition(event, container) {\r\n  // d3.mouse\r\n  // Returns the x and y coordinates of the current event relative to the specified container. The container may be an HTML or SVG container element, such as a G element or an SVG element. The coordinates are returned as a two-element array of numbers [x, y].\r\n  // BUG: d3.mouse doesn’t observe CSS transform on Firefox — https://github.com/d3/d3-selection/issues/81\r\n  // TEMPORARY FIX: https://github.com/d3/d3-selection/issues/191#issuecomment-474987103\r\n\r\n  let position = [];\r\n\r\n  if (platform.name === 'Firefox' && event.target.closest('.half-slide-active')) {\r\n    // this works for Firefox even in transformed container\r\n    // if (platform.name === 'Firefox')\r\n    // but creates another bug when used on top of another SVG element (with different viewbox?),\r\n    // so make temporary fix only of .half-slide-active to fix the orginal bug with new bug\r\n    // console.log(d3.event.target.closest('.half-slide-active'));\r\n    position = [\r\n      event.offsetX,\r\n      event.offsetY,\r\n    ];\r\n  } else {\r\n    // this works for Chrome\r\n    position = d3.pointer(event, container);\r\n\r\n    // fix for ios\r\n    // https://github.com/d3/d3-selection/blob/main/src/pointer.js\r\n    // vs\r\n    // https://github.com/d3/d3-selection/blob/main/src/pointers.js\r\n    // both or nothing\r\n    if (!position[0]) {\r\n      [ position ] = d3.pointers(event, container);\r\n    }\r\n  }\r\n\r\n  return {\r\n    x: d3.format('.0f')(position[0]),\r\n    y: d3.format('.0f')(position[1]),\r\n  };\r\n}\r\n\r\nexport function __positionTranslated(el) {\r\n\r\n\r\n  const curTransform = new WebKitCSSMatrix(window.getComputedStyle(el).webkitTransform);\r\n\r\n  const body = document.body;\r\n\r\n  const scrollTop = window.pageYOffset || body.scrollTop;\r\n  const scrollLeft = window.pageXOffset || body.scrollLeft;\r\n\r\n  return {\r\n    left: el.offsetLeft + curTransform.m41,\r\n    top: el.offsetTop + curTransform.m42,\r\n  };\r\n\r\n}\r\n\r\nexport function __position(el) {\r\n\r\n  const elAttibutes = el.getBoundingClientRect();\r\n  const body = document.body;\r\n\r\n  const scrollTop = window.pageYOffset || body.scrollTop;\r\n  const scrollLeft = window.pageXOffset || body.scrollLeft;\r\n\r\n  return {\r\n    left: elAttibutes.left + scrollLeft,\r\n    top: elAttibutes.top + scrollTop,\r\n    height: elAttibutes.height,\r\n    width: elAttibutes.width,\r\n  };\r\n}\r\n\r\n// TODO: check for https://github.com/vladocar/nanoJS/\r\nexport function __toggleClass(element, cls) {\r\n  if (__hasClass(element, cls)) {\r\n    __removeClass(element, cls);\r\n  } else {\r\n    __addClass(element, cls);\r\n  }\r\n}\r\n\r\nexport function __hasClass(element, cls) {\r\n  // if there are no elements or classes, we're done\r\n  if (!element || !cls) return false;\r\n  return (element.classList) ? element.classList.contains(cls) : (`${element.className} `).indexOf(`${cls} `) > -1;\r\n}\r\n\r\nexport function __addClass(elements, classes) {\r\n  let _elements = elements;\r\n  let _classes = classes;\r\n\r\n  // if there are no elements or classes, we're done\r\n  if (!_elements || !_classes) { return; }\r\n\r\n  if (typeof (_elements) === 'string') {\r\n    // if we have a selector, get the chosen _elements\r\n    _elements = document.querySelectorAll(_elements);\r\n  } else if (_elements.tagName) {\r\n    // if we have a single DOM element, make it an array to simplify behavior\r\n    _elements = [_elements];\r\n  }\r\n\r\n  if (typeof (_classes) === 'string') {\r\n    // make an array from string _classes\r\n    _classes = _classes.split(' ');\r\n  } else {\r\n    console.log('Class argument must be string with spaces in between class names.');\r\n    return;\r\n  }\r\n\r\n  // add class to all chosen _elements\r\n  for (let i = 0; i < _elements.length; i += 1) {\r\n    // check classList support\r\n    if (_elements[i].classList) {\r\n      _elements[i].classList.add(..._classes);\r\n    } else if (!__hasClass(_elements[i], ..._classes)) {\r\n      for (let j = 0; j < _classes.length; j += 1) {\r\n        _elements[i].classes += ` ${_classes[j]}`;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function __removeClass(elements, classes) {\r\n  let _elements = elements;\r\n  let _classes = classes;\r\n\r\n  // if there are no elements or classes, we're done\r\n  if (!_elements || !_classes) { return; }\r\n\r\n  if (typeof (_elements) === 'string') {\r\n    // if we have a selector, get the chosen _elements\r\n    _elements = document.querySelectorAll(_elements);\r\n  } else if (_elements.tagName) {\r\n    // if we have a single DOM element, make it an array to simplify behavior\r\n    _elements = [_elements];\r\n  }\r\n\r\n  if (typeof (_classes) === 'string') {\r\n    // make an array from string _classes\r\n    _classes = _classes.split(' ');\r\n  } else {\r\n    console.log('Class argument must be string with spaces in between class names.');\r\n    return;\r\n  }\r\n\r\n  // remove class from all chosen _elements\r\n  for (let i = 0; i < _elements.length; i += 1) {\r\n    // check classList support\r\n    if (_elements[i].classList) {\r\n      _elements[i].classList.remove(..._classes);\r\n    } else {\r\n      for (let j = 0; j < _classes.length; j += 1) {\r\n        _elements[i].className = _elements[i].className.replace(new RegExp(`\\\\b${classes[j]}\\\\b`, 'g'), '');\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function __getElementComputedValue(element, value) {\r\n  const values = getComputedStyle(element);\r\n  return values.getPropertyValue(value) || null;\r\n}\r\n\r\n/**\r\n * https://stackoverflow.com/questions/17130940/retrieve-the-same-offsetx-on-touch-like-mouse-event#answer-66858288\r\n * \r\n * @param {event} Event\r\n * @returns Object with { x: offsetX, y:offsetY }\r\n */\r\nexport function __offSetForTouchEvent(e) {\r\n  const {\r\n    x, y, width, height,\r\n  } = e.target.getBoundingClientRect();\r\n  const offsetX = ((e.touches[0].clientX - x) / width) * e.target.offsetWidth;\r\n  const offsetY = ((e.touches[0].clientY - y) / height) * e.target.offsetHeight;\r\n\r\n  return { x: offsetX, y: offsetY };\r\n}\r\n","import { __createNewCustomEvent } from '../../lib/utils';\r\n\r\nconst mediaEvents = {\r\n  playchange: __createNewCustomEvent('playchange'),\r\n  timechange: __createNewCustomEvent('timechange'),\r\n  canplaystart: __createNewCustomEvent('canplaystart'),\r\n};\r\n\r\nfunction stopPlayingVideoPlayers($players) {\r\n  // pause all other playing media tracks\r\n  $players.forEach(($player) => {\r\n    const $media = $player.querySelector('audio') || $player.querySelector('video');\r\n    if ($media && !$media.paused) {\r\n      $media.pause();\r\n      $player\r\n        .querySelector('[data-player-control]')\r\n        .setAttribute('data-player-control', 'paused');\r\n    }\r\n  });\r\n}\r\n\r\nfunction getSecondsMinutesFormat(seconds) {\r\n  const duration = {\r\n    seconds: Math.floor(seconds),\r\n    minutes: Math.floor(seconds / 60),\r\n  };\r\n\r\n  duration.seconds = (duration.seconds - (duration.minutes * 60)).toString(10);\r\n\r\n  return `${duration.minutes}:${(`0${duration.seconds}`).slice(-2)}`;\r\n}\r\n\r\nexport {\r\n  getSecondsMinutesFormat,\r\n  stopPlayingVideoPlayers,\r\n  mediaEvents,\r\n};\r\n","import Component from '../component';\r\nimport { getSecondsMinutesFormat, stopPlayingVideoPlayers } from './media';\r\n\r\nexport default class AudioPlayer extends Component {\r\n  // eslint-disable-next-line no-useless-constructor\r\n  constructor($element) {\r\n    super($element);\r\n  }\r\n\r\n  // TODO: move to audio-simple.js\r\n  static addEventListeners($item, showFeedback) {\r\n    const $players = document.querySelectorAll('[data-player-audio]');\r\n    const $audio = $item.querySelector('audio');\r\n    const $playButton = $item.querySelector('[data-player-control]');\r\n    const $timeLeft = $item.querySelector('[data-audio-time-left]');\r\n\r\n    $playButton.addEventListener('click', (event) => {\r\n      if ($playButton.getAttribute('data-player-control') === 'paused') {\r\n        // TODO: abstract\r\n        stopPlayingVideoPlayers($players);\r\n        $audio.play();\r\n        $playButton.setAttribute('data-player-control', 'playing');\r\n      } else {\r\n        // TODO: abstract\r\n        $audio.pause();\r\n        $playButton.setAttribute('data-player-control', 'paused');\r\n      }\r\n\r\n      showFeedback();\r\n\r\n      event.stopPropagation();\r\n    }, false);\r\n\r\n    // do not propagate audio control events higher into the dom\r\n    $playButton.addEventListener('mousedown', (event) => {\r\n      event.stopPropagation();\r\n    }, false);\r\n\r\n    $audio.addEventListener('timeupdate', () => {\r\n      $timeLeft.innerText = getSecondsMinutesFormat($audio.currentTime);\r\n    });\r\n\r\n    $audio.addEventListener('ended', () => {\r\n      $playButton.setAttribute('data-player-control', 'paused');\r\n    });\r\n  }\r\n}\r\n","export default class SVGDragNDrop {\r\n  // static drag(id) {\r\n  //   d3.drag()\r\n  //     .on('start', () => {\r\n  //       SVGDragNDrop.start(id);\r\n  //     })\r\n  //     .on('drag', () => {\r\n  //       SVGDragNDrop.dragged(id);\r\n  //     })\r\n  //     .on('end', () => {\r\n  //       SVGDragNDrop.end(id);\r\n  //     });\r\n  // }\r\n\r\n  static start($element) {\r\n    d3.select($element).raise().classed('is-dragged', true);\r\n  }\r\n\r\n  static dragged(event, $element, type, diff, $node) {\r\n    let [xZarov, yZarov] = this.getJustifiedCord(event, $element, type, diff, $node);\r\n    d3.select($element).attr('x', xZarov.toFixed()).attr('y', yZarov.toFixed());\r\n  }\r\n\r\n  static end(event, $element, type, diff, $node) {\r\n    let [xZarov, yZarov] = this.getJustifiedCord(event, $element, type, diff, $node);\r\n    d3.select($element)\r\n      .attr('x', xZarov.toFixed())\r\n      .attr('y', yZarov.toFixed())\r\n      // neumožňuje v jiných funkcí s tímto objektem dále pracovat,\r\n      // protože pracují s id\r\n      // .attr('id', `${type}-${d3.event.x.toFixed()}-${d3.event.y.toFixed()}`)\r\n      .classed('is-dragged', false);\r\n  }\r\n\r\n  /**\r\n   * Method which return additional offsets due the orientation of textarea\r\n   * @returns {Array} [x,y]\r\n   *\r\n   * @param {Object} orientation object of orentation of textarea against black dot\r\n   * @param {Object} elementResolution object of element resolution\r\n   */\r\n  static getOffsetOfText(orientation, elementResolution) {\r\n    if (orientation[0] === 'left' && orientation[1] === 'top') {\r\n      return [elementResolution.width - 10, elementResolution.height - 10];\r\n    }\r\n    if (orientation[0] === 'left' && orientation[1] === 'bottom') {\r\n      return [elementResolution.width - 10, 0];\r\n    }\r\n    if (orientation[0] === 'right' && orientation[1] === 'top') {\r\n      return [0, elementResolution.height - 10];\r\n    }\r\n    if (orientation[0] === 'right' && orientation[1] === 'bottom') {\r\n      return [0, 0];\r\n    }\r\n  }\r\n\r\n  static getJustifiedCord(event, $element, type, diff, $node) {\r\n    const elementResolution = {\r\n      height: $node.offsetHeight,\r\n      width: $node.offsetWidth,\r\n    };\r\n\r\n    const svgResolution = $element\r\n      .getAttribute('data-svg-resolution')\r\n      .split(', ')\r\n      .map((e) => parseInt(e, 10));\r\n\r\n    switch (type) {\r\n      case 'text':\r\n        return this.textJustified(\r\n          event,\r\n          $element,\r\n          diff,\r\n          elementResolution,\r\n          svgResolution,\r\n        );\r\n      case 'pretahovani':\r\n        return this.pretahovaniJustified(\r\n          event,\r\n          $element,\r\n          diff,\r\n          svgResolution,\r\n        );\r\n      default:\r\n        return this.circleJustified(event, svgResolution, diff, elementResolution);\r\n    }\r\n  }\r\n\r\n  static textJustified(event, $element, diff, elementResolution, svgResolution) {\r\n    const orientation = $element\r\n      .getAttribute('data-svg-text-orientation')\r\n      .split(', ');\r\n    const textCenter = this.getOffsetOfText(orientation, elementResolution);\r\n    let xZarov = 0;\r\n    let yZarov = 0;\r\n\r\n    // for x\r\n    if (event.x - diff.x <= 10 + textCenter[0]) {\r\n      xZarov = 10 + textCenter[0];\r\n    } else if (\r\n      event.x - diff.x >\r\n      svgResolution[0] - elementResolution.width + textCenter[0]\r\n    ) {\r\n      xZarov = svgResolution[0] - elementResolution.width + textCenter[0];\r\n    } else {\r\n      xZarov = event.x - diff.x;\r\n    }\r\n    // for y\r\n    if (event.y - diff.y <= 10 + textCenter[1]) {\r\n      yZarov = 10 + textCenter[1];\r\n    } else if (\r\n      event.y - diff.y >\r\n      svgResolution[1] - elementResolution.height + textCenter[1]\r\n    ) {\r\n      yZarov = svgResolution[1] - elementResolution.height + textCenter[1];\r\n    } else {\r\n      yZarov = event.y - diff.y;\r\n    }\r\n    return [xZarov, yZarov];\r\n  }\r\n\r\n  static pretahovaniJustified(event, $element, diff, svgResolution) {\r\n    const elementResolution = {\r\n      height: $element.attributes.height.value,\r\n      width: $element.attributes.width.value,\r\n    };\r\n    let xZarov = 0;\r\n    let yZarov = 0;\r\n    // FOR X\r\n    // left side\r\n    if (event.x - diff.x <= 0) {\r\n      xZarov = 0;\r\n    }\r\n    // right side\r\n    else if (event.x - diff.x > svgResolution[0] - elementResolution.width) {\r\n      xZarov = svgResolution[0] - elementResolution.width;\r\n    }\r\n    // else for X axis\r\n    else {\r\n      xZarov = event.x - diff.x;\r\n    }\r\n    // FOR Y\r\n    // upper side\r\n    if (event.y - diff.y <= 0) {\r\n      yZarov = 0;\r\n    }\r\n    // down side\r\n    else if (\r\n      event.y - diff.y >\r\n      svgResolution[1] - elementResolution.height\r\n    ) {\r\n      yZarov = svgResolution[1] - elementResolution.height;\r\n    }\r\n    // else for y\r\n    else {\r\n      yZarov = event.y - diff.y;\r\n    }\r\n    return [xZarov, yZarov];\r\n  }\r\n\r\n  static circleJustified(event, svgResolution, diff, elementResolution) {\r\n    let xZarov = 0;\r\n    let yZarov = 0;\r\n    // FOR X\r\n    // left side\r\n    if (event.x - diff.x <= elementResolution.width / 2) {\r\n      xZarov = elementResolution.width / 2;\r\n    }\r\n    // right side\r\n    else if (\r\n      event.x - diff.x >\r\n      svgResolution[0] - elementResolution.width / 2\r\n    ) {\r\n      xZarov = svgResolution[0] - elementResolution.width / 2;\r\n    }\r\n    // else for X axis\r\n    else {\r\n      xZarov = event.x - diff.x;\r\n    }\r\n    // FOR Y\r\n    // upper side\r\n    if (event.y - diff.y <= elementResolution.height / 2) {\r\n      yZarov = elementResolution.height / 2;\r\n    }\r\n    // down side\r\n    else if (\r\n      event.y - diff.y >\r\n      svgResolution[1] - elementResolution.height / 2\r\n    ) {\r\n      yZarov = svgResolution[1] - elementResolution.height / 2;\r\n    }\r\n    // else for y\r\n    else {\r\n      yZarov = event.y - diff.y;\r\n    }\r\n    return [xZarov, yZarov];\r\n  }\r\n\r\n  static circleMove(d3Element, event, svgResolution, diff, elementResolution) {\r\n    const [xZarov, yZarov] = this.circleJustified(event, svgResolution, diff, elementResolution);\r\n    d3Element.attr('cx', xZarov.toFixed()).attr('cy', yZarov.toFixed());\r\n  }\r\n}\r\n","import { __localPosition, __dispatchEvent, __getElementComputedValue } from '../../lib/utils';\r\n\r\n// import SVG from '../svg';\r\nimport SVGDragNDrop from './svg-dragndrop';\r\nimport SVG from '../svg';\r\n\r\nexport default class SVGDraw {\r\n  // static selectPath(svg) {\r\n  //   // https://bl.ocks.org/mbostock/8027637\r\n  // }\r\n\r\n  static renderPath(event, $svg, color, callback) {\r\n    if (event.sourceEvent.target.nodeName === 'image') {\r\n\r\n      const line = d3.line()\r\n        // removed smooth curve to get rid of loong decimals\r\n        // see https://github.com/d3/d3-path/issues/10\r\n        .curve(d3.curveLinear); // _dragStarted\r\n\r\n      const format = d3.format('.0f');\r\n      const d = event.subject;\r\n      // origin\r\n      let x0 = format(event.x);\r\n      let y0 = format(event.y);\r\n\r\n      const id = `${$svg.id}_path-${x0}-${y0}`;\r\n\r\n      const active = d3.select(`#${$svg.id} .svg-view`).append('svg:path')\r\n        // .attr('marker-start', 'url('#marker-circle-blue')')\r\n        // .attr('marker-end', 'url('#marker-arrow-blue')')\r\n        .attr('data-svg-path', '')\r\n        .attr('class', `svg-path ${color}`)\r\n        .attr('id', id)\r\n        .datum(d);\r\n\r\n      // github.com/d3/d3-drag#event_on\r\n      event\r\n        .on('drag', (dragEvent) => {\r\n          // current position\r\n          const x1 = format(dragEvent.x);\r\n          const y1 = format(dragEvent.y);\r\n          // distance from origin\r\n          const dx = x1 - x0;\r\n          const dy = y1 - y0;\r\n\r\n          // if the distance of drag event is too large, make new origin\r\n          if ((dx * dx) + (dy * dy) > 300) d.push([x0 = x1, y0 = y1]);\r\n          // smooth line, correct last point\r\n          else d[d.length - 1] = [x1, y1];\r\n\r\n          active.attr('d', line);\r\n        })\r\n        .on('end', () => {\r\n          const $thisPath = d3.select(`#${id}`);\r\n          if ($thisPath) {\r\n            if ($thisPath.attr('d')) {\r\n              if ($thisPath.attr('d').length < 40) {\r\n                $thisPath.remove();\r\n              }\r\n              else {\r\n                // dispatch event that svg has changed\r\n                __dispatchEvent(document, 'svg.change', {}, {\r\n                  svg: {\r\n                    id: $svg.id,\r\n                    task: 'create',\r\n                    node: $thisPath.node(),\r\n                    nodeName: $thisPath.node().nodeName,\r\n                    contextMenu: false,\r\n                  },\r\n                });\r\n              }\r\n            }\r\n            else if (!$thisPath.attr('d')) {\r\n              $thisPath.remove();\r\n            }\r\n          }\r\n\r\n          callback();\r\n        });\r\n\r\n      // add events to element\r\n      SVGDraw.pathEventsManager($svg, d3.select(`#${id}`).node());\r\n    }\r\n  }\r\n\r\n  // Draw a SVG circle on click\r\n  static createCircle(event, $svg, color) {\r\n    const svgGroup = d3.select($svg).select('.svg-view');\r\n    // d3.select(`#${$svg.id} .svg-view`);\r\n    // const canvas = document.querySelector(`#${$svg.id} .svg-view`);\r\n    const localPosition = __localPosition(event, $svg);\r\n    const id = `${$svg.id}_circle-${localPosition.x}-${localPosition.y}`;\r\n\r\n    const $circle = svgGroup.append('svg:circle')\r\n      .attr('data-svg-circle', '')\r\n      .attr('id', id)\r\n      .attr('cx', localPosition.x)\r\n      .attr('cy', localPosition.y)\r\n      .attr('data-svg-resolution', `${svgGroup.attr('width')}, ${svgGroup.attr('height')}`)\r\n      .attr('data-svg-type', 'circle')\r\n      .attr('class', `svg-circle ${color} unselectable`);\r\n\r\n    const $element = document.querySelector(`#${id}`);\r\n\r\n    // add events to element\r\n    SVGDraw.circleEventsManager($svg, $element);\r\n\r\n    // dispatch event that svg has changed\r\n    __dispatchEvent(document, 'svg.change', {}, {\r\n      svg: {\r\n        id: $svg.id,\r\n        task: 'create',\r\n        node: $element,\r\n        nodeName: $element.nodeName,\r\n        contextMenu: false,\r\n      },\r\n    });\r\n  }\r\n\r\n  static pathEventsManager($svg, $element) {\r\n    d3.select(`#${$element.id}`).on('click', (event) => {\r\n      // dispatch event that svg has changed\r\n      __dispatchEvent(document, 'svg.change', {}, {\r\n        svg: {\r\n          id: $svg.id,\r\n          task: 'remove',\r\n          node: event.target,\r\n          nodeName: event.target.nodeName,\r\n          contextMenu: false,\r\n        },\r\n      });\r\n\r\n      d3.select(`#${$element.id}`).remove();\r\n\r\n      event.preventDefault();\r\n    }, false);\r\n  }\r\n\r\n  static circleEventsManager($svg, $element) {\r\n    const $canvas = document.querySelector(`#${$svg.id} .svg-view`); // group <g>...</g>\r\n    const d3Element = d3.select($element);\r\n    const svgResolution = [\r\n      parseInt($canvas.getAttribute('width'), 10),\r\n      parseInt($canvas.getAttribute('height'), 10),\r\n    ];\r\n    const circleR = __getElementComputedValue($element, 'r');\r\n    const elementResolution = [\r\n      circleR * 2, // height\r\n      circleR * 2, // width\r\n    ];\r\n\r\n    // TODO:\r\n    // standalone function\r\n    // same for all draggable svg elements\r\n    let elementPosition = [\r\n      d3Element.attr('cx'),\r\n      d3Element.attr('cy'),\r\n    ];\r\n    let diff = {};\r\n\r\n    d3Element.on('click', (event) => {\r\n\r\n      // dispatch event that svg has changed\r\n      __dispatchEvent(document, 'svg.change', {}, {\r\n        svg: {\r\n          id: $svg.id,\r\n          task: 'remove',\r\n          node: $element,\r\n          nodeName: $element.nodeName,\r\n          contextMenu: false,\r\n        },\r\n      });\r\n\r\n      event.target.remove();\r\n    })\r\n      .call(d3.drag()\r\n        .container($canvas)\r\n        .subject($element)\r\n        .on('start', (event) => {\r\n          diff = {\r\n            x: event.x - elementPosition[0],\r\n            y: event.y - elementPosition[1],\r\n          };\r\n\r\n          SVGDragNDrop.start($element);\r\n\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.propagation', {}, {\r\n            event: { from: 'circle.drag.start', data: event },\r\n          });\r\n        })\r\n        .on('drag', (event) => {\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\r\n          if (d3Element.attr('data-svg-selected') === 'true') return;\r\n\r\n          SVGDragNDrop.circleMove(d3Element, event, svgResolution, diff, elementResolution);\r\n        })\r\n        .on('end', (event) => {\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\r\n          if (d3Element.attr('data-svg-selected') === 'true') return;\r\n\r\n          const oldXCoordinate = elementPosition[0];\r\n          const oldYCoordinate = elementPosition[1];\r\n          let taskType = 'move';\r\n\r\n          SVGDragNDrop.circleMove(d3Element, event, svgResolution, diff, elementResolution);\r\n          d3Element.classed('is-dragged', false);\r\n\r\n          elementPosition = [\r\n            $element.getAttribute('cx'),\r\n            $element.getAttribute('cy'),\r\n          ];\r\n\r\n          // if clone is changed, then dispatch create event\r\n          if (SVG.removeCloneConnectionManager($element)) taskType = 'create';\r\n\r\n          if (elementPosition[0] !== oldXCoordinate || elementPosition[1] !== oldYCoordinate) {\r\n            // dispatch event that svg has changed\r\n            __dispatchEvent(document, 'svg.change', {}, {\r\n              svg: {\r\n                id: $svg.id,\r\n                task: taskType,\r\n                node: $element,\r\n                nodeName: $element.nodeName,\r\n                contextMenu: false,\r\n              },\r\n            });\r\n          }\r\n        }));\r\n  }\r\n\r\n  // it is mimular to circle EventManager but not same\r\n  static dropItemEventsManager($svg, $element) {\r\n    const $canvas = document.querySelector(`#${$svg.id} .svg-view`); // group <g>...</g>\r\n    const d3Element = d3.select($element);\r\n\r\n    // TODO:\r\n    // standalone function\r\n    // same for all draggable svg elements\r\n    let elementPosition = [\r\n      d3Element.attr('x'),\r\n      d3Element.attr('y'),\r\n    ];\r\n    let diff = {};\r\n\r\n    d3Element.on('click', () => {\r\n\r\n      // dispatch event that svg has changed\r\n      __dispatchEvent(document, 'svg.change', {}, {\r\n        svg: {\r\n          id: $svg.id,\r\n          task: 'remove',\r\n          node: $element,\r\n          nodeName: $element.nodeName,\r\n          contextMenu: false,\r\n        },\r\n      });\r\n\r\n      // dispatch event that drop item was deleted\r\n      const idParts = $element.id.split('_');\r\n      const $slide = $svg.closest('.slide');\r\n      if (idParts[idParts.length - 1] === 'dropItem') {\r\n        __dispatchEvent(document, 'svg.drop.delete', {}, {\r\n          item: {\r\n            slideId: $slide.id,\r\n            id: idParts[1],\r\n            $object: $element.firstChild,\r\n          },\r\n        });\r\n      }\r\n\r\n      $element.remove();\r\n    })\r\n      .call(d3.drag()\r\n        .container($canvas)\r\n        .subject($element)\r\n        .on('start', (event) => {\r\n          diff = {\r\n            x: event.x - elementPosition[0],\r\n            y: event.y - elementPosition[1],\r\n          };\r\n\r\n          SVGDragNDrop.start($element);\r\n\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.propagation', {}, {\r\n            event: { from: 'circle.drag.start', data: event },\r\n          });\r\n        })\r\n        .on('drag', (event) => {\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\r\n          if (d3Element.attr('data-svg-selected') === 'true') return;\r\n\r\n          SVGDragNDrop.dragged(event, $element, 'pretahovani', diff, $element);\r\n        })\r\n        .on('end', (event) => {\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\r\n          if (d3Element.attr('data-svg-selected') === 'true') return;\r\n\r\n          const oldXCoordinate = elementPosition[0];\r\n          const oldYCoordinate = elementPosition[1];\r\n          let taskType = 'move';\r\n\r\n          SVGDragNDrop.end(event, $element, 'pretahovani', diff, $element);\r\n\r\n          d3Element.classed('is-dragged', false);\r\n\r\n          elementPosition = [\r\n            $element.getAttribute('x'),\r\n            $element.getAttribute('y'),\r\n          ];\r\n\r\n          // if clone is changed, then dispatch create event\r\n          if (SVG.removeCloneConnectionManager($element)) taskType = 'create';\r\n\r\n          if (elementPosition[0] !== oldXCoordinate || elementPosition[1] !== oldYCoordinate) {\r\n            // dispatch event that svg has changed\r\n            __dispatchEvent(document, 'svg.change', {}, {\r\n              svg: {\r\n                id: $svg.id,\r\n                task: taskType,\r\n                node: $element,\r\n                nodeName: $element.nodeName,\r\n                contextMenu: false,\r\n              },\r\n            });\r\n          }\r\n        }));\r\n  }\r\n}\r\n","import {\r\n  __addClass,\r\n  __removeClass,\r\n  __hasClass,\r\n  __dispatchEvent,\r\n} from '../../lib/utils';\r\n\r\nimport SVG from '../svg';\r\nimport SVGDragNDrop from './svg-dragndrop';\r\n\r\nexport default class SVGText {\r\n  static createText(maxLength = 333, minLength = 2) {\r\n    const defaultWidth = '15.2rem';\r\n    const defaultHeight = '55px';\r\n\r\n    const $svg = document.querySelector('[data-svg-active=\"true\"]');\r\n    const svgID = $svg.id;\r\n    const svgGroup = d3.select($svg).select('.svg-view');\r\n\r\n    // const $canvas = $svg.querySelector('.svg-view');\r\n    const $radialMenu = document.querySelector('[data-radial-menu]');\r\n    const localPosition = {\r\n      x: $radialMenu.getAttribute('data-local-x'),\r\n      y: $radialMenu.getAttribute('data-local-y'),\r\n    };\r\n    const id = `${svgID}_svg-text-${localPosition.x}-${localPosition.y}`;\r\n    const hash = `#${id}`;\r\n    const orientation = {\r\n      x: (svgGroup.attr('width') - localPosition.x) > 320 ? 'right' : 'left',\r\n      y: (svgGroup.attr('height') - localPosition.y) > 60 ? 'bottom' : 'top',\r\n    };\r\n    // let firstWrite = true;\r\n\r\n    // text wrapper\r\n    const foreignObject = svgGroup.append('svg:foreignObject')\r\n      .attr('class', `svg-text orientation-${orientation.x} orientation-${orientation.y} unselectable`)\r\n      .attr('data-svg-text', '')\r\n      .attr('x', localPosition.x)\r\n      .attr('y', localPosition.y)\r\n      .attr('data-svg-text-orientation', `${orientation.x}, ${orientation.y}`)\r\n      .attr('data-svg-resolution', `${svgGroup.attr('width')}, ${svgGroup.attr('height')}`)\r\n      .attr('style', `width: ${defaultWidth}; height: ${defaultHeight};`);\r\n\r\n    // create visual point of interest for text input\r\n    const circle = svgGroup.append('svg:circle')\r\n      .attr('id', `${id}-circle`)\r\n      .attr('cx', localPosition.x)\r\n      .attr('cy', localPosition.y)\r\n      .attr('class', 'svg-circle svg-circle-text do-not-remove unselectable');\r\n\r\n    // create text input\r\n    const textarea = foreignObject.append('xhtml:textarea')\r\n      .attr('maxlength', maxLength)\r\n      .attr('tabindex', '-1')\r\n      .attr('id', id)\r\n      .attr('class', 'svg-textarea')\r\n      .attr('data-save', '')\r\n      .attr('data-svg-textarea-target', svgID)\r\n      .attr('style', `width: ${defaultWidth}; height: ${defaultHeight};`);\r\n\r\n    // fix visual orientation on bottom\r\n    SVGText.fixVisualOrientation(foreignObject.node());\r\n\r\n    // set focus to the new text input\r\n    $svg.querySelector(hash).focus();\r\n\r\n    // add events to element\r\n    SVGText.textEventsManager($svg, textarea.node(), circle.node(), true, minLength);\r\n  }\r\n\r\n  static textEventsManager($svg, $textarea, $circle, isCreated, minLength = 2) {\r\n    const $canvas = $svg.querySelector('.svg-view');\r\n    const hash = `#${$textarea.id}`;\r\n    let firstWrite = isCreated;\r\n    let oldText = $textarea.value;\r\n\r\n    // TODO\r\n    // standalone function\r\n    // same for all draggable svg elements\r\n    const $element = $svg.querySelector(hash).parentElement;\r\n    let elementPosition = [\r\n      $element.getAttribute('x'),\r\n      $element.getAttribute('y'),\r\n    ];\r\n    let diff = {};\r\n\r\n    d3.select(hash)\r\n      // drag & drop\r\n      .call(d3.drag()\r\n        .container($canvas)\r\n        .subject($element)\r\n        .on('start', (event) => {\r\n          diff = {\r\n            x: event.x - elementPosition[0],\r\n            y: event.y - elementPosition[1],\r\n          };\r\n\r\n          SVGDragNDrop.start($element);\r\n\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.propagation', {}, {\r\n            event: { from: 'text.drag.start', data: event },\r\n          });\r\n        })\r\n        .on('drag', (event) => {\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\r\n\r\n          SVGDragNDrop.dragged(event, $element, 'text', diff, $textarea);\r\n\r\n          // circle is moving with text\r\n          $circle.setAttribute('cx', $element.getAttribute('x'));\r\n          $circle.setAttribute('cy', $element.getAttribute('y'));\r\n        })\r\n        .on('end', (event) => {\r\n          // dispatch event for radio menu - iOS fix\r\n          __dispatchEvent(document, 'event.stopPropagation', {}, { event: {} });\r\n          // enable editting created comment\r\n          $textarea.focus();\r\n\r\n          const oldXCoordinate = elementPosition[0];\r\n          const oldYCoordinate = elementPosition[1];\r\n          let taskType = 'move';\r\n\r\n          SVGDragNDrop.end(event, $element, 'text', diff, $textarea);\r\n\r\n          elementPosition = [\r\n            $element.getAttribute('x'),\r\n            $element.getAttribute('y'),\r\n          ];\r\n\r\n          // circle is moving with text\r\n          $circle.setAttribute('cx', elementPosition[0]);\r\n          $circle.setAttribute('cy', elementPosition[1]);\r\n\r\n          if (!firstWrite && (elementPosition[0] !== oldXCoordinate || elementPosition[1] !== oldYCoordinate)) {\r\n            // if clone is changed, then dispatch create event\r\n            if (SVG.removeCloneConnectionManager($element.childNodes[0])) {\r\n              taskType = 'create';\r\n              // also for circle\r\n              SVG.removeCloneConnectionManager($circle);\r\n            }\r\n\r\n            // dispatch event that svg has changed\r\n            __dispatchEvent(document, 'svg.change', {}, {\r\n              svg: {\r\n                id: $svg.id,\r\n                task: taskType,\r\n                node: $element.childNodes[0],\r\n                nodeName: $element.childNodes[0].nodeName,\r\n                circle: $circle,\r\n                contextMenu: false,\r\n              },\r\n            });\r\n          }\r\n\r\n          // fix for tablets and mobiles\r\n          // circle must be over text\r\n          d3.select($circle).raise();\r\n        }))\r\n      // keystroke\r\n      // control height of the text input on every key stroke\r\n      .on('keyup', (event) => {\r\n        SVGText.updateTextareaHeight(event.target);\r\n      })\r\n      // loss of focus\r\n      .on('blur', (event) => {\r\n        const $target = event.target;\r\n        const { value } = $target;\r\n        let taskType;\r\n        let wrongBool = false;\r\n\r\n        if (value.length === 0) {\r\n          SVG.removeItem(false, hash);\r\n          return;\r\n        }\r\n        if (value.length < minLength) {\r\n          __addClass($target, 'is-wrong');\r\n          wrongBool = true;\r\n        }\r\n        else if ((value.length >= minLength) && __hasClass($target, 'is-wrong')) {\r\n          __removeClass($target, 'is-wrong');\r\n          wrongBool = false;\r\n        }\r\n\r\n        if (oldText !== value) {\r\n          if (firstWrite) {\r\n            taskType = 'create';\r\n            firstWrite = false;\r\n          }\r\n          else {\r\n            taskType = 'change';\r\n          }\r\n          oldText = value;\r\n          // if clone is changed, then dispatch create event\r\n          if (SVG.removeCloneConnectionManager($target)) {\r\n            taskType = 'create';\r\n            // also for circle\r\n            SVG.removeCloneConnectionManager($circle);\r\n          }\r\n\r\n          // dispatch event that svg has changed\r\n          __dispatchEvent(document, 'svg.change', {}, {\r\n            svg: {\r\n              id: $svg.id,\r\n              task: taskType,\r\n              node: $target,\r\n              nodeName: $target.nodeName,\r\n              circle: $circle,\r\n              isWrong: wrongBool,\r\n              contextMenu: false,\r\n            },\r\n          });\r\n        }\r\n\r\n        // update oldText\r\n        oldText = value;\r\n        // fix ios text writing\r\n        event.target.classList.remove('unselectable');\r\n      })\r\n      // gain focus\r\n      .on('focus', () => {\r\n        d3.select($element).raise();\r\n        d3.select($circle).raise();\r\n      });\r\n  }\r\n\r\n  static updateTextareaHeight($target) {\r\n    $target.style.height = '1px';\r\n\r\n    const newHeight = `${22 + $target.scrollHeight}px`;\r\n    $target.style.height = newHeight;\r\n\r\n    // fix value for FO either\r\n    const $parent = $target.parentElement;\r\n    $parent.style.height = newHeight;\r\n    // fix visual orientation on bottom\r\n    SVGText.fixVisualOrientation($parent);\r\n  }\r\n\r\n  static fixVisualOrientation($element) {\r\n    const currentCommentWidth = $element.style.width;\r\n    const currentCommentHeight = $element.style.height;\r\n    if ($element.classList.contains('orientation-left') && $element.classList.contains('orientation-top')) {\r\n      $element.style.transform = `translate(-${currentCommentWidth}, -${currentCommentHeight})`;\r\n    }\r\n    else if ($element.classList.contains('orientation-top')) {\r\n      $element.style.transform = `translateY(-${currentCommentHeight})`;\r\n    }\r\n    else if ($element.classList.contains('orientation-left')) {\r\n      $element.style.transform = `translateX(-${currentCommentWidth})`;\r\n    }\r\n  }\r\n\r\n  static comicBubblesEventsManager($svg, $node) {\r\n    let firstWrite = true;\r\n    let oldText = $node.value;\r\n\r\n    d3.select($node).on('keyup', (event) => {\r\n      SVGText.updateTextareaHeight(event.target);\r\n    })\r\n      .on('blur', (event) => {\r\n        const $target = event.target;\r\n        const { value } = $target;\r\n        let taskType;\r\n\r\n        if (oldText !== value) {\r\n          if (firstWrite) {\r\n            taskType = 'create';\r\n            firstWrite = false;\r\n          }\r\n          else {\r\n            taskType = 'change';\r\n            if (value.length === 0) {\r\n              firstWrite = true;\r\n            }\r\n          }\r\n          oldText = value;\r\n          // if clone is changed, then dispatch create event\r\n          if (SVG.removeCloneConnectionManager($target)) taskType = 'create';\r\n\r\n          // dispatch event that svg has changed\r\n          __dispatchEvent(document, 'svg.change', {}, {\r\n            svg: {\r\n              id: $svg.id,\r\n              task: taskType,\r\n              node: $target,\r\n              nodeName: $target.nodeName,\r\n              isBubble: true,\r\n              contextMenu: false,\r\n            },\r\n          });\r\n        }\r\n\r\n        // update oldText\r\n        oldText = value;\r\n      });\r\n  }\r\n}\r\n","/**\r\n * čára:\r\n *  - nakreslit   ( drag'n'drop )\r\n *  - smazat      ( left click )\r\n *  - radial menu ( right click)\r\n *    - změnit barvu\r\n *    - smazaní\r\n *    - textový komentář\r\n * textové pole:\r\n *  - vytvořit    ( right click on svg )\r\n *    - nic => smaže se\r\n *    - málo znaků => zčervená\r\n *    - přes řádek textu => zvětší se\r\n *  - změnit      ( click on and write )\r\n *  - smazat      ( right click on textarea )\r\n *  - přenést     ( drag'n'drop )\r\n *  - radial menu ( right click on mark )\r\n *    - změnit barvu\r\n *    - smazaní\r\n *    - textový komentář\r\n * značka:\r\n *  - nakreslit   ( left click on svg )\r\n *  - přenést     ( drag'n'drop )\r\n *  - smazat      ( left click on mark )\r\n *  - radial menu ( right click)\r\n *    - změnit barvu\r\n *    - smazaní\r\n *    - textový komentář\r\n * komiksová bublina:  ( je již vytvořena předem )\r\n *  - napsat dovnitř\r\n *    - nic => zůstane\r\n *    - přes řádek textu => zvětší se\r\n */\r\n/* eslint-disable brace-style */\r\nimport Component from './component';\r\nimport { __dispatchEvent, __removeClass, __addClass, __globalPosition } from '../lib/utils';\r\nimport SVGDraw from './svg-lib/svg-draw';\r\nimport SVGText from './svg-lib/svg-text';\r\nimport SVGDragNDrop from './svg-lib/svg-dragndrop';\r\n\r\nexport default class SVG extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n    this.$canvas = this.target.querySelector('.svg-view');\r\n\r\n    this.format = d3.format('.0f');\r\n\r\n    this._setSize();\r\n\r\n    this.init();\r\n    this._initWhenDone();\r\n  }\r\n\r\n  init() {\r\n    if (HISTORYLAB.import.done) return;\r\n\r\n    // duplicate source of different svg element\r\n    this.toDuplicate = this.target.getAttribute('data-duplicate-svg');\r\n\r\n    // make array from data-attributes (contains what kind of actions can user do on this svg)\r\n    const svgSpecificActions = this.target.getAttribute('data-svg-target').split(' ');\r\n\r\n    // get default color\r\n    const colors = this.target.getAttribute('data-svg-colors');\r\n\r\n    for (let i = 0; i < svgSpecificActions.length; i += 1) {\r\n      if (svgSpecificActions[i] === 'kresleni') {\r\n        const svgSpecificColor = colors ? colors.split(' ')[0] : 'yellow';\r\n        this._initPath(this.showFeedback, svgSpecificColor);\r\n      }\r\n      else if (svgSpecificActions[i] === 'znacky') {\r\n        const svgSpecificColor = colors ? colors.split(' ')[0] : 'blue';\r\n        this._initCircle(this.showFeedback, svgSpecificColor);\r\n      }\r\n      // else if (svgSpecificActions[i] === 'text') {\r\n      //   this._initText();\r\n      // }\r\n    }\r\n\r\n    // this._initZoom();\r\n    // comic bubbles if exists\r\n    this._initComicBubbles();\r\n\r\n    // listen events\r\n    this._getEvents();\r\n    this._getDropEvent();\r\n  }\r\n\r\n  // eslint-disable-next-line class-methods-use-this\r\n  _initWhenDone() {\r\n    if (!HISTORYLAB.import.done) return;\r\n\r\n    d3.selectAll('[data-svg-text] textarea')\r\n      // local context needed because of `this`\r\n      // eslint-disable-next-line func-names\r\n      .on('mouseenter', function () {\r\n        d3.select(this.closest('foreignObject')).raise();\r\n      });\r\n  }\r\n\r\n  _setSize() {\r\n    // NOTE: Cannot set `width` because of change of width when on half slide.\r\n    // TODO: set size on window resize\r\n\r\n    // might not be needed when inside sortable or other higher level module\r\n    // TODO: add condition for other higher level modules\r\n    // if (this.target.closest('[data-sortable-target')) return false;\r\n\r\n    const viewbox = this.target.getAttribute('viewBox').split(' ');\r\n    const rect = this.target.getBoundingClientRect(); // max-height: 100vh\r\n    // const getMaxWidthAbsolute = () => {\r\n    //   if (matchMedia('screen and (min-width: 1025px)').matches) {\r\n    //     return window.innerWidth * .8; // max-width: 62vw\r\n    //   }\r\n\r\n    //   return window.innerWidth;\r\n    // };\r\n    const maxWidthAbsolute = window.innerWidth;\r\n    const maxHeightAbsolute = window.innerHeight * 0.9;\r\n    const getHeight = () => {\r\n      if (!rect.height) return viewbox[3];\r\n      if (rect.height > viewbox[3]) return viewbox[3];\r\n\r\n      return rect.height;\r\n    };\r\n\r\n    const height = getHeight() > maxHeightAbsolute ? maxHeightAbsolute : getHeight();\r\n\r\n    const scale = height / viewbox[3];\r\n    const maxWidth = viewbox[2] * scale;\r\n    const setMaxWidth = scale ? `${maxWidth < maxWidthAbsolute ? maxWidth : maxWidthAbsolute}px` : '';\r\n\r\n    this.target.style.maxWidth = setMaxWidth;\r\n\r\n    // fix for svg + draggable/gallery (horizontal layout) in Chrome\r\n    if (\r\n      this.target.getAttribute('data-svg-drop')\r\n      && !this.target.closest('.layout-vertical')\r\n    ) {\r\n      this.target.closest('.svgs-container').style.maxWidth = setMaxWidth;\r\n    }\r\n  }\r\n\r\n  // _initZoom() {\r\n  //   const view = d3.select(`#${this.target.id} .svg-view`);\r\n  //   const size = [\r\n  //     view.attr('width'),\r\n  //     view.attr('height'),\r\n  //   ];\r\n  //   SVGZoom.zoom(this.target, view, size);\r\n  // }\r\n\r\n  _initPath(callback, color) {\r\n    d3.select(this.target)\r\n      .call(d3.drag()\r\n        .container(() => this.target)\r\n        .subject((event) => {\r\n          const p = [event.x.toFixed(), event.y.toFixed()];\r\n\r\n          return [p, p];\r\n        })\r\n        .on('start', (event) => {\r\n          SVGDraw.renderPath(event, this.target, color, callback);\r\n        }));\r\n  }\r\n  // _initText() {\r\n  //   d3.select(this.target).on('click', () => {\r\n  //     SVGText.openTextDialog(this.target);\r\n  //     d3.event.preventDefault();\r\n  //   });\r\n  // }\r\n\r\n  _initCircle(callback, color) {\r\n    d3.select(this.target).on('click', (event) => {\r\n      const item = event.target;\r\n      const { nodeName } = item;\r\n      const validPlace = (nodeName === 'image');\r\n      // const isCircle = (__hasClass(item, 'svg-circle'));\r\n\r\n      if (!validPlace) {\r\n        return;\r\n      }\r\n\r\n      SVGDraw.createCircle(event, this.target, color);\r\n      callback();\r\n\r\n      event.preventDefault();\r\n    }, false);\r\n  }\r\n\r\n  _initComicBubbles() {\r\n    const $comicBubbles = this.target.querySelectorAll('.svg-komiks .svg-textarea');\r\n\r\n    if ($comicBubbles) {\r\n      $comicBubbles.forEach(($comicBubble) => {\r\n        SVGText.comicBubblesEventsManager(this.target, $comicBubble);\r\n      });\r\n    }\r\n  }\r\n\r\n  _generateNewID(oldID) {\r\n    const idParts = oldID.split('_');\r\n    // beware if it's a error, return oldID\r\n    if (idParts.length < 2) {\r\n      console.log('Svg ID error!', oldID);\r\n      return oldID;\r\n    }\r\n\r\n    // solve thirt part of id\r\n    if (idParts[idParts.length - 1] !== `clone-${idParts[0]}`) {\r\n      idParts.push(`clone-${idParts[0]}`);\r\n    }\r\n\r\n    // solve first part of id\r\n    idParts[0] = this.target.id;\r\n\r\n    const newID = idParts.join('_');\r\n    return newID;\r\n  }\r\n\r\n  _getEvents() {\r\n\r\n    const svgDuplicateSources = this.toDuplicate ? this.toDuplicate.split(' ') : [];\r\n\r\n    if (svgDuplicateSources[0]) {\r\n\r\n      document.addEventListener('svg.change', (e) => {\r\n        if (svgDuplicateSources.includes(e.detail.svg.id)) {\r\n          const $templateNode = e.detail.svg.node;\r\n          const $templateCircle = e.detail.svg.circle;\r\n          const { nodeName } = e.detail.svg;\r\n          const localNodeID = this._generateNewID($templateNode.id);\r\n          const $localNode = this.target.querySelector(`#${localNodeID}`);\r\n          let task;\r\n          // for creating new element or we edit the old one after created one\r\n          if ($localNode || e.detail.svg.task === 'create') {\r\n            task = e.detail.svg.task;\r\n          } else {\r\n            return;\r\n          }\r\n\r\n          /**\r\n           * 1. divided by node name\r\n           * 2. divided by task type\r\n           * path => svg lines\r\n           * TEXTAREA => text fields or comic bubbles\r\n           * foreignObject => svg circles\r\n           */\r\n          if (nodeName === 'path') {\r\n            switch (task) {\r\n              case 'create':\r\n                this._clonePath($templateNode, localNodeID);\r\n                break;\r\n              case 'color':\r\n                __removeClass($localNode, 'red blue');\r\n                __addClass($localNode, e.detail.svg.color);\r\n                break;\r\n              case 'remove':\r\n                $localNode.remove();\r\n                break;\r\n              default:\r\n                console.log('Nondefinated path events task. :(');\r\n            }\r\n          } else if (nodeName === 'TEXTAREA') {\r\n            if (e.detail.svg.isBubble) {\r\n              switch (task) {\r\n                case 'create':\r\n                  this._cloneComicBubbles($templateNode, localNodeID);\r\n                  break;\r\n                case 'change':\r\n                  if ($templateNode.value.length !== 0) {\r\n                    $localNode.value = $templateNode.value;\r\n                    // if needs resize\r\n                    if ($localNode.style.height !== $templateNode.style.height) {\r\n                      $localNode.style.height = $templateNode.style.height;\r\n                    }\r\n                  } else {\r\n                    $localNode.parentElement.remove();\r\n                  }\r\n                  break;\r\n                default:\r\n                  console.log('Nondefinated comicBubble events task. :(');\r\n              }\r\n            } else {\r\n              let templateCircleID;\r\n\r\n              // for removing from radial\r\n              if (!$templateCircle) {\r\n                const idParts = $templateNode.id.split('_');\r\n                // the middle part\r\n                // svg-text.js line 44\r\n                idParts[1] += '-circle';\r\n                templateCircleID = idParts.join('_');\r\n              } else {\r\n                templateCircleID = $templateCircle.id;\r\n              }\r\n\r\n              const localCircleID = this._generateNewID(templateCircleID);\r\n              const $localCircle = this.target.querySelector(`#${localCircleID}`);\r\n\r\n              switch (task) {\r\n                case 'create':\r\n                  this._cloneTextField(e.detail.svg.isWrong, $templateNode, $templateCircle, localNodeID, localCircleID);\r\n                  break;\r\n                case 'change':\r\n                  $localNode.value = $templateNode.value;\r\n                  // if is now wrong lenght\r\n                  if (e.detail.svg.isWrong) {\r\n                    __addClass($localNode, 'is-wrong');\r\n                  } else {\r\n                    __removeClass($localNode, 'is-wrong');\r\n                  }\r\n                  // if needs resize\r\n                  if ($localNode.style.height !== $templateNode.style.height) {\r\n                    $localNode.style.height = $templateNode.style.height;\r\n                  }\r\n                  break;\r\n                case 'color':\r\n                  __removeClass($localCircle, 'red blue');\r\n                  __addClass($localCircle, e.detail.svg.color);\r\n                  break;\r\n                case 'move':\r\n                  if ($localNode) {\r\n                    $localNode.parentElement.remove();\r\n                    $localCircle.remove();\r\n                  }\r\n                  this._cloneTextField(e.detail.svg.isWrong, $templateNode, $templateCircle, localNodeID, localCircleID);\r\n                  break;\r\n                case 'remove':\r\n                  $localNode.parentElement.remove();\r\n                  $localCircle.remove();\r\n                  break;\r\n                default:\r\n                  console.log('Nondefinated textField events task. :(');\r\n              }\r\n            }\r\n          } else if (nodeName === 'circle') {\r\n            switch (task) {\r\n              case 'create':\r\n                this._cloneCircle($templateNode, localNodeID);\r\n                break;\r\n              case 'color':\r\n                __removeClass($localNode, 'red blue');\r\n                __addClass($localNode, e.detail.svg.color);\r\n                break;\r\n              case 'move':\r\n                if ($localNode) {\r\n                  $localNode.remove();\r\n                }\r\n                this._cloneCircle($templateNode, localNodeID);\r\n                break;\r\n              case 'remove':\r\n                $localNode.remove();\r\n                break;\r\n              default:\r\n                console.log('Nondefinated circle events task. :(');\r\n            }\r\n          } else if (nodeName === 'foreignObject') {\r\n            switch (task) {\r\n              case 'create':\r\n                this._cloneDropItem($templateNode, localNodeID);\r\n                break;\r\n              case 'move':\r\n                if ($localNode) {\r\n                  $localNode.remove();\r\n                }\r\n                this._cloneDropItem($templateNode, localNodeID);\r\n                break;\r\n              case 'remove':\r\n                $localNode.remove();\r\n                break;\r\n              default:\r\n                console.log('Nondefinated drop item events task. :(');\r\n            }\r\n          } else {\r\n            console.log('Nondefinated events nodeName. :(', nodeName);\r\n          }\r\n\r\n          // dispatch event that svg has changed\r\n          __dispatchEvent(document, 'svg.change', {}, {\r\n            svg: {\r\n              id: this.target.id,\r\n              task: e.detail.svg.task,\r\n              node: $templateNode,\r\n              circle: $templateCircle,\r\n              nodeName,\r\n              contextMenu: false,\r\n            },\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  _getDropEvent() {\r\n    // need if we drop more than one same item\r\n    let idSalt = 0;\r\n\r\n    document.addEventListener('svg.drop', (event) => {\r\n\r\n      if (event.detail.svg.id === this.target.id) {\r\n\r\n        const {\r\n          $node, position, type, size,\r\n        } = event.detail.svg;\r\n\r\n        const getMultiply = () => {\r\n          // make images smaller when dropped\r\n          if (type === 'image' || type === 'svg') return 0.62;\r\n          // make tags larger when dropped to not jump on more lines\r\n          if (type === 'tag') return 1.075;\r\n\r\n          return 1;\r\n        };\r\n        const multiply = getMultiply();\r\n\r\n        size.width *= multiply;\r\n        size.height *= multiply;\r\n\r\n        const diff = {\r\n          x: this.format((size.width / 2)),\r\n          y: this.format((size.height / 2)),\r\n        };\r\n\r\n        const elemSize = {\r\n          h: this.format(size.height),\r\n          w: this.format(size.width),\r\n        };\r\n\r\n        const $d3canvas = d3.select(`#${this.target.id} .svg-view`);\r\n        const $d3foreignObject = $d3canvas.append('svg:foreignObject')\r\n          .attr('width', `${elemSize.w}`)\r\n          .attr('height', `${elemSize.h}`)\r\n          .attr('x', this.format(position.x - diff.x))\r\n          .attr('y', this.format(position.y - diff.y))\r\n          .attr('data-svg-resolution', `${$d3canvas.attr('width')}, ${$d3canvas.attr('height')}`)\r\n          .attr('data-svg-type', 'pretahovani')\r\n          .attr('id', `${this.target.id}_${$node.getAttribute('data-id')}_${idSalt}_dropItem`)\r\n          .attr('class', 'unselectable try-something');\r\n          // _dropItem is important identifier\r\n\r\n        const $dropItem = $d3foreignObject.append('xhtml:div')\r\n          .attr('class', `dropped__item dropped__item--${type} unselectable`)\r\n          .attr('style', `width: ${elemSize.w}px; height: ${elemSize.h}px;`)\r\n          .node();\r\n        \r\n        const $itemToAdd = $node.firstElementChild.firstElementChild;\r\n        $itemToAdd.classList.add('unselectable');\r\n        $itemToAdd.style.width = `${elemSize.w}px`;\r\n        $itemToAdd.style.height = `${elemSize.h}px`;\r\n        $itemToAdd.style.paddingLeft = `${this.format(elemSize.w * 0.1)}px`;\r\n\r\n        const $textBox = $itemToAdd.querySelector('span');\r\n        $textBox.style.width = `${this.format(elemSize.w * 0.75)}px`;\r\n        $textBox.style.paddingLeft = `${this.format(elemSize.w * 0.05)}px`;\r\n\r\n        // const $textIcon = $itemToAdd.querySelector('.keywords-item-icon');\r\n        // $textIcon.style.width = `${this.format(elemSize.w * 0.03)}px`;\r\n        // $textIcon.style.height = `${this.format(elemSize.w * 0.03)}px`;\r\n\r\n        $dropItem.appendChild($itemToAdd);\r\n\r\n        const $foreignObject = $d3foreignObject.node();\r\n\r\n        // increment salt\r\n        idSalt += 1;\r\n\r\n        // add events to element\r\n        SVGDraw.dropItemEventsManager(this.target, $foreignObject);\r\n        // fix drop on corners\r\n        SVGDragNDrop.end(position, $foreignObject, 'pretahovani', diff, $node);\r\n\r\n        // dispatch event that svg has changed\r\n        __dispatchEvent(document, 'svg.change', {}, {\r\n          svg: {\r\n            id: this.target.id,\r\n            task: 'create',\r\n            node: $foreignObject,\r\n            nodeName: $foreignObject.nodeName,\r\n            contextMenu: false,\r\n          },\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  _clonePath($templateNode, localNodeID) {\r\n    const $localNode = $templateNode.cloneNode(true);\r\n    $localNode.id = localNodeID;\r\n    this.$canvas.appendChild($localNode);\r\n    // add events to element\r\n    SVGDraw.pathEventsManager(this.target, $localNode);\r\n  }\r\n\r\n  _cloneTextField(isWrong, $templateNode, $templateCircle, localNodeID, localCircleID) {\r\n    // clone comments mark\r\n    const $localCircle = $templateCircle.cloneNode(true);\r\n    $localCircle.id = localCircleID;\r\n    this.$canvas.appendChild($localCircle);\r\n\r\n    const $localNode = $templateNode.parentElement.cloneNode(true);\r\n    $localNode.childNodes[0].id = localNodeID;\r\n    this.$canvas.insertBefore($localNode, $localCircle);\r\n    if (isWrong) {\r\n      __addClass($localNode, 'is-wrong');\r\n    } else {\r\n      __removeClass($localNode, 'is-wrong');\r\n    }\r\n    // add events to element\r\n    SVGText.textEventsManager(this.target, $localNode.childNodes[0], $localCircle, false);\r\n  }\r\n\r\n  _cloneCircle($templateNode, localNodeID) {\r\n    const $localNode = $templateNode.cloneNode(true);\r\n    $localNode.id = localNodeID;\r\n    this.$canvas.appendChild($localNode);\r\n    SVGDraw.circleEventsManager(this.target, $localNode);\r\n\r\n    return $localNode;\r\n  }\r\n\r\n  _cloneDropItem($templateNode, localNodeID) {\r\n    const $localNode = $templateNode.cloneNode(true);\r\n    $localNode.id = localNodeID;\r\n    this.$canvas.appendChild($localNode);\r\n    SVGDraw.dropItemEventsManager(this.target, $localNode);\r\n\r\n    return $localNode;\r\n  }\r\n\r\n  _cloneComicBubbles($templateNode, localNodeID) {\r\n    const $localNode = $templateNode.parentElement.cloneNode(true);\r\n    $localNode.childNodes[1].id = localNodeID;\r\n    this.$canvas.appendChild($localNode);\r\n    // add events to element\r\n    SVGText.comicBubblesEventsManager(this.target, $localNode.childNodes[1]);\r\n  }\r\n\r\n  static selectItem(item) {\r\n    item.setAttribute('data-svg-selected', 'true');\r\n  }\r\n\r\n  // Remove 'selected' classname from element within SVG\r\n  static deselectItem() {\r\n    // previously \"selected\" elements\r\n    const selected = document.querySelectorAll('[data-svg-selected=\"true\"]');\r\n    // unselect them\r\n    for (let i = 0; i < selected.length; i += 1) {\r\n      selected[i].setAttribute('data-svg-selected', 'false');\r\n    }\r\n  }\r\n\r\n  // Remove element from within SVG\r\n  // [data-svg-selected=\"true\"] marks selected element in SVG\r\n  static removeItem(isRadial, element = '[data-svg-selected=\"true\"]') {\r\n    let $element = document.querySelector(element);\r\n    let nodeName = $element.nodeName;\r\n    const $parent = $element.parentElement; // for <foreignObject>\r\n\r\n    // TEXTAREA => text field(right click in textarea)\r\n    // DIV => text field(click in radial menu) or circle\r\n    switch (nodeName) {\r\n      case 'path':\r\n      case 'circle':\r\n        // $element = $element;\r\n        break;\r\n      case 'TEXTAREA':\r\n        // $element = $element;\r\n        break;\r\n      case 'DIV':\r\n        // tag\r\n        if ($parent.getAttribute('data-svg-type') === 'pretahovani') {\r\n          $element = $parent;\r\n        } // comment\r\n        else {\r\n          $element = $parent.childNodes[0];\r\n        }\r\n        nodeName = $element.nodeName;\r\n        break;\r\n      default:\r\n        console.log('Nondefinated node type. :(', nodeName);\r\n    }\r\n\r\n    // get svg id from object id\r\n    const svgID = $element.id.split('_')[0];\r\n\r\n    // dispatch event that svg has changed\r\n    __dispatchEvent(document, 'svg.change', {}, {\r\n      svg: {\r\n        id: svgID,\r\n        task: 'remove',\r\n        node: $element,\r\n        nodeName,\r\n        contextMenu: isRadial,\r\n      },\r\n    });\r\n\r\n    if ($parent.nodeName === 'foreignObject') {\r\n      // remove comment's circle\r\n      // id by svg-text.js line 44\r\n      const elemIdParts = $element.id.split('_');\r\n      d3.select(`[id^=\"${elemIdParts[0]}_${elemIdParts[1]}-circle\"`).remove();\r\n\r\n      d3.select($parent).remove();\r\n\r\n      // dispatch event that drop item was deleted\r\n      const idParts = $parent.id.split('_');\r\n      const $slide = document.querySelector(`#${svgID}`).closest('.slide');\r\n      if (idParts[idParts.length - 1] === 'dropItem') {\r\n        __dispatchEvent(document, 'svg.drop.delete', {}, {\r\n          item: {\r\n            slideId: $slide.id,\r\n            id: idParts[1],\r\n            $object: $element.firstChild,\r\n          },\r\n        });\r\n      }\r\n    } else {\r\n      d3.select($element).remove();\r\n    }\r\n  }\r\n\r\n  // Unmark all SVGs with 'svg-active' classname\r\n  static deactivate() {\r\n    const allActiveSvgs = document.querySelectorAll('[data-svg-active=\"true\"]');\r\n    for (let i = 0; i < allActiveSvgs.length; i += 1) {\r\n      allActiveSvgs[i].setAttribute('data-svg-active', 'false');\r\n    }\r\n  }\r\n\r\n  // Mark active SVG with 'svg-active' classname\r\n  static activate(svg) {\r\n    SVG.deactivate();\r\n    svg.setAttribute('data-svg-active', 'true');\r\n  }\r\n\r\n  // Remove connection between clone and template\r\n  // Remove third part of id if exists\r\n  static removeCloneConnectionManager($node) {\r\n    const idParts = $node.id.split('_');\r\n    if (idParts[idParts.length - 1].includes('clone')) {\r\n      idParts.pop();\r\n      $node.id = idParts.join('_');\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // Find near elements if exist\r\n  // Do nothing if event target is element of svg\r\n  // Small black radial menu circle has d=14px (_radial-menu.scss #radial-menu) 6\r\n  // check coordinates for element:\r\n  //  -3,-3  0,-5  +3,-3\r\n  //  -5, 0        +5, 0\r\n  //  -3,+3  0,+5  +3,+3\r\n  static findNearElements(event) {\r\n    let $element = event.target;\r\n    const relativeCoords = [\r\n      [-3, -3], [0, -5], [3, -3], [-5, 0], [5, 0], [-3, 3], [0, 5], [3, 3],\r\n    ];\r\n    // svg-radial-menu filterMenuButtons(clickedItem, hasText, hasMoreColors) 418\r\n    if ($element.nodeName === 'image' || $element.nodeName === 'svg') {\r\n      relativeCoords.every((coord) => {\r\n        const globalPosition = __globalPosition(event);\r\n        const $nextElement = document.elementFromPoint(globalPosition.x + coord[0], globalPosition.y + coord[1]);\r\n        // fix for border where next can be nodes from outside of svg\r\n        if ($nextElement.nodeName === 'DIV' || $nextElement.nodeName === 'svg') {\r\n          return true;\r\n        }\r\n\r\n        $element = $nextElement;\r\n        return $element.nodeName === 'image';\r\n      });\r\n    }\r\n\r\n    return $element;\r\n  }\r\n}\r\n","import Component from './component';\r\nimport AudioPlayer from './media/audio-player';\r\nimport SVG from './svg';\r\nimport { stopPlayingVideoPlayers } from './media/media';\r\nimport { __dispatchEvent } from '../lib/utils';\r\n\r\nexport default class Sortable extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n    this.$settings = document.querySelector(\r\n      `[data-sortable-id-reference=\"${this.target.id}\"]`,\r\n    );\r\n    this.feedback = JSON.parse(\r\n      this.$settings.getAttribute('data-module-zpetnavazba'),\r\n    );\r\n    this.$container = this.target;\r\n    this.$items = this.target.querySelectorAll('[data-sortable-drag]');\r\n    this.$droppables = this.target.querySelectorAll('[data-sortable-drop]');\r\n    this.$placeholder = () => document.querySelector('#sortable-placeholder');\r\n    this.$players = this.$container.querySelectorAll('[data-player-audio]');\r\n    this.$inheritors = document.querySelectorAll(\r\n      `[data-sortable-inheritor=${this.target.id}]`,\r\n    );\r\n    this.inheritors = [];\r\n    this.order = [];\r\n\r\n    // get direction (type of sortable \"horizontalni\" or \"vertikalni\")\r\n    this.direction = this.target.getAttribute('data-sortable-target');\r\n    this.trackingTouch = false;\r\n    this.before = false;\r\n    this.after = false;\r\n    this.evaluation = undefined;\r\n\r\n    this.mouse = {\r\n      x: (event) => event.clientX || event.touches[0].clientX,\r\n      y: (event) => event.clientY || event.touches[0].clientY,\r\n      x0: 0,\r\n      y0: 0,\r\n      x1: 0,\r\n      y1: 0,\r\n    };\r\n\r\n    this.dragged = {\r\n      el: null,\r\n      clone: null,\r\n      posRel: {},\r\n      rect: () => this.dragged.el.getBoundingClientRect(),\r\n      size: {},\r\n      type: null,\r\n    };\r\n\r\n    this.siblings = {\r\n      prev: null,\r\n      next: null,\r\n    };\r\n\r\n    this._onStart = this._onStart.bind(this);\r\n    this._onMove = this._onMove.bind(this);\r\n    this._onEnd = this._onEnd.bind(this);\r\n    this._update = this._update.bind(this);\r\n\r\n    this._setupInitialOrder();\r\n    this._setupInheritors();\r\n    this._addEventListeners();\r\n\r\n    this.cache = {\r\n      colors: []\r\n    };\r\n\r\n    // get colors for all feedback variants\r\n    if (this.feedback) {\r\n      this.cache.colors = this.feedback.map(feedback => feedback.barva);\r\n    }\r\n  }\r\n\r\n  _onStart(event) {\r\n    if (!event.target.hasAttribute('data-sortable-drag')) {\r\n      return;\r\n    }\r\n\r\n    // TODO: zastavit všechno audio on drag start\r\n    if (this.$players.length > 0) {\r\n      stopPlayingVideoPlayers(this.$players);\r\n    }\r\n\r\n    this.trackingTouch = true;\r\n\r\n    this.dragged.el = event.target;\r\n    this.dragged.type = event.target.getAttribute('data-sortable-drag');\r\n    this.dragged.clone = this.dragged.el.cloneNode(true);\r\n    this.dragged.posRel.top = this.dragged.el.offsetTop;\r\n    this.dragged.posRel.left = this.dragged.el.offsetLeft;\r\n    this.dragged.size.width = this.dragged.el.offsetWidth;\r\n    this.dragged.size.height = this.dragged.el.offsetHeight;\r\n\r\n    this.dragged.el.style.top = `${this.dragged.posRel.top}px`;\r\n    this.dragged.el.style.left = `${this.dragged.posRel.left}px`;\r\n    this.dragged.el.style.width = `${this.dragged.size.width}px`;\r\n    this.dragged.el.style.height = `${this.dragged.size.height}px`;\r\n    this.dragged.el.classList.add('is-dragged');\r\n\r\n    this.$container.classList.add('is-dragged');\r\n\r\n    this._addPlaceholder(this.dragged.el);\r\n    this._onOver();\r\n\r\n    this.mouse.x0 = this.mouse.x(event);\r\n    this.mouse.y0 = this.mouse.y(event);\r\n\r\n    event.preventDefault();\r\n  }\r\n\r\n  _onMove(event) {\r\n    if (!this.trackingTouch) {\r\n      return;\r\n    }\r\n\r\n    this.mouse.x1 = this.mouse.x(event) - this.mouse.x0;\r\n    this.mouse.y1 = this.mouse.y(event) - this.mouse.y0;\r\n\r\n    window.requestAnimationFrame(this._update);\r\n\r\n    this._onOver();\r\n  }\r\n\r\n  _onEnd(event) {\r\n    if (!this.trackingTouch) {\r\n      return;\r\n    }\r\n\r\n    this.trackingTouch = false;\r\n    this.$container.classList.remove('is-dragged');\r\n    this.dragged.el.classList.remove('is-dragged');\r\n    this.dragged.el.style.top = '';\r\n    this.dragged.el.style.left = '';\r\n    this.dragged.el.style.width = '';\r\n    this.dragged.el.style.height = '';\r\n    this.dragged.el.style.transform = '';\r\n\r\n    const $placeholder = this.$placeholder();\r\n    const rect = $placeholder.getBoundingClientRect();\r\n\r\n    switch (this.direction) {\r\n      case 'horizontal':\r\n        if (rect.left <= this.mouse.x(event) <= rect.right) {\r\n          this._onDrop();\r\n        }\r\n        break;\r\n      case 'vertical':\r\n        if (rect.top <= this.mouse.y(event) <= rect.bottom) {\r\n          this._onDrop();\r\n        }\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n\r\n    this._removePlaceholder();\r\n    this._updateOrder();\r\n    this._updateOrderInInheritors();\r\n    this._dispatchEvent();\r\n    this._checkAndResolveFeedback();\r\n  }\r\n\r\n  // _onEnter() {}\r\n\r\n  _onOver() {\r\n    this.before = false;\r\n    this.after = false;\r\n\r\n    this._getReference();\r\n\r\n    if (\r\n      this.siblings.next\r\n      && this.siblings.next.hasAttribute('data-sortable-drop')\r\n    ) {\r\n      const next = this.siblings.next.getBoundingClientRect();\r\n\r\n      switch (this.direction) {\r\n        case 'horizontal':\r\n          if (this.dragged.rect().right > next.left + next.width / 1.5) {\r\n            this.after = true;\r\n            this._addPlaceholder(this.siblings.next);\r\n          }\r\n          break;\r\n        case 'vertical':\r\n          if (this.dragged.rect().bottom > next.top + next.height / 1.5) {\r\n            this.after = true;\r\n            this._addPlaceholder(this.siblings.next);\r\n          }\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (\r\n      this.siblings.prev\r\n      && this.siblings.prev.hasAttribute('data-sortable-drop')\r\n    ) {\r\n      const prev = this.siblings.prev.getBoundingClientRect();\r\n\r\n      switch (this.direction) {\r\n        case 'horizontal':\r\n          if (this.dragged.rect().left < prev.right - prev.width / 1.5) {\r\n            this.before = true;\r\n            this._addPlaceholder(this.siblings.prev);\r\n          }\r\n          break;\r\n        case 'vertical':\r\n          if (this.dragged.rect().top < prev.bottom - prev.height / 1.5) {\r\n            this.before = true;\r\n            this._addPlaceholder(this.siblings.prev);\r\n          }\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  // _onLeave() {}\r\n\r\n  _onDrop() {\r\n    const $placeholder = this.$placeholder();\r\n\r\n    this._addEventListenerToItem(this.dragged.clone);\r\n    // TODO: přiřadit eventListenery audio playerům\r\n    if (this.dragged.clone.querySelector('[data-player-audio]')) {\r\n      AudioPlayer.addEventListeners(this.dragged.clone, this.showFeedback);\r\n    }\r\n\r\n    this.$container.insertBefore(this.dragged.clone, $placeholder);\r\n    this.dragged.el.parentElement.removeChild(this.dragged.el);\r\n  }\r\n\r\n  _update() {\r\n    this.dragged.el.style.transform = `translate3d(${this.mouse.x1}px, ${this.mouse.y1}px, 0) rotate(5deg)`;\r\n  }\r\n\r\n  _addPlaceholder(item) {\r\n    this._removePlaceholder();\r\n\r\n    const $placeholder = document.createElement('div');\r\n    $placeholder.classList.add('sortable-item', 'sortable-placeholder');\r\n    $placeholder.setAttribute('id', 'sortable-placeholder');\r\n    $placeholder.style.minHeight = `${this.dragged.size.height}px`;\r\n\r\n    if (this.dragged.el.querySelector('img')) {\r\n      const src = this.dragged.el.querySelector('img').getAttribute('src');\r\n      const img = document.createElement('img');\r\n      img.setAttribute('src', src);\r\n      $placeholder.appendChild(img);\r\n    }\r\n\r\n    if (this.after) {\r\n      this.$container.insertBefore($placeholder, item.nextElementSibling);\r\n    } else if (this.before) {\r\n      this.$container.insertBefore($placeholder, item);\r\n    } else {\r\n      this.$container.insertBefore($placeholder, item);\r\n    }\r\n  }\r\n\r\n  _removePlaceholder() {\r\n    const $placeholder = this.$placeholder();\r\n    if ($placeholder) $placeholder.parentElement.removeChild($placeholder);\r\n  }\r\n\r\n  _getReference() {\r\n    const $placeholder = this.$placeholder();\r\n    this.siblings.prev =\r\n      $placeholder.previousElementSibling === this.dragged.el\r\n        ? this.dragged.el.previousElementSibling\r\n        : $placeholder.previousElementSibling;\r\n    this.siblings.next =\r\n      $placeholder.nextElementSibling === this.dragged.el\r\n        ? this.dragged.el.nextElementSibling\r\n        : $placeholder.nextElementSibling;\r\n  }\r\n\r\n  _addEventListenerToItem($item) {\r\n    // touch events\r\n    $item.addEventListener('touchstart', this._onStart, false);\r\n    // mouse events\r\n    $item.addEventListener('mousedown', this._onStart, false);\r\n\r\n    if (this.dragged.type === 'svg') {\r\n      const svg = new SVG($item.querySelector('[data-svg-target]'));\r\n    }\r\n  }\r\n\r\n  _addEventListeners() {\r\n    // touch events\r\n    document.addEventListener('touchmove', this._onMove);\r\n    document.addEventListener('touchend', this._onEnd);\r\n    // mouse events\r\n    document.addEventListener('mousemove', this._onMove);\r\n    document.addEventListener('mouseup', this._onEnd);\r\n\r\n    this.$items.forEach(($item) => {\r\n      this._addEventListenerToItem($item);\r\n    });\r\n  }\r\n\r\n  // Methods for check if the array is sorted or not\r\n  // Return True: array is in the right state, False: array is NOT in the right state\r\n  // Array looks like: [1,2,3,4]\r\n  // eslint-disable-next-line class-methods-use-this\r\n  checkIfTheArrayIsGood(array) {\r\n    // condition for function some(), return if there is item in array which is not in right position\r\n    const elementInWrongPosition = (element, index) => index !== (element - 1);\r\n    // all has to be negate, to return the right condition (true: sorted, false:not sorted)\r\n    return !array.some(elementInWrongPosition);\r\n  }\r\n\r\n  // Method which check how many steps needs to be done to sort array\r\n  // Return: 0 -> 0 steps, array is sorted\r\n  //        1 -> 1 steps is needed for sort the array\r\n  //        2 -> 2 and more steps is needed for sort the array\r\n  // Array looks like: [1,2,3,4]\r\n  oneMove(array) {\r\n    if (this.checkIfTheArrayIsGood(array)) return 0; // Check if the array is sorted\r\n    for (let i = 0; i < array.length; i += 1) {\r\n      if (array[i] !== i + 1) {\r\n        const changedArray = [...array];\r\n        const element = changedArray[i];\r\n        changedArray.splice(i, 1);\r\n        changedArray.splice(element - 1, 0, element);\r\n\r\n        if (this.checkIfTheArrayIsGood(changedArray)) return 1; // Check if the array after 1 step is sorted\r\n      }\r\n    }\r\n    return 2; // In every other results the array needs more than 2 steps to be sorted\r\n  }\r\n\r\n  // After interaction with modul razeni this method is called to resolve a feedback button\r\n  _checkAndResolveFeedback() {\r\n    if (this.feedback) {\r\n      // Get the array of items (gets only their correct position - in int), example -> [1,3,4,2]\r\n      const arrayOfItems = [\r\n        ...this.target.querySelectorAll('[data-sortable-drag]'),\r\n      ].map((item) => parseInt(item.dataset.sortableSpravnaodpoved, 10));\r\n\r\n      // variable to map a feedback which is got from condition in JSON\r\n      let feedbackResult = 0;\r\n\r\n      // Check if the zpetnaVazba is 2 or 3 conditional\r\n      if (this.feedback.length === 2) {\r\n        if (!this.checkIfTheArrayIsGood(arrayOfItems)) {\r\n          feedbackResult = 1;\r\n        }\r\n      }\r\n      else {\r\n        feedbackResult = this.oneMove(arrayOfItems);\r\n      }\r\n\r\n      // map feedback via feedbackResult\r\n      const feedbackActual = this.feedback.find((feedback) => feedback.podminka === feedbackResult);\r\n\r\n      this.$buttonFeedback.classList.remove(...this.cache.colors);\r\n      this.$buttonFeedback.classList.add(feedbackActual.barva);\r\n      this.$buttonFeedbackText.innerText = feedbackActual.text;\r\n      this.evaluation = feedbackActual.splneno;\r\n    }\r\n    this.showFeedback();\r\n  }\r\n\r\n  _setupInitialOrder() {\r\n    this._updateOrder();\r\n  }\r\n\r\n  _setupInheritors() {\r\n    if (this.$inheritors.length > 0) {\r\n      this.inheritors = Array.from(this.$inheritors).map(($inheritor) => ({\r\n        $inheritor,\r\n        $container: $inheritor.querySelector('[data-sortable-inheritor-item]')\r\n          .parentElement,\r\n      }));\r\n    }\r\n  }\r\n\r\n  _updateOrder() {\r\n    this.order = Array.from(\r\n      this.target.querySelectorAll('[data-sortable-drag]'),\r\n    ).map(($item) => ({ id: parseInt($item.dataset.sortableIndex, 10) }));\r\n  }\r\n\r\n  _updateOrderInInheritors() {\r\n    if (this.$inheritors.length > 0) {\r\n      this.inheritors.forEach((inheritor) => {\r\n        this.order.forEach((item) => {\r\n          inheritor.$container.appendChild(\r\n            inheritor.$container.querySelector(\r\n              `[data-sortable-inheritor-item=\"${item.id}\"]`,\r\n            ),\r\n          );\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  _dispatchEvent() {\r\n    __dispatchEvent(\r\n      this.target,\r\n      'sortable.change',\r\n      {},\r\n      {\r\n        id: this.target.id,\r\n        evaluation: this.evaluation,\r\n        order: this.order,\r\n      },\r\n    );\r\n  }\r\n}\r\n","/* eslint-disable brace-style */\r\nimport {\r\n  __addClass,\r\n  __removeClass,\r\n  __hasClass,\r\n  __localPosition,\r\n  __globalPosition,\r\n  __dispatchEvent,\r\n} from '../../lib/utils';\r\nimport SVG from '../svg';\r\nimport SVGText from './svg-text';\r\n\r\nexport default class SVGRadialMenu {\r\n\r\n  constructor($radialMenu, $svgs) {\r\n    this.$radialMenu = $radialMenu;\r\n    this.$radialMenuItems = this.$radialMenu.querySelectorAll('[data-radial-menu-item]');\r\n    this.$colorItems = this.$radialMenu.querySelectorAll('.radial-menu-color');\r\n    this.$textItems = this.$radialMenu.querySelectorAll('.radial-menu-text');\r\n    this.$createTextItem = this.$radialMenu.querySelector('#create-text');\r\n    this.$removeItem = this.$radialMenu.querySelector('#remove-content');\r\n    this.$tooltip = this.$radialMenu.querySelector('[data-radial-menu-tooltip]');\r\n    this.$svgs = $svgs;\r\n\r\n    this.initialSetUp = true;\r\n\r\n    this.menuRadius = parseInt(window.getComputedStyle(this.$radialMenu.querySelector('.radial-menu-wrapper'), null).getPropertyValue('width'), 10) / 2;\r\n    this.itemRadius = parseInt(window.getComputedStyle(this.$radialMenu.querySelector('.radial-menu-item'), null).getPropertyValue('width'), 10) / 2;\r\n\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    this.setUpRadialMenuItems();\r\n    this.addEventListenersToRadialMenu();\r\n\r\n    // activate radial menu when right click on svg\r\n    this.$svgs.forEach(($svg) => {\r\n      d3.select($svg)\r\n        .on('contextmenu', (event) => {\r\n          this.openRadialMenu(event);\r\n        });\r\n\r\n      this.iOSAddonEvents($svg);\r\n    });\r\n  }\r\n\r\n  static hasText($svg) {\r\n    const svgSpecificActions = $svg.getAttribute('data-svg-target').split(' ');\r\n    return svgSpecificActions.includes('text');\r\n  }\r\n\r\n  static hasMoreColors($svg) {\r\n    const colors = $svg.getAttribute('data-svg-colors');\r\n    const svgSpecificColor = colors ? colors.split(' ') : undefined;\r\n    return (svgSpecificColor && svgSpecificColor.length > 1) || !colors;\r\n  }\r\n\r\n  iOSAddonEvents($svg) {\r\n    // now it helping to fix to not selext text when menu display on comment\r\n    // it is depand on timeout for device hold selection event\r\n    // chosen experimentally\r\n    // TODO: find out proper way to define constant\r\n    const delay = 400;\r\n    // https://www.geeksforgeeks.org/detect-a-device-is-ios-or-not-using-javascript/\r\n    // https://github.com/victorqribeiro/radialMenu/blob/master/src/RadialMenu.js#L437\r\n    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\r\n    if (isIOS) {\r\n      console.log('This is a IOS device');\r\n      let timer;\r\n\r\n      // circle events\r\n      document.addEventListener('event.propagation', (e) => {\r\n        const event = e.detail.event.data.sourceEvent;\r\n\r\n        timer = setTimeout(() => {\r\n          event.preventDefault();\r\n          this.openRadialMenu(event);\r\n        }, delay);\r\n      });\r\n\r\n      document.addEventListener('event.stopPropagation', () => {\r\n        if (timer) clearTimeout(timer);\r\n      });\r\n\r\n      // image events\r\n      // d3 listeners are wrong option because they have stopPropagation\r\n      // where we dont need\r\n      // d3.select($svg).on('touchstart', ()=>{}).on('touchmove', ()=>{})...\r\n      $svg.addEventListener('touchstart', (event) => {\r\n        if (event.touches.length === 1) {\r\n          timer = setTimeout(() => {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            this.openRadialMenu(event);\r\n          }, delay);\r\n        }\r\n      });\r\n      $svg.addEventListener('touchmove', () => {\r\n        if (timer) clearTimeout(timer);\r\n      });\r\n      $svg.addEventListener('touchend', () => {\r\n        if (timer) clearTimeout(timer);\r\n      });\r\n      $svg.addEventListener('touchcancel', () => {\r\n        if (timer) clearTimeout(timer);\r\n      });\r\n    }\r\n  }\r\n\r\n  openRadialMenu(event) {\r\n    const $svg = event.target.closest('svg');\r\n    const hasText = SVGRadialMenu.hasText($svg);\r\n    const hasMoreColors = SVGRadialMenu.hasMoreColors($svg);\r\n    \r\n    // fix for drawing and helpful for touch devices\r\n    const $clickedItem = SVG.findNearElements(event);\r\n    // mark this SVG as the active one\r\n    SVG.activate($svg);\r\n    // deselect all previously selected items\r\n    SVG.deselectItem();\r\n    // show radial menu buttons based on clicked element\r\n    // and .select appropriate elements based on clicked element\r\n    this.filterMenuButtons($clickedItem, hasText, hasMoreColors);\r\n    this.showRadialMenu(event, $svg);\r\n    // prevent default 'contextmenu' event\r\n    event.preventDefault();\r\n\r\n    // for removing text selection\r\n    // no inpact for PC\r\n    window.getSelection().removeAllRanges();\r\n    this.initialSetUp = false;\r\n  }\r\n\r\n  setUpRadialMenuItems() {\r\n    // this.positionRadialMenuItems(this.$radialMenuItems);\r\n\r\n    this.$radialMenuItems.forEach(($item) => {\r\n      this.addEventListenersToRadialMenuItem($item);\r\n    });\r\n  }\r\n\r\n  positionRadialMenuItems($items) {\r\n    const _itemsLength = $items.length;\r\n    const _menuRadius = this.menuRadius;\r\n    const _itemRadius = this.itemRadius;\r\n    const _menuOffset = _menuRadius - _itemRadius;\r\n    const _interval = 0.6283185307;\r\n    // if more items center them\r\n    const _centerOffset = (-_interval / 2) + ((_itemsLength * _interval) / 2);\r\n\r\n    // make a \"flower\"\r\n    $items.forEach(($item, index) => {\r\n      // Calculate the angle at which the element will be placed.\r\n      // For a semicircle, we would use (index / _itemsLength) * Math.PI.\r\n      const angle = (Math.PI + ((index * _interval) * -1)) + _centerOffset;\r\n\r\n      // get position\r\n      const x = (_menuRadius * Math.sin(angle)) + _menuOffset;\r\n      const y = (_menuRadius * Math.cos(angle)) + _menuOffset;\r\n\r\n      $item.style.left = `${x.toFixed(1)}px`;\r\n      $item.style.top = `${y.toFixed(1)}px`;\r\n\r\n      // if (this.initialSetUp === true) {\r\n      //   this.addEventListenersToRadialMenuItem($item);\r\n      // }\r\n    });\r\n  }\r\n\r\n  addEventListenersToRadialMenu() {\r\n    this.onMouseLeave();\r\n\r\n    this.$radialMenu.addEventListener('click', (event) => {\r\n      this.hideRadialMenu(this.$radialMenu);\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.$radialMenu.addEventListener('contextmenu', (event) => {\r\n      this.hideRadialMenu(this.$radialMenu);\r\n      event.preventDefault();\r\n    });\r\n  }\r\n\r\n  addEventListenersToRadialMenuItem(item) {\r\n    const $item = item;\r\n\r\n    // actions\r\n    const action = $item.getAttribute('data-radial-menu-item');\r\n    // remove item\r\n    if (action === 'remove-content') {\r\n      $item.addEventListener('click', () => {\r\n        SVG.removeItem(true);\r\n        this.hideRadialMenu();\r\n      }, false);\r\n    }\r\n    // create user text\r\n    else if (action === 'create-text') {\r\n      d3.select($item).on('click', () => {\r\n        SVGText.createText();\r\n        this.hideRadialMenu();\r\n      }, false);\r\n    }\r\n    // označit podobnost\r\n    else if (action === 'color-point-blue') {\r\n      $item.addEventListener('click', () => {\r\n        SVGRadialMenu.changeColor('blue');\r\n        this.hideRadialMenu();\r\n      }, false);\r\n    }\r\n    // označit rozdil\r\n    else if (action === 'color-point-red') {\r\n      $item.addEventListener('click', () => {\r\n        SVGRadialMenu.changeColor('red');\r\n        this.hideRadialMenu();\r\n      }, false);\r\n    }\r\n    // označit rozdil\r\n    else if (action === 'color-point-red') {\r\n      $item.addEventListener('click', () => {\r\n        SVGRadialMenu.changeColor('red');\r\n        this.hideRadialMenu();\r\n      }, false);\r\n    }\r\n    // přiřadit kategorii\r\n    // else if (action === 'category') {\r\n    //   const category = $item.getAttribute('data-category');\r\n    //   const categoryLabel = $item.getAttribute('data-radial-menu-item-tooltip');\r\n\r\n    //   $item.addEventListener('click', () => {\r\n    //     const $selected = document.querySelector('[data-svg-selected=\"true\"]');\r\n    //     const $parentForeignObject = $selected.parentElement;\r\n    //     let $category = $parentForeignObject.querySelector('.svg-category-label');\r\n\r\n    //     $selected.setAttribute('data-svg-category', category);\r\n\r\n    //     if (!$category) {\r\n    //       $category = document.createElement('div');\r\n    //       $category.classList.add('svg-category-label');\r\n    //       $parentForeignObject.prepend($category);\r\n    //     }\r\n\r\n    //     $category.innerText = categoryLabel;\r\n\r\n    //     this.hideRadialMenu();\r\n    //   }, false);\r\n    // }\r\n\r\n    // tooltip\r\n    $item.addEventListener('mouseenter', (event) => {\r\n      this.$tooltip.innerHTML = event.currentTarget.getAttribute('data-radial-menu-item-tooltip');\r\n      this.$tooltip.style.display = 'block';\r\n    }, false);\r\n    $item.addEventListener('mouseleave', () => {\r\n      this.$tooltip.innerHTML = '';\r\n      this.$tooltip.style.display = 'none';\r\n    }, false);\r\n  }\r\n\r\n  // Draw a SVG circle on click\r\n  static changeColor(color, element = '[data-svg-selected=\"true\"]') {\r\n    let $element = document.querySelector(element);\r\n    let nodeName = $element.nodeName;\r\n    let taskType = 'color';\r\n\r\n    __removeClass($element, 'red blue');\r\n    __addClass($element, color);\r\n\r\n    // DIV => text field  or circle\r\n    switch (nodeName) {\r\n      case 'path':\r\n      case 'circle':\r\n        // $element = $element;\r\n        break;\r\n      case 'DIV':\r\n        if ($element.parentElement.childNodes[1]) {\r\n          $element = $element.parentElement.childNodes[1];\r\n        } else {\r\n          $element = $element.parentElement;\r\n        }\r\n        nodeName = $element.nodeName;\r\n        break;\r\n      default:\r\n        console.log('Nondefinated node type. :(', nodeName);\r\n    }\r\n\r\n    // if clone is changed, then dispatch create event\r\n    // if it is comments mark\r\n    if (nodeName === 'circle' && $element.id.includes('svg-text')) {\r\n      const commentID = $element.id.replace('-circle', '');\r\n      const $comment = document.querySelector(`#${commentID}`);\r\n      SVG.removeCloneConnectionManager($comment);\r\n    }\r\n\r\n    if (SVG.removeCloneConnectionManager($element)) {\r\n      taskType = 'create';\r\n    }\r\n\r\n    // get svg id from object id\r\n    const svgID = $element.id.split('_')[0];\r\n\r\n    // dispatch event that svg has changed\r\n    __dispatchEvent(document, 'svg.change', {}, {\r\n      svg: {\r\n        id: svgID,\r\n        task: taskType,\r\n        node: $element,\r\n        nodeName,\r\n        contextMenu: true,\r\n        color,\r\n      },\r\n    });\r\n  }\r\n\r\n  showRadialMenu(event, $activeSVG) {\r\n    const $svg = $activeSVG || document.querySelector('[data-svg-active=\"true\"]');\r\n    // get global position of the right click event\r\n    const globalPosition = __globalPosition(event);\r\n    const localPosition = __localPosition(event, $svg);\r\n    this.$radialMenu.setAttribute('data-local-x', localPosition.x);\r\n    this.$radialMenu.setAttribute('data-local-y', localPosition.y);\r\n    // set position of radial menu\r\n    // number of 13 is size of #radial-menu\r\n    this.$radialMenu.style.top = `${globalPosition.y - 7}px`;\r\n    this.$radialMenu.style.left = `${globalPosition.x - 7}px`;\r\n\r\n    // make a flower\r\n    const $activeRadialMenuItem = this.$radialMenu.querySelectorAll('.is-active');\r\n    this.positionRadialMenuItems($activeRadialMenuItem);\r\n\r\n    // show radial menu\r\n    __addClass(this.$radialMenu, 'is-active');\r\n\r\n    // return {\r\n    //   localPosition,\r\n    //   globalPosition,\r\n    // };\r\n  }\r\n\r\n  hideRadialMenu() {\r\n    // hide radial menu\r\n    __removeClass(this.$radialMenu, 'is-active');\r\n    // deactivate all SVGs\r\n    SVG.deactivate();\r\n    // deselect all SVG items\r\n    SVG.deselectItem();\r\n\r\n    // deactivate radial menu items when the menu is hidden\r\n    setTimeout(() => {\r\n      if (!__hasClass(this.$radialMenu, 'is-active')) {\r\n        this.$radialMenuItems.forEach(($item) => {\r\n          __removeClass($item, 'is-active');\r\n        });\r\n      }\r\n    }, 150);\r\n  }\r\n\r\n  onMouseLeave() {\r\n    let mouseLeaveDelay;\r\n\r\n    this.$radialMenu.addEventListener('mouseleave', () => {\r\n      mouseLeaveDelay = setTimeout(() => {\r\n        this.hideRadialMenu(this.$radialMenu);\r\n      }, 500);\r\n    });\r\n\r\n    this.$radialMenu.addEventListener('mouseenter', () => {\r\n      clearTimeout(mouseLeaveDelay);\r\n    });\r\n  }\r\n\r\n  filterMenuButtons(clickedItem, hasText, hasMoreColors) {\r\n    if (__hasClass(clickedItem, 'svg-path') || clickedItem.nodeName === 'path') {\r\n      if (hasText) {\r\n        __addClass(this.$createTextItem, 'is-active');\r\n      } else {\r\n        __removeClass(this.$createTextItem, 'is-active');\r\n      }\r\n      // __addClass(this.$removeItem, 'is-active');\r\n\r\n      if (hasMoreColors) {\r\n        this.$colorItems.forEach(($colorItem) => {\r\n          __addClass($colorItem, 'is-active');\r\n        });\r\n      }\r\n\r\n      this.$textItems.forEach(($textItem) => {\r\n        __removeClass($textItem, 'is-active');\r\n      });\r\n\r\n      // mark it as slected\r\n      // SVG.selectItem(clickedItem);\r\n    }\r\n    if (__hasClass(clickedItem, 'svg-circle')) {\r\n      if (hasText) {\r\n        __addClass(this.$createTextItem, 'is-active');\r\n      } else {\r\n        __removeClass(this.$createTextItem, 'is-active');\r\n      }\r\n      // __addClass(this.$removeItem, 'is-active');\r\n\r\n      if (hasMoreColors) {\r\n        this.$colorItems.forEach(($colorItem) => {\r\n          __addClass($colorItem, 'is-active');\r\n        });\r\n      }\r\n\r\n      this.$textItems.forEach(($textItem) => {\r\n        __removeClass($textItem, 'is-active');\r\n      });\r\n\r\n      // mark it as slected\r\n      // SVG.selectItem(clickedItem);\r\n    }\r\n    if (__hasClass(clickedItem, 'svg-textarea')) {\r\n      __removeClass(this.$createTextItem, 'is-active');\r\n      // __addClass(this.$removeItem, 'is-active');\r\n\r\n      if (!__hasClass(clickedItem, 'do-not-remove')) {\r\n        this.$colorItems.forEach(($colorItem) => {\r\n          __removeClass($colorItem, 'is-active');\r\n        });\r\n\r\n        this.$textItems.forEach(($textItem) => {\r\n          __addClass($textItem, 'is-active');\r\n        });\r\n      }\r\n\r\n      // mark it as slected\r\n      // SVG.selectItem(clickedItem);\r\n    }\r\n    if (clickedItem.nodeName === 'image') {\r\n      if (hasText) {\r\n        __addClass(this.$createTextItem, 'is-active');\r\n      } else {\r\n        __removeClass(this.$createTextItem, 'is-active');\r\n      }\r\n\r\n      __removeClass(this.$removeItem, 'is-active');\r\n\r\n      this.$colorItems.forEach(($colorItem) => {\r\n        __removeClass($colorItem, 'is-active');\r\n      });\r\n\r\n      this.$textItems.forEach(($textItem) => {\r\n        __removeClass($textItem, 'is-active');\r\n      });\r\n    }\r\n    else {\r\n      if (__hasClass(clickedItem, 'do-not-remove')) {\r\n        __removeClass(this.$removeItem, 'is-active');\r\n      } else {\r\n        if (hasText) {\r\n          __addClass(this.$createTextItem, 'is-active');\r\n        } else {\r\n          __removeClass(this.$createTextItem, 'is-active');\r\n        }\r\n        __addClass(this.$removeItem, 'is-active');\r\n      }\r\n      // mark it as slected\r\n      SVG.selectItem(clickedItem);\r\n    }\r\n  }\r\n}\r\n","import { __dispatchEvent } from '../../lib/utils';\r\n\r\n// plugin specification: https://prosemirror.net/docs/ref/#state.Plugin_System\r\nexport default class SelectionMenu {\r\n  constructor(editorId, schema, editorView, $menuTemplate) {\r\n    this.$menuBox = $menuTemplate;\r\n\r\n    this.init(editorId, schema, editorView);\r\n    this.update(editorView, null);\r\n  }\r\n\r\n  init(editorId, schema, editorView) {\r\n    const { nodes, marks } = schema;\r\n\r\n    // menu close buttom logic\r\n    // In Firefox still is selected text\r\n    const $closeButton = this.$menuBox.querySelector('a');\r\n    $closeButton.addEventListener('click', () => {\r\n      this.update(editorView);\r\n    });\r\n\r\n    // hide menu after unfocus editor\r\n    editorView.dom.parentNode.addEventListener('blur', (event) => {\r\n      if (event.relatedTarget\r\n        && !event.relatedTarget.classList.contains('menu-item') // no menu button\r\n        && !event.relatedTarget.classList.contains('contextual-menu-component')) { // no menu close button\r\n        this.update(editorView);\r\n      }\r\n    });\r\n\r\n    // menu items logic\r\n    const $menuItems = this.$menuBox.querySelectorAll('.menu-item');\r\n    // sugar for creating different data-tag-id\r\n    let sugar = 0;\r\n\r\n    if ($menuItems) {\r\n      $menuItems.forEach(($menuItem) => {\r\n        // get attributes for marked parts\r\n        const color = $menuItem.getAttribute('data-color');\r\n        const dataCommandName = $menuItem.getAttribute('data-command-name');\r\n\r\n        $menuItem.addEventListener('click', (event) => {\r\n          event.preventDefault();\r\n\r\n          if (!SelectionMenu.isAdded(marks.marker, editorView.state)) {\r\n            // create unique dataTagId\r\n            const dataTagId = `${this.$menuBox.id}-${sugar}`;\r\n            // add remove button from schema\r\n            SelectionMenu.addRemoveButton(editorView, nodes.removeButton);\r\n            // define command\r\n            // https://github.com/ProseMirror/prosemirror-commands/blob/91f86b300ba850d496cc6e142c0aed9ae81893f1/src/commands.js#L488\r\n            // https://github.com/ProseMirror/prosemirror-transform/blob/03a011ae1e098b958f9479c1cee1e997cef2ba4d/src/mark.js#L9\r\n            // https://github.com/ProseMirror/prosemirror-transform/blob/03a011ae1e098b958f9479c1cee1e997cef2ba4d/src/mark_step.js#L16\r\n            // https://github.com/ProseMirror/prosemirror-transform/blob/master/CHANGELOG.md#129-2021-01-19\r\n            const command = pm.toggleMark(marks.marker, { color, dataCommandName, dataTagId });\r\n            // marked selection part\r\n            command(editorView.state, editorView.dispatch, editorView);\r\n            // remember selection\r\n            const markedSelection = editorView.state.selection;\r\n            // set selection empty\r\n            SelectionMenu.closeSelection(editorView);\r\n            // increase sugar\r\n            sugar += 1;\r\n            // create one dispatchable dom element to dispatch from this tool\r\n            const $dispatchNode = SelectionMenu.connectAllSelectedParts(editorView, dataTagId);\r\n            // add removing marker logic\r\n            SelectionMenu.removingMarkerHandler({\r\n              editorId, editorView, markedSelection, $dispatchNode, dataTagId, dataCommandName, marker: marks.marker,\r\n            });\r\n            // dispatch event that editor has changed\r\n            __dispatchEvent(document, 'editor.change', {}, {\r\n              text: {\r\n                id: editorId,\r\n                task: 'add',\r\n                tagData: { tagName: dataCommandName },\r\n                value: $dispatchNode,\r\n                tagColor: color,\r\n              },\r\n            });\r\n          } // nothing will be marked\r\n          else {\r\n            this.update(editorView, null);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    // add to editor\r\n    editorView.dom.parentNode.appendChild(this.$menuBox);\r\n  }\r\n\r\n  // calling from editor every time when editor is updated\r\n  // manage showing and hiding menu and menu position\r\n  update(view, lastState) {\r\n    const { state, readOnly } = view;\r\n    const activeElementClasses = document.activeElement.classList;\r\n\r\n    // have to be canvas dom node\r\n    if (!state || readOnly || state.selection.empty || !activeElementClasses.contains('canvas')) {\r\n      if (!this.$menuBox.classList.contains('hidden')) {\r\n        this.$menuBox.classList.add('hidden');\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.$menuBox.classList.remove('hidden');\r\n\r\n    if (!this.$menuBox.offsetParent) {\r\n      if (!this.$menuBox.classList.contains('hidden')) {\r\n        this.$menuBox.classList.add('hidden');\r\n      }\r\n      return;\r\n    }\r\n    // Update the Content state before calculating the position\r\n    // this.contentUpdate(editorView.state);\r\n\r\n    const { from, to } = state.selection;\r\n\r\n    try {\r\n      const start = view.coordsAtPos(from);\r\n      const end = view.coordsAtPos(to);\r\n\r\n      const box = this.$menuBox.getBoundingClientRect();\r\n\r\n      const offsetParentBox = this.$menuBox.offsetParent.getBoundingClientRect();\r\n      let left = (((start.left + end.left) / 2) - (box.width / 2) - offsetParentBox.left);\r\n\r\n      if (left < 5) {\r\n        left = 5;\r\n      }\r\n\r\n      this.$menuBox.style.left = `${left}px`;\r\n      this.$menuBox.style.top = `${start.top - offsetParentBox.top - box.height}px`;\r\n    }\r\n    catch (err) {\r\n      console.error('Menu selection error', err);\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    if (this.$menuBox) {\r\n      this.$menuBox.remove();\r\n    }\r\n  }\r\n\r\n  // check if part of selection was marked\r\n  static isAdded(marker, state) {\r\n    const { ranges } = state.selection;\r\n    let has = false;\r\n\r\n    for (let i = 0; !has && i < ranges.length; i += 1) {\r\n      const { $from, $to } = ranges[i];\r\n      // https://prosemirror.net/docs/ref/#model.Node.rangeHasMark\r\n      has = state.doc.rangeHasMark($from.pos, $to.pos, marker);\r\n    }\r\n\r\n    return has;\r\n  }\r\n\r\n  // TODO: do in same transaction with toggleMark\r\n  static addRemoveButton(editorView, removeButton) {\r\n    const { state } = editorView;\r\n    const { ranges } = state.selection;\r\n\r\n    const lastPosition = ranges[ranges.length - 1].$to.pos;\r\n    // https://prosemirror.net/docs/ref/#state.EditorState.apply\r\n    // https://prosemirror.net/docs/ref/#transform.Transform.insert\r\n    // https://prosemirror.net/docs/ref/#model.NodeType.create\r\n    const newState = state.apply(state.tr.insert(lastPosition, removeButton.create()));\r\n    // update editor state\r\n    editorView.updateState(newState);\r\n  }\r\n\r\n  static closeSelection(editorView) {\r\n    const { state } = editorView;\r\n\r\n    // https://prosemirror.net/docs/ref/#state.EditorState.apply\r\n    // https://prosemirror.net/docs/ref/#state.Transaction.setSelection\r\n    // https://prosemirror.net/docs/ref/#state.TextSelection^create\r\n    const newState = state.apply(state.tr.setSelection(pm.TextSelection.create(state.doc, 0, 0)));\r\n    // update editor state\r\n    editorView.updateState(newState);\r\n  }\r\n\r\n  static removingMarkerHandler(inputs) {\r\n    const {\r\n      editorId, editorView, markedSelection, $dispatchNode, dataTagId, dataCommandName, marker,\r\n    } = inputs;\r\n    // find remove button at the end of marked part\r\n    const $removeButton = editorView.dom.querySelector(`[data-tag-id=${dataTagId}] > span.node-close`);\r\n\r\n    if ($removeButton) {\r\n      $removeButton.addEventListener('click', (event) => {\r\n        event.preventDefault();\r\n\r\n        // find all marked parts\r\n        const $markedParts = editorView.dom.querySelectorAll(`span[data-tag-id=${dataTagId}]`);\r\n        const { state } = editorView;\r\n        const { tr } = state;\r\n        // for all ranges\r\n        for (let index = 0; index < $markedParts.length; index += 1) {\r\n          const $markedPart = $markedParts[index];\r\n          // https://prosemirror.net/docs/ref/#view.EditorView.posAtDOM\r\n          const fromPos = editorView.posAtDOM($markedPart);\r\n          const toPos = fromPos + $markedPart.textContent.length + 2;\r\n          const matched = [];\r\n          const step = 0;\r\n\r\n          // better option but error\r\n          // tr.removeMark($from.pos, $to.pos, marker);\r\n\r\n          // copy pased from Transform.prototype.removeMark\r\n          // https://github.com/ProseMirror/prosemirror-transform/blob/master/src/mark.js\r\n          // https://prosemirror.net/docs/ref/#model.Node.nodesBetween\r\n          tr.doc.nodesBetween(fromPos, toPos, (node, pos) => {\r\n            if (!node.isInline) return;\r\n\r\n            let toRemove = null;\r\n            if (marker instanceof pm.MarkType) {\r\n              // https://prosemirror.net/docs/ref/#model.MarkType.isInSet\r\n              const found = marker.isInSet(node.marks);\r\n              if (found) toRemove = [found];\r\n            }\r\n            else if (marker) {\r\n              // https://prosemirror.net/docs/ref/#model.Mark.isInSet\r\n              if (marker.isInSet(node.marks)) toRemove = [marker];\r\n            }\r\n            else {\r\n              toRemove = node.marks;\r\n            }\r\n\r\n            if (toRemove && toRemove.length) {\r\n              const end = Math.min(pos + node.nodeSize, toPos);\r\n              for (let i = 0; i < toRemove.length; i += 1) {\r\n                const style = toRemove[i];\r\n                let found;\r\n                for (let j = 0; j < matched.length; j += 1) {\r\n                  const m = matched[j];\r\n                  // https://prosemirror.net/docs/ref/#model.Mark.eq\r\n                  if (m.step === step - 1 && style.eq(matched[j].style)) found = m;\r\n                }\r\n                if (found) {\r\n                  found.to = end;\r\n                  found.step = step;\r\n                }\r\n                else {\r\n                  matched.push({\r\n                    style, from: Math.max(pos, fromPos), to: end, step,\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          });\r\n          // https://prosemirror.net/docs/ref/#transform.Transform.step\r\n          // https://prosemirror.net/docs/ref/#transform.RemoveMarkStep\r\n          matched.forEach((m) => tr.step(new pm.RemoveMarkStep(m.from, m.to, m.style)));\r\n        }\r\n\r\n        // remove removeButton and update state\r\n        // https://prosemirror.net/docs/ref/#view.EditorView.posAtDOM\r\n        const fromPostRB = editorView.posAtDOM($removeButton);\r\n        tr.delete(fromPostRB - 1, fromPostRB + 1);\r\n\r\n        // update editor state\r\n        const newState = state.apply(tr);\r\n        editorView.updateState(newState);\r\n\r\n        // dispatch event that editor has changed\r\n        __dispatchEvent(document, 'editor.change', {}, {\r\n          text: {\r\n            id: editorId,\r\n            task: 'remove',\r\n            tagData: { tagName: dataCommandName },\r\n            value: $dispatchNode,\r\n          },\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  // helper function for dispatch event\r\n  // connect all marked parts\r\n  // clone first part and add here text content of other parts\r\n  static connectAllSelectedParts(view, dataTagId) {\r\n    const $nodes = view.dom.querySelectorAll(`span[data-tag-id=${dataTagId}]`);\r\n    if ($nodes.length === 1) return $nodes[0];\r\n    if ($nodes.length > 1) {\r\n      const $finalNode = $nodes[0].cloneNode(true);\r\n      let fullContent = $nodes[0].textContent;\r\n      for (let i = 1; i < $nodes.length; i += 1) {\r\n        fullContent += $nodes[i].textContent;\r\n      }\r\n      $finalNode.innerHTML = fullContent;\r\n      return $finalNode;\r\n    }\r\n\r\n    console.error(\"Error: Didn't find parts of marked part of text.\");\r\n    return null;\r\n  }\r\n}\r\n","// plugin specification: https://prosemirror.net/docs/ref/#state.Plugin_System\r\nexport default class WrittingMenu {\r\n  constructor(editorView, $menuTemplate) {\r\n    this.$removeAllChanges = $menuTemplate.querySelector('.editor-toolbar-action-reset');\r\n\r\n    this.init(editorView);\r\n  }\r\n\r\n  init(editorView) {\r\n    const firstState = editorView.state;\r\n\r\n    this.$removeAllChanges.addEventListener('click', () => {\r\n      // eslint-disable-next-line no-alert, no-restricted-globals\r\n      const isConfirmed = confirm('Opravdu chcete vrátit text do původní podoby? Vaše změny se tímto ztratí.');\r\n\r\n      if (isConfirmed) {\r\n        editorView.updateState(firstState);\r\n      }\r\n    });\r\n  }\r\n\r\n  static update(view, lastState) {\r\n    // const { state, readOnly } = view;\r\n  }\r\n\r\n  destroy() {\r\n    if (this.$removeAllChanges) {\r\n      this.$removeAllChanges.remove();\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Defined all supported html nodes in editor\r\n * Divided in nodes and marks\r\n * Nodes are static - https://prosemirror.net/docs/ref/#model.NodeSpec\r\n * Marks are dynamic - https://prosemirror.net/docs/ref/#model.MarkSpec\r\n * Example: https://github.com/ProseMirror/prosemirror-schema-basic/blob/master/src/schema-basic.js\r\n */\r\nconst schemaConfig = {\r\n  nodes: {\r\n    doc: { content: 'block+' },\r\n    heading: {\r\n      attrs: {\r\n        level: { default: 1 },\r\n        style: { default: false },\r\n      },\r\n      content: 'inline*',\r\n      group: 'block',\r\n      defining: true,\r\n      parseDOM: [{\r\n        tag: 'h1',\r\n        getAttrs(dom) {\r\n          return { level: 1, style: dom.getAttribute('style') };\r\n        },\r\n      },\r\n      {\r\n        tag: 'h2',\r\n        getAttrs(dom) {\r\n          return { level: 2, style: dom.getAttribute('style') };\r\n        },\r\n      },\r\n      {\r\n        tag: 'h3',\r\n        getAttrs(dom) {\r\n          return { level: 3, style: dom.getAttribute('style') };\r\n        },\r\n      },\r\n      {\r\n        tag: 'h4',\r\n        getAttrs(dom) {\r\n          return { level: 4, style: dom.getAttribute('style') };\r\n        },\r\n      },\r\n      {\r\n        tag: 'h5',\r\n        getAttrs(dom) {\r\n          return { level: 5, style: dom.getAttribute('style') };\r\n        },\r\n      },\r\n      {\r\n        tag: 'h6',\r\n        getAttrs(dom) {\r\n          return { level: 6, style: dom.getAttribute('style') };\r\n        },\r\n      }],\r\n      toDOM(node) { const { style } = node.attrs; return [`h${node.attrs.level}`, { style }, 0]; },\r\n    },\r\n    paragraph: {\r\n      content: 'inline*',\r\n      group: 'block',\r\n      defining: true,\r\n      attrs: {\r\n        style: { default: false },\r\n      },\r\n      parseDOM: [{\r\n        tag: 'p',\r\n        getAttrs(dom) {\r\n          return { style: dom.getAttribute('style') };\r\n        },\r\n      }],\r\n      toDOM(node) { const { style } = node.attrs; return ['p', { style }, 0]; },\r\n    },\r\n    list: {\r\n      content: 'block+',\r\n      group: 'block',\r\n      attrs: {\r\n        type: { default: false },\r\n      },\r\n      parseDOM: [{\r\n        tag: 'ol',\r\n        getAttrs(dom) {\r\n          return { type: dom.getAttribute('type') };\r\n        },\r\n      }],\r\n      toDOM(node) { const { type } = node.attrs; return ['ol', { type }, 0]; },\r\n    },\r\n    listItem: {\r\n      content: 'inline*',\r\n      group: 'block',\r\n      parseDOM: [{ tag: 'li' }],\r\n      toDOM() { return ['li', 0]; },\r\n    },\r\n    hard_break: {\r\n      group: 'block',\r\n      selectable: false,\r\n      parseDOM: [{ tag: 'br' }],\r\n      toDOM() { return ['br']; },\r\n    },\r\n    // hr: {\r\n    //   inline: true,\r\n    //   group: 'inline',\r\n    //   selectable: false,\r\n    //   parseDOM: [{ tag: 'hr' }],\r\n    //   toDOM() { return ['hr']; },\r\n    // },\r\n    text: {\r\n      inline: true,\r\n      group: 'inline',\r\n    },\r\n    // premarked parts\r\n    premarked: {\r\n      content: 'inline',\r\n      inline: true,\r\n      group: 'inline',\r\n      attrs: {\r\n        id: {},\r\n        textData: {},\r\n        className: {},\r\n      },\r\n      parseDOM: [{\r\n        tag: 'span.text-option',\r\n        getAttrs: ($dom) => {\r\n          const id = $dom.getAttribute('id');\r\n          const textData = $dom.getAttribute('data-text-option');\r\n          const className = $dom.getAttribute('class');\r\n          return { id, textData, className };\r\n        },\r\n      }],\r\n      toDOM: (node) => {\r\n        const { id, textData, className } = node.attrs;\r\n        return ['span', {\r\n          'id': id,\r\n          'class': className,\r\n          'data-text-option': textData,\r\n        }, 0];\r\n      },\r\n    },\r\n    // marker remove button\r\n    removeButton: {\r\n      inline: true,\r\n      group: 'inline',\r\n      selectable: false,\r\n      parseDOM: [{ tag: 'span.node-close' }],\r\n      toDOM() {\r\n        return ['span', { class: 'node-close' }, '×'];\r\n      },\r\n    },\r\n  },\r\n  marks: {\r\n    italic: {\r\n      parseDOM: [{ tag: 'i' }, { tag: 'em' }],\r\n      toDOM() { return ['em', 0]; },\r\n    },\r\n    bold: {\r\n      parseDOM: [{ tag: 'b' }],\r\n      toDOM() { return ['b', 0]; },\r\n    },\r\n    code: {\r\n      parseDOM: [{ tag: 'code' }],\r\n      toDOM() { return ['code', 0]; },\r\n    },\r\n    small: {\r\n      parseDOM: [{ tag: 'small' }],\r\n      toDOM() { return ['small', 0]; },\r\n    },\r\n    marker: {\r\n      attrs: {\r\n        color: {},\r\n        dataCommandName: {},\r\n        dataTagId: {},\r\n      },\r\n      parseDOM: [{\r\n        tag: 'span[data-tag-id]',\r\n        getAttrs: ($dom) => {\r\n          const color = $dom.getAttribute('data-color');\r\n          const dataCommandName = $dom.getAttribute('data-command-name');\r\n          const dataTagId = $dom.getAttribute('data-tag-id');\r\n          return { color, dataCommandName, dataTagId };\r\n        },\r\n      }],\r\n      toDOM: (node) => {\r\n        const { color, dataCommandName, dataTagId } = node.attrs;\r\n        return ['span', {\r\n          'class': `node-selected node-text-${color}`,\r\n          'data-command-name': dataCommandName,\r\n          'data-tag-id': dataTagId,\r\n          'data-color': color,\r\n        }, 0];\r\n      },\r\n    },\r\n    writtingInsertPart: {\r\n      attrs: {\r\n        id: {},\r\n      },\r\n      parseDOM: [{\r\n        tag: 'span.user-inserted-text.user-inserted-text-inner',\r\n        getAttrs: ($dom) => {\r\n          const id = $dom.getAttribute('data-add-id');\r\n          return { id };\r\n        },\r\n      }],\r\n      toDOM: (node) => {\r\n        const { id } = node.attrs;\r\n        return ['span', {\r\n          'class': 'user-inserted-text user-inserted-text-inner',\r\n          'data-add-id': id,\r\n        }, 0];\r\n      },\r\n    },\r\n    writtingRemovePart: {\r\n      attrs: {\r\n        id: {},\r\n      },\r\n      parseDOM: [{\r\n        tag: 'span.user-removed-text.user-removed-text-inner',\r\n        getAttrs: ($dom) => {\r\n          const id = $dom.getAttribute('data-remove-id');\r\n          return { id };\r\n        },\r\n      }],\r\n      toDOM: (node) => {\r\n        const { id } = node.attrs;\r\n        return ['span', {\r\n          'class': 'user-removed-text user-removed-text-inner',\r\n          'data-remove-id': id,\r\n        }, 0];\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nexport default schemaConfig;\r\n","import Component from '../component';\r\nimport SelectionMenu from './selectionMenu';\r\nimport WrittingMenu from './writtingMenu';\r\nimport schemaConfig from './schema';\r\nimport { __dispatchEvent } from '../../lib/utils';\r\n\r\nexport default class Editor extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n    this.editor = undefined;\r\n    this.id = this.target.id;\r\n    this.editorType = this.target.getAttribute('data-editor');\r\n    // find editor place in cviceni\r\n    this.$editor = this.target.querySelector(`#prosemirror-editor-${this.id}`);\r\n    // find editor content\r\n    this.$content = this.target.querySelector(`#prosemirror-content-${this.id}`);\r\n    this.schema = new pm.Schema(schemaConfig);\r\n\r\n    // only if cviceni isn't done load html\r\n    if (!HISTORYLAB.import.done) {\r\n      this.initHTML();\r\n    }\r\n    else {\r\n      this.initJSON();\r\n    }\r\n  }\r\n\r\n  // calling from save-data.js\r\n  getEditorJSON() {\r\n    if (this.editor) {\r\n      // get JSON format of last editor state\r\n      return this.editor.state.toJSON();\r\n    }\r\n    return {};\r\n  }\r\n\r\n  // type of editor is set here\r\n  initHTML() {\r\n    let plugins;\r\n    // add plugin by editor type\r\n    if (this.editorType === 'zvyraznovani') {\r\n      const bubbleMenu = this.selectionMenu(this.id);\r\n      plugins = [bubbleMenu];\r\n    }\r\n\r\n    if (this.editorType === 'predznaceny') {\r\n      const premarkedParts = Editor.premarkedParts(this.id, this.schema);\r\n      plugins = [premarkedParts];\r\n    }\r\n\r\n    if (this.editorType === 'psani') {\r\n      const writting = this.writting(pm.keydownHandler);\r\n      const histKeymap = pm.keymap({ 'Mod-z': pm.undo, 'Mod-y': pm.redo });\r\n      plugins = [pm.history(), histKeymap, writting];\r\n    }\r\n\r\n    // create editor instance by defining editor view\r\n    this.editor = new pm.EditorView(this.$editor, {\r\n      // state is created from html structure parsed from our text and array of plugins\r\n      state: pm.EditorState.create({\r\n        doc: pm.DOMParser.fromSchema(this.schema).parse(this.$content),\r\n        plugins,\r\n      }),\r\n    });\r\n  }\r\n\r\n  // only visualization of saved data\r\n  // load saved data from JSON format\r\n  initJSON() {\r\n    const data = JSON.parse(this.$content.textContent);\r\n    const readOnly = Editor.readOnlyMod();\r\n    const { schema } = this;\r\n\r\n    // create editor instance by defining editor view\r\n    this.editor = new pm.EditorView(this.$editor, {\r\n      // editor state is created from JSON object and schema\r\n      state: pm.EditorState.fromJSON({ schema, plugins: [readOnly] }, data),\r\n    });\r\n  }\r\n\r\n  // only diable editing editor\r\n  // https://prosemirror.net/docs/ref/#view.EditorProps.editable\r\n  static readOnlyMod() {\r\n    return new pm.Plugin({\r\n      props: {\r\n        editable() {\r\n          return false;\r\n        },\r\n      },\r\n      // plugin key has to be unique in editor\r\n      key: new pm.PluginKey('ReadOnlyMod'),\r\n    });\r\n  }\r\n\r\n  // manager of marker\r\n  selectionMenu(editorId) {\r\n    const { schema } = this;\r\n    // get menu from gulp\r\n    const $menuTemplate = this.target.querySelector(`#marker-menu-${this.target.id}`);\r\n    return new pm.Plugin({\r\n      // set plugin visualization means set definated marker menu as part of plugin\r\n      view(editorView) {\r\n        return new SelectionMenu(editorId, schema, editorView, $menuTemplate);\r\n      },\r\n      // when editable is false history doesn't work\r\n      props: {\r\n        editable() {\r\n          return false;\r\n        },\r\n      },\r\n      // plugin key has to be unique in editor\r\n      key: new pm.PluginKey('SelectionMenu'),\r\n    });\r\n  }\r\n\r\n  // manager of premarker\r\n  static premarkedParts(editorId, schema) {\r\n    return new pm.Plugin({\r\n      props: {\r\n        // when editable is false history doesn't work\r\n        editable() {\r\n          return false;\r\n        },\r\n        // https://prosemirror.net/docs/ref/#view.EditorProps.handleClickOn\r\n        handleClickOn(view, pos, node, nodePos) {\r\n          if (schema.nodes.premarked.name === node.type.name) {\r\n            // definition of class adding to selected node\r\n            const classSelectDefinition = 'selected';\r\n            const { state } = view;\r\n            const { tr } = state;\r\n\r\n            let newClassName;\r\n            let task;\r\n            // variable for extra data from cviceni JSON for dispatch event distribution\r\n            const tagData = JSON.parse(node.attrs.textData);\r\n            tagData.tagName = 'vyznacena-pasaz';\r\n\r\n            if (node.attrs.className.includes(classSelectDefinition)) {\r\n              newClassName = node.attrs.className.replace(` ${classSelectDefinition}`, '');\r\n              task = 'remove';\r\n            }\r\n            else {\r\n              newClassName = `${node.attrs.className} ${classSelectDefinition}`;\r\n              task = 'add';\r\n            }\r\n\r\n            // for create new state it's important to not change html node directly\r\n            // it's important to use prosemirror functions\r\n            const nodeAttrs = {\r\n              id: node.attrs.id,\r\n              className: newClassName,\r\n              textData: node.attrs.textData,\r\n            };\r\n\r\n            // replace old node on set position by new node with new attributes\r\n            tr.setNodeMarkup(nodePos, null, nodeAttrs);\r\n\r\n            // changing editor's state\r\n            const newState = state.apply(tr);\r\n            view.updateState(newState);\r\n\r\n            // dispatch event that editor has changed\r\n            const $node = view.dom.querySelector(`#${node.attrs.id}`);\r\n            __dispatchEvent(document, 'editor.change', {}, {\r\n              text: {\r\n                id: editorId,\r\n                task,\r\n                tagData,\r\n                value: $node.cloneNode(true),\r\n              },\r\n            });\r\n          }\r\n          return false;\r\n        },\r\n      },\r\n      // plugin key has to be unique in editor\r\n      key: new pm.PluginKey('PremarkedParts'),\r\n    });\r\n  }\r\n\r\n  // manager of writting\r\n  writting(keydownHandler) {\r\n    // get menu items from gulp\r\n    const $toolbarTemplate = this.target.querySelector(`#toolbar-${this.target.id}`);\r\n    // console.log($toolbarTemplate);\r\n    let sugar = 0;\r\n\r\n    // definition of deleted parts logic\r\n    const deletedParts = (state, dispatch) => {\r\n      // create unique id\r\n      const id = `remove-part-${sugar}`;\r\n      // define command\r\n      const command = pm.toggleMark(this.schema.marks.writtingRemovePart, { id });\r\n      // marked selection part\r\n      command(state, dispatch);\r\n      // increase sugar\r\n      sugar += 1;\r\n      return true;\r\n    };\r\n\r\n    return new pm.Plugin({\r\n      // set plugin visualization means set definated writting menu as part of plugin\r\n      view(editorView) {\r\n        return new WrittingMenu(editorView, $toolbarTemplate);\r\n      },\r\n      props: {\r\n        handleKeyDown: keydownHandler({ Delete: deletedParts, Backspace: deletedParts }),\r\n      },\r\n      // plugin key has to be unique in editor\r\n      key: new pm.PluginKey('Writting'),\r\n    });\r\n  }\r\n}\r\n","import { __toggleClass, __getHTML, __dispatchEvent } from '../lib/utils';\r\nimport Component from './component';\r\n\r\n// zoom the image\r\nexport default class Keywords extends Component {\r\n  constructor($element, opts = {}) {\r\n    super($element);\r\n    this.id = this.target.id;\r\n    this.function = this.target.getAttribute('data-keywords') || 'selekce-' || 'selekce+';\r\n    this.$controls = this.target.querySelectorAll('[data-keywords-control]');\r\n\r\n    this.opts = { ...Keywords.defaults, ...opts };\r\n\r\n    this.$itemsContainer = this.target.querySelector(`.${this.opts.itemsContainerClassName}`);\r\n\r\n    if (this.opts.inherit && this.opts.inherit.from.length > 0) {\r\n      // console.log(this.opts.inherit.from);\r\n      this.isInherited = true;\r\n    }\r\n    else {\r\n      this.$items = this.target.querySelectorAll(`.${this.opts.itemClassName}`);\r\n    }\r\n\r\n  }\r\n\r\n  init() {\r\n    switch (this.function) {\r\n      case 'selekce-':\r\n      case 'selekce+':\r\n        // we have data at the instantiation for importing\r\n        if (this.opts.import && this.opts.import.length > 0) {\r\n          this.$itemsContainer.innerHTML = Keywords._getHTMLFromItems(this.opts.import);\r\n        }\r\n\r\n        // console.log(this.id, this.isInherited);\r\n        if (this.isInherited) {\r\n          // if onInit, we copy the elements\r\n          // by their ids into the itemsContainer of this object\r\n          if (this.opts.inherit.onInit) {\r\n            this._regenerateItemsContainerFromInherited();\r\n          }\r\n        }\r\n\r\n        this._registerHandlers();\r\n        break;\r\n      case 'wordcloud':\r\n        this.$items.forEach(($item) => {\r\n          $item.setAttribute('data-keywords-item', 0);\r\n        });\r\n        this._changeSizeOfKeywordItem(this.opts.skala);\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  _changeSizeOfKeywordItem(maxLevel) {\r\n    maxLevel = maxLevel ? parseInt(maxLevel, 10) : 4;\r\n\r\n    function setNewLevelValue($keyword, number, feedback) {\r\n      const oldValue = parseInt($keyword.getAttribute('data-keywords-item'), 10);\r\n      const newValue = oldValue + number;\r\n      const value = Math.abs(newValue) > maxLevel ? oldValue : newValue;\r\n      $keyword.setAttribute('data-keywords-item', value);\r\n\r\n      feedback();\r\n    }\r\n\r\n    this.$controls.forEach(($control) => {\r\n      const $keyword = $control.parentElement.parentElement;\r\n      const controlFunction = $control.getAttribute('data-keywords-control');\r\n\r\n      switch (controlFunction) {\r\n        case 'minus':\r\n          $control.addEventListener('click', (event) => {\r\n            setNewLevelValue($keyword, -1, this.showFeedback);\r\n            event.preventDefault();\r\n          });\r\n          break;\r\n\r\n        case 'plus':\r\n          $control.addEventListener('click', (event) => {\r\n            setNewLevelValue($keyword, 1, this.showFeedback);\r\n            event.preventDefault();\r\n          });\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  _regenerateItemsContainerFromInherited() {\r\n    let tempContent = '';\r\n\r\n    this.opts.inherit.from.forEach((id) => {\r\n      const temp = document.getElementById(id).querySelector(`.${this.opts.itemsContainerClassName}`).innerHTML;\r\n      // rename ids of the original items to avoid duplicates in the DOM\r\n      tempContent += Keywords.renameItemsIds(id, this.id, temp);\r\n      // console.log(tempContent);\r\n    });\r\n\r\n    this.$itemsContainer.innerHTML = tempContent;\r\n\r\n    this.$items = this.target.querySelectorAll(`.${this.opts.itemClassName}`);\r\n  }\r\n\r\n  _registerHandlers() {\r\n\r\n    // this.target.querySelectorAll(`.${this.opts.itemClassName}`).forEach(($item) => {\r\n    this.$items.forEach(($item) => {\r\n      $item.addEventListener('click', this._clickEventHandler.bind(this), true);\r\n      document.addEventListener('keyword.change', (e) => { this._dispatchEventHandler(e, $item); }, false);\r\n    });\r\n\r\n  }\r\n\r\n\r\n  _clickEventHandler(e) {\r\n\r\n    if (e.type === 'click') {\r\n\r\n      __toggleClass(e.currentTarget, 'disabled');\r\n\r\n      // dispatch event that keyword has changed\r\n      __dispatchEvent(document, 'keyword.change', {}, {\r\n        keywords: {\r\n          id: this.id,\r\n          node: e.currentTarget,\r\n        },\r\n      });\r\n\r\n      this.showFeedback();\r\n    }\r\n  }\r\n\r\n  _dispatchEventHandler(e, $item) {\r\n    const { id, node } = e.detail.keywords;\r\n\r\n    if (this.isInherited && this.opts.inherit.from.includes(id)) {\r\n      const currentId = $item.id;\r\n      const nodeId = node.id;\r\n      const removeFeatureIdFromCurrentId = currentId.replace(this.id, '');\r\n      const removeFeatureIdFromNodeId = nodeId.replace(id, '');\r\n\r\n      if (removeFeatureIdFromCurrentId === removeFeatureIdFromNodeId) {\r\n        __toggleClass($item, 'disabled');\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nKeywords._getItemFromDOMElement = ($item) => ({\r\n  class: $item.className,\r\n  id: $item.getAttribute('id'),\r\n  text: $item.innerText,\r\n});\r\n\r\nKeywords._getItemsHTML = ($itemsContainer) => $itemsContainer.innerHTML;\r\n\r\nKeywords._getItemsFromHTML = ($itemsContainer, itemsClassName) => {\r\n  const $items = $itemsContainer.querySelectorAll(`.${itemsClassName}`);\r\n  const itemsArray = [];\r\n\r\n  $items.forEach(($item) => {\r\n    itemsArray.push(Keywords._getItemFromDOMElement($item));\r\n  });\r\n\r\n\r\n  return itemsArray;\r\n\r\n};\r\n\r\nKeywords._getDOMElementFromItem = (item) => {\r\n\r\n  const newDiv = document.createElement('div');\r\n  newDiv.setAttribute('class', item.class);\r\n  newDiv.setAttribute('id', item.id);\r\n  newDiv.innerHTML = item.text;\r\n\r\n  return __getHTML(newDiv);\r\n\r\n};\r\n\r\nKeywords._getHTMLFromItems = (items) => {\r\n\r\n  let contentHTML = '';\r\n\r\n  items.forEach((item) => {\r\n\r\n    contentHTML += Keywords._getDOMElementFromItem(item);\r\n\r\n  });\r\n\r\n  return contentHTML;\r\n\r\n};\r\n\r\n\r\nKeywords.renameItemsIds = (oldId, newId, itemsHTML) => {\r\n\r\n  const expString = new RegExp(oldId, 'g');\r\n\r\n  return itemsHTML.replace(expString, newId);\r\n\r\n};\r\n\r\nKeywords.defaults = {\r\n  itemsContainerClassName: 'keywords-items-container',\r\n  itemClassName: 'keywords-item',\r\n};\r\n","import { __removeClass, __toggleClass } from '../lib/utils';\r\nimport Component from './component';\r\n\r\n\r\nexport default class TestQuiz extends Component {\r\n\r\n  constructor(id, element, opts) {\r\n    super(element);\r\n\r\n    this.id = id;\r\n\r\n    this.opts = { ...TestQuiz.defaults, ...opts };\r\n\r\n    this.$questions = this.target.querySelectorAll(`.${this.opts.itemClass}`);\r\n    this.cache = {\r\n      answersCorrect: 0,\r\n      colors: [],\r\n      questions: [],\r\n    };\r\n\r\n    // get colors for all feedback variants\r\n    if (this.opts.zpetnaVazba) {\r\n      this.cache.colors = this.opts.zpetnaVazba.map((feedback) => feedback.barva);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    this._registerHandlers();\r\n  }\r\n\r\n  _registerHandlers() {\r\n\r\n    this.$questions.forEach(($question, questionIndex) => {\r\n      // all questions are without answer by default\r\n      this.cache.questions.push({ answered: false });\r\n\r\n      const answerCorrect = parseInt($question.getAttribute('data-module-answer'), 10);\r\n      const $answers = $question.querySelectorAll(`.${this.opts.optionClass}`);\r\n\r\n      $answers.forEach(($answer, answerIndex) => {\r\n        $answer.addEventListener('click', () => {\r\n          const $answerCurrent = $answer;\r\n\r\n          // if already selected do nothing\r\n          if ($answerCurrent.classList.contains('selected')) {\r\n            return;\r\n          }\r\n\r\n          // remove the selection\r\n          $answers.forEach(($answersItem) => __removeClass($answersItem, this.opts.selectedClass));\r\n          // select the clicked one\r\n          __toggleClass($answerCurrent, this.opts.selectedClass);\r\n\r\n          // get sum of all corect answers\r\n          if (this.opts.zpetnaVazba) {\r\n            if (answerIndex === answerCorrect) {\r\n              this.cache.answersCorrect += 1;\r\n            } else if (this.cache.answersCorrect !== 0 && this.cache.questions[questionIndex].answered === true) {\r\n              this.cache.answersCorrect -= 1;\r\n            }\r\n            // loop through all \"zpetnaVazba\" to get the one with the fullfilled condition\r\n            const feedbackActual = this.opts.zpetnaVazba.find((feedback) => feedback.podminka.includes(this.cache.answersCorrect));\r\n\r\n            // show the right feedback message\r\n            this.$buttonFeedback.classList.remove(...this.cache.colors);\r\n            this.$buttonFeedback.classList.add(feedbackActual.barva);\r\n            this.$buttonFeedbackText.innerText = feedbackActual.text;\r\n          }\r\n\r\n          // note that this question has been answered (whether true or false)\r\n          this.cache.questions[questionIndex].answered = true;\r\n\r\n          // show OK button with feedback only when all question have been answered\r\n          if (this.cache.questions.find((question) => !question.answered) === undefined) {\r\n            this.showFeedback();\r\n          }\r\n\r\n        }, false);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nTestQuiz.defaults = {\r\n  itemClass: 'test-quiz-item',\r\n  optionClass: 'option',\r\n  selectedClass: 'selected',\r\n};\r\n","/* eslint-disable max-classes-per-file */\r\n// [data-fullscreen]\r\nimport Component from './component';\r\nimport MagnifyingGlass from './magnifying-glass';\r\nimport { imageIsLoaded } from '../lib/utils';\r\n\r\nclass Fullscreen extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.$fullscreen = document.querySelector('[data-fullscreen=\"fullscreen\"]');\r\n    this.$fullscreenContainer = this.$fullscreen.querySelector('[data-fullscreen=\"container\"]');\r\n    this.$fullscreenTarget = this.$fullscreen.querySelector('[data-fullscreen=\"target\"]');\r\n\r\n    this.window = {};\r\n    this.image = {};\r\n\r\n    this.window.width = window.innerWidth;\r\n    this.window.height = window.innerHeight;\r\n    this.window.ratio = this.window.width / this.window.height;\r\n  }\r\n}\r\n\r\nexport default class FullscreenToggle extends Fullscreen {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.imageAlternative = this.target.getAttribute('data-fullscreen-image');\r\n\r\n    // TODO: do not rely on DOM .nextElementSibling, .firstElementChild, etc…\r\n    this.target.addEventListener('click', (event) => {\r\n      // Check if there is different image for zvetseni\r\n      if (this.imageAlternative) {\r\n        this.$fullscreenContainer.innerHTML = this.target.nextElementSibling.nextElementSibling.outerHTML;\r\n        this.$fullscreenTarget = this.$fullscreenContainer.firstElementChild;\r\n        this.$fullscreenTarget.classList.remove('is-hidden');\r\n      }\r\n      else {\r\n        this.$fullscreenContainer.innerHTML = this.target.nextElementSibling.outerHTML;\r\n        this.$fullscreenTarget = this.$fullscreenContainer.firstElementChild;\r\n      }\r\n\r\n      this.$fullscreenTarget.removeAttribute('style');\r\n      this.$fullscreenTarget.removeAttribute('id');\r\n\r\n      switch (this.target.nextElementSibling.nodeName.toLowerCase()) {\r\n        case 'img':\r\n          setTimeout(() => {\r\n            imageIsLoaded(this.$fullscreenTarget.currentSrc)\r\n              .then(() => {\r\n                this.image.width = this.$fullscreenTarget.naturalWidth;\r\n                this.image.height = this.$fullscreenTarget.naturalHeight;\r\n                this.image.ratio = this.image.width / this.image.height;\r\n\r\n                this.setSize();\r\n\r\n                const magnifyingGlass = new MagnifyingGlass(this.$fullscreenTarget);\r\n              });\r\n          }, 10);\r\n          break;\r\n\r\n        case 'svg':\r\n          // eslint-disable-next-line no-case-declarations\r\n          const viewbox = this.$fullscreenTarget.getAttribute('viewBox').split(' ');\r\n\r\n          [, , this.image.width, this.image.height] = viewbox;\r\n          this.image.ratio = this.image.width / this.image.height;\r\n\r\n          this.setSize();\r\n\r\n          // eslint-disable-next-line no-case-declarations\r\n          const $svgTexts = this.$fullscreenTarget.querySelectorAll('textarea');\r\n          if ($svgTexts.length > 0) {\r\n            $svgTexts.forEach(($svgText) => {\r\n              const { id } = $svgText;\r\n              $svgText.removeAttribute('id');\r\n              $svgText.value = document.getElementById(id).value;\r\n              $svgText.readOnly = true;\r\n            });\r\n          }\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n\r\n      this.$fullscreen.classList.toggle('hidden');\r\n\r\n      this.showFeedback();\r\n\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    }, false);\r\n\r\n  }\r\n\r\n  setSize() {\r\n    if (this.image.ratio >= this.window.ratio) {\r\n      this.$fullscreenTarget.style.width = '100%';\r\n      this.$fullscreenTarget.style.height = 'auto';\r\n    }\r\n    else {\r\n      this.$fullscreenTarget.style.width = 'auto';\r\n      this.$fullscreenTarget.style.height = `${this.window.height}px`;\r\n    }\r\n  }\r\n}\r\n","import Component from './component';\r\nimport { __dispatchEvent } from '../lib/utils';\r\n\r\nexport default class UserText extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.$item = this.target.closest('.user-text');\r\n    this.$counter = this.$item.querySelector('[data-usertext-counter]');\r\n    this.$counterWrapper = this.$item.querySelector('.user-text__counter');\r\n    this.$instruction = this.$item.querySelector('.user-text__question');\r\n\r\n    this.$userTexts = this.$slide.querySelectorAll('[data-textarea-target]');\r\n\r\n    this.feedback = JSON.parse(this.target.getAttribute('data-feedback'));\r\n\r\n    this.lengthExpected = {\r\n      min: parseInt(this.target.getAttribute('minlength') === '0' ? 1 : this.target.getAttribute('minlength'), 10),\r\n      avg: null,\r\n      max: parseInt(this.target.getAttribute('maxlength') / 2, 10),\r\n    };\r\n    this.lengthExpected.avg = Math.floor((this.lengthExpected.max - this.lengthExpected.min) / 4 + this.lengthExpected.min);\r\n\r\n    this.cache = {\r\n      answersCorrect: 0,\r\n      colors: [\r\n        'color-red',\r\n        'color-orange',\r\n        'color-green',\r\n      ],\r\n      questions: [],\r\n    };\r\n\r\n    this.lastValue = '';\r\n    this.hadData = this.target.value && this.target.value.length > 0;\r\n    this.wasUsed = false;\r\n\r\n    if (this.hadData) {\r\n      this.updateCharacterCounter();\r\n    }\r\n\r\n    if (!HISTORYLAB.import.done) {\r\n      // duplicate source of different text element\r\n      this.toDuplicate = this.target.getAttribute('data-duplicate-text');\r\n      this.textDuplicateSources = this.toDuplicate ? this.toDuplicate.split(' ') : [];\r\n\r\n      // listen events\r\n      this.getEvents();\r\n      this.addEventListeners();\r\n    } // when cviceni is done it needs to reload questions - fix for selectable\r\n    else {\r\n      if (this.$instruction && this.$instruction.hasAttribute('data-from')) {\r\n        const keyAttribute = 'data-selectable-data';\r\n        const fromId = this.$instruction.getAttribute('data-from');\r\n        const $destination = document.querySelector(`#${fromId} .is-checked [${keyAttribute}]`);\r\n\r\n        // set question\r\n        if ($destination && $destination.getAttribute(keyAttribute)) {\r\n          this.$instruction.innerText = $destination.getAttribute(keyAttribute);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  updateCharacterCounter(length = this.target.value.length) {\r\n    this.$counterWrapper.classList.remove(...this.cache.colors);\r\n    if (length < this.lengthExpected.min) this.$counterWrapper.classList.add(this.cache.colors[0]);\r\n    else if (length <= this.lengthExpected.avg) this.$counterWrapper.classList.add(this.cache.colors[1]);\r\n    else if (length > this.lengthExpected.avg) this.$counterWrapper.classList.add(this.cache.colors[2]);\r\n\r\n    this.$counter.innerText = length;\r\n    this.target.classList.add('is-used', !this.wasUsed);\r\n    this.wasUsed = true;\r\n  }\r\n\r\n  updateFeedback(length = this.target.value.length) {\r\n    if (!this.$buttonFeedback) return;\r\n\r\n    this.$buttonFeedback.classList.remove(...this.cache.colors);\r\n    if (length < this.lengthExpected.min) {\r\n      this.$buttonFeedback.classList.add(this.cache.colors[0]);\r\n      this.$buttonFeedbackText.innerText = this.feedback.none;\r\n    } else {\r\n\r\n      if (length <= this.lengthExpected.avg) {\r\n        this.$buttonFeedback.classList.add(this.cache.colors[1]);\r\n        this.$buttonFeedbackText.innerText = this.feedback.short;\r\n      }\r\n      else if (length > this.lengthExpected.avg) {\r\n        this.$buttonFeedback.classList.add(this.cache.colors[2]);\r\n        this.$buttonFeedbackText.innerText = this.feedback.ok;\r\n      }\r\n\r\n      this.target.setAttribute('data-textarea-target', 'success');\r\n      // check if all conditions of the same component on the same slide are met\r\n      const conditionAll = Array.from(this.$userTexts).find(($userText) => ($userText.getAttribute('data-textarea-target') !== 'success'));\r\n\r\n      if (conditionAll === undefined) {\r\n        // show OK button or feedback\r\n        this.showFeedback();\r\n      }\r\n    }\r\n  }\r\n\r\n  addEventListeners() {\r\n    // BLUR\r\n    this.target.addEventListener('blur', (event) => {\r\n      this.updateCharacterCounter();\r\n\r\n      if (event.target.value !== this.lastValue) {\r\n        const taskName = (this.lastValue === '') ? 'create' : 'change';\r\n        this.lastValue = event.target.value;\r\n\r\n        // dispatch event that text has changed\r\n        __dispatchEvent(document, 'text.change', {}, {\r\n          text: {\r\n            id: event.target.id,\r\n            task: taskName,\r\n            text: event.target.value,\r\n          },\r\n        });\r\n\r\n        // remove connection of any textfields\r\n        this.textDuplicateSources = [];\r\n      }\r\n    });\r\n\r\n    // KEYUP\r\n    this.target.addEventListener('keyup', (event) => {\r\n      event.stopPropagation();\r\n\r\n      const valueLength = this.target.value.length;\r\n      this.updateCharacterCounter(valueLength);\r\n      this.updateFeedback(valueLength);\r\n    });\r\n  }\r\n\r\n  getEvents() {\r\n    // when Selectable module modify question in user text\r\n    if (this.$instruction && this.$instruction.hasAttribute('data-from')) {\r\n      const fromId = this.$instruction.getAttribute('data-from');\r\n\r\n      document.addEventListener('selection.change', (e) => {\r\n        if (fromId === e.detail.id && e.detail.itemData && typeof e.detail.itemData === 'string') {\r\n          this.$instruction.innerText = e.detail.itemData;\r\n        }\r\n      });\r\n    }\r\n\r\n    // when textarea value is taken from other textarea\r\n    if (this.textDuplicateSources[0]) {\r\n\r\n      document.addEventListener('text.change', (e) => {\r\n        if (this.textDuplicateSources.includes(e.detail.text.id)) {\r\n\r\n          const taskName = (this.target.value === '') ? 'create' : 'change';\r\n          switch (e.detail.text.task) {\r\n            case 'create':\r\n            case 'change':\r\n              // if is something already there\r\n              if (this.target.value !== '') this.target.value += '\\n';\r\n\r\n              // if array length is one it means that can by connection line\r\n              if (this.textDuplicateSources.length === 1) {\r\n                this.target.value = e.detail.text.text;\r\n              } else {\r\n                this.target.value += `${e.detail.text.text}\\n`;\r\n              }\r\n\r\n              // dispatch event that text has changed\r\n              __dispatchEvent(document, 'text.change', {}, {\r\n                text: {\r\n                  id: this.target.id,\r\n                  task: taskName,\r\n                  text: this.target.value,\r\n                },\r\n              });\r\n\r\n              // make different first value if is need\r\n              this.lastValue = this.target.value;\r\n\r\n              this.updateCharacterCounter();\r\n              break;\r\n            default:\r\n              console.log('Nondefinated text events task. :(');\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n","import Component from '../component';\r\n\r\nexport default class AudioPlayerNormal extends Component {\r\n\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.$playButton = this.target.querySelector('[data-player-control]');\r\n    this.$loadWave = this.target.querySelector('[data-audio-wave]');\r\n    this.$leftTime = this.target.querySelector('[data-audio-time-left]');\r\n    this.$audioDuration = this.target.querySelector('[data-audio-time-duration]');\r\n\r\n    this.wavesurfer = WaveSurfer.create({\r\n      container: this.$loadWave,\r\n      waveColor: '#A77977',\r\n      progressColor: '#FCE4E3',\r\n      height: 80,\r\n      responsive: true,\r\n      barWidth: 2,\r\n    });\r\n    this.wavesurfer.load(this.$loadWave.dataset.src);\r\n\r\n    this.initWave();\r\n  }\r\n\r\n  initWave() {\r\n    this.wavesurfer.on('ready', () => {\r\n      this.$leftTime.textContent = '0:00';\r\n      const duration = this.wavesurfer.getDuration();\r\n      const minutes = Math.floor((duration % 3600) / 60);\r\n      const seconds = (`00${Math.floor(duration % 60)}`).slice(-2);\r\n      this.$audioDuration.textContent = `${minutes}:${seconds}`;\r\n\r\n      this.addListenerAfterReady();\r\n    });\r\n  }\r\n\r\n  addListenerAfterReady() {\r\n    this.wavesurfer.on('audioprocess', (time) => {\r\n      const minutes = Math.floor((time % 3600) / 60);\r\n      const seconds = (`00${Math.floor(time % 60)}`).slice(-2);\r\n      this.$leftTime.textContent = `${minutes}:${seconds}`;\r\n    });\r\n\r\n    this.wavesurfer.on('finish', () => {\r\n      this.$playButton.setAttribute('data-player-control', 'paused');\r\n    });\r\n\r\n    this.$playButton.addEventListener('click', () => {\r\n      this.wavesurfer.playPause();\r\n\r\n      if (this.$playButton.getAttribute('data-player-control') === 'paused') {\r\n        this.$playButton.setAttribute('data-player-control', 'playing');\r\n      } else {\r\n        this.$playButton.setAttribute('data-player-control', 'paused');\r\n      }\r\n\r\n      this.showFeedback();\r\n    });\r\n\r\n    // stop audio prehravac kdyz se zapne dalsi slajd\r\n    const $nextSlides = document.querySelectorAll('[data-nav-button]');\r\n    $nextSlides.forEach(($nextSlide) => {\r\n      $nextSlide.addEventListener('click', () => {\r\n        if (this.$playButton.getAttribute('data-player-control') === 'playing') {\r\n          this.wavesurfer.playPause();\r\n          this.$playButton.setAttribute('data-player-control', 'paused');\r\n        }\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n}\r\n","import AudioPlayer from './audio-player';\r\nimport { getSecondsMinutesFormat } from './media';\r\n\r\nexport default class AudioPlayerSimple extends AudioPlayer {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.$audio = this.target.querySelector('audio');\r\n    this.$timeLeft = this.target.querySelector('[data-audio-time-left]');\r\n    this.$duration = this.target.querySelector('[data-audio-time-duration]');\r\n\r\n    this.$duration.innerText = `/${getSecondsMinutesFormat(this.$audio.duration)}`;\r\n\r\n    AudioPlayer.addEventListeners(this.target, this.showFeedback);\r\n  }\r\n}\r\n","import Component from './component';\r\n\r\nexport default class FakeMap extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.$buttons = this.target.querySelectorAll('[data-fake-map=\"toggle\"]');\r\n    this.$maps = this.target.querySelectorAll('[data-fake-map=\"map\"]');\r\n    this.lastActiveIndex = 0;\r\n\r\n    this.addEventListenerToButtons();\r\n  }\r\n\r\n  switchMap($button, index) {\r\n    this.$maps[this.lastActiveIndex].classList.remove('active');\r\n    this.$buttons[this.lastActiveIndex].classList.remove('active');\r\n\r\n    this.$maps[index].classList.add('active');\r\n    $button.classList.add('active');\r\n\r\n    this.lastActiveIndex = index;\r\n  }\r\n\r\n  addEventListenerToButtons() {\r\n    this.$buttons.forEach(($button, index) => {\r\n\r\n      $button.addEventListener('click', (event) => {\r\n        this.switchMap($button, index);\r\n        this.showFeedback();\r\n\r\n        event.preventDefault();\r\n      });\r\n\r\n    });\r\n  }\r\n}\r\n","/* eslint-disable no-nested-ternary */\r\nimport Component from '../component';\r\nimport { getSecondsMinutesFormat, mediaEvents } from './media';\r\n\r\nexport default class VideoPlayer extends Component {\r\n  constructor($element, options) {\r\n    super($element);\r\n\r\n    this.$media = this.target.querySelector('video');\r\n    this.options = Object(options);\r\n    this.prefix = this.options.prefix || 'media';\r\n    this.lang = Object(this.options.lang);\r\n    // lang.currentTime\r\n    // lang.play\r\n    // lang.pause\r\n    // lang.minutes\r\n    // lang.seconds\r\n    // lang.leaveFullscreen\r\n    // lang.enterFullscreen\r\n\r\n    this.paused = null;\r\n    this.currentTime = null;\r\n    this.duration = null;\r\n    this.interval = null;\r\n\r\n    this.$document = this.target.ownerDocument;\r\n    this.$controls = this.target.querySelector('.media-player-controls');\r\n    // play/pause toggle\r\n    this.$play = this.$controls.querySelector('[data-player-control]');\r\n    this.$playSymbol = this.$play.querySelector('.media-play-symbol');\r\n    this.$pauseSymbol = this.$play.querySelector('.media-pause-symbol');\r\n    // time slider\r\n    this.$time = this.$controls.querySelector('[data-video-time-progress]');\r\n    this.$timeMeter = this.$time.querySelector('.media-meter.media-time-meter');\r\n    this.$timeRange = this.$time.querySelector('.media-range.media-time-range');\r\n\r\n    // current time text\r\n    this.$currentTimeText = this.$document.createTextNode('');\r\n    this.$currentTime = this.$controls.querySelector('[data-video-time-left]');\r\n    this.$currentTime.appendChild(this.$currentTimeText);\r\n\r\n    // duration time text\r\n    this.durationTime = this.$media.duration;\r\n    this.$durationTime = this.$controls.querySelector('[data-video-time-duration]');\r\n    this.$durationTime.innerText = getSecondsMinutesFormat(this.durationTime);\r\n    this.$durationTime.setAttribute(\r\n      'title',\r\n      `${VideoPlayer.timeToAural(\r\n        this.durationTime,\r\n        this.lang.minutes || 'minutes',\r\n        this.lang.seconds || 'seconds',\r\n      )}`,\r\n    );\r\n\r\n    // fullscreen button\r\n    this.$fullscreen = this.$controls.querySelector(\r\n      '.fullscreen-toggle',\r\n    );\r\n    this.$enterFullscreenSymbol = this.$fullscreen.querySelector(\r\n      '.media-enterFullscreen-symbol',\r\n    );\r\n    this.$leaveFullscreenSymbol = this.$fullscreen.querySelector(\r\n      '.media-leaveFullscreen-symbol',\r\n    );\r\n\r\n    // fullscreen api\r\n    this._fullscreenchange = 'onfullscreenchange' in this.target\r\n      ? 'fullscreenchange'\r\n      : 'onwebkitfullscreenchange' in this.target\r\n        ? 'webkitfullscreenchange'\r\n        : 'onMSFullscreenChange' in this.target\r\n          ? 'MSFullscreenChange'\r\n          : 'fullscreenchange';\r\n\r\n    this._requestFullscreen = this.target.requestFullscreen\r\n    || this.target.webkitRequestFullscreen\r\n    // || this.target.mozRequestFullScreen\r\n    || this.target.msRequestFullscreen;\r\n\r\n    this.onCanPlayStart = this.onCanPlayStart.bind(this);\r\n    this.onLoadStart = this.onLoadStart.bind(this);\r\n    this.onLoadedData = this.onLoadedData.bind(this);\r\n    this.onPlayChange = this.onPlayChange.bind(this);\r\n    this.onTimeChange = this.onTimeChange.bind(this);\r\n    this.onPlayClick = this.onPlayClick.bind(this);\r\n    this.onTimeKeydown = this.onTimeKeydown.bind(this);\r\n    this.onTimeClick = this.onTimeClick.bind(this);\r\n    this.onTimeKeydown = this.onTimeKeydown.bind(this);\r\n    this.onFullscreenClick = this.onFullscreenClick.bind(this);\r\n    this.onFullscreenChange = this.onFullscreenChange.bind(this);\r\n\r\n    // add event listeners\r\n    this.$media.addEventListener('canplaythrough', this.onCanPlayStart);\r\n    this.$media.addEventListener('loadstart', this.onLoadStart);\r\n    this.$media.addEventListener('loadeddata', this.onLoadedData);\r\n    this.$media.addEventListener('pause', this.onPlayChange);\r\n    this.$media.addEventListener('play', this.onPlayChange);\r\n    this.$media.addEventListener('timeupdate', this.onTimeChange);\r\n    this.$controls.addEventListener('click', this.onPlayClick, false);\r\n    // this.$play.addEventListener('click', this.onPlayClick, false);\r\n    this.$play.addEventListener('keydown', this.onTimeKeydown);\r\n    this.$time.addEventListener('click', this.onTimeClick, false);\r\n    this.$time.addEventListener('keydown', this.onTimeKeydown);\r\n    this.$fullscreen.addEventListener('click', this.onFullscreenClick, false);\r\n    // listen for fullscreen changes\r\n    document.addEventListener(\r\n      this._fullscreenchange,\r\n      this.onFullscreenChange,\r\n    );\r\n\r\n    // pointer events from time control\r\n    VideoPlayer.onDrag(this.$time, this.$timeRange, (percentage) => {\r\n      this.$media.currentTime = this.duration * Math.max(0, Math.min(1, percentage));\r\n\r\n      this.onTimeChange();\r\n    });\r\n\r\n    this.onLoadStart();\r\n  }\r\n\r\n  static _fullscreenElement() {\r\n    return document.fullscreenElement\r\n    || document.webkitFullscreenElement\r\n    // || document.mozFullScreenElement\r\n    || document.msFullscreenElement;\r\n  }\r\n\r\n  static _exitFullscreen() {\r\n    return document.exitFullscreen\r\n    || document.webkitCancelFullScreen\r\n    // || document.mozCancelFullScreen\r\n    || document.msExitFullscreen;\r\n  }\r\n\r\n  // when the play state changes\r\n  onPlayChange() {\r\n    if (this.paused !== this.$media.paused) {\r\n      this.paused = this.$media.paused;\r\n\r\n      this.$play.setAttribute(\r\n        'aria-label',\r\n        this.paused ? this.lang.play || 'play' : this.lang.pause || 'pause',\r\n      );\r\n      this.target.setAttribute(\r\n        'data-player-state',\r\n        this.paused ? 'paused' : 'playing',\r\n      );\r\n      this.$playSymbol.setAttribute('aria-hidden', !this.paused);\r\n      this.$pauseSymbol.setAttribute('aria-hidden', this.paused);\r\n\r\n      clearInterval(this.interval);\r\n\r\n      if (!this.paused) {\r\n        // listen for time changes every 30th of a second\r\n        this.interval = setInterval(this.onTimeChange, 34);\r\n      }\r\n\r\n      // dispatch new \"playchange\" event\r\n      this.$media.dispatchEvent(mediaEvents.playchange);\r\n    }\r\n  }\r\n\r\n  // when the time changes\r\n  onTimeChange() {\r\n    if (\r\n      this.currentTime !== this.$media.currentTime\r\n      || this.duration !== this.$media.duration\r\n    ) {\r\n      this.currentTime = this.$media.currentTime;\r\n      this.duration = this.$media.duration || 0;\r\n\r\n      const currentTimePercentage = this.currentTime / this.duration;\r\n      // const currentTimeCode = VideoPlayer.timeToTimecode(this.currentTime);\r\n      const currentTimeCode = getSecondsMinutesFormat(this.currentTime);\r\n      // const remainingTimeCode = VideoPlayer.timeToTimecode(\r\n      //   this.duration - Math.floor(this.currentTime),\r\n      // );\r\n\r\n      if (currentTimeCode !== this.$currentTimeText.nodeValue) {\r\n        this.$currentTimeText.nodeValue = currentTimeCode;\r\n\r\n        this.$currentTime.setAttribute(\r\n          'title',\r\n          `${VideoPlayer.timeToAural(\r\n            this.currentTime,\r\n            this.lang.minutes || 'minutes',\r\n            this.lang.seconds || 'seconds',\r\n          )}`,\r\n        );\r\n      }\r\n\r\n      // if (remainingTimeCode !== this.$remainingTimeText.nodeValue) {\r\n      //   this.$remainingTimeText.nodeValue = remainingTimeCode;\r\n\r\n      //   $(this.$remainingTime, {\r\n      //     title: `${VideoPlayer.timeToAural(\r\n      //       this.duration - this.currentTime,\r\n      //       this.lang.minutes || 'minutes',\r\n      //       this.lang.seconds || 'seconds',\r\n      //     )}`,\r\n      //   });\r\n      // }\r\n\r\n      this.$time.setAttribute('aria-valuenow', this.currentTime);\r\n      this.$time.setAttribute('aria-valuemin', 0);\r\n      this.$time.setAttribute('aria-valuemax', this.duration);\r\n\r\n      this.$timeMeter.style.width = `${currentTimePercentage * 100}%`;\r\n\r\n      // dispatch new \"timechange\" event\r\n      this.$media.dispatchEvent(mediaEvents.timechange);\r\n    }\r\n  }\r\n\r\n  // when media loads for the first time\r\n  onLoadStart() {\r\n    this.$media.removeEventListener('canplaythrough', this.onCanPlayStart);\r\n    this.$media.addEventListener('canplaythrough', this.onCanPlayStart);\r\n\r\n    this.onPlayChange();\r\n    this.onFullscreenChange();\r\n    this.onTimeChange();\r\n  }\r\n\r\n  // when the immediate current playback position is available\r\n  onLoadedData() {\r\n    this.onTimeChange();\r\n  }\r\n\r\n  // when the media can play\r\n  onCanPlayStart() {\r\n    this.$media.removeEventListener('canplaythrough', this.nCanPlayStart);\r\n\r\n    // dispatch new \"canplaystart\" event\r\n    this.$media.dispatchEvent(mediaEvents.canplaystart);\r\n\r\n\r\n    if (!this.paused || this.$media.autoplay) {\r\n      this.$media.play();\r\n    }\r\n  }\r\n\r\n  onFullscreenChange() {\r\n    const isFullscreen = this.target === VideoPlayer._fullscreenElement();\r\n\r\n    this.$fullscreen.setAttribute(\r\n      'aria-label',\r\n      isFullscreen\r\n        ? this.lang.leaveFullscreen || 'leave full screen'\r\n        : this.lang.enterFullscreen || 'enter full screen',\r\n    );\r\n    this.$enterFullscreenSymbol.setAttribute('aria-hidden', isFullscreen);\r\n    this.$leaveFullscreenSymbol.setAttribute('aria-hidden', !isFullscreen);\r\n  }\r\n\r\n  // when the play control is clicked\r\n  onPlayClick(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    this.$media[this.$media.paused ? 'play' : 'pause']();\r\n  }\r\n\r\n  // when the time control\r\n  onTimeClick(event) {\r\n    event.stopPropagation();\r\n\r\n    // handle click if clicked without pointer\r\n    if (!event.pointerType && !event.detail) {\r\n      this.onPlayClick(event);\r\n    }\r\n  }\r\n\r\n  // click from fullscreen control\r\n  onFullscreenClick(event) {\r\n    event.stopPropagation();\r\n\r\n    if (this._requestFullscreen) {\r\n      if (this.target === VideoPlayer._fullscreenElement()) {\r\n        // exit fullscreen\r\n        VideoPlayer._exitFullscreen().call(document);\r\n      } else {\r\n        // enter fullscreen\r\n        this._requestFullscreen.call(this.target);\r\n\r\n        // maintain focus in internet explorer\r\n        this.$fullscreen.focus();\r\n\r\n        // maintain focus in safari\r\n        setTimeout(() => {\r\n          this.$fullscreen.focus();\r\n        }, 200);\r\n      }\r\n    } else if (this.$media.webkitSupportsFullscreen) {\r\n      // iOS allows fullscreen of the video itself\r\n      if (this.$media.webkitDisplayingFullscreen) {\r\n        // exit ios fullscreen\r\n        this.$media.webkitExitFullscreen();\r\n      } else {\r\n        // enter ios fullscreen\r\n        this.$media.webkitEnterFullscreen();\r\n      }\r\n\r\n      this.onFullscreenChange();\r\n    }\r\n  }\r\n\r\n  // keydown from play control or current time control\r\n  onTimeKeydown(event) {\r\n    const { keyCode, shiftKey } = event;\r\n\r\n    // 37: LEFT, 38: UP, 39: RIGHT, 40: DOWN\r\n    if (keyCode >= 37 && keyCode <= 40) {\r\n      event.preventDefault();\r\n\r\n      const offset = keyCode === 37 || keyCode === 39 ? keyCode - 38 : keyCode - 39;\r\n\r\n      this.$media.currentTime = Math.max(\r\n        0,\r\n        Math.min(\r\n          this.$media.duration,\r\n          this.$media.currentTime + offset * (shiftKey ? 10 : 1),\r\n        ),\r\n      );\r\n\r\n      this.onTimeChange();\r\n    }\r\n  }\r\n\r\n  // Handle Drag Ranges\r\n  static onDrag(target, innerTarget, listener) {\r\n    // eslint-disable-line max-params\r\n    const hasPointerEvent = undefined !== target.onpointerup;\r\n    const hasTouchEvent = undefined !== target.ontouchstart;\r\n    const pointerDown = hasPointerEvent\r\n      ? 'pointerdown'\r\n      : hasTouchEvent\r\n        ? 'touchstart'\r\n        : 'mousedown';\r\n    const pointerMove = hasPointerEvent\r\n      ? 'pointermove'\r\n      : hasTouchEvent\r\n        ? 'touchmove'\r\n        : 'mousemove';\r\n    const pointerUp = hasPointerEvent\r\n      ? 'pointerup'\r\n      : hasTouchEvent\r\n        ? 'touchend'\r\n        : 'mouseup';\r\n\r\n    // ...\r\n    const axisProp = 'clientX';\r\n\r\n    let window;\r\n    let start;\r\n    let end;\r\n\r\n    function onpointermove(event) {\r\n      // prevent browser actions on this event\r\n      event.preventDefault();\r\n\r\n      // the pointer coordinate\r\n      const position = axisProp in event\r\n        ? event[axisProp]\r\n        : (event.touches && event.touches[0] && event.touches[0][axisProp])\r\n            || 0;\r\n\r\n      // the percentage of the pointer along the container\r\n      const percentage = (position - start) / (end - start);\r\n\r\n      // call the listener with percentage\r\n      listener(percentage);\r\n    }\r\n\r\n    function onpointerdown(event) {\r\n      // window\r\n      window = target.ownerDocument.defaultView;\r\n\r\n      // client boundaries\r\n      const rect = innerTarget.getBoundingClientRect();\r\n\r\n      // the container start and end coordinates\r\n      start = rect.left;\r\n      end = rect.right;\r\n\r\n      onpointermove(event);\r\n\r\n      window.addEventListener(pointerMove, onpointermove);\r\n      window.addEventListener(pointerUp, onpointerup);\r\n    }\r\n\r\n    function onpointerup() {\r\n      window.removeEventListener(pointerMove, onpointermove);\r\n      window.removeEventListener(pointerUp, onpointerup);\r\n    }\r\n\r\n    // on pointer down\r\n    target.addEventListener(pointerDown, onpointerdown);\r\n  }\r\n\r\n  // Time To Timecode\r\n  // DEPRECATED (media.util)\r\n  // static timeToTimecode(time) {\r\n  //   return `${`0${Math.floor(time / 60)}`.slice(-2)}:${`0${Math.floor(\r\n  //     time % 60,\r\n  //   )}`.slice(-2)}`;\r\n  // }\r\n\r\n  // Time To Aural\r\n  // DEPRECATED (media.util)\r\n  static timeToAural(time, langMinutes, langSeconds) {\r\n    return `${Math.floor(time / 60)} ${langMinutes}, ${Math.floor(\r\n      time % 60,\r\n    )} ${langSeconds}`;\r\n  }\r\n}\r\n","/* eslint-disable linebreak-style */\r\nimport Component from './component';\r\nimport { __dispatchEvent } from '../lib/utils';\r\n\r\nexport default class Selectable extends Component {\r\n\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    // TODO: is DOM element before/after the editor itself.. move it to the editor?\r\n    this.$settings = document.querySelector(`[data-selectable-id-reference=\"${this.target.id}\"]`);\r\n\r\n    this.feedback = JSON.parse(this.$settings.getAttribute('data-module-zpetnavazba'));\r\n    this.settings = JSON.parse(this.$settings.getAttribute('data-module-settings'));\r\n\r\n    this.$items = this.target.querySelectorAll('.selectable-item');\r\n\r\n    this.cache = {\r\n      answersCorrect: 0,\r\n      zpetnaVazba: false,\r\n      colors: [],\r\n      checkedInput: 0,\r\n    };\r\n\r\n    this.$inputs = this.target.querySelectorAll('input');\r\n    this.$inputs.forEach(($input) => {\r\n      this._changeClassIfChecked($input);\r\n      this._addEventListeners($input);\r\n    });\r\n\r\n    // get colors for all feedback variants\r\n    if (this.feedback) {\r\n      this.cache.zpetnaVazba = true;\r\n      this.cache.colors = this.feedback.map((feedback) => feedback.barva);\r\n    }\r\n\r\n  }\r\n\r\n  _addEventListeners($input) {\r\n    $input.addEventListener('change', () => {\r\n\r\n      this.$inputs.forEach(($input_) => {\r\n        this._changeClassIfChecked($input_);\r\n      });\r\n\r\n      this._checkAndResolveFeedback();\r\n\r\n      this._dispatchEvent($input);\r\n    }, false);\r\n  }\r\n\r\n  /* eslint class-methods-use-this: [\"error\", { \"exceptMethods\": [\"_changeClassIfChecked\"] }] */\r\n  // TODO: might be possible with CSS only with `:checked` selector & sibling combinator`+` or `~`\r\n  _changeClassIfChecked($input) {\r\n    $input.closest('.selectable-item').classList.toggle('is-checked', $input.checked === true);\r\n  }\r\n\r\n  _checkAndResolveFeedback() {\r\n    this.cache.answersCorrect = 0;\r\n\r\n    if (this.settings.viceOdpovedi) {\r\n      this.$items.forEach(($item, index) => {\r\n        if (this.$inputs[index].checked) {\r\n          this.cache.checkedInput += 1;\r\n        }\r\n        if (this.$inputs[index].checked && $item.hasAttribute('data-select-spravnaodpoved')) {\r\n          this.cache.answersCorrect += 1;\r\n        }\r\n        if (!this.$inputs[index].checked && !$item.hasAttribute('data-select-spravnaodpoved')) {\r\n          this.cache.answersCorrect += 1;\r\n        }\r\n      });\r\n    }\r\n    else {\r\n      this.$items.forEach(($item, index) => {\r\n        if (this.$inputs[index].checked) {\r\n          this.cache.checkedInput += 1;\r\n        }\r\n        if (this.$inputs[index].checked && $item.hasAttribute('data-select-spravnaodpoved')) {\r\n          this.cache.answersCorrect += 1;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Display feedback button (if no checkbox is select, the button is hidden)\r\n    if ((this.cache.checkedInput === 0 && !this.settings.vybrano) || (this.cache.checkedInput === this.$inputs.length && this.settings.vybrano) || this.settings.disableFeedback) {\r\n      this.hideFeedback();\r\n    } else {\r\n\r\n      if (this.cache.zpetnaVazba) {\r\n        const feedbackActual = this.feedback.find((feedback) => feedback.podminka.includes(this.cache.answersCorrect));\r\n        this.$buttonFeedback.classList.remove(...this.cache.colors);\r\n        this.$buttonFeedback.classList.add(feedbackActual.barva);\r\n        this.$buttonFeedbackText.innerText = feedbackActual.text;\r\n      }\r\n\r\n      this.showFeedback();\r\n    }\r\n\r\n    this.target.classList.toggle('has-checked', this.cache.checkedInput > 0);\r\n\r\n    this.cache.checkedInput = 0;\r\n  }\r\n\r\n  _dispatchEvent($input) {\r\n    // const items = Array.from(this.$inputs).map(($input) => ({\r\n    //   checked: $input.checked,\r\n    //   id: $input.id,\r\n    // }));\r\n    const $label = $input.parentNode.querySelector('label');\r\n    let task;\r\n\r\n    if ($input.type === 'radio') {\r\n      task = 'change';\r\n    }\r\n    else if ($input.type === 'checkbox') {\r\n      task = ($input.checked) ? 'select' : 'unselect';\r\n    }\r\n    else {\r\n      console.error('ERROR: Undefinated input type.');\r\n    }\r\n\r\n    __dispatchEvent(this.target, 'selection.change', {}, {\r\n      id: this.target.id,\r\n      task,\r\n      itemId: $input.id,\r\n      itemData: $input.getAttribute('data-selectable-data'),\r\n      $node: $label.firstChild,\r\n    });\r\n  }\r\n}\r\n","/* eslint-disable no-case-declarations */\r\nimport Component from './component';\r\n\r\nexport default class NewTable extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n    // duplicate source of different editor elements\r\n    this.dataFrom = this.target.parentNode.getAttribute('data-from');\r\n    this.dataSources = this.dataFrom ? this.dataFrom.split(' ') : [];\r\n    this.id = $element.getAttribute('id');\r\n    this.cache = {\r\n      tasks: [],\r\n    };\r\n\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    const autofill = this.target.parentNode.getAttribute('data-autofill');\r\n\r\n    switch (autofill) {\r\n      case 'columns':\r\n        this._columnManager();\r\n        break;\r\n      case 'rows':\r\n        this._rowManager();\r\n        break;\r\n      case 'cells':\r\n        const allCells = this.target.querySelectorAll('.table-new__cell');\r\n\r\n        allCells.forEach(($cell) => {\r\n          const columnId = $cell.getAttribute('data-column-id');\r\n          const rowId = $cell.getAttribute('data-row-id');\r\n          // add listener only for cells in table\r\n          if (columnId && rowId) {\r\n            this._cellManager($cell, columnId, rowId);\r\n          }\r\n        });\r\n        break;\r\n      default:\r\n        console.log('NewTableERROR: Undefinated autofill key word!', autofill);\r\n    }\r\n  }\r\n\r\n  _rowManager() {\r\n    document.addEventListener('editor.change', (e) => {\r\n      const data = e.detail.text;\r\n\r\n      if (this.dataSources.includes(data.id)) {\r\n        let $tableRow;\r\n        let rightToAdd = true;\r\n\r\n        // get columns header\r\n        const $header = this.target.previousSibling;\r\n        const $headerCells = $header.firstChild.childNodes;\r\n\r\n        switch (data.task) {\r\n          case 'add':\r\n            $tableRow = document.createElement('div');\r\n            $tableRow.setAttribute('class', 'table-new__row');\r\n\r\n            $headerCells.forEach(($item) => {\r\n              const $rowCell = document.createElement('div');\r\n              $rowCell.setAttribute('class', 'table-new__cell');\r\n              const itemType = JSON.parse($item.getAttribute('data-type'));\r\n\r\n              // check if tagName is definated and than set variable to false\r\n              if (itemType.tagName && itemType.tagName !== data.tagData.tagName) {\r\n                rightToAdd = false;\r\n              }\r\n              else {\r\n                // add data to cell\r\n                this.fillCell(itemType, data, $rowCell);\r\n              }\r\n\r\n              // only add if it is right to add\r\n              if (rightToAdd) $tableRow.appendChild($rowCell);\r\n            });\r\n\r\n            // only add if it is right to add\r\n            if (rightToAdd) this.target.appendChild($tableRow);\r\n            break;\r\n          case 'remove':\r\n            const tableRows = this.target.childNodes;\r\n\r\n            tableRows.forEach(($row) => {\r\n              $row.childNodes.forEach(($cell, index) => {\r\n                const itemType = JSON.parse($headerCells[index].getAttribute('data-type'));\r\n\r\n                if (NewTable.isRightToDeleteHelper($cell, data.value, itemType)) {\r\n                  $tableRow = $row;\r\n\r\n                }\r\n              });\r\n            });\r\n\r\n            // olny if row for remove exists\r\n            if ($tableRow) {\r\n              // remove tasks from cache\r\n              $tableRow.childNodes.forEach(($cell) => {\r\n                this._removeTaskFromCache($cell);\r\n              });\r\n\r\n              $tableRow.remove();\r\n            }\r\n            break;\r\n          default:\r\n            console.log('NewTableERROR: Undefinated task for new table! (rowManager)');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // TODO: adding just specific tags names like in rowManager\r\n  _columnManager() {\r\n    document.addEventListener('editor.change', (e) => {\r\n      const data = e.detail.text;\r\n\r\n      if (this.dataSources.includes(data.id)) {\r\n        const $rows = this.target.childNodes;\r\n\r\n        switch (data.task) {\r\n          case 'add':\r\n            $rows.forEach(($row) => {\r\n              const $cell = document.createElement('div');\r\n              $cell.setAttribute('class', 'table-new__cell');\r\n\r\n              const $firstCell = $row.firstChild;\r\n              const itemType = JSON.parse($firstCell.getAttribute('data-type'));\r\n\r\n              // add data to cell\r\n              this.fillCell(itemType, data, $cell);\r\n\r\n              $row.appendChild($cell);\r\n            });\r\n            break;\r\n          case 'remove':\r\n            let columnIndex;\r\n            $rows.forEach(($row) => {\r\n              const $firstCell = $row.firstChild;\r\n              const itemType = JSON.parse($firstCell.getAttribute('data-type'));\r\n\r\n              $row.childNodes.forEach(($cell, index) => {\r\n                if (NewTable.isRightToDeleteHelper($cell, data.value, itemType)) {\r\n                  columnIndex = index;\r\n                }\r\n              });\r\n            });\r\n\r\n            this.target.childNodes.forEach(($row) => {\r\n              // remove tasks from cache\r\n              this._removeTaskFromCache($row.childNodes[columnIndex]);\r\n\r\n              $row.childNodes[columnIndex].remove();\r\n            });\r\n            break;\r\n          default:\r\n            console.log('NewTableERROR: Undefinated task for new table! (columnManager)');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  _cellManager($cell, columnId, rowId) {\r\n    const itemType = JSON.parse(this._findCellType($cell));\r\n    const cellController = (data) => {\r\n      switch (data.task) {\r\n        case 'add':\r\n          const $tag = document.createElement('div');\r\n          this.fillCell(itemType, data, $cell);\r\n\r\n          $cell.appendChild($tag);\r\n          break;\r\n        case 'remove':\r\n          const $tags = $cell.querySelectorAll('div');\r\n          let removed = false;\r\n          for (let i = 0; i < $tags.length; i += 1) {\r\n            if (!removed && NewTable.isRightToDeleteHelper($tags[i], data.value, itemType)) {\r\n              // TODO: remove only childrens of $elm => empty div is still there\r\n              $tags[i].remove();\r\n              removed = true;\r\n            }\r\n          }\r\n          break;\r\n        default:\r\n          console.log('NewTableERROR: Undefinated task for new table! (cellManager)');\r\n      }\r\n    };\r\n\r\n    document.addEventListener('editor.change', (e) => {\r\n      const data = e.detail.text;\r\n\r\n      if (this.dataSources.includes(data.id) && (data.tagData.tagName === rowId || data.tagData.tagName === columnId)) {\r\n\r\n        if (!itemType.textId || itemType.textId === data.id) {\r\n          cellController(data);\r\n        }\r\n      }\r\n    });\r\n    document.addEventListener('draggable.drop', (e) => {\r\n      const data = e.detail;\r\n\r\n      if (this.dataSources.includes(data.id) && e.detail.columnId === columnId) {\r\n        // get text\r\n        const $span = data.$node.querySelector('span').cloneNode(true);\r\n        $span.classList.add('node-selected', 'node-text-gray');\r\n        $span.setAttribute('data-by', 'table-drop');\r\n\r\n        cellController({ task: data.task, value: $span });\r\n      }\r\n    });\r\n  }\r\n\r\n  fillCell(itemType, data, $node) {\r\n    let $innerItem;\r\n    let cacheObj;\r\n\r\n    // seed init or generate\r\n    let seed = 0;\r\n    if (this.cache.tasks.length > 0) {\r\n      const lastId = this.cache.tasks[this.cache.tasks.length - 1].id;\r\n      const idParts = lastId.split('-');\r\n      seed = +idParts[idParts.length - 1] + 1;\r\n    }\r\n\r\n    $node.classList.add(`table-new__cell--${itemType.name}`, `table-new__cell--${itemType.type}`);\r\n\r\n    switch (itemType.name) {\r\n      case 'dup-text':\r\n        $innerItem = document.createElement('div');\r\n        if (itemType.type === 'text') {\r\n          $innerItem.innerHTML = data.value.textContent;\r\n        }\r\n        else if (itemType.type === 'tag') {\r\n          // have to by clone, because if not it will by duplicatet do more tables it will be just in last one\r\n          $innerItem.appendChild(data.value.cloneNode(true));\r\n        }\r\n        break;\r\n      case 'select':\r\n        // create task in cache\r\n        cacheObj = { id: `${this.id}-select-${seed}`, answer: '', rightAnswer: data.tagData };\r\n        this.cache.tasks.push(cacheObj);\r\n\r\n        // create node in html\r\n        $innerItem = document.createElement(itemType.name);\r\n\r\n        $innerItem.setAttribute('id', cacheObj.id);\r\n        $innerItem.setAttribute('data-save', 'value');\r\n        $innerItem.setAttribute('tabindex', -1);\r\n\r\n        itemType.options.forEach((value) => {\r\n          const $option = document.createElement('option');\r\n          $option.innerHTML = value;\r\n          $innerItem.appendChild($option);\r\n        });\r\n\r\n        // add event listener\r\n        $innerItem.addEventListener('change', (event) => this._correctedAnswer(event, cacheObj));\r\n        break;\r\n      case 'input':\r\n      case 'textarea':\r\n        // create task in cache\r\n        cacheObj = { id: `${this.id}-input-${seed}`, answer: '', rightAnswer: data.tagData };\r\n        this.cache.tasks.push(cacheObj);\r\n\r\n        // create node in html\r\n        $innerItem = document.createElement(itemType.name);\r\n\r\n        $innerItem.setAttribute('id', cacheObj.id);\r\n        $innerItem.setAttribute('data-save', 'value');\r\n        $innerItem.setAttribute('tabindex', -1);\r\n\r\n        if (itemType.name === 'textarea') {\r\n          $innerItem.setAttribute('resize', cacheObj.id);\r\n        }\r\n\r\n        Object.keys(itemType.attributes).forEach((key) => {\r\n          $innerItem.setAttribute(key, itemType.attributes[key]);\r\n        });\r\n\r\n        // add event listener\r\n        $innerItem.addEventListener('change', (event) => this._correctedAnswer(event, cacheObj));\r\n        break;\r\n      case 'drop':\r\n        $innerItem = document.createElement('div');\r\n        const numberOfDrops = itemType.number ? itemType.number : -1;\r\n        // set attribute for draggable logic\r\n        $innerItem.setAttribute('data-drop-place', numberOfDrops);\r\n        break;\r\n      default:\r\n        $innerItem = document.createElement('div');\r\n        /*\r\n          if item Type name is value of data object from delivered cviceni feature\r\n          then use it and it's value set in table\r\n          else set empry value and show error\r\n       */\r\n        if (data.tagData[itemType.name]) {\r\n          $innerItem.innerHTML = data.tagData[itemType.name];\r\n        }\r\n        else {\r\n          $innerItem.innerHTML = ' ';\r\n          console.log('FillCellERROR: Undefinated object name.', itemType);\r\n        }\r\n    }\r\n    $node.appendChild($innerItem);\r\n  }\r\n\r\n  // prepare for more types of duplicate types\r\n  static isRightToDeleteHelper(elm, deliveredValue, itemType) {\r\n    let result;\r\n    if (itemType.name === 'dup-text') {\r\n      result = elm.textContent === deliveredValue.textContent;\r\n    } // different type then dup-text hasn't duplicate option\r\n    else {\r\n      result = false;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  _findCellType($cell) {\r\n    const rowType = $cell.parentNode.firstChild.getAttribute('data-type');\r\n    if (rowType) return rowType;\r\n\r\n    // if rows header isn´t definated\r\n    const columnId = $cell.getAttribute('data-column-id');\r\n    const $columnHeader = this.target.parentNode.querySelector(`.table-new__cell--header[data-column-id=${columnId}]`);\r\n    if ($columnHeader) return $columnHeader.getAttribute('data-type');\r\n\r\n    return 'empty';\r\n  }\r\n\r\n  _correctedAnswer(event, cacheObj) {\r\n    this.cache.tasks.forEach((task) => {\r\n      if (task.id === cacheObj.id) {\r\n        task.answer = event.target.value;\r\n      }\r\n    });\r\n\r\n    // console.log('select change', this.cache);\r\n  }\r\n\r\n  _removeTaskFromCache($cell) {\r\n    this.cache.tasks.forEach((task, index) => {\r\n      if ($cell.firstChild.tagName === 'SELECT' || $cell.firstChild.tagName === 'INPUT' || $cell.firstChild.tagName === 'TEXTAREA') {\r\n        if ($cell.firstChild.id === task.id) {\r\n          this.cache.tasks.splice(index, 1);\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n","import Component from './component';\r\nimport { __dispatchEvent, __localPosition, __offSetForTouchEvent } from '../lib/utils';\r\n\r\nexport default class Draggable extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    this.idPrefix = 'drag-item';\r\n    // duplicate source of different editor elements\r\n    this.dataFrom = this.target.getAttribute('data-from');\r\n    this.dataSources = this.dataFrom ? this.dataFrom.split(' ') : [];\r\n\r\n    this.position = {\r\n      x: 0,\r\n      y: 0,\r\n      dx: 0,\r\n      dy: 0,\r\n    };\r\n    this.cache = {\r\n      // to know if draggable item was dropped or not and how many times\r\n      items: {},\r\n    };\r\n\r\n    this.$targetPrevious = null;\r\n    this.$targetCurrent = null;\r\n    this.$draggedItem = null;\r\n\r\n    this.objWidth = null;\r\n    this.objHeight = null;\r\n\r\n    this.lastEvent = null;\r\n\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    const $dragItems = this.target.querySelectorAll('.draggable__item');\r\n    $dragItems.forEach(($dragItem) => {\r\n      // get id\r\n      const id = $dragItem.getAttribute('data-id');\r\n      // inicial drop numbers\r\n      this.cache.items[id] = 0;\r\n      // use d3 container for $dragItem\r\n      this.dragAndDropEvents(d3.select($dragItem), id);\r\n    });\r\n\r\n    // initial handler for dropped item to svg\r\n    this.handleDeleteItemFromSvgDrop();\r\n\r\n    // initial handler for adding tags from text\r\n    this.handleAddTagsFromText();\r\n  }\r\n\r\n  // dropToken is used for handle usecase when user drag from drop-place to drop-place\r\n  dragAndDropEvents($dragItem, itemId, dropToken = true) {\r\n    // drag & drop\r\n    $dragItem.call(d3.drag()\r\n      .container(this.$slide)\r\n      .on('start', (event) => { this.onStart(event, $dragItem); })\r\n      .on('drag', (event) => { this.onDrag(event, $dragItem); })\r\n      .on('end', (event) => { this.onDrop(event, $dragItem, itemId, dropToken); }));\r\n  }\r\n\r\n  onStart(event, $dragItem) {\r\n    this.$slide.classList.add('is-dragging');\r\n\r\n    this.$targetPrevious = event.sourceEvent.target;\r\n\r\n    // in this method is better to have classic html node\r\n    const $dragItemHTML = $dragItem.node();\r\n\r\n    // initial position\r\n    this.objWidth = $dragItemHTML.offsetWidth;\r\n    this.objHeight = $dragItemHTML.offsetHeight;\r\n    this.position.dx = 0;\r\n    this.position.dy = 0;\r\n\r\n    // touch event dont have clientX directly in event but in array of touches\r\n    if (event.sourceEvent.clientX) {\r\n      this.position.x = event.sourceEvent.clientX - event.sourceEvent.offsetX;\r\n      this.position.y = event.sourceEvent.clientY - event.sourceEvent.offsetY;\r\n    } // for touches optimize\r\n    else {\r\n      const position = __localPosition(event, $dragItem);\r\n      const offset = __offSetForTouchEvent(event.sourceEvent);\r\n      this.position.x = position.x - offset.x;\r\n      this.position.y = position.y - offset.y;\r\n    }\r\n\r\n    // get dragged node\r\n    // clone element if from DRAG place\r\n    if ($dragItemHTML.parentNode.hasAttribute('data-drag-place')) {\r\n      this.$draggedItem = $dragItemHTML.cloneNode(true);\r\n    }\r\n    // do not clone if from DROP place\r\n    else {\r\n      this.$draggedItem = $dragItemHTML;\r\n\r\n      // get table data\r\n      const $table = $dragItemHTML.closest('.table-new__body');\r\n      const $cell = $dragItemHTML.closest('.table-new__cell');\r\n      const columnId = $cell.getAttribute('data-column-id');\r\n\r\n      // dispatch event that item has been removed from drop place\r\n      __dispatchEvent(document, 'draggable.drop', {}, {\r\n        id: $table.id,\r\n        task: 'remove',\r\n        columnId,\r\n        // type: itemType,\r\n        $node: $dragItemHTML,\r\n      });\r\n    }\r\n\r\n    // add to body\r\n    document.body.appendChild(this.$draggedItem);\r\n    // convert back to d3 container\r\n    this.$draggedItem = d3.select(this.$draggedItem);\r\n\r\n    this.$draggedItem\r\n      .classed('is-dragged', true)\r\n      .classed('was-dropped', false)\r\n      .attr('style', `top:${this.position.y}px; left:${this.position.x}px;`);\r\n\r\n    // touchend doesnt have coordinates\r\n    this.lastEvent = event.sourceEvent;\r\n  }\r\n\r\n  onDrag(event, $dragItem) {\r\n    // touchend doesnt have coordinates\r\n    this.lastEvent = event.sourceEvent;\r\n    // console.log($dragItem.node());\r\n    // update position\r\n    this.position.dx += event.dx;\r\n    this.position.dy += event.dy;\r\n\r\n    // move with dragging element\r\n    this.$draggedItem.style('transform', `translate3d(${this.position.dx}px, ${this.position.dy}px, 0) rotate(5deg)`);\r\n\r\n    this.$targetCurrent = event.sourceEvent.target;\r\n    // check for make placeholder in drop place\r\n    if (this.$targetPrevious !== this.$targetCurrent) {\r\n\r\n      // remove placeholder in old target\r\n      const $placeholderOld = this.$targetPrevious.querySelector('.draggable__item--placeholder');\r\n      if ($placeholderOld) $placeholderOld.remove();\r\n\r\n      // create placeholder in new target\r\n      if (this.$targetCurrent.hasAttribute('data-drop-place')) {\r\n        const numberOfPossibleDrops = this.$targetCurrent.getAttribute('data-drop-place');\r\n        const numberOfDropsDone = this.$targetCurrent.childElementCount;\r\n\r\n        // console.log('ondrag', numberOfDropsDone);\r\n\r\n        if (numberOfPossibleDrops === '-1' || +numberOfPossibleDrops > numberOfDropsDone) {\r\n          // remove this class is important for creating placeholder from dragging item from drop place\r\n          const $placeholderNew = $dragItem.clone(true)\r\n            .classed('is-dragged', false)\r\n            .classed('draggable__item--placeholder', true)\r\n            .attr('style', 'outline: 0px;')\r\n            .node();\r\n\r\n          this.$targetCurrent.appendChild($placeholderNew);\r\n        }\r\n      }\r\n\r\n      // update target\r\n      this.$targetPrevious = this.$targetCurrent;\r\n    }\r\n  }\r\n\r\n  onDrop(event, $dragItem, itemId, dropToken) {\r\n    if (this.lastEvent.touches) {\r\n      const coords = this.lastEvent.touches[0];\r\n      this.$targetCurrent = document.elementFromPoint(coords.clientX, coords.clientY);\r\n    }\r\n    else {\r\n      this.$targetCurrent = event.sourceEvent.target;\r\n    }\r\n\r\n    // when dropping within droppable normal DOM node\r\n    if (this.$targetCurrent.hasAttribute('data-drop-place')) {\r\n\r\n      // get placeholder\r\n      let $dropItem = this.$targetCurrent.querySelector('.draggable__item--placeholder');\r\n\r\n      if ($dropItem) {\r\n        const itemType = $dropItem.getAttribute('data-draggable-item');\r\n\r\n        // remove unneeded classes for dropItem\r\n        $dropItem.classList.remove('draggable__item--placeholder', 'was-dropped');\r\n        $dropItem.classList.add('dropped__item');\r\n\r\n        // update drops num\r\n        if (dropToken) {\r\n          $dragItem.classed('was-dropped', true);\r\n          this.cache.items[itemId] += 1;\r\n        }\r\n\r\n        if (itemType === 'svg') {\r\n          const $fullScreenIcon = $dropItem.querySelector('[data-fullscreen=\"toggle\"]');\r\n          // replaced svg don't have full screen icon\r\n          if ($fullScreenIcon) {\r\n            $fullScreenIcon.remove();\r\n          }\r\n        }\r\n        else {\r\n          // add cross for remove item\r\n          const $rightElmChild = $dropItem.firstElementChild;\r\n          const $cross = document.createElement('span');\r\n          $cross.classList.add('node-close');\r\n          $cross.innerText = '×';\r\n\r\n          // remove svg from frop item\r\n          $rightElmChild.removeChild($rightElmChild.lastElementChild);\r\n          $rightElmChild.appendChild($cross);\r\n\r\n          // remove item after click on cross\r\n          $cross.addEventListener('click', () => {\r\n            this.removeDraggableItem($dropItem, itemId, dropToken);\r\n          });\r\n        }\r\n\r\n        // add events to clone for posible dragging back\r\n        // dropItem has to by in d3 container\r\n        this.dragAndDropEvents(d3.select($dropItem), itemId, false);\r\n      } // only click on drop item\r\n      else {\r\n        $dropItem = $dragItem.clone(true)\r\n          .classed('is-dragged', false)\r\n          .attr('style', 'outline: 0px;')\r\n          .node();\r\n\r\n        this.$targetCurrent.appendChild($dropItem);\r\n\r\n        // add events to clone for posible dragging back\r\n        // dropItem has to by in d3 container\r\n        this.dragAndDropEvents(d3.select($dropItem), itemId, false);\r\n      }\r\n\r\n      // get table data\r\n      const $table = this.$targetCurrent.closest('.table-new__body');\r\n      const $cell = this.$targetCurrent.closest('.table-new__cell');\r\n      const columnId = $cell.getAttribute('data-column-id');\r\n\r\n      // dispatch event that item has been dropped\r\n      __dispatchEvent(document, 'draggable.drop', {}, {\r\n        id: $table.id,\r\n        task: 'add',\r\n        columnId,\r\n        // type: itemType,\r\n        $node: $dropItem,\r\n      });\r\n\r\n      // remove draggedItem from DOM\r\n      this.$draggedItem.remove();\r\n    }\r\n    // when dropping within SVG\r\n    else {\r\n      // get svg\r\n      const $svg = this.$targetCurrent.closest('svg');\r\n      // check drop attribute\r\n      const svgCanDrop = $svg ? $svg.hasAttribute('data-svg-drop') : false;\r\n\r\n      // when dropping within droppable svg node\r\n      if (svgCanDrop) {\r\n        const position = __localPosition(this.lastEvent, $svg);\r\n        const $node = this.$draggedItem.classed('is-dragged', false)\r\n          .attr('style', 'outline: 0px;')\r\n          .node();\r\n\r\n        // update drops num\r\n        $dragItem.classed('was-dropped', true);\r\n        this.cache.items[itemId] += 1;\r\n\r\n        // add to svg\r\n        // dispatch event that svg has changed\r\n        __dispatchEvent(document, 'svg.drop', {}, {\r\n          svg: {\r\n            id: $svg.id,\r\n            $node,\r\n            type: $node.getAttribute('data-draggable-item'),\r\n            position,\r\n            size: {\r\n              width: this.objWidth,\r\n              height: this.objHeight,\r\n            },\r\n          },\r\n        });\r\n\r\n        this.$draggedItem.remove();\r\n\r\n      }\r\n      // when dropping outside of droppable area\r\n      else {\r\n        // if it's last drop then remove drop class\r\n        this.removeDraggableItem(this.$draggedItem, itemId, dropToken);\r\n      }\r\n\r\n    }\r\n\r\n    this.$slide.classList.remove('is-dragging');\r\n  }\r\n\r\n  handleDeleteItemFromSvgDrop() {\r\n\r\n    document.addEventListener('svg.drop.delete', (event) => {\r\n      const { slideId, id, $object } = event.detail.item;\r\n\r\n      // console.log('smazano', id, $object);\r\n      const $sameItemFromDragPlace = this.target.querySelector(`div[data-id=${id}]`);\r\n\r\n      if ($sameItemFromDragPlace && this.$slide.id === slideId) {\r\n        // if it's last drop then remove drop class\r\n        if (this.cache.items[id] === 1) {\r\n          $sameItemFromDragPlace.classList.remove('was-dropped');\r\n        }\r\n\r\n        // update drop number of concrete item\r\n        this.cache.items[id] -= 1;\r\n      }\r\n    });\r\n  }\r\n\r\n  handleAddTagsFromText() {\r\n    // need if we drop more than one same item\r\n    let idSalt = 1;\r\n\r\n    document.addEventListener('editor.change', (e) => {\r\n      const data = e.detail.text;\r\n      const concreteTagName = this.target.getAttribute('data-tagName');\r\n\r\n      // if concreteTagName\r\n      if (this.dataSources.includes(data.id) && (!concreteTagName || concreteTagName === data.tagData.tagName)) {\r\n        let $newDaggabletItem;\r\n        let $tagTextSpan;\r\n        let textToAdd;\r\n        let newId;\r\n        let idParts;\r\n\r\n        switch (data.task) {\r\n          case 'add':\r\n            // clone hidden tag\r\n            $newDaggabletItem = this.target.firstElementChild.cloneNode(true);\r\n            $newDaggabletItem.classList.remove('hidden');\r\n\r\n            // find place where to add tags text\r\n            $tagTextSpan = $newDaggabletItem.querySelector('.keywords-item');\r\n\r\n            // get right text to add\r\n            textToAdd = data.value.textContent;\r\n            if (textToAdd[textToAdd.length - 1] === '×') {\r\n              textToAdd = textToAdd.slice(0, -1);\r\n            }\r\n\r\n            // add text\r\n            $tagTextSpan.firstElementChild.innerHTML = textToAdd;\r\n\r\n            // add color to draggable item\r\n            $newDaggabletItem.firstElementChild.classList.add(`node-text-${data.tagColor}`);\r\n            $tagTextSpan.classList.add(`node-text-${data.tagColor}`);\r\n\r\n            // create new id\r\n            newId = $newDaggabletItem.getAttribute('data-id');\r\n            idParts = newId.split('-');\r\n            idParts.splice(-1, 1, `dup-${idSalt}`);\r\n            newId = idParts.join('-');\r\n\r\n            // set new id\r\n            $newDaggabletItem.setAttribute('data-id', newId);\r\n\r\n            // add to cache\r\n            this.cache.items[newId] = 0;\r\n\r\n            idSalt += 1;\r\n            this.target.appendChild($newDaggabletItem);\r\n\r\n            // add listeners for drag'n'drop\r\n            this.dragAndDropEvents(d3.select($newDaggabletItem), newId);\r\n            break;\r\n          case 'remove':\r\n            this.target.childNodes.forEach(($cell) => {\r\n              if (Draggable.isRightToDeleteHelper($cell, data.value, $cell.getAttribute('data-draggable-item'))) {\r\n                $cell.remove();\r\n              }\r\n            });\r\n            break;\r\n          default:\r\n            console.log('NewTableERROR: Undefinated task for new table! (cellManager)');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  removeDraggableItem($draggedItem, itemId, dropToken) {\r\n    // if it's last drop then remove drop class\r\n    if (this.cache.items[itemId] === 1) {\r\n      const $sameItemFromDragPlace = this.target.querySelector(`div[data-id=${itemId}]`);\r\n      $sameItemFromDragPlace.classList.remove('was-dropped');\r\n    }\r\n\r\n    // update drop number of concrete item\r\n    if (!dropToken) {\r\n      this.cache.items[itemId] -= 1;\r\n    }\r\n\r\n    // remove draggedItem from DOM\r\n    $draggedItem.remove();\r\n  }\r\n\r\n  // prepare for more types of duplicate types\r\n  static isRightToDeleteHelper(elm, deliveredValue, itemType) {\r\n    // fix for tags\r\n    // table div textContent include '×' as last char\r\n    // because it is in self span\r\n    let elemTextContent;\r\n    if (itemType === 'tag' && elm.textContent[elm.textContent.length - 1] === '×') {\r\n      elemTextContent = elm.textContent.slice(0, -1);\r\n    }\r\n    else {\r\n      elemTextContent = elm.textContent;\r\n    }\r\n    return elemTextContent === deliveredValue.textContent;\r\n  }\r\n}\r\n","import Component from './component';\r\nimport AudioPlayer from './media/audio-player';\r\n\r\nexport default class Gallery extends Component {\r\n  constructor($element) {\r\n    super($element);\r\n\r\n    // select all right gallery items\r\n    const $selectableItemss = this.target.querySelectorAll('.selected-item');\r\n    const $dupItems = this.target.querySelectorAll('[data-duplicate]');\r\n\r\n    // fix for selectables - data load\r\n    if (!HISTORYLAB.import.done) {\r\n      // set events for all found items\r\n      $selectableItemss.forEach(($item) => Gallery.setSelectEvents($item));\r\n      $dupItems.forEach(($item) => Gallery.setTextEvents($item));\r\n    } else {\r\n      $selectableItemss.forEach(($item) => {\r\n        // hide placeholder\r\n        const $placeholder = $item.querySelector('.selected-item__placeholder');\r\n        $placeholder.classList.add('is-hidden');\r\n        // right item\r\n        const $destination = document.querySelector(`#${$item.getAttribute('data-selectedId')} .is-checked`);\r\n        if ($destination) Gallery.addItemFromSelect($item, '-loaded', {$node: $destination})\r\n      });\r\n    }\r\n  }\r\n\r\n  static setSelectEvents($item) {\r\n    const selectedId = $item.getAttribute('data-selectedId');\r\n    const $placeholder = $item.querySelector('.selected-item__placeholder');\r\n\r\n    document.addEventListener('selection.change', (e) => {\r\n      if (selectedId === e.detail.id) {\r\n        const data = e.detail;\r\n        const idTail = '-duplicated';\r\n\r\n        switch (data.task) {\r\n          // singlechoice\r\n          case 'change':\r\n            Gallery.removeItemFromSelect($item);\r\n            Gallery.addItemFromSelect($item, idTail, data);\r\n            break;\r\n\r\n          // multichoice\r\n          case 'select':\r\n            // hide placeholder\r\n            $placeholder.classList.add('is-hidden');\r\n\r\n            Gallery.addItemFromSelect($item, idTail, data);\r\n            break;\r\n\r\n          case 'unselect':\r\n            Gallery.removeItemFromSelect($item, data.itemId + idTail);\r\n\r\n            // show placeholder if its have to\r\n            if ($item.childElementCount === 1) {\r\n              $placeholder.classList.remove('is-hidden');\r\n            }\r\n            break;\r\n\r\n          default:\r\n            console.error('ERROR: Undefinated task type.');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  static setTextEvents($item) {\r\n    const acceptedId = $item.getAttribute('data-duplicate');\r\n    const textDuplicateSources = acceptedId ? acceptedId.split(' ') : [];\r\n\r\n    document.addEventListener('text.change', (e) => {\r\n      const data = e.detail.text;\r\n\r\n      if (textDuplicateSources.includes(data.id)) {\r\n        switch (data.task) {\r\n          case 'create':\r\n          case 'change':\r\n            // TODO: More inputs to one output\r\n            $item.innerHTML = data.text;\r\n            break;\r\n          default:\r\n            console.log('Nondefinated text events task. :(');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  static addItemFromSelect($item, idTail, data) {\r\n    const $dupNode = data.$node.cloneNode(true);\r\n    $dupNode.setAttribute('data-id', data.itemId + idTail);\r\n\r\n    // add listeners to audio\r\n    if ($dupNode.hasAttribute('data-player-audio')) {\r\n      AudioPlayer.addEventListeners($dupNode, () => {});\r\n    }\r\n\r\n    $item.appendChild($dupNode);\r\n  }\r\n\r\n  static removeItemFromSelect($item, dataId = undefined) {\r\n    if (dataId) {\r\n      const $dupNode = $item.querySelector(`[data-id=${dataId}]`);\r\n      $dupNode.remove();\r\n    }\r\n    else {\r\n      $item.firstChild.remove();\r\n    }\r\n  }\r\n}\r\n","/* eslint-disable no-unused-vars */\r\nimport MagnifyingGlass from './magnifying-glass';\r\nimport Sortable from './sortable';\r\nimport SVG from './svg';\r\nimport SVGRadialMenu from './svg-lib/svg-radial-menu';\r\nimport Editor from './editor/editor';\r\nimport Keywords from './keywords';\r\nimport TestQuiz from './test-quiz';\r\nimport FullscreenToggle from './fullscreen';\r\nimport UserText from './user-text';\r\nimport AudioPlayerNormal from './media/audio-player-normal';\r\nimport AudioPlayerSimple from './media/audio-player-simple';\r\nimport FakeMap from './fake-map';\r\nimport { stopPlayingVideoPlayers } from './media/media';\r\nimport VideoPlayer from './media/video';\r\nimport Selectable from './selectable';\r\nimport NewTable from './new-table';\r\nimport Draggable from './draggable';\r\nimport Gallery from './gallery';\r\n\r\nconst windowLoadComponents = () => {\r\n  console.log('windowLoad:components');\r\n\r\n  // Video player - normal\r\n  const $videoPlayers = document.querySelectorAll('[data-player-video]');\r\n  if ($videoPlayers.length > 0) {\r\n    $videoPlayers.forEach(($videoPlayer) => {\r\n      // console.log('$videoPlayer', $videoPlayer);\r\n      const videoPlayer = new VideoPlayer($videoPlayer);\r\n    });\r\n\r\n    document.addEventListener('slide.change', () => {\r\n      stopPlayingVideoPlayers($videoPlayers);\r\n    });\r\n  }\r\n\r\n  // Audio player - normal\r\n  const $audioPlayerNormals = document.querySelectorAll('[data-player-audio=\"normal\"]');\r\n  if ($audioPlayerNormals.length > 0) {\r\n    $audioPlayerNormals.forEach(($audioPlayerNormal) => {\r\n      const audioPlayerNormal = new AudioPlayerNormal($audioPlayerNormal);\r\n    });\r\n\r\n    // TODO > audio-player-normal.js#61\r\n    // document.addEventListener('slide.change', () => {\r\n    //   stopPlayingVideoPlayers($audioPlayerNormals);\r\n    // });\r\n  }\r\n\r\n  // Audio player — simple\r\n  const $audioPlayerSimples = document.querySelectorAll('[data-player-audio=\"simple\"]');\r\n  if ($audioPlayerSimples.length > 0) {\r\n    $audioPlayerSimples.forEach(($audioPlayerSimple) => {\r\n      const audioPlayerSimple = new AudioPlayerSimple($audioPlayerSimple);\r\n    });\r\n\r\n    document.addEventListener('slide.change', () => {\r\n      stopPlayingVideoPlayers($audioPlayerSimples);\r\n    });\r\n  }\r\n\r\n  // Fullscreen\r\n  const $fullscreenToggles = document.querySelectorAll('[data-fullscreen=\"toggle\"]');\r\n  if ($fullscreenToggles.length > 0) {\r\n    $fullscreenToggles.forEach(($fullscreenToggle) => {\r\n      const fullscreenToggle = new FullscreenToggle($fullscreenToggle);\r\n    });\r\n  }\r\n\r\n  // Magnifying glass\r\n  const $magnifyingGlass = document.querySelectorAll('[data-lupa-target]');\r\n  if ($magnifyingGlass.length > 0) {\r\n    for (let i = 0; i < $magnifyingGlass.length; i += 1) {\r\n      const magnifyingGlass = new MagnifyingGlass($magnifyingGlass[i]);\r\n    }\r\n  }\r\n\r\n  // Fake Map\r\n  const $fakeMaps = document.querySelectorAll('[data-fake-map=\"target\"]');\r\n  if ($fakeMaps.length > 0) {\r\n    for (let i = 0; i < $fakeMaps.length; i += 1) {\r\n      const fakeMap = new FakeMap($fakeMaps[i]);\r\n    }\r\n  }\r\n\r\n  //\r\n  // load these below in working mode only\r\n\r\n  // User texts\r\n  // - preview/working mode logic inside the component\r\n  //  - show\r\n  const $userTexts = document.querySelectorAll('[data-textarea-target=\"\"]');\r\n  if ($userTexts.length > 0) {\r\n    $userTexts.forEach(($userText) => {\r\n      const userText = new UserText($userText);\r\n    });\r\n  }\r\n\r\n  // SVG + Radial menu\r\n  // - preview/working mode logic in side the component\r\n  //  - to set max-width\r\n  const $svgs = document.querySelectorAll('[data-svg-target]');\r\n  if ($svgs.length > 0) {\r\n\r\n    if (HISTORYLAB.import.done !== true) {\r\n      // radial menu\r\n      const $radialMenu = document.querySelector('[data-radial-menu]');\r\n      if ($radialMenu) {\r\n        const radialMenu = new SVGRadialMenu($radialMenu, $svgs);\r\n      }\r\n    }\r\n\r\n    // svgs\r\n    // setSize is needed\r\n    $svgs.forEach(($svg) => {\r\n      const svg = new SVG($svg);\r\n    });\r\n  }\r\n\r\n  // Editor\r\n  const $editors = document.querySelectorAll('[data-editor]');\r\n  if ($editors.length > 0) {\r\n    $editors.forEach(($editor) => {\r\n      const editor = new Editor($editor);\r\n      // important for getting data from editor\r\n      // each editor has to be add to list of cviceni tools\r\n      // editor id must to be unique\r\n      HISTORYLAB.tools[editor.id] = editor;\r\n    });\r\n  }\r\n\r\n  // Gallery listener\r\n  const $galleries = document.querySelectorAll('[data-gallery]');\r\n  if ($galleries.length > 0) {\r\n    $galleries.forEach(($gallery) => {\r\n      const gallery = new Gallery($gallery);\r\n    });\r\n  }\r\n\r\n  if (HISTORYLAB.import.done !== true) {\r\n    // Test Quizes\r\n    const $testQuizs = document.querySelectorAll('[data-target-test-quiz]');\r\n    if ($testQuizs.length > 0) {\r\n      $testQuizs.forEach(($testQuiz) => {\r\n        const settings = document.querySelector(\r\n          `[data-test-quiz-id-reference=\"${$testQuiz.getAttribute(\r\n            'data-test-quiz-id',\r\n          )}\"]`,\r\n        );\r\n\r\n        const testQuiz = new TestQuiz(\r\n          $testQuiz.getAttribute('data-test-quiz-id'),\r\n          $testQuiz,\r\n          JSON.parse(settings.getAttribute('data-module-settings')),\r\n        );\r\n        testQuiz.init();\r\n      });\r\n    }\r\n\r\n    // New table\r\n    const $newTables = document.querySelectorAll('[data-new-table]');\r\n    if ($newTables.length > 0) {\r\n      $newTables.forEach(($newTable) => {\r\n        const newTable = new NewTable($newTable);\r\n      });\r\n    }\r\n\r\n    // Pretahovani\r\n    const $draggables = document.querySelectorAll('[data-draggable]');\r\n    if ($draggables.length > 0) {\r\n      $draggables.forEach(($draggable) => {\r\n        const draggable = new Draggable($draggable);\r\n      });\r\n    }\r\n\r\n    // Sortable\r\n    const $sortables = document.querySelectorAll('[data-sortable-target]');\r\n    if ($sortables.length > 0) {\r\n      $sortables.forEach(($sortable) => {\r\n        const sortable = new Sortable($sortable);\r\n      });\r\n    }\r\n\r\n    // Selectable\r\n    const $selectables = document.querySelectorAll('[data-selectable-target]');\r\n    if ($selectables.length > 0) {\r\n      $selectables.forEach(($selectable) => {\r\n        const selectable = new Selectable($selectable);\r\n      });\r\n    }\r\n\r\n    // Keywords selection\r\n    const $keywords = document.querySelectorAll('[data-keywords]');\r\n    if ($keywords.length > 0) {\r\n      $keywords.forEach(($keyword) => {\r\n        const settings = $keyword.hasAttribute('data-module-settings')\r\n          ? $keyword.getAttribute('data-module-settings')\r\n          : {};\r\n        const keywords = new Keywords($keyword, JSON.parse(settings));\r\n        keywords.init();\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\nexport default windowLoadComponents;\r\n","/* eslint-disable consistent-return */\r\nimport domLoadComponents from './dom-load';\r\nimport windowLoadComponents from './window-load';\r\nimport unsupportedBrowsers from '../lib/unsupported-browsers';\r\n\r\n(() => {\r\n  if (unsupportedBrowsers()) return false;\r\n\r\n  // The DOMContentLoaded event fires when parsing of the current page is complete. DOMContentLoaded is a great event to use to hookup UI functionality to complex web pages.\r\n  document.addEventListener('DOMContentLoaded', domLoadComponents, false);\r\n\r\n  // The load event fires when all files have finished loading from all resources, including ads and images.\r\n  window.addEventListener('load', windowLoadComponents, false);\r\n})();\r\n","const unsupportedBrowsers = () => {\r\n\r\n  // feature detection for unsupported browsers\r\n  const isUnsupported = !Array.from\r\n    || !Element.prototype.matches\r\n    || !Element.prototype.closest\r\n    || typeof window.CustomEvent !== 'function'\r\n    || typeof Object.assign !== 'function';\r\n\r\n  if (isUnsupported) {\r\n    console.warn('Not supported browser.');\r\n\r\n    const $unsupported = document.querySelector('#unsupported');\r\n    $unsupported.querySelector('#unsupported-browser').innerHTML = ` ${platform.name} ${platform.version} `;\r\n    $unsupported.classList.remove('is-hidden');\r\n\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport default unsupportedBrowsers;\r\n"],"names":["domLoadComponents","console","log","Component","$element","_classCallCheck","this","target","$slide","closest","lang","document","documentElement","getAttribute","HISTORYLAB","done","$buttonFeedback","querySelector","$buttonFeedbackText","showFeedback","bind","_createClass","key","value","classList","contains","remove","add","MagnifyingGlass","_Component","_inherits","_super","_createSuper","_this","call","$canvas","ctx","getContext","_onStart","_assertThisInitialized","_onMove","_onEnd","_update","_onResize","zoomGlassSize","targetBCR","zoomed","targetZoomed","x","y","trackingTouch","displayStyle","_addEventListeners","_initCanvas","window","requestAnimationFrame","width","height","dPR","devicePixelRation","style","concat","scale","getBoundingClientRect","event","getComputedStyle","display","preventDefault","pageX","touches","pageY","TAU","Math","PI","radius","ratioX","max","min","left","ratioY","top","scaledTargetWidth","scaledTargetHeight","platform","os","family","indexOf","name","shadowColor","shadowBlur","shadowOffsetY","clearRect","fillStyle","beginPath","arc","closePath","fill","save","clip","drawImage","restore","_setTransformStyle","addEventListener","betterX","betterY","halfYoomGlassSize","abs","innerWidth","transform","__createNewCustomEvent","options","arguments","length","undefined","data","properties","Object","assign","bubbles","CustomEvent","_objectSpread","detail","__dispatchEvent","type","payload","dispatchEvent","__globalPosition","__localPosition","container","position","offsetX","offsetY","d3","pointer","_slicedToArray","pointers","format","__toggleClass","element","cls","__hasClass","__removeClass","__addClass","className","elements","classes","_elements","_classes","querySelectorAll","tagName","split","i","_elements$i$classList","apply","_toConsumableArray","j","_elements$i$classList2","replace","RegExp","mediaEvents","playchange","timechange","canplaystart","stopPlayingVideoPlayers","$players","forEach","$player","$media","paused","pause","setAttribute","getSecondsMinutesFormat","seconds","duration","floor","minutes","toString","slice","AudioPlayer","$item","$audio","$playButton","$timeLeft","play","stopPropagation","innerText","currentTime","SVGDragNDrop","select","raise","classed","diff","$node","_this$getJustifiedCor2","getJustifiedCord","xZarov","yZarov","attr","toFixed","_this$getJustifiedCor4","orientation","elementResolution","offsetHeight","offsetWidth","svgResolution","map","e","parseInt","textJustified","pretahovaniJustified","circleJustified","textCenter","getOffsetOfText","attributes","d3Element","_this$circleJustified2","SVGDraw","$svg","color","callback","sourceEvent","nodeName","line","curve","curveLinear","d","subject","x0","y0","id","active","append","datum","on","dragEvent","x1","y1","dx","dy","push","$thisPath","svg","task","node","contextMenu","pathEventsManager","svgGroup","localPosition","circleEventsManager","circleR","getPropertyValue","elementPosition","drag","start","from","circleMove","oldXCoordinate","oldYCoordinate","taskType","SVG","removeCloneConnectionManager","idParts","item","slideId","$object","firstChild","dragged","end","SVGText","maxLength","minLength","defaultWidth","defaultHeight","svgID","$radialMenu","hash","foreignObject","circle","textarea","fixVisualOrientation","focus","textEventsManager","$textarea","$circle","isCreated","firstWrite","oldText","parentElement","childNodes","updateTextareaHeight","$target","wrongBool","isWrong","removeItem","newHeight","scrollHeight","$parent","currentCommentWidth","currentCommentHeight","isBubble","_setSize","init","_initWhenDone","toDuplicate","svgSpecificActions","colors","svgSpecificColor","_initPath","_initCircle","_initComicBubbles","_getEvents","_getDropEvent","selectAll","viewbox","rect","maxWidthAbsolute","maxHeightAbsolute","innerHeight","getHeight","maxWidth","setMaxWidth","_this2","p","renderPath","_this3","createCircle","_this4","$comicBubbles","$comicBubble","comicBubblesEventsManager","oldID","join","_this5","svgDuplicateSources","includes","$templateNode","$templateCircle","localNodeID","_generateNewID","$localNode","_clonePath","_cloneComicBubbles","templateCircleID","localCircleID","$localCircle","_cloneTextField","_cloneCircle","_cloneDropItem","_this6","idSalt","_event$detail$svg","size","multiply","elemSize","h","w","$d3canvas","$d3foreignObject","$dropItem","$itemToAdd","firstElementChild","paddingLeft","$textBox","appendChild","$foreignObject","dropItemEventsManager","cloneNode","insertBefore","selected","isRadial","elemIdParts","allActiveSvgs","deactivate","pop","every","coord","globalPosition","$nextElement","elementFromPoint","Sortable","$settings","feedback","JSON","parse","$container","$items","$droppables","$placeholder","$inheritors","inheritors","order","direction","before","after","evaluation","mouse","clientX","clientY","el","clone","posRel","siblings","prev","next","_setupInitialOrder","_setupInheritors","cache","barva","hasAttribute","offsetTop","offsetLeft","_addPlaceholder","_onOver","right","_onDrop","bottom","_removePlaceholder","_updateOrder","_updateOrderInInheritors","_dispatchEvent","_checkAndResolveFeedback","_getReference","_addEventListenerToItem","addEventListeners","removeChild","createElement","minHeight","src","img","nextElementSibling","previousElementSibling","array","some","index","checkIfTheArrayIsGood","changedArray","splice","_this$$buttonFeedback","arrayOfItems","dataset","sortableSpravnaodpoved","feedbackResult","oneMove","feedbackActual","find","podminka","text","splneno","Array","$inheritor","sortableIndex","inheritor","SVGRadialMenu","$svgs","$radialMenuItems","$colorItems","$textItems","$createTextItem","$removeItem","$tooltip","initialSetUp","menuRadius","itemRadius","setUpRadialMenuItems","addEventListenersToRadialMenu","openRadialMenu","iOSAddonEvents","timer","test","navigator","userAgent","MSStream","setTimeout","clearTimeout","hasText","hasMoreColors","$clickedItem","findNearElements","activate","deselectItem","filterMenuButtons","showRadialMenu","getSelection","removeAllRanges","addEventListenersToRadialMenuItem","_itemsLength","_menuRadius","_itemRadius","_menuOffset","_interval","_centerOffset","angle","sin","cos","onMouseLeave","hideRadialMenu","action","createText","changeColor","innerHTML","currentTarget","$activeSVG","$activeRadialMenuItem","positionRadialMenuItems","mouseLeaveDelay","_this7","clickedItem","$colorItem","$textItem","selectItem","commentID","$comment","SelectionMenu","editorId","schema","editorView","$menuTemplate","$menuBox","update","nodes","marks","dom","parentNode","relatedTarget","$menuItems","sugar","$menuItem","dataCommandName","isAdded","marker","state","dataTagId","addRemoveButton","removeButton","pm","toggleMark","command","dispatch","markedSelection","selection","closeSelection","$dispatchNode","connectAllSelectedParts","removingMarkerHandler","tagData","tagColor","view","lastState","readOnly","activeElementClasses","activeElement","empty","offsetParent","_state$selection","to","coordsAtPos","box","offsetParentBox","err","error","ranges","has","_ranges$i","$from","$to","doc","rangeHasMark","pos","lastPosition","newState","tr","insert","create","updateState","setSelection","TextSelection","inputs","$removeButton","$markedParts","_loop","$markedPart","fromPos","posAtDOM","toPos","textContent","matched","nodesBetween","isInline","toRemove","MarkType","found","isInSet","nodeSize","m","step","eq","RemoveMarkStep","fromPostRB","$nodes","$finalNode","fullContent","WrittingMenu","$removeAllChanges","firstState","confirm","schemaConfig","content","heading","attrs","level","default","group","defining","parseDOM","tag","getAttrs","toDOM","paragraph","list","listItem","hard_break","selectable","inline","premarked","textData","$dom","_node$attrs","class","italic","bold","code","small","_node$attrs2","writtingInsertPart","writtingRemovePart","Editor","editor","editorType","$editor","$content","Schema","initJSON","initHTML","toJSON","plugins","selectionMenu","premarkedParts","writting","keydownHandler","histKeymap","keymap","undo","redo","history","EditorView","EditorState","DOMParser","fromSchema","readOnlyMod","fromJSON","Plugin","props","editable","PluginKey","$toolbarTemplate","deletedParts","handleKeyDown","Delete","Backspace","handleClickOn","nodePos","newClassName","classSelectDefinition","nodeAttrs","setNodeMarkup","Keywords","opts","$controls","defaults","$itemsContainer","itemsContainerClassName","inherit","isInherited","itemClassName","_getHTMLFromItems","onInit","_regenerateItemsContainerFromInherited","_registerHandlers","_changeSizeOfKeywordItem","skala","maxLevel","setNewLevelValue","$keyword","number","oldValue","newValue","$control","tempContent","temp","getElementById","renameItemsIds","_clickEventHandler","_dispatchEventHandler","keywords","_e$detail$keywords","currentId","nodeId","_getItemFromDOMElement","_getItemsHTML","_getItemsFromHTML","itemsClassName","itemsArray","_getDOMElementFromItem","newDiv","outerHTML","wrapper","__getHTML","items","contentHTML","oldId","newId","itemsHTML","expString","TestQuiz","$questions","itemClass","answersCorrect","questions","zpetnaVazba","$question","questionIndex","answered","answerCorrect","$answers","optionClass","$answer","answerIndex","$answerCurrent","$answersItem","selectedClass","_this2$$buttonFeedbac","question","FullscreenToggle","_Fullscreen","_super2","imageAlternative","$fullscreenContainer","$fullscreenTarget","removeAttribute","toLowerCase","currentSrc","Promise","resolve","reject","Image","onload","onerror","then","image","naturalWidth","naturalHeight","ratio","setSize","_viewbox","$svgTexts","$svgText","$fullscreen","toggle","Fullscreen","UserText","$counter","$counterWrapper","$instruction","$userTexts","lengthExpected","avg","lastValue","hadData","wasUsed","updateCharacterCounter","keyAttribute","fromId","$destination","textDuplicateSources","getEvents","_this$$counterWrapper","none","ok","$userText","taskName","valueLength","updateFeedback","itemData","AudioPlayerNormal","$loadWave","$leftTime","$audioDuration","wavesurfer","WaveSurfer","waveColor","progressColor","responsive","barWidth","load","initWave","getDuration","addListenerAfterReady","time","playPause","$nextSlide","AudioPlayerSimple","_AudioPlayer","$duration","FakeMap","$buttons","$maps","lastActiveIndex","addEventListenerToButtons","$button","switchMap","VideoPlayer","prefix","interval","$document","ownerDocument","$play","$playSymbol","$pauseSymbol","$time","$timeMeter","$timeRange","$currentTimeText","createTextNode","$currentTime","durationTime","$durationTime","timeToAural","$enterFullscreenSymbol","$leaveFullscreenSymbol","_fullscreenchange","_requestFullscreen","requestFullscreen","webkitRequestFullscreen","msRequestFullscreen","onCanPlayStart","onLoadStart","onLoadedData","onPlayChange","onTimeChange","onPlayClick","onTimeKeydown","onTimeClick","onFullscreenClick","onFullscreenChange","onDrag","percentage","clearInterval","setInterval","currentTimePercentage","currentTimeCode","nodeValue","removeEventListener","nCanPlayStart","autoplay","isFullscreen","_fullscreenElement","leaveFullscreen","enterFullscreen","pointerType","_exitFullscreen","webkitSupportsFullscreen","webkitDisplayingFullscreen","webkitExitFullscreen","webkitEnterFullscreen","keyCode","shiftKey","offset","fullscreenElement","webkitFullscreenElement","msFullscreenElement","exitFullscreen","webkitCancelFullScreen","msExitFullscreen","innerTarget","listener","hasPointerEvent","onpointerup","hasTouchEvent","ontouchstart","pointerDown","pointerMove","pointerUp","axisProp","onpointermove","defaultView","langMinutes","langSeconds","Selectable","settings","checkedInput","$inputs","$input","_changeClassIfChecked","$input_","checked","viceOdpovedi","vybrano","disableFeedback","hideFeedback","$label","itemId","NewTable","dataFrom","dataSources","tasks","autofill","_columnManager","_rowManager","$cell","columnId","rowId","_cellManager","$tableRow","rightToAdd","$headerCells","previousSibling","$rowCell","itemType","fillCell","$row","isRightToDeleteHelper","_removeTaskFromCache","$rows","$firstCell","columnIndex","_findCellType","cellController","$tag","$tags","removed","textId","$span","$innerItem","cacheObj","seed","answer","rightAnswer","$option","_correctedAnswer","keys","numberOfDrops","rowType","$columnHeader","elm","deliveredValue","Draggable","idPrefix","$targetPrevious","$targetCurrent","$draggedItem","objWidth","objHeight","lastEvent","$dragItem","dragAndDropEvents","handleDeleteItemFromSvgDrop","handleAddTagsFromText","dropToken","onStart","onDrop","_e$target$getBounding","$dragItemHTML","$table","body","$placeholderOld","numberOfPossibleDrops","numberOfDropsDone","childElementCount","$placeholderNew","coords","$fullScreenIcon","$rightElmChild","$cross","lastElementChild","removeDraggableItem","_event$detail$item","$sameItemFromDragPlace","$newDaggabletItem","$tagTextSpan","textToAdd","concreteTagName","Gallery","$selectableItemss","$dupItems","addItemFromSelect","setSelectEvents","setTextEvents","selectedId","idTail","removeItemFromSelect","acceptedId","$dupNode","dataId","windowLoadComponents","$videoPlayers","$videoPlayer","$audioPlayerNormals","$audioPlayerNormal","$audioPlayerSimples","$audioPlayerSimple","$fullscreenToggles","$fullscreenToggle","$magnifyingGlass","$fakeMaps","$editors","tools","$galleries","$gallery","$testQuizs","$testQuiz","$newTables","$newTable","$draggables","$draggable","$sortables","$sortable","$selectables","$selectable","$keywords","Element","prototype","matches","warn","$unsupported","version","unsupportedBrowsers"],"mappings":"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"}