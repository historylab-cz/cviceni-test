!function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t},a=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},r=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},o=function t(i){e(this,t),this.target=i},l=function(t){function n(t){e(this,n);var i=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return i.element=document.querySelector("[data-lupa]"),i.canvas=document.querySelector("[data-lupa-canvas]"),i.ctx=i.canvas.getContext("2d"),i._onStart=i._onStart.bind(i),i._onMove=i._onMove.bind(i),i._onEnd=i._onEnd.bind(i),i._update=i._update.bind(i),i._onResize=i._onResize.bind(i),i.zoomGlassSize=230,i.targetBCR=null,i.zoomed=0,i.targetZoomed=0,i.x=0,i.y=0,i.trackingTouch=!1,i._addEventListeners(),i._initCanvas(),i._onResize(),window.requestAnimationFrame(i._update),i}return a(n,o),i(n,[{key:"_initCanvas",value:function(){var t=this.zoomGlassSize,e=this.zoomGlassSize,i=window.devicePixelRation||1;this.canvas.width=t*i,this.canvas.height=e*i,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.ctx.scale(i,i)}},{key:"_onResize",value:function(){this.targetBCR=this.target.getBoundingClientRect()}},{key:"_onStart",value:function(t){t.target===this.target&&(t.preventDefault(),this.x=t.pageX||t.touches[0].pageX,this.y=t.pageY||t.touches[0].pageY,this.trackingTouch=!0,this.targetZoomed=1,this.zoomed=0,window.requestAnimationFrame(this._update))}},{key:"_onMove",value:function(t){this.trackingTouch&&(this.x=t.pageX||t.touches[0].pageX,this.y=t.pageY||t.touches[0].pageY)}},{key:"_onEnd",value:function(){this.targetZoomed=0,this.trackingTouch=!1}},{key:"_update",value:function(){var t=2*Math.PI,e=100*this.zoomed;this.targetBCR=this.target.getBoundingClientRect();var i=Math.max(0,Math.min(1,(this.x-this.targetBCR.left)/this.targetBCR.width)),n=Math.max(0,Math.min(1,(this.y-this.targetBCR.top)/this.targetBCR.height)),a=2.5*this.targetBCR.width,s=2.5*this.targetBCR.height;this.ctx.shadowColor="rgba(0,0,0,0.4)",this.ctx.shadowBlur=12,this.ctx.shadowOffsetY=8,this.ctx.clearRect(0,0,this.zoomGlassSize,this.zoomGlassSize),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(this.zoomGlassSize/2,this.zoomGlassSize-10-e,e,0,t),this.ctx.closePath(),this.ctx.fill(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.zoomGlassSize/2,this.zoomGlassSize-10-(e+1),1.03*e,0,t),this.ctx.clip(),this.ctx.closePath(),this.ctx.drawImage(this.target,-i*a+this.zoomGlassSize/2,-n*s+this.zoomGlassSize/2,a,s),this.ctx.restore(),this.element.style.transform="translate("+this.x+"px, "+this.y+"px)",this.zoomed+=(this.targetZoomed-this.zoomed)/4,this.zoomed>.001?window.requestAnimationFrame(this._update):this.zoomed=0}},{key:"_addEventListeners",value:function(){document.addEventListener("touchstart",this._onStart),document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onEnd),document.addEventListener("mousedown",this._onStart),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onEnd),window.addEventListener("resize",this._onResize)}}]),n}();function d(e){return e&&"object"===(void 0===e?"undefined":t(e))&&!Array.isArray(e)}function c(t,e){e.parentNode.insertBefore(t,e)}function u(t){t.parentNode.removeChild(t)}function h(t){if(t&&t.tagName){if(t.outerHTML)return t.outerHTML;var e=document.createElement("div");return e.appendChild(t.cloneNode(!0)),e.innerHTML}}function g(t){var e=d3.mouse(t);return{x:d3.format(".0f")(e[0]),y:d3.format(".0f")(e[1])}}function m(t){var e=new WebKitCSSMatrix(window.getComputedStyle(t).webkitTransform),i=document.body;window.pageYOffset||i.scrollTop,window.pageXOffset||i.scrollLeft;return{left:t.offsetLeft+e.m41,top:t.offsetTop+e.m42}}function v(t){var e=t.getBoundingClientRect(),i=document.body,n=window.pageYOffset||i.scrollTop,a=window.pageXOffset||i.scrollLeft;return{left:e.left+a,top:e.top+n,height:e.height,width:e.width}}function f(t,e){p(t,e)?b(t,e):y(t,e)}function p(t,e){return!(!t||!e)&&(t.classList?t.classList.contains(e):(t.className+" ").indexOf(e+" ")>-1)}function y(t,e){var i=t,n=e;if(i&&n)if("string"==typeof i?i=document.querySelectorAll(i):i.tagName&&(i=[i]),"string"==typeof n){n=n.split(" ");for(var a=0;a<i.length;a+=1){var s;if(i[a].classList)(s=i[a].classList).add.apply(s,r(n));else if(!p.apply(void 0,[i[a]].concat(r(n))))for(var o=0;o<n.length;o+=1)i[a].classes+=" "+n[o]}}else console.log("Class argument must be string with spaces in between class names.")}function b(t,e){var i=t,n=e;if(i&&n)if("string"==typeof i?i=document.querySelectorAll(i):i.tagName&&(i=[i]),"string"==typeof n){n=n.split(" ");for(var a=0;a<i.length;a+=1){var s;if(i[a].classList)(s=i[a].classList).remove.apply(s,r(n));else for(var o=0;o<n.length;o+=1)i[a].className=i[a].className.replace(new RegExp("\\b"+e[o]+"\\b","g"),"")}}else console.log("Class argument must be string with spaces in between class names.")}var E=function(t){function n(t){e(this,n);var i=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return i.zoomIntensity=3,i.targetContainer=i.target.parentElement,i._onClick=i._onClick.bind(i),i._onMove=i._onMove.bind(i),i._onResize=i._onResize.bind(i),i._getImageDimensions(),i._addEventListeners(),i}return a(n,o),i(n,[{key:"_getImageDimensions",value:function(){this.targetBCR=this.target.getBoundingClientRect(),this.targetContainer.style.height=this.targetBCR.height+"px"}},{key:"_onResize",value:function(){this.targetBCR=this.target.getBoundingClientRect()}},{key:"_onClick",value:function(t){t.target===this.target&&(t.preventDefault(),p(this.target,"enlarged")?(p(this.target,"detail-move")&&b(this.target,"detail-move"),b(this.target,"enlarged"),this.target.style.left="",this.target.style.top=""):(this._onResize(),y(this.target,"enlarged"),this.x=t.clientX||t.touches[0].pageX,this.y=t.clientY||t.touches[0].pageY,this.target.style.top=this.positionY+"%",this.target.style.left=this.positionX+"%"))}},{key:"_onMove",value:function(t){t.target===this.target&&p(this.target,"enlarged")&&p(this.target,"enlarged")&&(p(this.target,"detail-move")||y(this.target,"detail-move"),this.x=t.clientX||t.touches[0].pageX,this.y=t.clientY||t.touches[0].pageY,this.target.style.top=this.positionY+"%",this.target.style.left=this.positionX+"%")}},{key:"_addEventListeners",value:function(){document.addEventListener("touchstart",this._onClick),document.addEventListener("touchmove",this._onMove),document.addEventListener("mousedown",this._onClick),document.addEventListener("mousemove",this._onMove)}}],[{key:"positionY",get:function(){return(this.y-this.targetBCR.top)/this.targetBCR.height*-100*(this.zoomIntensity-1)}},{key:"positionX",get:function(){return(this.x-this.targetBCR.left)/this.targetBCR.width*-100*(this.zoomIntensity-1)}}]),n}(),_=function(t){function n(t){e(this,n);var i=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return i.container=i.target,i.items=t.querySelectorAll("[data-sortable-drag]"),i.droppables=t.querySelectorAll("[data-sortable-drop]"),i.placeholder=function(){return document.querySelector("#sortable-placeholder")},i.trackingTouch=!1,i.before=!1,i.after=!1,i.mouse={x:function(t){return t.clientX||t.touches[0].clientX},y:function(t){return t.clientY||t.touches[0].clientY},x0:0,y0:0,x1:0,y1:0},i.dragged={el:null,clone:null,posRel:{},rect:function(){return i.dragged.el.getBoundingClientRect()},size:{}},i.siblings={prev:null,next:null},i._onStart=i._onStart.bind(i),i._onMove=i._onMove.bind(i),i._onEnd=i._onEnd.bind(i),i._update=i._update.bind(i),i._addEventListeners(),i}return a(n,o),i(n,[{key:"_onStart",value:function(t){t.target.hasAttribute("data-sortable-drag")&&(this.trackingTouch=!0,this.dragged.el=t.target,this.dragged.clone=this.dragged.el.cloneNode(!0),this.dragged.posRel.top=this.dragged.el.offsetTop,this.dragged.posRel.left=this.dragged.el.offsetLeft,this.dragged.size.width=this.dragged.el.offsetWidth,this.dragged.size.height=this.dragged.el.offsetHeight,this.dragged.el.style.top=this.dragged.posRel.top+"px",this.dragged.el.style.left=this.dragged.posRel.left+"px",this.dragged.el.style.width=this.dragged.size.width+"px",this.dragged.el.style.height=this.dragged.size.height+"px",this.dragged.el.classList.add("is-dragged"),this.container.classList.add("is-dragged"),this._addPlaceholder(this.dragged.el),this._onOver(t),this.mouse.x0=this.mouse.x(t),this.mouse.y0=this.mouse.y(t),t.preventDefault())}},{key:"_onMove",value:function(t){this.trackingTouch&&(this.mouse.x1=this.mouse.x(t)-this.mouse.x0,this.mouse.y1=this.mouse.y(t)-this.mouse.y0,window.requestAnimationFrame(this._update),this._onOver(t))}},{key:"_onEnd",value:function(t){if(this.trackingTouch){this.trackingTouch=!1,this.container.classList.remove("is-dragged"),this.dragged.el.classList.remove("is-dragged"),this.dragged.el.style.top="",this.dragged.el.style.left="",this.dragged.el.style.width="",this.dragged.el.style.height="",this.dragged.el.style.transform="";var e=this.placeholder().getBoundingClientRect();e.left<=this.mouse.x(t)<=e.right&&this._onDrop(),this._removePlaceholder()}}},{key:"_onOver",value:function(t){if(this.before=!1,this.after=!1,this._getReference(),this.siblings.next&&this.siblings.next.hasAttribute("data-sortable-drop")){var e=this.siblings.next.getBoundingClientRect();this.dragged.rect().right>e.left+e.width/1.5&&(this.after=!0,this._addPlaceholder(this.siblings.next))}if(this.siblings.prev&&this.siblings.prev.hasAttribute("data-sortable-drop")){var i=this.siblings.prev.getBoundingClientRect();this.dragged.rect().left<i.right-i.width/1.5&&(this.before=!0,this._addPlaceholder(this.siblings.prev))}}},{key:"_onDrop",value:function(){var t=this.placeholder();this._addEventListenerToItem(this.dragged.clone),this.container.insertBefore(this.dragged.clone,t),this.dragged.el.parentNode.removeChild(this.dragged.el)}},{key:"_update",value:function(){this.dragged.el.style.transform="translate3d("+this.mouse.x1+"px, "+this.mouse.y1+"px, 0) rotate(5deg)"}},{key:"_addPlaceholder",value:function(t){this._removePlaceholder();var e=document.createElement("div");if(e.classList.add("sortable-item","sortable-placeholder"),e.setAttribute("id","sortable-placeholder"),this.dragged.el.querySelector("img")){var i=this.dragged.el.querySelector("img").getAttribute("src"),n=document.createElement("img");n.setAttribute("src",i),e.appendChild(n)}this.after?this.container.insertBefore(e,t.nextElementSibling):(this.before,this.container.insertBefore(e,t))}},{key:"_removePlaceholder",value:function(){var t=this.placeholder();t&&t.parentNode.removeChild(t)}},{key:"_getReference",value:function(){var t=this.placeholder();this.siblings.prev=t.previousElementSibling===this.dragged.el?this.dragged.el.previousElementSibling:t.previousElementSibling,this.siblings.next=t.nextElementSibling===this.dragged.el?this.dragged.el.nextElementSibling:t.nextElementSibling}},{key:"_addEventListenerToItem",value:function(t){t.addEventListener("touchstart",this._onStart),t.addEventListener("mousedown",this._onStart)}},{key:"_addEventListeners",value:function(){document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onEnd),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onEnd);for(var t=0;t<this.items.length;t+=1)this._addEventListenerToItem(this.items[t])}}]),n}(),C=function(){function t(){e(this,t)}return i(t,null,[{key:"start",value:function(t){d3.select(t).raise().classed("is-dragged",!0)}},{key:"dragged",value:function(t,e){d3.select(t).attr("x",(d3.event.x-e.x).toFixed()).attr("y",(d3.event.y-e.y).toFixed())}},{key:"end",value:function(t,e,i){d3.select(t).attr("x",(d3.event.x-i.x).toFixed()).attr("y",(d3.event.y-i.y).toFixed()).classed("is-dragged",!1)}}]),t}(),x=function(){function t(){e(this,t)}return i(t,null,[{key:"renderPath",value:function(t){if("image"===d3.event.sourceEvent.target.nodeName){var e=d3.line().curve(d3.curveLinear),i=d3.format(".0f"),n=d3.event.subject,a=i(d3.event.x),s=i(d3.event.y),r="path-"+a+"-"+s,o=d3.select("#"+t.id+" .svg-view").append("svg:path").attr("data-svg-path","").attr("class","svg-path").attr("id",r).datum(n);d3.event.on("drag",function(){var t=i(d3.event.x),r=i(d3.event.y),l=t-a,d=r-s;l*l+d*d>300?n.push([a=t,s=r]):n[n.length-1]=[t,r],o.attr("d",e)}).on("end",function(){var t=d3.select("#"+r);t&&(t.attr("d")?t.attr("d").length<40&&t.remove():t.attr("d")||t.remove())}),d3.select("#"+r).on("click",function(){d3.select("#"+r).remove(),d3.event.preventDefault()},!1)}}},{key:"createCircle",value:function(t){var e=d3.select("#"+t.id+" .svg-view"),i=document.querySelector("#"+t.id+" .svg-view"),n=g(t),a="circle-"+n.x+"-"+n.y,s="#"+a,r=e.append("svg:foreignObject").attr("data-svg-circle","").attr("id",a).attr("x",n.x).attr("y",n.y).attr("width",1).attr("height",1),o=document.querySelector(s),l=[o.getAttribute("x"),o.getAttribute("y")],d={};r.append("xhtml:div").attr("class","svg-circle").on("click",function(){d3.select(d3.event.target.parentNode).remove()}).call(d3.drag().container(i).subject(o).on("start",function(){d={x:d3.event.x-l[0],y:d3.event.y-l[1]},C.start(s)}).on("drag",function(){C.dragged(s,d)}).on("end",function(){C.end(s,"circle",d),l=[o.getAttribute("x"),o.getAttribute("y")]}))}}]),t}(),A=function(){function t(){e(this,t)}return i(t,null,[{key:"createText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:333,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=d3.select('[data-svg-active="true"]'),a=n.attr("id"),s=n.select(".svg-view"),r=document.querySelector('[data-svg-active="true"] .svg-view'),o=document.querySelector("[data-radial-menu]"),l={x:o.getAttribute("data-local-x"),y:o.getAttribute("data-local-y")},d="svg-text-"+l.x+"-"+l.y,c="#"+d;s.append("svg:foreignObject").attr("class","svg-text").attr("x",l.x).attr("y",l.y).attr("width",1).attr("height",1).append("xhtml:textarea").attr("maxlength",e).attr("tabindex","-1").attr("id",d).attr("class","svg-textarea").attr("data-save","").attr("data-svg-textarea-target",a),document.querySelector(""+c).focus();var u=document.querySelector(c).parentNode,h=[u.getAttribute("x"),u.getAttribute("y")],g={};d3.select(""+c).call(d3.drag().container(r).subject(u).on("start",function(){g={x:d3.event.x-h[0],y:d3.event.y-h[1]},C.start(u)}).on("drag",function(){C.dragged(u,g)}).on("end",function(){C.end(u,"text",g),h=[u.getAttribute("x"),u.getAttribute("y")]})).on("keyup",function(){t.updateTextareaHeight(d3.event.target)}).on("blur",function(){var t=d3.event.target,e=t.value;0!==e.length?e.length<i?y(t,"is-wrong"):e.length>=i&&p(t,"is-wrong")&&b(t,"is-wrong"):w.removeItem(u)}).on("focus",function(){d3.select(u).raise()})}},{key:"updateTextareaHeight",value:function(t){t.style.height="1px",t.style.height=22+t.scrollHeight+"px"}}]),t}(),w=function(t){function n(t){e(this,n);var i=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return i.init(),i}return a(n,o),i(n,[{key:"init",value:function(){for(var t=this.target.getAttribute("data-svg-target").split(" "),e=0;e<t.length;e+=1)"kresleni"===t[e]?this._initPath():"znacky"===t[e]&&this._initCircle();this._setSize(),this._initComicBubbles()}},{key:"_setSize",value:function(){var t=this.target.getAttribute("viewBox").split(" "),e=this.target.getBoundingClientRect().height/t[3];this.target.style.maxWidth=t[2]*e+"px"}},{key:"_initPath",value:function(){var t=this;d3.select(this.target).call(d3.drag().container(function(){return t.target}).subject(function(){var t=[d3.event.x.toFixed(),d3.event.y.toFixed()];return[t,t]}).on("start",function(){x.renderPath(t.target)}))}},{key:"_initCircle",value:function(){var t=this;d3.select(this.target).on("click",function(){"image"===d3.event.target.nodeName&&(x.createCircle(t.target),d3.event.preventDefault())},!1)}},{key:"_initComicBubbles",value:function(){var t=this.target.querySelectorAll(".svg-komiks .svg-textarea");t&&d3.selectAll(t).on("keyup",function(){A.updateTextareaHeight(d3.event.target)})}}],[{key:"selectItem",value:function(t){t.setAttribute("data-svg-selected","true")}},{key:"deselectItem",value:function(){for(var t=document.querySelectorAll('[data-svg-selected="true"]'),e=0;e<t.length;e+=1)t[e].setAttribute("data-svg-selected","false")}},{key:"removeItem",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'[data-svg-selected="true"]';d3.select(t).remove()}},{key:"deactivate",value:function(){for(var t=document.querySelectorAll('[data-svg-active="true"]'),e=0;e<t.length;e+=1)t[e].setAttribute("data-svg-active","false")}},{key:"activate",value:function(t){n.deactivate(),t.setAttribute("data-svg-active","true")}}]),n}(),k=function(){function t(i,n){e(this,t),this.$radialMenu=i,this.$radialMenuItems=this.$radialMenu.querySelectorAll("[data-radial-menu-item]"),this.$colorItems=this.$radialMenu.querySelectorAll(".radial-menu-color"),this.$textItems=this.$radialMenu.querySelectorAll(".radial-menu-text"),this.$createTextItem=this.$radialMenu.querySelector("#create-text"),this.$removeItem=this.$radialMenu.querySelector("#remove-content"),this.$tooltip=this.$radialMenu.querySelector("[data-radial-menu-tooltip]"),this.$svgs=n,this.initialSetUp=!0,this.menuRadius=parseInt(window.getComputedStyle(this.$radialMenu.querySelector(".radial-menu-wrapper"),null).getPropertyValue("width"),10)/2,this.itemRadius=parseInt(window.getComputedStyle(this.$radialMenu.querySelector(".radial-menu-item"),null).getPropertyValue("width"),10)/2,this.init()}return i(t,[{key:"init",value:function(){var t=this;this.setUpRadialMenuItems(),this.addEventListenersToRadialMenu(),Array.from(this.$svgs).forEach(function(e){d3.select(e).on("contextmenu",function(){w.activate(e),w.deselectItem(),t.filterMenuButtons(d3.event.target),t.showRadialMenu(e,d3.event),d3.event.preventDefault()})}),this.initialSetUp=!1}},{key:"setUpRadialMenuItems",value:function(){var t=this;Array.from(this.$radialMenuItems).forEach(function(e){t.addEventListenersToRadialMenuItem(e)})}},{key:"positionRadialMenuItems",value:function(t){var e=t.length,i=this.menuRadius,n=this.itemRadius,a=i-n,s=.6283185307*e/2-.31415926535;Array.from(t).forEach(function(t,e){var n=Math.PI+.6283185307*e*-1+s,r=i*Math.sin(n)+a,o=i*Math.cos(n)+a;t.style.left=r.toFixed(1)+"px",t.style.top=o.toFixed(1)+"px"})}},{key:"addEventListenersToRadialMenu",value:function(){this.onMouseLeave()}},{key:"addEventListenersToRadialMenuItem",value:function(e){var i=this,n=e,a=n.getAttribute("data-radial-menu-item");if("remove-content"===a)n.addEventListener("click",function(){w.removeItem(),i.hideRadialMenu()},!1);else if("create-text"===a)d3.select(n).on("click",function(){A.createText(),i.hideRadialMenu()},!1);else if("color-point-blue"===a)n.addEventListener("click",function(){t.changeColor("blue"),i.hideRadialMenu()},!1);else if("color-point-red"===a)n.addEventListener("click",function(){t.changeColor("red"),i.hideRadialMenu()},!1);else if("color-point-red"===a)n.addEventListener("click",function(){t.changeColor("red"),i.hideRadialMenu()},!1);else if("category"===a){var s=n.getAttribute("data-category"),r=n.getAttribute("data-radial-menu-item-tooltip");n.addEventListener("click",function(){var t=document.querySelector('[data-svg-selected="true"]'),e=t.parentNode,n=e.querySelector(".svg-category-label");t.setAttribute("data-svg-category",s),n||((n=document.createElement("div")).classList.add("svg-category-label"),e.prepend(n)),n.innerText=r,i.hideRadialMenu()},!1)}n.addEventListener("mouseenter",function(t){i.$tooltip.innerHTML=t.currentTarget.getAttribute("data-radial-menu-item-tooltip"),i.$tooltip.style.display="block"},!1),n.addEventListener("mouseleave",function(){i.$tooltip.innerHTML="",i.$tooltip.style.display="none"},!1)}},{key:"showRadialMenu",value:function(t,e){var i=t||document.querySelector('[data-svg-active="true"]'),n=function(t){return{x:t.pageX,y:t.pageY}}(e),a=g(i);this.$radialMenu.setAttribute("data-local-x",a.x),this.$radialMenu.setAttribute("data-local-y",a.y),this.$radialMenu.style.top=n.y-7+"px",this.$radialMenu.style.left=n.x-7+"px";var s=this.$radialMenu.querySelectorAll(".is-active");this.positionRadialMenuItems(s),y(this.$radialMenu,"is-active")}},{key:"hideRadialMenu",value:function(){var t=this;b(this.$radialMenu,"is-active"),w.deactivate(),w.deselectItem(),setTimeout(function(){p(t.$radialMenu,"is-active")||Array.from(t.$radialMenuItems).forEach(function(t){b(t,"is-active")})},150)}},{key:"onMouseLeave",value:function(){var t=this,e=void 0;this.$radialMenu.addEventListener("mouseleave",function(){e=setTimeout(function(){t.hideRadialMenu(t.$radialMenu)},500)}),this.$radialMenu.addEventListener("mouseenter",function(){clearTimeout(e)})}},{key:"filterMenuButtons",value:function(t){(p(t,"svg-path")||"path"===t.nodeName)&&(y(this.$createTextItem,"is-active"),Array.from(this.$colorItems).forEach(function(t){y(t,"is-active")}),Array.from(this.$textItems).forEach(function(t){b(t,"is-active")})),p(t,"svg-circle")&&(y(this.$createTextItem,"is-active"),Array.from(this.$colorItems).forEach(function(t){y(t,"is-active")}),Array.from(this.$textItems).forEach(function(t){b(t,"is-active")})),p(t,"svg-textarea")&&(b(this.$createTextItem,"is-active"),p(t,"do-not-remove")||(Array.from(this.$colorItems).forEach(function(t){b(t,"is-active")}),Array.from(this.$textItems).forEach(function(t){y(t,"is-active")}))),"image"===t.nodeName?(y(this.$createTextItem,"is-active"),b(this.$removeItem,"is-active"),Array.from(this.$colorItems).forEach(function(t){b(t,"is-active")}),Array.from(this.$textItems).forEach(function(t){b(t,"is-active")})):(p(t,"do-not-remove")?b(this.$removeItem,"is-active"):y(this.$removeItem,"is-active"),w.selectItem(t))}}],[{key:"changeColor",value:function(t){var e=document.querySelector('[data-svg-selected="true"]');b(e,"red blue"),y(e,t)}}]),t}(),T=function(){function t(){e(this,t),this._events=[]}return i(t,[{key:"on",value:function(t,e){var i=this;(t=this._split(t)).forEach(function(t){i._events[t]||(i._events[t]=[]),i._events[t].push(e)})}},{key:"off",value:function(t,e){var i=this;(t=this._split(t)).forEach(function(t){i._events[t]&&(i.events[t]=i._events[t].filter(function(t){return t!==e}))})}},{key:"trigger",value:function(t,e){var i=this;(t=this._split(t)).forEach(function(t){i._events[t]&&i._events[t].forEach(function(n){n.call(i,t,e)})})}},{key:"_split",value:function(t){return t.replace(/^\s+|\s+$/g,"").split(/\s+/)}}]),t}(),S={editor:{id:"editor",ADD_TAG:"editor:ADD_TAG",DELETE_TAG:"editor:DELETE_TAG",UPDATE_TAG:"editor:UPDATE_TAG",CHANGE:"editor:CHANGE"},keywords:{id:"keywords",CHANGE:"keywords:CHANGE"},testQuiz:{id:"testQuiz",ADD_ANSWER:"testQuiz:ADD_ANSWER",REMOVE_ANSWER:"testQuiz:REMOVE_ANSWER",UPDATE_ANSWER:"testQuiz:UPDATE_ANSWER",CHANGE:"testQuiz:CHANGE"},textOptions:{id:"textOptions",ADD:"textOptions:ADD",DELETE:"textOptions:DELETE",UPDATE:"textOptions:UPDATE",CHANGE:"textOptions:CHANGE"},store:{id:"store",ADD:"ADD",DELETE:"DELETE",UPDATE:"UPDATE",CHANGE:"CHANGE"}},L=new(function(t){function n(){e(this,n);var t=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._data={},t._data.tags=[],t}return a(n,T),i(n,[{key:"_checkTagExists",value:function(t){var e=!1;return this._data.tags.forEach(function(i,n){i.id===t&&(e={item:i,index:n})}),e}},{key:"addTag",value:function(t){if(0!==this._data.tags.length&&this._checkTagExists(t.id))throw new Error("Tag already exists! Will not add it.");void 0===t.data.userSelectedNodeItems&&(t.data.userSelectedNodeItems=[]),this._data.tags.push(t),L.trigger(S.editor.CHANGE,{action:{id:S.editor.id,type:S.editor.ADD_TAG,data:{tagContainer:t}}})}},{key:"deleteTag",value:function(t){var e=this._checkTagExists(t.id);if(!1!==e)return this._data.tags.splice(e.index,1),L.trigger(S.editor.CHANGE,{action:{id:S.editor.id,type:S.editor.DELETE_TAG,data:{tagContainer:{editorId:t.editorId,id:t.id,tagName:t.tagName,data:{}}}}}),!0;throw new Error("Tag does not exist! Will not delete it.")}},{key:"getAllTags",value:function(t){return void 0!==t&&t.editorId?this._data.tags.filter(function(e){return e.editorId===t.editorId}):this._data.tags}},{key:"getTagsBy",value:function(t){return void 0!==t&&(-1!==["editorId","id","tagName"].indexOf(t.key)&&(Array.isArray(t.value)||(t.value=[t.value]),console.log(t.value),console.log(this._data.tags),this._data.tags.filter(function(e){return e[t.key]===t.value[0]||e[t.key]===t.value[1]})))}},{key:"getLastTag",value:function(t){if(void 0===t||!t.editorId)return this._data.tags[this._data.tags.length-1];var e=this._data.tags.filter(function(e){return e.editorId===t.editorId});return e[e.length-1]}}]),n}()),N=new(function(t){function n(){e(this,n);var t=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._data=[],t}return a(n,T),i(n,[{key:"_checkExists",value:function(t){var e=!1;return this._data.forEach(function(i,n){i.id===t&&(e={item:i,index:n})}),e}},{key:"add",value:function(t){if(0!==this._data.length&&this._checkExists(t.id))throw new Error("Object already exists! Will not add it.");this._data.push(t),N.trigger(S.textOptions.id,{action:{type:S.textOptions.ADD},data:t})}},{key:"delete",value:function(t){var e=this._checkExists(t.id);if(!1!==e)return this._data.splice(e.index,1),N.trigger(S.textOptions.id,{action:{type:S.textOptions.DELETE},data:t}),!0;throw new Error("Tag does not exist! Will not delete it.")}},{key:"getAll",value:function(t){return void 0!==t&&t.editor?this._data.filter(function(e){return e.id===t.id}):this._data}},{key:"getBy",value:function(t){return void 0!==t&&-1!==["id"].indexOf(t.key)&&(Array.isArray(t.value)||(t.value=[t.value]),this._data.filter(function(e){return e[t.key]===t.value[0]||e[t.key]===t.value[1]}))}},{key:"getLast",value:function(t){if(void 0===t||!t.editor)return this._data[this._data.length-1];var e=this._data.filter(function(e){return e.id===t.id});return e[e.length-1]}}]),n}()),M=function(){function t(i){e(this,t),this.$editor=i,this.id=this.$editor.id,this.settings=JSON.parse(document.querySelector('[data-editor-id-reference="'+this.id+'"]').getAttribute("data-module-settings")),this.opts=function t(e,i){var a=Object.assign({},e);return d(e)&&d(i)&&Object.keys(i).forEach(function(s){d(i[s])&&s in e?a[s]=t(e[s],i[s]):Object.assign(a,n({},s,i[s]))}),a}(t.defaults,this.settings),this.models={passive:["cteni"],interactive:["predznaceny","zvyraznovani","komentáře","psani"],withMenu:["predznaceny","zvyraznovani","komentáře"]},this.totalTagId=0,this.hasMenu=!0,this.selection=null,this.lastSelectionSettings={},this.isCollapsed=null,this.savedSelectionRange=null,this.selectionAttributes=null,this.dummyRangeElement=null,this.selectionMouseDown=!1,this.selectionDirection=null,this.hasEditableContentChanged=!1,this.lastPressedKey=null,this.hasToolbar=!1,this.toolbar={},this.originalContent={},this.currentContent={},this._handlers=[],this.wrapLastDeletesTimeoutClass="",this.wrapLastDeletesTimeoutFunction=function(){},this.wrapLastAdditionsTimeoutClass="",this.wrapLastAdditionsTimeoutFunction=function(){},this.isWrappingLastText=!1,this.cache={body:document.body,window:window},this.init()}return i(t,[{key:"init",value:function(){if(t._hasMenu(this.opts))try{this.$menu=this.$editor.getElementsByClassName(this.opts.menuClass)[0],this.$menuActions=this.$menu.getElementsByClassName("menu")[0].getElementsByClassName("menu-item"),this.$menuClose=this.$menu.getElementsByClassName("close")[0]}catch(t){this.hasMenu=!1}else this.hasMenu=!1;t._hasToolbar(this.opts)&&(this.hasToolbar=!0),this.$canvas=this.$editor.getElementsByClassName(this.opts.canvasClass)[0],"cteni"!==this.opts.funkce&&(y(this.$menu,"hidden"),"psani"===this.opts.funkce&&(this.originalContent.html=this.$canvas.innerHTML,this.originalContent.text=this.$canvas.innerText,this.currentContent.html=this.$canvas.innerHTML,this.currentContent.text=this.$canvas.innerText,this.wrapLastDeletesTimeoutClass=this._generateNewTagGroupClass(),this.wrapLastAdditionsTimeoutClass=this._generateNewTagGroupClass()),this.hasToolbar&&(this.toolbar.$element=this.$editor.getElementsByClassName("editor-toolbar")[0],this.toolbar.$btnReset=this.toolbar.$element.getElementsByClassName("editor-toolbar-action-reset")[0]),this.registerEditableHandlers()),"predznaceny"===this.opts.funkce&&this.initPreHighlightedTextOptions()}},{key:"_generateNewTagId",value:function(){return this.totalTagId=this.totalTagId+1,this.id+"-"+this.totalTagId}},{key:"_generateNewTagGroupClass",value:function(){return this.totalTagId=this.totalTagId+1,"group-"+this.id+"-"+this.totalTagId}},{key:"registerEditableHandlers",value:function(){var t=this;this.$canvas.addEventListener("mousedown",this.handlerFocus.bind(this),!1),this.$canvas.addEventListener("focusout ",this.handlerFocus.bind(this),!1),this.cache.body.addEventListener("mouseup",this.handlerFocus.bind(this),!1),"psani"===this.opts.funkce&&this.$canvas.addEventListener("keydown",function(e){var i,n=e.which||e.keyCode,a=e.key;if("Backspace"===a||"Delete"===a){var s=window.getSelection();if(s.rangeCount){window.clearTimeout(t.wrapLastDeletesTimeoutFunction);var r=s.getRangeAt(0),o=r.cloneRange();if(t.lastSelectionSettings.isCollapsed)try{o.setStart(r.startContainer,r.startOffset-1)}catch(e){o.setStart(r.startContainer,r.startOffset),o.collapse(!0)}else o.setStart(r.startContainer,r.startOffset);o.setEnd(r.endContainer,r.endOffset);var l=o.cloneContents().textContent.trim();if(""!==l&&"&nbsp;"!==l||t.isWrappingLastText){var d=document.createElement("span");d.className="user-removed-text-inner "+t.wrapLastDeletesTimeoutClass,o.surroundContents(d),s.removeAllRanges(),s.addRange(r),t.wrapLastDeletesTimeoutFunction=setTimeout(function(){t.isWrappingLastText=!1;var e=document.createElement("span");e.contentEditable=!1,e.className="user-removed-text";var i=t._generateNewTagId();e.id=i;var n=Array.from(document.getElementsByClassName(t.wrapLastDeletesTimeoutClass));c(e,n[0]),n.forEach(function(t,i){e.appendChild(t)});var a=document.createElement("span");a.className=t.opts.closeBtnClass;a.addEventListener("click",function e(i){var n=i.currentTarget,a=n.parentNode;n.removeEventListener("click",e),a.removeChild(n),t._removeSurroundingNode(a),i.stopPropagation()}.bind(t)),document.getElementById(i).appendChild(a),t.wrapLastDeletesTimeout=!0,t.wrapLastDeletesTimeoutClass=t._generateNewTagGroupClass()},700),t.isWrappingLastText=!0,e.preventDefault()}else{if(!t.isWrappingLastText)return;e.preventDefault()}}}else if((i=n)>47&&i<58||32==i||13==i||i>64&&i<91||i>95&&i<112||i>185&&i<193||i>218&&i<223){var h=window.getSelection();if(t.lastSelectionSettings.isCollapsed){if(32===n){if(!t.isWrappingLastText)return;a=" "}if(h.rangeCount){window.clearTimeout(t.wrapLastAdditionsTimeoutFunction);var g=h.getRangeAt(0),m=g.cloneRange();try{m.setStart(g.startContainer,g.startOffset-1)}catch(e){m.setStart(g.startContainer,g.startOffset),m.collapse(!0)}m.setStart(g.startContainer,g.startOffset),m.setEnd(g.endContainer,g.endOffset);var v=document.createElement("span");v.contentEditable=!1,v.className="user-inserted-text-inner "+t.wrapLastAdditionsTimeoutClass,v.innerHTML=a,m.insertNode(v),g.setStartAfter(v),h.removeAllRanges(),h.addRange(g),t.wrapLastAdditionsTimeoutFunction=setTimeout(function(){t.isWrappingLastText=!1;var e=document.createElement("span");e.contentEditable=!1,e.className="user-inserted-text";var i=t._generateNewTagId();e.id=i;var n=Array.from(document.getElementsByClassName(t.wrapLastAdditionsTimeoutClass));c(e,n[0]),n.forEach(function(t,i){e.appendChild(t)});var a=document.createElement("span");a.className=t.opts.closeBtnClass;a.addEventListener("click",function t(e){var i=e.currentTarget,n=i.parentNode;i.removeEventListener("click",t),u(n),e.stopPropagation()}.bind(t)),document.getElementById(i).appendChild(a),t.wrapLastAdditionsTimeoutClass=t._generateNewTagGroupClass()},700),t.isWrappingLastText=!0}!1===t.hasEditableContentChanged&&(t.hasEditableContentChanged=!0),e.preventDefault()}else if(h.rangeCount){var f=h.getRangeAt(0),p=f.cloneRange();p.setStart(f.startContainer,f.startOffset),p.setEnd(f.endContainer,f.endOffset);var y=document.createElement("span");y.contentEditable=!1,y.className="user-removed-text";var b=t._generateNewTagId();y.id=b;var E=document.createElement("span");E.className="user-removed-text-inner",y.appendChild(E),p.surroundContents(y);var _=document.createElement("span");_.className=t.opts.closeBtnClass;_.addEventListener("click",function e(i){var n=i.currentTarget,a=n.parentNode;n.removeEventListener("click",e),a.removeChild(n),t._removeSurroundingNode(a),i.stopPropagation()}.bind(t)),document.getElementById(b).appendChild(_),window.clearTimeout(t.wrapLastAdditionsTimeoutFunction);var C=document.createElement("span");C.contentEditable=!1,C.className="user-inserted-text-inner "+t.wrapLastAdditionsTimeoutClass,C.innerHTML=a+" ",c(C,y),f.setStartAfter(C),h.removeAllRanges(),h.addRange(f),t.wrapLastAdditionsTimeoutFunction=setTimeout(function(){var e=document.createElement("span");e.contentEditable=!1,e.className="user-inserted-text";var i=t._generateNewTagId();e.id=i;var n=Array.from(document.getElementsByClassName(t.wrapLastAdditionsTimeoutClass));c(e,n[0]),n.forEach(function(t,i){e.appendChild(t)});var a=document.createElement("span");a.className=t.opts.closeBtnClass;a.addEventListener("click",function t(e){var i=e.currentTarget,n=i.parentNode;i.removeEventListener("click",t),u(n),e.stopPropagation()}.bind(t)),document.getElementById(i).appendChild(a),t.wrapLastAdditionsTimeoutClass=t._generateNewTagGroupClass()},700),e.preventDefault()}}}),this.hasMenu&&this.registerMenuHandler(),this.hasToolbar&&this.toolbar.$btnReset.addEventListener("click",function(){confirm("Opravdu chcete vrátit text do původní podoby? Vaše změny se tímto ztratí.")&&(t.$canvas.innerHTML=t.originalContent.html)})}},{key:"registerMenuHandler",value:function(){for(var t=0,e=this.$menuActions.length;t<e;t+=1)this.$menuActions[t].addEventListener("click",this.handlerMenuActions.bind(this),!1);this.$menuClose.addEventListener("click",this.handlerMenuClose.bind(this),!1)}},{key:"initPreHighlightedTextOptions",value:function(){var t=this,e="data-text-option",i=this.opts.predznaceni,n=this.$editor.querySelector(".canvas"),a=n.innerHTML,s=new RegExp("&nbsp;","g");a=a.replace(s," "),i.forEach(function(i,n){var s=Object.assign({text:t.opts.nazev},i),r=new RegExp(i.vyraz,"i");a=a.replace(r,'<span class="text-option" id="'+t.id+"-text-option-"+n+'" '+e+"='"+JSON.stringify(s)+"'>"+i.vyraz+"</span>")}),n.innerHTML=a,this.$textOptionsElements=this.$editor.querySelectorAll("["+e+"]"),Array.from(this.$textOptionsElements).forEach(function(i){i.addEventListener("click",function(){f(i,t.opts.textOptions.selectedClass),p(i,t.opts.textOptions.selectedClass)?N.add({editor:t.id,id:i.id,tag:i,data:JSON.parse(i.getAttribute(e))}):N.delete({editor:t.id,id:i.id})})})}},{key:"toggleMenu",value:function(){!0!==(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&!0!==this.selectionMouseDown?p(this.$menu,"hidden")&&!1===this.selectionMouseDown&&(this._setmenuDimensions(),b(this.$menu,"hidden")):y(this.$menu,"hidden")}},{key:"_setmenuDimensions",value:function(){var t=function(t){var e,i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=t.cloneNode(!0);a.style.visibility="hidden",a.style.display="block",e=a,(i=t).parentNode.insertBefore(e,i.nextSibling);var s=a.getBoundingClientRect(),r=n?m(a):v(a);return u(a),{width:s.width,height:s.height,top:r.top,left:r.left}}(this.$menu),e=m(this.$editor),i=v(this.$editor),n=this.selectionAttributes.left+this.selectionAttributes.width+t.width+this.opts.menuMargin.x>e.left+i.width,a=this.selectionAttributes.top-t.height-this.opts.menuMargin.y<e.top,s=(this.selectionAttributes.top,this.selectionAttributes.height,t.height,this.opts.menuMargin.y,e.top,i.height,void 0),r=void 0;s=n?this.selectionAttributes.left-t.width-this.opts.menuMargin.x:this.selectionAttributes.left+this.selectionAttributes.width+this.opts.menuMargin.x,r=a?this.selectionAttributes.top+t.height+this.opts.menuMargin.y:this.selectionAttributes.top-t.height-this.opts.menuMargin.y,this.$menu.style.left=s+"px",this.$menu.style.top=r+"px"}},{key:"handlerMenuClose",value:function(t){this.toggleMenu(!0),t.preventDefault()}},{key:"handlerMenuActions",value:function(t){var e=t.currentTarget,i=e.getAttribute("data-command"),n=e.getAttribute("data-command-name"),a=JSON.parse(e.getAttribute("data-command-options"));this.setSelection(i,n,a),t.preventDefault()}},{key:"handlerFocus",value:function(t){3===t.which||p(t.target,"node-close")||p(t.target,"node-selected")||("mousedown"===t.type&&(this.selectionMouseDown=!0,!0===this.hasMenu&&this.toggleMenu()),"mouseup"===t.type&&this.selectionMouseDown&&(this.lastSelectionSettings={},this.selection=window.getSelection(),this.isCollapsed=this.lastSelectionSettings.isCollapsed=this.selection.isCollapsed,this.savedSelectionRange=this.selection.getRangeAt(0),this.selectionMouseDown=!1,this.lastSelectionSettings.anchorOffset=this.selection.anchorOffset,this.lastSelectionSettings.focusOffset=this.selection.focusOffset,this.lastSelectionSettings.text=this.savedSelectionRange.toString(),!1===this.selection.isCollapsed&&""!==this.savedSelectionRange.toString().trim()&&(this.selectionDirection=this.selection.anchorOffset<=this.selection.focusOffset?"right":"left",!0===this.hasMenu&&(this._setSelectionPosition(),this.toggleMenu()))))}},{key:"_setSelectionPosition",value:function(){var t=document.createElement("span");t.className="dummy-range-element",this.savedSelectionRange.surroundContents(t);var e=m(t),i=v(t);this.selectionAttributes={left:e.left,top:e.top,width:i.width,height:i.height},b(t,"dummy-range-element"),this._removeSurroundingNode(t)}},{key:"_extractAndSaveContents",value:function(t){t.appendChild(this.savedSelectionRange.extractContents()),this.savedSelectionRange.insertNode(t);var e=t.getAttribute("data-command-name"),i=this._generateNewTagId();t.setAttribute("data-tag-id",i),L.addTag({editor:this.id,id:i,tag:t,tagName:e,data:{}})}},{key:"_removeSurroundingNode",value:function(t){var e=t.textContent;t.parentNode.insertBefore(document.createTextNode(e),t),u(t)}},{key:"_createCloseBtnForElement",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement("span");n.setAttribute("class",i.class);i.toggleClass.split(" ");n.addEventListener("click",function t(i){var n=i.currentTarget,a=n.parentNode;n.removeEventListener("click",t),a.removeChild(n),void 0!==a.commentRef&&(e.$editor.removeChild(a.commentRef),a.commentRef=null),e._removeSurroundingNode(a);var s=a.getAttribute("data-command-name");L.deleteTag({editor:e.id,id:a.getAttribute("data-tag-id"),tag:a,tagName:s,data:{}}),i.stopPropagation()}.bind(this)),t.appendChild(n)}},{key:"_calculateCommentPosition",value:function(t){var e=m(t);return{left:e.left+parseInt(t.offsetWidth,10)+this.opts.commentMargin.x+"px",top:e.top+this.opts.commentMargin.y+"px"}}},{key:"_createCommentForNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=document.getElementById("comment-template").innerHTML,n=document.createElement("div");n.innerHTML=i;var a=n.childNodes[1];a.data={},a.data.nodeRef=t;var s=a.getElementsByClassName("comment-new-text")[0],r=a.getElementsByTagName("button")[0],o=a.getElementsByClassName("comments-container")[0],l=this._calculateCommentPosition(t);a.style.left=l.left,a.style.top=l.top,y(a,e.class),a.addEventListener("click",function(e){p(e.target,"close")&&(y(a,"hidden"),b(t,"active"))}),r.addEventListener("click",function(t){if(""!==s.value){var e=document.createElement("div");e.className="comment-item",e.innerText=s.value,o.appendChild(e),s.value=""}}),this.$editor.append(a),y(t,"comment-created"),t.commentRef=a}},{key:"_addCommentHandlerForElement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(t,"has-comments"),t.addEventListener("click",function(i){if(!p(i.target,"node-close")){if(p(t,"comment-created")){var n=this._calculateCommentPosition(t);t.commentRef.style.left=n.left,t.commentRef.style.top=n.top,b(t.commentRef,"hidden")}else this._createCommentForNode(t,e);p(t,"active")?(b(t,"active"),y(t.commentRef,"hidden")):y(t,"active")}i.stopPropagation()}.bind(this))}},{key:"setSelection",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.selection){if("toggle-class"===t){var n=document.createElement("span");n.setAttribute("class",i.toggleClass),n.setAttribute("data-command-name",e),!0===i.closeBtn&&this._createCloseBtnForElement(n,{class:"node-close",toggleClass:i.toggleClass}),!0===i.comments&&this._addCommentHandlerForElement(n,{class:i.commentsClass}),this._extractAndSaveContents(n),!0===i.showCommentsOnInit&&n.click()}this.toggleMenu(!0)}}}]),t}();M.defaults={menuClass:"contextual-menu-component",canvasClass:"canvas",resetBtnClass:"reset",closeBtnClass:"node-close",nodeSelectedClass:"node-selected",commentMargin:{x:50,y:0},menuMargin:{x:15,y:15},textOptions:{enable:!1,animatedClass:"active",selectedClass:"selected",deselectedClass:"deselected"}},M._hasMenu=function(t){return"cteni"!==t.funkce&&"psani"!==t.funkce&&!1!==t.menu&&void 0!==t.menu},M._hasToolbar=function(t){return"psani"===t.funkce||!1!==t.toolbar&&void 0!==t.toolbar};var R=function(){function t(i,n,a){e(this,t),this.id=i,this.$element=n,this.opts=Object.assign({},t.defaults,a),this.isAdvanced=this.opts.isAdvanced,this.rowIndex=0,this.tableResult=this.$element.getElementsByClassName("table-result")[0],this.tableResultBody=this.tableResult.getElementsByClassName("table-body")[0],this.tableSelectedItems=this.$element.getElementsByClassName("table-selected-items")[0],this.tableSelectedItemsBody=this.tableSelectedItems.getElementsByClassName("table-body")[0],this.activeDragged=null,this._getRowHTML=this.isAdvanced?t._getAdvancedRowHTML:t._getRowHTML}return i(t,[{key:"init",value:function(){this._registerStoreHandlers(this.tableResultBody,this.tableSelectedItemsBody),this._registerHandlers()}},{key:"_registerStoreHandlers",value:function(t,e){var i=this;L.on(S.editor.CHANGE,function(n,a){var s=a.action,r=void 0,o=void 0;switch(s.type){case S.editor.ADD_TAG:switch((r=s.data.tagContainer).tagName){case i.opts.casti[1].sloupce[0].tag:if(t.insertAdjacentHTML("beforeend",i._getRowHTML(h(r.tag),r.id)),!i.opts.letSecondCaseRunIfSame&&i.opts.casti[1].sloupce[0].tag!==i.opts.casti[1].sloupce[1].tag)break;case i.opts.casti[1].sloupce[1].tag:(o=r.tag.cloneNode(!0)).setAttribute("draggable",!0),o.addEventListener("click",i._handlerDraggable.bind(i),!1),o.addEventListener("dragstart",i._handlerDraggable.bind(i),!1),o.addEventListener("dragend",i._handlerDraggable.bind(i),!1),o.addEventListener("drag",i._handlerDraggable.bind(i),!1),e.appendChild(o)}break;case S.editor.DELETE_TAG:r=s.data.tagContainer,Array.prototype.forEach.call(document.querySelectorAll('[data-tag-id="'+r.id+'"]'),function(t){p(t.parentNode,"cell-read-only")?u(t.parentNode.parentNode):u(t)})}})}},{key:"_registerHandlers",value:function(){this.$element.addEventListener("dragover",this._handlerDrop.bind(this),!1),this.$element.addEventListener("dragleave",this._handlerDrop.bind(this),!1),this.$element.addEventListener("drop",this._handlerDrop.bind(this),!1)}},{key:"_handlerDraggable",value:function(t){return"dragstart"===t.type&&(t.dataTransfer.setData("text/plain","node"),t.dataTransfer.dropEffect="",t.target.style.opacity=.5,this.activeDragged=t.target.cloneNode(!0)),"dragend"===t.type&&(t.target.style.opacity=1),!1}},{key:"_handlerDrop",value:function(t){return p(t.target,"dashboard-canvas-widget-content")&&("dragover"===t.type&&(t.preventDefault(),t.dataTransfer.dropEffect="",t.target.style.background="#eee"),"dragleave"===t.type&&(t.target.style.background="#fff"),"drop"===t.type&&(t.preventDefault(),t.target.style.background="#fff",this.activeDragged.style.opacity=1,this.activeDragged.addEventListener("click",function(t){p(t.target,"node-close")&&t.target.parentNode.remove()}),t.target.appendChild(this.activeDragged))),!1}}]),t}();R.defaults={isAdvanced:!1},R._getRowHTML=function(t){return'\n    <div class="table-row">\n      <div class="cell cell-read-only cell-border-right">'+t+'</div>\n      <div class="cell dashboard-canvas-widget-content"></div>\n    </div>\n  '},R._getAdvancedRowHTML=function(t){return'\n    <div class="table-row">\n      <div class="cell cell-read-only cell-border-right">'+t+'</div>\n      <div class="cell dashboard-canvas-widget-content cell-border-right"></div>\n      <div class="cell table-input">\n        <input id="table-akteri-vztahy-input-'+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)+'" data-input-target="" data-save="value" type="text" placeholder="Vztah aktérů…" tabindex="-1">\n      </div>\n    </div>\n  '};var $=new(function(t){function n(){e(this,n);var t=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._data={},t}return a(n,T),i(n,[{key:"change",value:function(t,e,i){this._data[t]||(this._data[t]={}),this._data[t].items=e,this._data[t].itemsHTML=i,$.trigger(S.keywords.CHANGE,{action:{id:S.keywords.id,type:S.keywords.CHANGE,data:{keywordsSelectionId:t,newItems:e,newItemsHTML:i}}})}},{key:"export",value:function(){return this._data}}]),n}()),I=function(){function t(i,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e(this,t),this.id=i,this.$element=n,this.opts=Object.assign({},t.defaults,a),this.$itemsContainer=this.$element.getElementsByClassName(this.opts.itemsContainerClassName)[0],this.opts.inherit&&this.opts.inherit.from.length>0?this.isInherited=!0:this.$items=this.$element.getElementsByClassName(this.opts.itemClassName)}return i(t,[{key:"init",value:function(){this.opts.import&&this.opts.import.length>0&&(this.$itemsContainer.innerHTML=t._getHTMLFromItems(this.opts.import)),$.change(this.id,t._getItemsFromHTML(this.$itemsContainer,this.opts.itemClassName),t._getItemsHTML(this.$itemsContainer)),this.isInherited&&(this.opts.inherit.onInit&&this._regenerateItemsContainerFromInherited(),this._registerStoreHandlers()),this._registerHandlers()}},{key:"_regenerateItemsContainerFromInherited",value:function(){var e=this,i="";this.opts.inherit.from.forEach(function(n){var a=document.getElementById(n).getElementsByClassName(e.opts.itemsContainerClassName)[0].innerHTML;i+=t.renameItemsIds(n,e.id,a)}),this.$itemsContainer.innerHTML=i,this.$items=this.$element.getElementsByClassName(this.opts.itemClassName),$.change(this.id,t._getItemsFromHTML(this.$itemsContainer,this.opts.itemClassName),t._getItemsHTML(this.$itemsContainer))}},{key:"_registerHandlers",value:function(){var t=this;Array.from(this.$element.getElementsByClassName(this.opts.itemClassName)).forEach(function(e){e.addEventListener("click",t._eventHandler.bind(t),!1)})}},{key:"_registerStoreHandlers",value:function(){var t=this;$.on(S.keywords.CHANGE,function(e,i){var n=i.action,a=i.action.data;switch(n.type){case S.keywords.CHANGE:t.opts.inherit.from.indexOf(a.keywordsSelectionId)>-1&&(t._regenerateItemsContainerFromInherited(),t._registerHandlers())}})}},{key:"_eventHandler",value:function(e){"click"===e.type&&(f(e.target,"disabled"),$.change(this.id,t._getItemsFromHTML(this.$itemsContainer,this.opts.itemClassName),t._getItemsHTML(this.$itemsContainer)))}}]),t}();I._getItemFromDOMElement=function(t){return{class:t.className,id:t.getAttribute("id"),text:t.innerText}},I._getItemsHTML=function(t){return t.innerHTML},I._getItemsFromHTML=function(t,e){var i=t.getElementsByClassName(e),n=[];return Array.from(i).forEach(function(t){n.push(I._getItemFromDOMElement(t))}),n},I._getDOMElementFromItem=function(t){var e=document.createElement("div");return e.setAttribute("class",t.class),e.setAttribute("id",t.id),e.innerHTML=t.text,h(e)},I._getHTMLFromItems=function(t){var e="";return t.forEach(function(t){e+=I._getDOMElementFromItem(t)}),e},I.renameItemsIds=function(t,e,i){var n=new RegExp(t,"g");return i.replace(n,e)},I.defaults={itemClassName:"keyword-item",itemsContainerClassName:"keywords-selection-items-container"};var D=function(){function t(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this.$element=i,this.id=this.$element.getAttribute("id"),this.opts=Object.assign({},t.defaults,n),this.commandNames=JSON.parse(this.$element.getAttribute(this.opts.itemSubscribeAttributeClassName)),this.$itemsContainer=this.$element.getElementsByClassName(this.opts.itemsContainerClassName)[0]}return i(t,[{key:"init",value:function(){this._registerStoreHandlers()}},{key:"_registerStoreHandlers",value:function(){var t=this;L.on(S.editor.CHANGE,function(e,i){i.action;var n=i.action.data.tagContainer;if(t.commandNames.indexOf(n.tagName)>-1){var a="";L.getTagsBy({key:"tagName",value:t.commandNames}).forEach(function(t){a+=h(t.tag)}),t.$itemsContainer.innerHTML=a}})}}]),t}();D.defaults={itemsContainerClassName:"editor-tags-placeholder-content",itemSubscribeAttributeClassName:"data-placeholder-editor-subscribe"};var O=function(){function t(i,n,a){e(this,t),this.id=i,this.$element=n,this.opts=Object.assign({},t.defaults,a),this.$items=this.$element.getElementsByClassName(this.opts.itemClass)}return i(t,[{key:"init",value:function(){this._registerHandlers()}},{key:"_registerHandlers",value:function(){var t=this;Array.from(this.$items).forEach(function(e){var i=Array.from(e.getElementsByClassName(t.opts.optionClass));i.forEach(function(e){e.addEventListener("click",function(e){var n=e.currentTarget;i.forEach(function(e){e.isSameNode(n)||b(e,t.opts.selectedClass)}),f(n,t.opts.selectedClass)},!1)})})}}]),t}();O.defaults={itemClass:"test-quiz-item",optionClass:"option",selectedClass:"selected"};var B=function(){function t(i,n,a){e(this,t),this.id=i,this.$target=n,this.opts=Object.assign({},t.defaults,a),this.rowIndex=0,this.$tableResultBody=this.$target.getElementsByClassName("table-body")[0],this.dataSettings=this.opts.data}return i(t,[{key:"init",value:function(){"store"===this.dataSettings.source&&this._registerStoreHandlers()}},{key:"_registerStoreHandlers",value:function(){var e=this;N.on(this.dataSettings.subscribe.join(" "),function(i,n){var a=n.action,s=n.data;switch(a.type){case S[i].ADD:e.$tableResultBody.insertAdjacentHTML("beforeend",t._getRowHTML(s));break;case S[i].DELETE:u(document.getElementById(s.id+"_table"))}})}}]),t}();B.defaults={},B._getRowHTML=function(t){return'\n    <div class="table-row" id="'+t.id+'_table">\n      <div class="cell">'+t.data.text+'</div>\n      <div class="cell">'+t.data.vyraz+'</div>\n      <div class="cell">\n        <select id="'+t.id+'-select-osoba" name="osoba" data-save="value">\n          <option>Vyberte osobu</option>\n          <option>já</option>\n          <option>ty</option>\n          <option>on/ona/ono</option>\n          <option>my</option>\n          <option>vy</option>\n          <option>oni/ony/ona</option>\n          <option>infinitiv</option>\n        </select>\n      </div>\n      <div class="cell">\n        <select id="'+t.id+'-select-zpusob" name="zpusob" data-save="value">\n          <option>Vyberte způsob</option>\n          <option>oznamovací</option>\n          <option>podmiňovací</option>\n          <option>rozkazovací</option>\n          <option id="select-zpusob-infinitiv">infinitiv</option>\n        </select>\n      </div>\n    </div>\n  '};document.addEventListener("DOMContentLoaded",function(){console.log("domLoad:components")},!1),window.addEventListener("load",function(){console.log("windowLoad:components");var t=document.querySelectorAll("[data-editor]");t.length>0&&Array.from(t).forEach(function(t){new M(t)});var e=document.querySelectorAll("[data-target-test-quiz]");e.length>0&&Array.from(e).forEach(function(t){var e=document.querySelector('[data-test-quiz-id-reference="'+t.getAttribute("data-test-quiz-id")+'"]');new O(t.getAttribute("data-test-quiz-id"),t,JSON.parse(e.getAttribute("data-module-settings"))).init()});var i=document.querySelectorAll("[data-target-analytical-table]");i.length>0&&Array.from(i).forEach(function(t){var e=document.querySelector('[data-analytical-table-id-reference="'+t.getAttribute("data-analytical-table-id")+'"]');new R(t.getAttribute("data-analytical-table-id"),t,JSON.parse(e.getAttribute("data-module-settings"))).init()});var n=document.querySelectorAll("[data-target-generic-table]");n.length>0&&Array.from(n).forEach(function(t){var e=document.querySelector('[data-generic-table-id-reference="'+t.getAttribute("data-generic-table-id")+'"]');new B(t.getAttribute("data-generic-table-id"),t,JSON.parse(e.getAttribute("data-module-settings"))).init()});var a=document.querySelectorAll("[data-lupa-target]");if(a.length>0)for(var s=0;s<a.length;s+=1)new l(a[s]);var r=document.querySelectorAll("[data-photo-detail-target]");if(r.length>0)for(var o=0;o<r.length;o+=1)new E(r[o]);var d=document.querySelectorAll("[data-svg-target]");if(d.length>0){var c=document.querySelector("[data-radial-menu]");c&&new k(c,d);for(var u=0;u<d.length;u+=1)new w(d[u])}var h=document.querySelectorAll("[data-sortable-target]");if(h.length>0)for(var g=0;g<h.length;g+=1)new _(h[g]);var m=document.querySelectorAll("[data-keywords-selection]");m.length>0&&Array.from(m).forEach(function(t){var e=t.hasAttribute("data-module-settings")?t.getAttribute("data-module-settings"):{};new I(t.getAttribute("id"),t,JSON.parse(e)).init()});var v=document.querySelectorAll(".editor-tags-placeholder");v.length>0&&Array.from(v).forEach(function(t){var e=new D(t);console.log(e),e.init()})},!1)}();
//# sourceMappingURL=components.build.js.map
