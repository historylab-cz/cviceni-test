!function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?l(t):e}function c(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u=function t(n){e(this,t),this.target=n},h=function(t){function n(t){var i;return e(this,n),(i=d(this,o(n).call(this,t))).element=document.querySelector("[data-lupa]"),i.canvas=document.querySelector("[data-lupa-canvas]"),i.ctx=i.canvas.getContext("2d"),i._onStart=i._onStart.bind(l(l(i))),i._onMove=i._onMove.bind(l(l(i))),i._onEnd=i._onEnd.bind(l(l(i))),i._update=i._update.bind(l(l(i))),i._onResize=i._onResize.bind(l(l(i))),i.zoomGlassSize=230,i.targetBCR=null,i.zoomed=0,i.targetZoomed=0,i.x=0,i.y=0,i.trackingTouch=!1,i._addEventListeners(),i._initCanvas(),i._onResize(),window.requestAnimationFrame(i._update),i}return s(n,u),i(n,[{key:"_initCanvas",value:function(){var t=this.zoomGlassSize,e=this.zoomGlassSize,n=window.devicePixelRation||1;this.canvas.width=t*n,this.canvas.height=e*n,this.canvas.style.width="".concat(t,"px"),this.canvas.style.height="".concat(e,"px"),this.ctx.scale(n,n)}},{key:"_onResize",value:function(){this.targetBCR=this.target.getBoundingClientRect()}},{key:"_onStart",value:function(t){t.target===this.target&&(t.preventDefault(),this.x=t.pageX||t.touches[0].pageX,this.y=t.pageY||t.touches[0].pageY,this.trackingTouch=!0,this.targetZoomed=1,this.zoomed=0,window.requestAnimationFrame(this._update))}},{key:"_onMove",value:function(t){this.trackingTouch&&(this.x=t.pageX||t.touches[0].pageX,this.y=t.pageY||t.touches[0].pageY)}},{key:"_onEnd",value:function(){this.targetZoomed=0,this.trackingTouch=!1}},{key:"_update",value:function(){var t=2*Math.PI,e=100*this.zoomed;this.targetBCR=this.target.getBoundingClientRect();var n=Math.max(0,Math.min(1,(this.x-this.targetBCR.left)/this.targetBCR.width)),i=Math.max(0,Math.min(1,(this.y-this.targetBCR.top)/this.targetBCR.height)),a=2.5*this.targetBCR.width,s=2.5*this.targetBCR.height;platform.os.family.indexOf("Windows")>-1&&platform.name.indexOf("Firefox")>-1||(this.ctx.shadowColor="rgba(0,0,0,0.4)",this.ctx.shadowBlur=12,this.ctx.shadowOffsetY=8),this.ctx.clearRect(0,0,this.zoomGlassSize,this.zoomGlassSize),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(this.zoomGlassSize/2,this.zoomGlassSize-10-e,e,0,t),this.ctx.closePath(),this.ctx.fill(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.zoomGlassSize/2,this.zoomGlassSize-10-(e+1),1.03*e,0,t),this.ctx.clip(),this.ctx.closePath(),this.ctx.drawImage(this.target,-n*a+this.zoomGlassSize/2,-i*s+this.zoomGlassSize/2,a,s),this.ctx.restore(),this.element.style.transform="translate(".concat(this.x,"px, ").concat(this.y,"px)"),this.zoomed+=(this.targetZoomed-this.zoomed)/4,this.zoomed>.001?window.requestAnimationFrame(this._update):this.zoomed=0}},{key:"_addEventListeners",value:function(){document.addEventListener("touchstart",this._onStart),document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onEnd),document.addEventListener("mousedown",this._onStart),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onEnd),window.addEventListener("resize",this._onResize)}}]),n}();function g(e){return e&&"object"===t(e)&&!Array.isArray(e)}function m(t,e){e.parentNode.insertBefore(t,e)}function v(t){t.parentNode.removeChild(t)}function f(t){if(t&&t.tagName){if(t.outerHTML)return t.outerHTML;var e=document.createElement("div");return e.appendChild(t.cloneNode(!0)),e.innerHTML}}function p(t){var e=d3.mouse(t);return{x:d3.format(".0f")(e[0]),y:d3.format(".0f")(e[1])}}function y(t){var e=new WebKitCSSMatrix(window.getComputedStyle(t).webkitTransform),n=document.body;window.pageYOffset||n.scrollTop,window.pageXOffset||n.scrollLeft;return{left:t.offsetLeft+e.m41,top:t.offsetTop+e.m42}}function b(t){var e=t.getBoundingClientRect(),n=document.body,i=window.pageYOffset||n.scrollTop,a=window.pageXOffset||n.scrollLeft;return{left:e.left+a,top:e.top+i,height:e.height,width:e.width}}function E(t,e){C(t,e)?x(t,e):_(t,e)}function C(t,e){return!(!t||!e)&&(t.classList?t.classList.contains(e):"".concat(t.className," ").indexOf("".concat(e," "))>-1)}function _(t,e){var n=t,i=e;if(n&&i)if("string"==typeof n?n=document.querySelectorAll(n):n.tagName&&(n=[n]),"string"==typeof i){i=i.split(" ");for(var a=0;a<n.length;a+=1){var s;if(n[a].classList)(s=n[a].classList).add.apply(s,c(i));else if(!C.apply(void 0,[n[a]].concat(c(i))))for(var o=0;o<i.length;o+=1)n[a].classes+=" ".concat(i[o])}}else console.log("Class argument must be string with spaces in between class names.")}function x(t,e){var n=t,i=e;if(n&&i)if("string"==typeof n?n=document.querySelectorAll(n):n.tagName&&(n=[n]),"string"==typeof i){i=i.split(" ");for(var a=0;a<n.length;a+=1){var s;if(n[a].classList)(s=n[a].classList).remove.apply(s,c(i));else for(var o=0;o<i.length;o+=1)n[a].className=n[a].className.replace(new RegExp("\\b".concat(e[o],"\\b"),"g"),"")}}else console.log("Class argument must be string with spaces in between class names.")}var A=function(t){function n(t){var i;return e(this,n),(i=d(this,o(n).call(this,t))).zoomIntensity=3,i.targetContainer=i.target.parentElement,i._onClick=i._onClick.bind(l(l(i))),i._onMove=i._onMove.bind(l(l(i))),i._onResize=i._onResize.bind(l(l(i))),i._getImageDimensions(),i._addEventListeners(),i}return s(n,u),i(n,[{key:"_getImageDimensions",value:function(){this.targetBCR=this.target.getBoundingClientRect(),this.targetContainer.style.height="".concat(this.targetBCR.height,"px")}},{key:"_onResize",value:function(){this.targetBCR=this.target.getBoundingClientRect()}},{key:"_onClick",value:function(t){t.target===this.target&&(t.preventDefault(),C(this.target,"enlarged")?(C(this.target,"detail-move")&&x(this.target,"detail-move"),x(this.target,"enlarged"),this.target.style.left="",this.target.style.top=""):(this._onResize(),_(this.target,"enlarged"),this.x=t.clientX||t.touches[0].pageX,this.y=t.clientY||t.touches[0].pageY,this.target.style.top="".concat(this.positionY,"%"),this.target.style.left="".concat(this.positionX,"%")))}},{key:"_onMove",value:function(t){t.target===this.target&&C(this.target,"enlarged")&&C(this.target,"enlarged")&&(C(this.target,"detail-move")||_(this.target,"detail-move"),this.x=t.clientX||t.touches[0].pageX,this.y=t.clientY||t.touches[0].pageY,this.target.style.top="".concat(this.positionY,"%"),this.target.style.left="".concat(this.positionX,"%"))}},{key:"_addEventListeners",value:function(){document.addEventListener("touchstart",this._onClick),document.addEventListener("touchmove",this._onMove),document.addEventListener("mousedown",this._onClick),document.addEventListener("mousemove",this._onMove)}}],[{key:"positionY",get:function(){return(this.y-this.targetBCR.top)/this.targetBCR.height*-100*(this.zoomIntensity-1)}},{key:"positionX",get:function(){return(this.x-this.targetBCR.left)/this.targetBCR.width*-100*(this.zoomIntensity-1)}}]),n}(),w=function(t){function n(t){var i;return e(this,n),(i=d(this,o(n).call(this,t))).container=i.target,i.items=t.querySelectorAll("[data-sortable-drag]"),i.droppables=t.querySelectorAll("[data-sortable-drop]"),i.placeholder=function(){return document.querySelector("#sortable-placeholder")},i.trackingTouch=!1,i.before=!1,i.after=!1,i.mouse={x:function(t){return t.clientX||t.touches[0].clientX},y:function(t){return t.clientY||t.touches[0].clientY},x0:0,y0:0,x1:0,y1:0},i.dragged={el:null,clone:null,posRel:{},rect:function(){return i.dragged.el.getBoundingClientRect()},size:{}},i.siblings={prev:null,next:null},i._onStart=i._onStart.bind(l(l(i))),i._onMove=i._onMove.bind(l(l(i))),i._onEnd=i._onEnd.bind(l(l(i))),i._update=i._update.bind(l(l(i))),i._addEventListeners(),i}return s(n,u),i(n,[{key:"_onStart",value:function(t){t.target.hasAttribute("data-sortable-drag")&&(this.trackingTouch=!0,this.dragged.el=t.target,this.dragged.clone=this.dragged.el.cloneNode(!0),this.dragged.posRel.top=this.dragged.el.offsetTop,this.dragged.posRel.left=this.dragged.el.offsetLeft,this.dragged.size.width=this.dragged.el.offsetWidth,this.dragged.size.height=this.dragged.el.offsetHeight,this.dragged.el.style.top="".concat(this.dragged.posRel.top,"px"),this.dragged.el.style.left="".concat(this.dragged.posRel.left,"px"),this.dragged.el.style.width="".concat(this.dragged.size.width,"px"),this.dragged.el.style.height="".concat(this.dragged.size.height,"px"),this.dragged.el.classList.add("is-dragged"),this.container.classList.add("is-dragged"),this._addPlaceholder(this.dragged.el),this._onOver(t),this.mouse.x0=this.mouse.x(t),this.mouse.y0=this.mouse.y(t),t.preventDefault())}},{key:"_onMove",value:function(t){this.trackingTouch&&(this.mouse.x1=this.mouse.x(t)-this.mouse.x0,this.mouse.y1=this.mouse.y(t)-this.mouse.y0,window.requestAnimationFrame(this._update),this._onOver(t))}},{key:"_onEnd",value:function(t){if(this.trackingTouch){this.trackingTouch=!1,this.container.classList.remove("is-dragged"),this.dragged.el.classList.remove("is-dragged"),this.dragged.el.style.top="",this.dragged.el.style.left="",this.dragged.el.style.width="",this.dragged.el.style.height="",this.dragged.el.style.transform="";var e=this.placeholder().getBoundingClientRect();e.left<=this.mouse.x(t)<=e.right&&this._onDrop(),this._removePlaceholder()}}},{key:"_onOver",value:function(t){if(this.before=!1,this.after=!1,this._getReference(),this.siblings.next&&this.siblings.next.hasAttribute("data-sortable-drop")){var e=this.siblings.next.getBoundingClientRect();this.dragged.rect().right>e.left+e.width/1.5&&(this.after=!0,this._addPlaceholder(this.siblings.next))}if(this.siblings.prev&&this.siblings.prev.hasAttribute("data-sortable-drop")){var n=this.siblings.prev.getBoundingClientRect();this.dragged.rect().left<n.right-n.width/1.5&&(this.before=!0,this._addPlaceholder(this.siblings.prev))}}},{key:"_onDrop",value:function(){var t=this.placeholder();this._addEventListenerToItem(this.dragged.clone),this.container.insertBefore(this.dragged.clone,t),this.dragged.el.parentNode.removeChild(this.dragged.el)}},{key:"_update",value:function(){this.dragged.el.style.transform="translate3d(".concat(this.mouse.x1,"px, ").concat(this.mouse.y1,"px, 0) rotate(5deg)")}},{key:"_addPlaceholder",value:function(t){this._removePlaceholder();var e=document.createElement("div");if(e.classList.add("sortable-item","sortable-placeholder"),e.setAttribute("id","sortable-placeholder"),this.dragged.el.querySelector("img")){var n=this.dragged.el.querySelector("img").getAttribute("src"),i=document.createElement("img");i.setAttribute("src",n),e.appendChild(i)}this.after?this.container.insertBefore(e,t.nextElementSibling):(this.before,this.container.insertBefore(e,t))}},{key:"_removePlaceholder",value:function(){var t=this.placeholder();t&&t.parentNode.removeChild(t)}},{key:"_getReference",value:function(){var t=this.placeholder();this.siblings.prev=t.previousElementSibling===this.dragged.el?this.dragged.el.previousElementSibling:t.previousElementSibling,this.siblings.next=t.nextElementSibling===this.dragged.el?this.dragged.el.nextElementSibling:t.nextElementSibling}},{key:"_addEventListenerToItem",value:function(t){t.addEventListener("touchstart",this._onStart),t.addEventListener("mousedown",this._onStart)}},{key:"_addEventListeners",value:function(){document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onEnd),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onEnd);for(var t=0;t<this.items.length;t+=1)this._addEventListenerToItem(this.items[t])}}]),n}(),k=function(){function t(){e(this,t)}return i(t,null,[{key:"start",value:function(t){d3.select(t).raise().classed("is-dragged",!0)}},{key:"dragged",value:function(t,e){d3.select(t).attr("x",(d3.event.x-e.x).toFixed()).attr("y",(d3.event.y-e.y).toFixed())}},{key:"end",value:function(t,e,n){d3.select(t).attr("x",(d3.event.x-n.x).toFixed()).attr("y",(d3.event.y-n.y).toFixed()).classed("is-dragged",!1)}}]),t}(),T=function(){function t(){e(this,t)}return i(t,null,[{key:"renderPath",value:function(t){if("image"===d3.event.sourceEvent.target.nodeName){var e=d3.line().curve(d3.curveLinear),n=d3.format(".0f"),i=d3.event.subject,a=n(d3.event.x),s=n(d3.event.y),o="path-".concat(a,"-").concat(s),r=d3.select("#".concat(t.id," .svg-view")).append("svg:path").attr("data-svg-path","").attr("class","svg-path").attr("id",o).datum(i);d3.event.on("drag",function(){var t=n(d3.event.x),o=n(d3.event.y),l=t-a,d=o-s;l*l+d*d>300?i.push([a=t,s=o]):i[i.length-1]=[t,o],r.attr("d",e)}).on("end",function(){var t=d3.select("#".concat(o));t&&(t.attr("d")?t.attr("d").length<40&&t.remove():t.attr("d")||t.remove())}),d3.select("#".concat(o)).on("click",function(){d3.select("#".concat(o)).remove(),d3.event.preventDefault()},!1)}}},{key:"createCircle",value:function(t){var e=d3.select("#".concat(t.id," .svg-view")),n=document.querySelector("#".concat(t.id," .svg-view")),i=p(t),a="circle-".concat(i.x,"-").concat(i.y),s="#".concat(a),o=e.append("svg:foreignObject").attr("data-svg-circle","").attr("id",a).attr("x",i.x).attr("y",i.y).attr("width",1).attr("height",1),r=document.querySelector(s),l=[r.getAttribute("x"),r.getAttribute("y")],d={};o.append("xhtml:div").attr("class","svg-circle").on("click",function(){d3.select(d3.event.target.parentNode).remove()}).call(d3.drag().container(n).subject(r).on("start",function(){d={x:d3.event.x-l[0],y:d3.event.y-l[1]},k.start(s)}).on("drag",function(){k.dragged(s,d)}).on("end",function(){k.end(s,"circle",d),l=[r.getAttribute("x"),r.getAttribute("y")]}))}}]),t}(),S=function(){function t(){e(this,t)}return i(t,null,[{key:"createText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:333,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=d3.select('[data-svg-active="true"]'),a=i.attr("id"),s=i.select(".svg-view"),o=document.querySelector('[data-svg-active="true"] .svg-view'),r=document.querySelector("[data-radial-menu]"),l={x:r.getAttribute("data-local-x"),y:r.getAttribute("data-local-y")},d="svg-text-".concat(l.x,"-").concat(l.y),c="#".concat(d);s.append("svg:foreignObject").attr("class","svg-text").attr("x",l.x).attr("y",l.y).attr("width",1).attr("height",1).append("xhtml:textarea").attr("maxlength",e).attr("tabindex","-1").attr("id",d).attr("class","svg-textarea").attr("data-save","").attr("data-svg-textarea-target",a),document.querySelector("".concat(c)).focus();var u=document.querySelector(c).parentNode,h=[u.getAttribute("x"),u.getAttribute("y")],g={};d3.select("".concat(c)).call(d3.drag().container(o).subject(u).on("start",function(){g={x:d3.event.x-h[0],y:d3.event.y-h[1]},k.start(u)}).on("drag",function(){k.dragged(u,g)}).on("end",function(){k.end(u,"text",g),h=[u.getAttribute("x"),u.getAttribute("y")]})).on("keyup",function(){t.updateTextareaHeight(d3.event.target)}).on("blur",function(){var t=d3.event.target,e=t.value;0!==e.length?e.length<n?_(t,"is-wrong"):e.length>=n&&C(t,"is-wrong")&&x(t,"is-wrong"):L.removeItem(u)}).on("focus",function(){d3.select(u).raise()})}},{key:"updateTextareaHeight",value:function(t){t.style.height="1px",t.style.height="".concat(22+t.scrollHeight,"px")}}]),t}(),L=function(t){function n(t){var i;return e(this,n),(i=d(this,o(n).call(this,t))).init(),i}return s(n,u),i(n,[{key:"init",value:function(){for(var t=this.target.getAttribute("data-svg-target").split(" "),e=0;e<t.length;e+=1)"kresleni"===t[e]?this._initPath():"znacky"===t[e]&&this._initCircle();this._setSize(),this._initComicBubbles()}},{key:"_setSize",value:function(){var t=this.target.getAttribute("viewBox").split(" "),e=this.target.getBoundingClientRect().height/t[3];this.target.style.maxWidth="".concat(t[2]*e,"px")}},{key:"_initPath",value:function(){var t=this;d3.select(this.target).call(d3.drag().container(function(){return t.target}).subject(function(){var t=[d3.event.x.toFixed(),d3.event.y.toFixed()];return[t,t]}).on("start",function(){T.renderPath(t.target)}))}},{key:"_initCircle",value:function(){var t=this;d3.select(this.target).on("click",function(){"image"===d3.event.target.nodeName&&(T.createCircle(t.target),d3.event.preventDefault())},!1)}},{key:"_initComicBubbles",value:function(){var t=this.target.querySelectorAll(".svg-komiks .svg-textarea");t&&d3.selectAll(t).on("keyup",function(){S.updateTextareaHeight(d3.event.target)})}}],[{key:"selectItem",value:function(t){t.setAttribute("data-svg-selected","true")}},{key:"deselectItem",value:function(){for(var t=document.querySelectorAll('[data-svg-selected="true"]'),e=0;e<t.length;e+=1)t[e].setAttribute("data-svg-selected","false")}},{key:"removeItem",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'[data-svg-selected="true"]';d3.select(t).remove()}},{key:"deactivate",value:function(){for(var t=document.querySelectorAll('[data-svg-active="true"]'),e=0;e<t.length;e+=1)t[e].setAttribute("data-svg-active","false")}},{key:"activate",value:function(t){n.deactivate(),t.setAttribute("data-svg-active","true")}}]),n}(),M=function(){function t(n,i){e(this,t),this.$radialMenu=n,this.$radialMenuItems=this.$radialMenu.querySelectorAll("[data-radial-menu-item]"),this.$colorItems=this.$radialMenu.querySelectorAll(".radial-menu-color"),this.$textItems=this.$radialMenu.querySelectorAll(".radial-menu-text"),this.$createTextItem=this.$radialMenu.querySelector("#create-text"),this.$removeItem=this.$radialMenu.querySelector("#remove-content"),this.$tooltip=this.$radialMenu.querySelector("[data-radial-menu-tooltip]"),this.$svgs=i,this.initialSetUp=!0,this.menuRadius=parseInt(window.getComputedStyle(this.$radialMenu.querySelector(".radial-menu-wrapper"),null).getPropertyValue("width"),10)/2,this.itemRadius=parseInt(window.getComputedStyle(this.$radialMenu.querySelector(".radial-menu-item"),null).getPropertyValue("width"),10)/2,this.init()}return i(t,[{key:"init",value:function(){var t=this;this.setUpRadialMenuItems(),this.addEventListenersToRadialMenu(),Array.from(this.$svgs).forEach(function(e){d3.select(e).on("contextmenu",function(){L.activate(e),L.deselectItem(),t.filterMenuButtons(d3.event.target),t.showRadialMenu(e,d3.event),d3.event.preventDefault()})}),this.initialSetUp=!1}},{key:"setUpRadialMenuItems",value:function(){var t=this;Array.from(this.$radialMenuItems).forEach(function(e){t.addEventListenersToRadialMenuItem(e)})}},{key:"positionRadialMenuItems",value:function(t){var e=t.length,n=this.menuRadius,i=this.itemRadius,a=n-i,s=.6283185307*e/2-.31415926535;Array.from(t).forEach(function(t,e){var i=Math.PI+.6283185307*e*-1+s,o=n*Math.sin(i)+a,r=n*Math.cos(i)+a;t.style.left="".concat(o.toFixed(1),"px"),t.style.top="".concat(r.toFixed(1),"px")})}},{key:"addEventListenersToRadialMenu",value:function(){var t=this;this.onMouseLeave(),this.$radialMenu.addEventListener("click",function(e){t.hideRadialMenu(t.$radialMenu),e.preventDefault()}),this.$radialMenu.addEventListener("contextmenu",function(e){t.hideRadialMenu(t.$radialMenu),e.preventDefault()})}},{key:"addEventListenersToRadialMenuItem",value:function(e){var n=this,i=e,a=i.getAttribute("data-radial-menu-item");if("remove-content"===a)i.addEventListener("click",function(){L.removeItem(),n.hideRadialMenu()},!1);else if("create-text"===a)d3.select(i).on("click",function(){S.createText(),n.hideRadialMenu()},!1);else if("color-point-blue"===a)i.addEventListener("click",function(){t.changeColor("blue"),n.hideRadialMenu()},!1);else if("color-point-red"===a)i.addEventListener("click",function(){t.changeColor("red"),n.hideRadialMenu()},!1);else if("color-point-red"===a)i.addEventListener("click",function(){t.changeColor("red"),n.hideRadialMenu()},!1);else if("category"===a){var s=i.getAttribute("data-category"),o=i.getAttribute("data-radial-menu-item-tooltip");i.addEventListener("click",function(){var t=document.querySelector('[data-svg-selected="true"]'),e=t.parentNode,i=e.querySelector(".svg-category-label");t.setAttribute("data-svg-category",s),i||((i=document.createElement("div")).classList.add("svg-category-label"),e.prepend(i)),i.innerText=o,n.hideRadialMenu()},!1)}i.addEventListener("mouseenter",function(t){n.$tooltip.innerHTML=t.currentTarget.getAttribute("data-radial-menu-item-tooltip"),n.$tooltip.style.display="block"},!1),i.addEventListener("mouseleave",function(){n.$tooltip.innerHTML="",n.$tooltip.style.display="none"},!1)}},{key:"showRadialMenu",value:function(t,e){var n=t||document.querySelector('[data-svg-active="true"]'),i=function(t){return{x:t.pageX,y:t.pageY}}(e),a=p(n);this.$radialMenu.setAttribute("data-local-x",a.x),this.$radialMenu.setAttribute("data-local-y",a.y),this.$radialMenu.style.top="".concat(i.y-7,"px"),this.$radialMenu.style.left="".concat(i.x-7,"px");var s=this.$radialMenu.querySelectorAll(".is-active");this.positionRadialMenuItems(s),_(this.$radialMenu,"is-active")}},{key:"hideRadialMenu",value:function(){var t=this;x(this.$radialMenu,"is-active"),L.deactivate(),L.deselectItem(),setTimeout(function(){C(t.$radialMenu,"is-active")||Array.from(t.$radialMenuItems).forEach(function(t){x(t,"is-active")})},150)}},{key:"onMouseLeave",value:function(){var t,e=this;this.$radialMenu.addEventListener("mouseleave",function(){t=setTimeout(function(){e.hideRadialMenu(e.$radialMenu)},500)}),this.$radialMenu.addEventListener("mouseenter",function(){clearTimeout(t)})}},{key:"filterMenuButtons",value:function(t){(C(t,"svg-path")||"path"===t.nodeName)&&(_(this.$createTextItem,"is-active"),Array.from(this.$colorItems).forEach(function(t){_(t,"is-active")}),Array.from(this.$textItems).forEach(function(t){x(t,"is-active")})),C(t,"svg-circle")&&(_(this.$createTextItem,"is-active"),Array.from(this.$colorItems).forEach(function(t){_(t,"is-active")}),Array.from(this.$textItems).forEach(function(t){x(t,"is-active")})),C(t,"svg-textarea")&&(x(this.$createTextItem,"is-active"),C(t,"do-not-remove")||(Array.from(this.$colorItems).forEach(function(t){x(t,"is-active")}),Array.from(this.$textItems).forEach(function(t){_(t,"is-active")}))),"image"===t.nodeName?(_(this.$createTextItem,"is-active"),x(this.$removeItem,"is-active"),Array.from(this.$colorItems).forEach(function(t){x(t,"is-active")}),Array.from(this.$textItems).forEach(function(t){x(t,"is-active")})):(C(t,"do-not-remove")?x(this.$removeItem,"is-active"):_(this.$removeItem,"is-active"),L.selectItem(t))}}],[{key:"changeColor",value:function(t){var e=document.querySelector('[data-svg-selected="true"]');x(e,"red blue"),_(e,t)}}]),t}(),N=function(){function t(){e(this,t),this._events=[]}return i(t,[{key:"on",value:function(t,e){var n=this;(t=this._split(t)).forEach(function(t){n._events[t]||(n._events[t]=[]),n._events[t].push(e)})}},{key:"off",value:function(t,e){var n=this;(t=this._split(t)).forEach(function(t){n._events[t]&&(n.events[t]=n._events[t].filter(function(t){return t!==e}))})}},{key:"trigger",value:function(t,e){var n=this;(t=this._split(t)).forEach(function(t){n._events[t]&&n._events[t].forEach(function(i){i.call(n,t,e)})})}},{key:"_split",value:function(t){return t.replace(/^\s+|\s+$/g,"").split(/\s+/)}}]),t}(),$={editor:{id:"editor",ADD_TAG:"editor:ADD_TAG",DELETE_TAG:"editor:DELETE_TAG",UPDATE_TAG:"editor:UPDATE_TAG",CHANGE:"editor:CHANGE"},keywords:{id:"keywords",CHANGE:"keywords:CHANGE"},testQuiz:{id:"testQuiz",ADD_ANSWER:"testQuiz:ADD_ANSWER",REMOVE_ANSWER:"testQuiz:REMOVE_ANSWER",UPDATE_ANSWER:"testQuiz:UPDATE_ANSWER",CHANGE:"testQuiz:CHANGE"},textOptions:{id:"textOptions",ADD:"textOptions:ADD",DELETE:"textOptions:DELETE",UPDATE:"textOptions:UPDATE",CHANGE:"textOptions:CHANGE"},store:{id:"store",ADD:"ADD",DELETE:"DELETE",UPDATE:"UPDATE",CHANGE:"CHANGE"}},R=new(function(t){function n(){var t;return e(this,n),(t=d(this,o(n).call(this)))._data={},t._data.tags=[],t}return s(n,N),i(n,[{key:"_checkTagExists",value:function(t){var e=!1;return this._data.tags.forEach(function(n,i){n.id===t&&(e={item:n,index:i})}),e}},{key:"addTag",value:function(t){if(0!==this._data.tags.length&&this._checkTagExists(t.id))throw new Error("Tag already exists! Will not add it.");void 0===t.data.userSelectedNodeItems&&(t.data.userSelectedNodeItems=[]),this._data.tags.push(t),R.trigger($.editor.CHANGE,{action:{id:$.editor.id,type:$.editor.ADD_TAG,data:{tagContainer:t}}})}},{key:"deleteTag",value:function(t){var e=this._checkTagExists(t.id);if(!1!==e)return this._data.tags.splice(e.index,1),R.trigger($.editor.CHANGE,{action:{id:$.editor.id,type:$.editor.DELETE_TAG,data:{tagContainer:{editorId:t.editorId,id:t.id,tagName:t.tagName,data:{}}}}}),!0;throw new Error("Tag does not exist! Will not delete it.")}},{key:"getAllTags",value:function(t){return void 0!==t&&t.editorId?this._data.tags.filter(function(e){return e.editorId===t.editorId}):this._data.tags}},{key:"getTagsBy",value:function(t){return void 0!==t&&(-1!==["editorId","id","tagName"].indexOf(t.key)&&(Array.isArray(t.value)||(t.value=[t.value]),console.log(t.value),console.log(this._data.tags),this._data.tags.filter(function(e){return e[t.key]===t.value[0]||e[t.key]===t.value[1]})))}},{key:"getLastTag",value:function(t){if(void 0===t||!t.editorId)return this._data.tags[this._data.tags.length-1];var e=this._data.tags.filter(function(e){return e.editorId===t.editorId});return e[e.length-1]}}]),n}()),I=new(function(t){function n(){var t;return e(this,n),(t=d(this,o(n).call(this)))._data=[],t}return s(n,N),i(n,[{key:"_checkExists",value:function(t){var e=!1;return this._data.forEach(function(n,i){n.id===t&&(e={item:n,index:i})}),e}},{key:"add",value:function(t){if(0!==this._data.length&&this._checkExists(t.id))throw new Error("Object already exists! Will not add it.");this._data.push(t),console.info("data",t),I.trigger($.textOptions.id,{action:{type:$.textOptions.ADD},data:t})}},{key:"delete",value:function(t){var e=this._checkExists(t.id);if(!1!==e)return this._data.splice(e.index,1),I.trigger($.textOptions.id,{action:{type:$.textOptions.DELETE},data:t}),!0;throw new Error("Tag does not exist! Will not delete it.")}},{key:"getAll",value:function(t){return void 0!==t&&t.editor?this._data.filter(function(e){return e.id===t.id}):this._data}},{key:"getBy",value:function(t){return void 0!==t&&-1!==["id"].indexOf(t.key)&&(Array.isArray(t.value)||(t.value=[t.value]),this._data.filter(function(e){return e[t.key]===t.value[0]||e[t.key]===t.value[1]}))}},{key:"getLast",value:function(t){if(void 0===t||!t.editor)return this._data[this._data.length-1];var e=this._data.filter(function(e){return e.id===t.id});return e[e.length-1]}}]),n}()),D=function(){function t(n){e(this,t),this.$editor=n,this.id=this.$editor.id,this.settings=JSON.parse(document.querySelector('[data-editor-id-reference="'.concat(this.id,'"]')).getAttribute("data-module-settings")),this.opts=function t(e,n){var i=Object.assign({},e);return g(e)&&g(n)&&Object.keys(n).forEach(function(s){g(n[s])&&s in e?i[s]=t(e[s],n[s]):Object.assign(i,a({},s,n[s]))}),i}(t.defaults,this.settings),this.models={passive:["cteni"],interactive:["predznaceny","zvyraznovani","komentáře","psani"],withMenu:["predznaceny","zvyraznovani","komentáře"]},this.totalTagId=0,this.hasMenu=!0,this.selection=null,this.lastSelectionSettings={},this.isCollapsed=null,this.savedSelectionRange=null,this.selectionAttributes=null,this.dummyRangeElement=null,this.selectionMouseDown=!1,this.selectionDirection=null,this.hasEditableContentChanged=!1,this.lastPressedKey=null,this.hasToolbar=!1,this.toolbar={},this.originalContent={},this.currentContent={},this._handlers=[],this.wrapLastDeletesTimeoutClass="",this.wrapLastDeletesTimeoutFunction=function(){},this.wrapLastAdditionsTimeoutClass="",this.wrapLastAdditionsTimeoutFunction=function(){},this.isWrappingLastText=!1,this.isWriting=!1,this.$groupDeleted=null,this.cache={body:document.body,window:window},this.init()}return i(t,[{key:"init",value:function(){if(t._hasMenu(this.opts))try{this.$menu=this.$editor.getElementsByClassName(this.opts.menuClass)[0],this.$menuActions=this.$menu.getElementsByClassName("menu")[0].getElementsByClassName("menu-item"),this.$menuClose=this.$menu.getElementsByClassName("close")[0]}catch(t){this.hasMenu=!1}else this.hasMenu=!1;t._hasToolbar(this.opts)&&(this.hasToolbar=!0),this.$canvas=this.$editor.getElementsByClassName(this.opts.canvasClass)[0],"cteni"!==this.opts.funkce&&(_(this.$menu,"hidden"),"psani"===this.opts.funkce&&(this.originalContent.html=this.$canvas.innerHTML,this.originalContent.text=this.$canvas.innerText,this.currentContent.html=this.$canvas.innerHTML,this.currentContent.text=this.$canvas.innerText,this.wrapLastDeletesTimeoutClass=this._generateNewTagGroupClass(),this.wrapLastAdditionsTimeoutClass=this._generateNewTagGroupClass()),this.hasToolbar&&(this.toolbar.$element=this.$editor.getElementsByClassName("editor-toolbar")[0],this.toolbar.$btnReset=this.toolbar.$element.getElementsByClassName("editor-toolbar-action-reset")[0]),this.registerEditableHandlers()),"predznaceny"===this.opts.funkce&&this.initPreHighlightedTextOptions()}},{key:"_generateNewTagId",value:function(){return this.totalTagId=this.totalTagId+1,"".concat(this.id,"-").concat(this.totalTagId)}},{key:"_generateNewTagGroupClass",value:function(){return this.totalTagId=this.totalTagId+1,"group-".concat(this.id,"-").concat(this.totalTagId)}},{key:"registerEditableHandlers",value:function(){var t=this;this.$canvas.addEventListener("mousedown",this.handlerFocus.bind(this),!1),this.$canvas.addEventListener("focusout ",this.handlerFocus.bind(this),!1),this.cache.body.addEventListener("mouseup",this.handlerFocus.bind(this),!1),"psani"===this.opts.funkce&&this.$canvas.addEventListener("keydown",function(e){var n,i=window.getSelection(),a=e.which||e.keyCode,s=e.key;if("Backspace"===s||"Delete"===s){if(console.log("Delete"),i.rangeCount){window.clearTimeout(t.wrapLastDeletesTimeoutFunction),console.log("rangeCount");var o=i.getRangeAt(0),r=o.cloneRange();if(t.lastSelectionSettings.isCollapsed){console.log("isCollapsed");try{r.setStart(o.startContainer,o.startOffset-1)}catch(e){r.setStart(o.startContainer,o.startOffset),r.collapse(!0)}}else console.log("NOT isCollapsed"),r.setStart(o.startContainer,o.startOffset);r.setEnd(o.endContainer,o.endOffset);var l=r.cloneContents().textContent.trim();if(""!==l&&"&nbsp;"!==l||t.isWrappingLastText){var d=document.createElement("span");d.className="user-removed-text-inner ".concat(t.wrapLastDeletesTimeoutClass),r.surroundContents(d),i.removeAllRanges(),i.addRange(o),t.wrapLastDeletesTimeoutFunction=setTimeout(function(){t.isWrappingLastText=!1;var e=document.createElement("span");e.contentEditable=!1,e.className="user-removed-text";var n=t._generateNewTagId();e.id=n;var i=Array.from(document.getElementsByClassName(t.wrapLastDeletesTimeoutClass));m(e,i[0]),i.forEach(function(t,n){e.appendChild(t)});var a=document.createElement("span");a.className=t.opts.closeBtnClass;a.addEventListener("click",function(e){var n=e.currentTarget.parentNode;t._removeNodeKeepTextContent(n),e.stopPropagation()}.bind(t)),document.getElementById(n).appendChild(a),t.wrapLastDeletesTimeout=!0,t.wrapLastDeletesTimeoutClass=t._generateNewTagGroupClass()},700),t.isWrappingLastText=!0,e.preventDefault()}else{if(!t.isWrappingLastText)return;e.preventDefault()}}}else if((n=a)>47&&n<58||32==n||13==n||n>64&&n<91||n>95&&n<112||n>185&&n<193||n>218&&n<223)if(t.lastSelectionSettings.isCollapsed){if(32===a){if(!t.isWrappingLastText)return;s=" "}if(i.rangeCount){window.clearTimeout(t.wrapLastAdditionsTimeoutFunction);var c=i.getRangeAt(0),u=c.cloneRange();u.setStart(c.startContainer,c.startOffset),u.setEnd(c.endContainer,c.endOffset);var h=document.createElement("span");h.contentEditable=!1,h.className="user-inserted-text-inner ".concat(t.wrapLastAdditionsTimeoutClass),h.innerHTML=s,u.insertNode(h),c.setStartAfter(h),i.removeAllRanges(),i.addRange(c),t.wrapLastAdditionsTimeoutFunction=setTimeout(function(){t.isWrappingLastText=!1;var e=document.createElement("span");e.contentEditable=!1,e.className="user-inserted-text";var n=t._generateNewTagId();e.id=n;var i=Array.from(document.getElementsByClassName(t.wrapLastAdditionsTimeoutClass));m(e,i[0]),i.forEach(function(t,n){e.appendChild(t)});var a=document.createElement("span");a.className=t.opts.closeBtnClass;a.addEventListener("click",function(t){v(t.currentTarget.parentNode),t.stopPropagation()}.bind(t)),document.getElementById(n).appendChild(a),t.wrapLastAdditionsTimeoutClass=t._generateNewTagGroupClass()},700),t.isWrappingLastText=!0}!1===t.hasEditableContentChanged&&(t.hasEditableContentChanged=!0),e.preventDefault()}else{window.clearTimeout(t.wrapLastAdditionsTimeoutFunction);var g=i.getRangeAt(0),f=g.cloneRange();if(f.setStart(g.startContainer,g.startOffset),f.setEnd(g.endContainer,g.endOffset),!1===t.isWriting&&i.toString().length>0){t.$groupDeleted=document.createElement("span"),t.$groupDeleted.contentEditable=!1,t.$groupDeleted.className="user-removed-text";var p=t._generateNewTagId();t.$groupDeleted.id=p;var y=document.createElement("span");y.className="user-removed-text-inner",t.$groupDeleted.appendChild(y),f.surroundContents(t.$groupDeleted);var b=document.createElement("span");b.className=t.opts.closeBtnClass;b.addEventListener("click",function(e){var n=e.currentTarget.parentNode;t._removeNodeKeepTextContent(n),e.stopPropagation()}.bind(t)),t.$groupDeleted.appendChild(b)}t.isWriting=!0;var E=document.createElement("span");E.contentEditable=!1,E.className="user-inserted-text-inner ".concat(t.wrapLastAdditionsTimeoutClass),E.innerHTML="".concat(s),m(E,t.$groupDeleted),g.setStartAfter(E),i.removeAllRanges(),i.addRange(g),t.wrapLastAdditionsTimeoutFunction=setTimeout(function(){t.isWriting=!1;var e=document.createElement("span");e.contentEditable=!1,e.className="user-inserted-text";var n=t._generateNewTagId();e.id=n;var i=Array.from(document.getElementsByClassName(t.wrapLastAdditionsTimeoutClass));m(e,i[0]),i.forEach(function(t,n){e.appendChild(t)});var a=document.createElement("span");a.className=t.opts.closeBtnClass;a.addEventListener("click",function(t){v(t.currentTarget.parentNode),t.stopPropagation()}.bind(t)),document.getElementById(n).appendChild(a),t.wrapLastAdditionsTimeoutClass=t._generateNewTagGroupClass()},700),e.preventDefault()}}),this.hasMenu&&this.registerMenuHandler(),this.hasToolbar&&this.toolbar.$btnReset.addEventListener("click",function(){confirm("Opravdu chcete vrátit text do původní podoby? Vaše změny se tímto ztratí.")&&(t.$canvas.innerHTML=t.originalContent.html)})}},{key:"registerMenuHandler",value:function(){for(var t=0,e=this.$menuActions.length;t<e;t+=1)this.$menuActions[t].addEventListener("click",this.handlerMenuActions.bind(this),!1);this.$menuClose.addEventListener("click",this.handlerMenuClose.bind(this),!1)}},{key:"initPreHighlightedTextOptions",value:function(){var t=this,e="data-text-option",n=this.opts.predznaceni,i=this.$editor.querySelector(".canvas"),a=i.innerHTML,s=new RegExp("&nbsp;","g");a=a.replace(s," "),n.forEach(function(n,i){var s=Object.assign({text:t.opts.nazev},n),o=new RegExp(n.vyraz,"i");a=a.replace(o,'<span class="text-option" id="'.concat(t.id,"-text-option-").concat(i,'" ').concat(e,"='").concat(JSON.stringify(s),"'>").concat(n.vyraz,"</span>"))}),i.innerHTML=a,this.$textOptionsElements=this.$editor.querySelectorAll("[".concat(e,"]")),Array.from(this.$textOptionsElements).forEach(function(n){n.addEventListener("click",function(){E(n,t.opts.textOptions.selectedClass),C(n,t.opts.textOptions.selectedClass)?I.add({editor:t.id,id:n.id,tag:n,data:JSON.parse(n.getAttribute(e))}):I.delete({editor:t.id,id:n.id})})})}},{key:"toggleMenu",value:function(){!0!==(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&!0!==this.selectionMouseDown?C(this.$menu,"hidden")&&!1===this.selectionMouseDown&&(this._setmenuDimensions(),x(this.$menu,"hidden")):_(this.$menu,"hidden")}},{key:"_setmenuDimensions",value:function(){var t,e,n=function(t){var e,n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=t.cloneNode(!0);a.style.visibility="hidden",a.style.display="block",e=a,(n=t).parentNode.insertBefore(e,n.nextSibling);var s=a.getBoundingClientRect(),o=i?y(a):b(a);return v(a),{width:s.width,height:s.height,top:o.top,left:o.left}}(this.$menu),i=y(this.$editor),a=b(this.$editor),s=this.selectionAttributes.left+this.selectionAttributes.width+n.width+this.opts.menuMargin.x>i.left+a.width,o=this.selectionAttributes.top-n.height-this.opts.menuMargin.y<i.top;this.selectionAttributes.top,this.selectionAttributes.height,n.height,this.opts.menuMargin.y,i.top,a.height;t=s?this.selectionAttributes.left-n.width-this.opts.menuMargin.x:this.selectionAttributes.left+this.selectionAttributes.width+this.opts.menuMargin.x,e=o?this.selectionAttributes.top+n.height+this.opts.menuMargin.y:this.selectionAttributes.top-n.height-this.opts.menuMargin.y,this.$menu.style.left="".concat(t,"px"),this.$menu.style.top="".concat(e,"px")}},{key:"handlerMenuClose",value:function(t){this.toggleMenu(!0),t.preventDefault()}},{key:"handlerMenuActions",value:function(t){var e=t.currentTarget,n=e.getAttribute("data-command"),i=e.getAttribute("data-command-name"),a=JSON.parse(e.getAttribute("data-command-options"));this.setSelection(n,i,a),t.preventDefault()}},{key:"handlerFocus",value:function(t){3===t.which||C(t.target,"node-close")||C(t.target,"node-selected")||("mousedown"===t.type&&(this.selectionMouseDown=!0,!0===this.hasMenu&&this.toggleMenu()),"mouseup"===t.type&&this.selectionMouseDown&&(this.lastSelectionSettings={},this.selection=window.getSelection(),this.isCollapsed=this.lastSelectionSettings.isCollapsed=this.selection.isCollapsed,this.savedSelectionRange=this.selection.getRangeAt(0),this.selectionMouseDown=!1,this.lastSelectionSettings.anchorOffset=this.selection.anchorOffset,this.lastSelectionSettings.focusOffset=this.selection.focusOffset,this.lastSelectionSettings.text=this.savedSelectionRange.toString(),!1===this.selection.isCollapsed&&""!==this.savedSelectionRange.toString().trim()&&(this.selectionDirection=this.selection.anchorOffset<=this.selection.focusOffset?"right":"left",!0===this.hasMenu&&(this._setSelectionPosition(),this.toggleMenu()))))}},{key:"_setSelectionPosition",value:function(){var t=document.createElement("span");t.className="dummy-range-element",this.savedSelectionRange.surroundContents(t);var e=y(t),n=b(t);this.selectionAttributes={left:e.left,top:e.top,width:n.width,height:n.height},x(t,"dummy-range-element"),this._removeNodeKeepTextContent(t)}},{key:"_extractAndSaveContents",value:function(t){t.appendChild(this.savedSelectionRange.extractContents()),this.savedSelectionRange.insertNode(t);var e=t.getAttribute("data-command-name"),n=this._generateNewTagId();t.setAttribute("data-tag-id",n),R.addTag({editor:this.id,id:n,tag:t,tagName:e,data:{}})}},{key:"_removeNodeKeepTextContent",value:function(t){var e=t.textContent;t.parentNode.insertBefore(document.createTextNode(e),t),v(t)}},{key:"_createCloseBtnForElement",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=document.createElement("span");i.setAttribute("class",n.class);n.toggleClass.split(" ");i.addEventListener("click",function t(n){var i=n.currentTarget,a=i.parentNode;i.removeEventListener("click",t),a.removeChild(i),void 0!==a.commentRef&&(e.$editor.removeChild(a.commentRef),a.commentRef=null),e._removeNodeKeepTextContent(a);var s=a.getAttribute("data-command-name");R.deleteTag({editor:e.id,id:a.getAttribute("data-tag-id"),tag:a,tagName:s,data:{}}),n.stopPropagation()}.bind(this)),t.appendChild(i)}},{key:"_calculateCommentPosition",value:function(t){var e=y(t);return{left:"".concat(e.left+parseInt(t.offsetWidth,10)+this.opts.commentMargin.x,"px"),top:"".concat(e.top+this.opts.commentMargin.y,"px")}}},{key:"_createCommentForNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.getElementById("comment-template").innerHTML,i=document.createElement("div");i.innerHTML=n;var a=i.childNodes[1];a.data={},a.data.nodeRef=t;var s=a.getElementsByClassName("comment-new-text")[0],o=a.getElementsByTagName("button")[0],r=a.getElementsByClassName("comments-container")[0],l=this._calculateCommentPosition(t);a.style.left=l.left,a.style.top=l.top,_(a,e.class),a.addEventListener("click",function(e){C(e.target,"close")&&(_(a,"hidden"),x(t,"active"))}),o.addEventListener("click",function(t){if(""!==s.value){var e=document.createElement("div");e.className="comment-item",e.innerText=s.value,r.appendChild(e),s.value=""}}),this.$editor.append(a),_(t,"comment-created"),t.commentRef=a}},{key:"_addCommentHandlerForElement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_(t,"has-comments"),t.addEventListener("click",function(n){if(!C(n.target,"node-close")){if(C(t,"comment-created")){var i=this._calculateCommentPosition(t);t.commentRef.style.left=i.left,t.commentRef.style.top=i.top,x(t.commentRef,"hidden")}else this._createCommentForNode(t,e);C(t,"active")?(x(t,"active"),_(t.commentRef,"hidden")):_(t,"active")}n.stopPropagation()}.bind(this))}},{key:"setSelection",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.selection){if("toggle-class"===t){var i=document.createElement("span");i.setAttribute("class",n.toggleClass),i.setAttribute("data-command-name",e),!0===n.closeBtn&&this._createCloseBtnForElement(i,{class:"node-close",toggleClass:n.toggleClass}),!0===n.comments&&this._addCommentHandlerForElement(i,{class:n.commentsClass}),this._extractAndSaveContents(i),!0===n.showCommentsOnInit&&i.click()}this.toggleMenu(!0)}}}]),t}();D.defaults={menuClass:"contextual-menu-component",canvasClass:"canvas",resetBtnClass:"reset",closeBtnClass:"node-close",nodeSelectedClass:"node-selected",commentMargin:{x:50,y:0},menuMargin:{x:15,y:15},textOptions:{enable:!1,animatedClass:"active",selectedClass:"selected",deselectedClass:"deselected"}},D._hasMenu=function(t){return"cteni"!==t.funkce&&"psani"!==t.funkce&&!1!==t.menu&&void 0!==t.menu},D._hasToolbar=function(t){return"psani"===t.funkce||!1!==t.toolbar&&void 0!==t.toolbar};var B=function(){function t(n,i,a){e(this,t),this.id=n,this.$element=i,this.opts=Object.assign({},t.defaults,a),this.isAdvanced=this.opts.isAdvanced,this.rowIndex=0,this.tableResult=this.$element.getElementsByClassName("table-result")[0],this.tableResultBody=this.tableResult.getElementsByClassName("table-body")[0],this.tableSelectedItems=this.$element.getElementsByClassName("table-selected-items")[0],this.tableSelectedItemsBody=this.tableSelectedItems.getElementsByClassName("table-body")[0],this.activeDragged=null,this._getRowHTML=this.isAdvanced?t._getAdvancedRowHTML:t._getRowHTML}return i(t,[{key:"init",value:function(){this._registerStoreHandlers(this.tableResultBody,this.tableSelectedItemsBody),this._registerHandlers()}},{key:"_registerStoreHandlers",value:function(t,e){var n=this;R.on($.editor.CHANGE,function(i,a){var s,o,r=a.action;switch(r.type){case $.editor.ADD_TAG:switch((s=r.data.tagContainer).tagName){case n.opts.casti[1].sloupce[0].tag:if(t.insertAdjacentHTML("beforeend",n._getRowHTML(f(s.tag),s.id)),!n.opts.letSecondCaseRunIfSame&&n.opts.casti[1].sloupce[0].tag!==n.opts.casti[1].sloupce[1].tag)break;case n.opts.casti[1].sloupce[1].tag:(o=s.tag.cloneNode(!0)).setAttribute("draggable",!0),o.addEventListener("click",n._handlerDraggable.bind(n),!1),o.addEventListener("dragstart",n._handlerDraggable.bind(n),!1),o.addEventListener("dragend",n._handlerDraggable.bind(n),!1),o.addEventListener("drag",n._handlerDraggable.bind(n),!1),e.appendChild(o)}break;case $.editor.DELETE_TAG:s=r.data.tagContainer,Array.prototype.forEach.call(document.querySelectorAll('[data-tag-id="'.concat(s.id,'"]')),function(t){C(t.parentNode,"cell-read-only")?v(t.parentNode.parentNode):v(t)})}})}},{key:"_registerHandlers",value:function(){this.$element.addEventListener("dragover",this._handlerDrop.bind(this),!1),this.$element.addEventListener("dragleave",this._handlerDrop.bind(this),!1),this.$element.addEventListener("drop",this._handlerDrop.bind(this),!1)}},{key:"_handlerDraggable",value:function(t){return"dragstart"===t.type&&(t.dataTransfer.setData("text/plain","node"),t.dataTransfer.dropEffect="",t.target.style.opacity=.5,this.activeDragged=t.target.cloneNode(!0)),"dragend"===t.type&&(t.target.style.opacity=1),!1}},{key:"_handlerDrop",value:function(t){return C(t.target,"dashboard-canvas-widget-content")&&("dragover"===t.type&&(t.preventDefault(),t.dataTransfer.dropEffect="",t.target.style.background="#eee"),"dragleave"===t.type&&(t.target.style.background="#fff"),"drop"===t.type&&(t.preventDefault(),t.target.style.background="#fff",this.activeDragged.style.opacity=1,this.activeDragged.addEventListener("click",function(t){C(t.target,"node-close")&&t.target.parentNode.remove()}),t.target.appendChild(this.activeDragged))),!1}}]),t}();B.defaults={isAdvanced:!1},B._getRowHTML=function(t){return'\n    <div class="table-row">\n      <div class="cell cell-read-only cell-border-right">'.concat(t,'</div>\n      <div class="cell dashboard-canvas-widget-content"></div>\n    </div>\n  ')},B._getAdvancedRowHTML=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return'\n    <div class="table-row">\n      <div class="cell cell-read-only cell-border-right">'.concat(t,'</div>\n      <div class="cell dashboard-canvas-widget-content cell-border-right"></div>\n      <div class="cell table-input">\n        <input id="table-akteri-vztahy-input-').concat(e,'" data-input-target="" data-save="value" type="text" placeholder="Vztah aktérů…" tabindex="-1">\n      </div>\n    </div>\n  ')};var H=new(function(t){function n(){var t;return e(this,n),(t=d(this,o(n).call(this)))._data={},t}return s(n,N),i(n,[{key:"change",value:function(t,e,n){this._data[t]||(this._data[t]={}),this._data[t].items=e,this._data[t].itemsHTML=n,H.trigger($.keywords.CHANGE,{action:{id:$.keywords.id,type:$.keywords.CHANGE,data:{keywordsSelectionId:t,newItems:e,newItemsHTML:n}}})}},{key:"export",value:function(){return this._data}}]),n}()),O=function(){function t(n,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e(this,t),this.id=n,this.$element=i,this.opts=Object.assign({},t.defaults,a),this.$itemsContainer=this.$element.getElementsByClassName(this.opts.itemsContainerClassName)[0],this.opts.inherit&&this.opts.inherit.from.length>0?this.isInherited=!0:this.$items=this.$element.getElementsByClassName(this.opts.itemClassName)}return i(t,[{key:"init",value:function(){this.opts.import&&this.opts.import.length>0&&(this.$itemsContainer.innerHTML=t._getHTMLFromItems(this.opts.import)),H.change(this.id,t._getItemsFromHTML(this.$itemsContainer,this.opts.itemClassName),t._getItemsHTML(this.$itemsContainer)),this.isInherited&&(this.opts.inherit.onInit&&this._regenerateItemsContainerFromInherited(),this._registerStoreHandlers()),this._registerHandlers()}},{key:"_regenerateItemsContainerFromInherited",value:function(){var e=this,n="";this.opts.inherit.from.forEach(function(i){var a=document.getElementById(i).getElementsByClassName(e.opts.itemsContainerClassName)[0].innerHTML;n+=t.renameItemsIds(i,e.id,a)}),this.$itemsContainer.innerHTML=n,this.$items=this.$element.getElementsByClassName(this.opts.itemClassName),H.change(this.id,t._getItemsFromHTML(this.$itemsContainer,this.opts.itemClassName),t._getItemsHTML(this.$itemsContainer))}},{key:"_registerHandlers",value:function(){var t=this;Array.from(this.$element.getElementsByClassName(this.opts.itemClassName)).forEach(function(e){e.addEventListener("click",t._eventHandler.bind(t),!1)})}},{key:"_registerStoreHandlers",value:function(){var t=this;H.on($.keywords.CHANGE,function(e,n){var i=n.action,a=n.action.data;switch(i.type){case $.keywords.CHANGE:t.opts.inherit.from.indexOf(a.keywordsSelectionId)>-1&&(t._regenerateItemsContainerFromInherited(),t._registerHandlers())}})}},{key:"_eventHandler",value:function(e){"click"===e.type&&(E(e.target,"disabled"),H.change(this.id,t._getItemsFromHTML(this.$itemsContainer,this.opts.itemClassName),t._getItemsHTML(this.$itemsContainer)))}}]),t}();O._getItemFromDOMElement=function(t){return{class:t.className,id:t.getAttribute("id"),text:t.innerText}},O._getItemsHTML=function(t){return t.innerHTML},O._getItemsFromHTML=function(t,e){var n=t.getElementsByClassName(e),i=[];return Array.from(n).forEach(function(t){i.push(O._getItemFromDOMElement(t))}),i},O._getDOMElementFromItem=function(t){var e=document.createElement("div");return e.setAttribute("class",t.class),e.setAttribute("id",t.id),e.innerHTML=t.text,f(e)},O._getHTMLFromItems=function(t){var e="";return t.forEach(function(t){e+=O._getDOMElementFromItem(t)}),e},O.renameItemsIds=function(t,e,n){var i=new RegExp(t,"g");return n.replace(i,e)},O.defaults={itemClassName:"keyword-item",itemsContainerClassName:"keywords-selection-items-container"};var z=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this.$element=n,this.id=this.$element.getAttribute("id"),this.opts=Object.assign({},t.defaults,i),this.commandNames=JSON.parse(this.$element.getAttribute(this.opts.itemSubscribeAttributeClassName)),this.$itemsContainer=this.$element.getElementsByClassName(this.opts.itemsContainerClassName)[0]}return i(t,[{key:"init",value:function(){this._registerStoreHandlers()}},{key:"_registerStoreHandlers",value:function(){var t=this;R.on($.editor.CHANGE,function(e,n){n.action;var i=n.action.data.tagContainer;if(t.commandNames.indexOf(i.tagName)>-1){var a="";R.getTagsBy({key:"tagName",value:t.commandNames}).forEach(function(t){a+=f(t.tag)}),t.$itemsContainer.innerHTML=a}})}}]),t}();z.defaults={itemsContainerClassName:"editor-tags-placeholder-content",itemSubscribeAttributeClassName:"data-placeholder-editor-subscribe"};var q=function(){function t(n,i,a){e(this,t),this.id=n,this.$element=i,this.opts=Object.assign({},t.defaults,a),this.$items=this.$element.getElementsByClassName(this.opts.itemClass)}return i(t,[{key:"init",value:function(){this._registerHandlers()}},{key:"_registerHandlers",value:function(){var t=this;Array.from(this.$items).forEach(function(e){var n=Array.from(e.getElementsByClassName(t.opts.optionClass));n.forEach(function(e){e.addEventListener("click",function(e){var i=e.currentTarget;n.forEach(function(e){e.isSameNode(i)||x(e,t.opts.selectedClass)}),E(i,t.opts.selectedClass)},!1)})})}}]),t}();q.defaults={itemClass:"test-quiz-item",optionClass:"option",selectedClass:"selected"};var P=function(){function t(n,i,a){e(this,t),this.id=n,this.$target=i,this.opts=Object.assign({},t.defaults,a),this.rowIndex=0,this.$tableResultBody=this.$target.getElementsByClassName("table-body")[0],this.dataSettings=this.opts.data}return i(t,[{key:"init",value:function(){"store"===this.dataSettings.source&&this._registerStoreHandlers()}},{key:"_registerStoreHandlers",value:function(){var e=this;I.on(this.dataSettings.subscribe.join(" "),function(n,i){var a=i.action,s=i.data;switch(console.info("data",s),a.type){case $[n].ADD:e.$tableResultBody.insertAdjacentHTML("beforeend",t._getRowHTML(s));break;case $[n].DELETE:v(document.getElementById("".concat(s.id,"_table")))}})}}]),t}();P.defaults={},P._getRowHTML=function(t){return'\n    <div class="table-row" id="'.concat(t.id,'_table">\n      <div class="cell">').concat(t.data.text,'</div>\n      <div class="cell">').concat(t.data.vyraz,'</div>\n      <div class="cell">\n        <select id="').concat(t.id,'-select-osoba" name="osoba" data-save="value">\n          <option>Vyberte osobu</option>\n          <option>já</option>\n          <option>ty</option>\n          <option>on/ona/ono</option>\n          <option>my</option>\n          <option>vy</option>\n          <option>oni/ony/ona</option>\n          <option>infinitiv</option>\n        </select>\n      </div>\n      <div class="cell">\n        <select id="').concat(t.id,'-select-zpusob" name="zpusob" data-save="value">\n          <option>Vyberte způsob</option>\n          <option>oznamovací</option>\n          <option>podmiňovací</option>\n          <option>rozkazovací</option>\n          <option id="select-zpusob-infinitiv">infinitiv</option>\n        </select>\n      </div>\n    </div>\n  ')};var G=function(t){function n(t){var i;return e(this,n),(i=d(this,o(n).call(this,t))).$fullscreen=document.querySelector('[data-fullscreen="target"]'),i.$fullscreenImage=i.$fullscreen.querySelector('[data-fullscreen="image"]'),i}return s(n,u),n}(),F=function(t){function n(t){var i;return e(this,n),(i=d(this,o(n).call(this,t))).imageSrc=i.target.nextElementSibling.src,i.target.addEventListener("click",function(t){i.$fullscreenImage.style.backgroundImage="url('".concat(i.imageSrc,"')"),i.$fullscreen.classList.toggle("hidden"),t.preventDefault()}),i}return s(n,G),n}();document.addEventListener("DOMContentLoaded",function(){console.log("domLoad:components")},!1),window.addEventListener("load",function(){console.log("windowLoad:components");var t=document.querySelectorAll('[data-fullscreen="toggle"]');t.length>0&&Array.from(t).forEach(function(t){new F(t)});var e=document.querySelectorAll("[data-editor]");e.length>0&&Array.from(e).forEach(function(t){new D(t)});var n=document.querySelectorAll("[data-target-test-quiz]");n.length>0&&Array.from(n).forEach(function(t){var e=document.querySelector('[data-test-quiz-id-reference="'.concat(t.getAttribute("data-test-quiz-id"),'"]'));new q(t.getAttribute("data-test-quiz-id"),t,JSON.parse(e.getAttribute("data-module-settings"))).init()});var i=document.querySelectorAll("[data-target-analytical-table]");i.length>0&&Array.from(i).forEach(function(t){var e=document.querySelector('[data-analytical-table-id-reference="'.concat(t.getAttribute("data-analytical-table-id"),'"]'));new B(t.getAttribute("data-analytical-table-id"),t,JSON.parse(e.getAttribute("data-module-settings"))).init()});var a=document.querySelectorAll("[data-target-generic-table]");a.length>0&&Array.from(a).forEach(function(t){var e=document.querySelector('[data-generic-table-id-reference="'.concat(t.getAttribute("data-generic-table-id"),'"]'));new P(t.getAttribute("data-generic-table-id"),t,JSON.parse(e.getAttribute("data-module-settings"))).init()});var s=document.querySelectorAll("[data-lupa-target]");if(s.length>0)for(var o=0;o<s.length;o+=1)new h(s[o]);var r=document.querySelectorAll("[data-photo-detail-target]");if(r.length>0)for(var l=0;l<r.length;l+=1)new A(r[l]);var d=document.querySelectorAll("[data-svg-target]");if(d.length>0){var c=document.querySelector("[data-radial-menu]");c&&new M(c,d);for(var u=0;u<d.length;u+=1)new L(d[u])}var g=document.querySelectorAll("[data-sortable-target]");if(g.length>0)for(var m=0;m<g.length;m+=1)new w(g[m]);var v=document.querySelectorAll("[data-keywords-selection]");v.length>0&&Array.from(v).forEach(function(t){var e=t.hasAttribute("data-module-settings")?t.getAttribute("data-module-settings"):{};new O(t.getAttribute("id"),t,JSON.parse(e)).init()});var f=document.querySelectorAll(".editor-tags-placeholder");f.length>0&&Array.from(f).forEach(function(t){var e=new z(t);console.log(e),e.init()})},!1)}();
//# sourceMappingURL=components.build.js.map
